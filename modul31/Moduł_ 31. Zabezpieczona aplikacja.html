<!DOCTYPE html>
<!-- saved from url=(0051)https://kodilla.com/pl/bootcamp-module/407/280/5935 -->
<html lang="pl" class=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="ahrefs-site-verification" content="c2d3c04b9f125c5b8c98d89f738d343f69d841f035150344a932150235c5639a">
    
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="csrf-token" content="RtYZFGj83q4iSrSPWWX0bG3bzYwVu4VNaOaoyGGq">

<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="https://kodilla.com/static/img/icons/apple-touch-icon-60x60.png?00000">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://kodilla.com/static/img/icons/apple-touch-icon-76x76.png?00000">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://kodilla.com/static/img/icons/apple-touch-icon-120x120.png?00000">
<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://kodilla.com/static/img/icons/apple-touch-icon-152x152.png?00000">
<link rel="icon" type="image/png" sizes="32x32" href="https://kodilla.com/static/img/icons/favicon-32x32.png?00000">
<link rel="icon" type="image/png" sizes="96x96" href="https://kodilla.com/static/img/icons/favicon-96x96.png?00000">
<link rel="icon" type="image/png" sizes="16x16" href="https://kodilla.com/static/img/icons/favicon-16x16.png?00000">

    <link rel="canonical" href="https://kodilla.com/pl/bootcamp-module/407/280/5935">

    <meta name="robots" content="noindex, follow">
    <title>    Moduł: 31. Zabezpieczona aplikacja
</title>
        <script type="text/javascript" src="./Moduł_ 31. Zabezpieczona aplikacja_files/saved_resource"></script><script type="text/javascript" async="" src="./Moduł_ 31. Zabezpieczona aplikacja_files/js"></script><script type="text/javascript" async="" id="inspsync" src="./Moduł_ 31. Zabezpieczona aplikacja_files/inspectlet.js"></script><script type="text/javascript" async="" src="./Moduł_ 31. Zabezpieczona aplikacja_files/saved_resource(1)"></script><script async="" src="./Moduł_ 31. Zabezpieczona aplikacja_files/tfa.js" id="tb_tfa_script"></script><script type="text/javascript" async="" src="./Moduł_ 31. Zabezpieczona aplikacja_files/insight.min.js"></script><script type="text/javascript" async="" src="./Moduł_ 31. Zabezpieczona aplikacja_files/analytics.js"></script><script type="text/javascript" async="" src="./Moduł_ 31. Zabezpieczona aplikacja_files/analytics.js"></script><script type="text/javascript" async="" src="./Moduł_ 31. Zabezpieczona aplikacja_files/js(1)"></script><script async="" src="./Moduł_ 31. Zabezpieczona aplikacja_files/gtm.js"></script><script src="./Moduł_ 31. Zabezpieczona aplikacja_files/389137334769464" async=""></script><script async="" src="./Moduł_ 31. Zabezpieczona aplikacja_files/fbevents.js"></script><script src="./Moduł_ 31. Zabezpieczona aplikacja_files/sdk.js" async="" crossorigin="anonymous"></script><script id="facebook-jssdk" src="./Moduł_ 31. Zabezpieczona aplikacja_files/sdk(1).js"></script><script src="./Moduł_ 31. Zabezpieczona aplikacja_files/diffuser.js" async=""></script><script>document.documentElement.classList.remove("no-js")</script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/yall.min.js"></script>
<link rel="stylesheet" href="./Moduł_ 31. Zabezpieczona aplikacja_files/bootstrap.min.css" as="style" onload="this.rel=&#39;stylesheet&#39;">
<link href="./Moduł_ 31. Zabezpieczona aplikacja_files/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="./Moduł_ 31. Zabezpieczona aplikacja_files/main-b3cf79332c.css" as="style" onload="this.rel=&#39;stylesheet&#39;">
            
    <link href="./Moduł_ 31. Zabezpieczona aplikacja_files/prism.min.css" rel="stylesheet">

    <link href="./Moduł_ 31. Zabezpieczona aplikacja_files/bootcamp-6d0888d826.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="./Moduł_ 31. Zabezpieczona aplikacja_files/perfect-scrollbar.css">
    <link rel="stylesheet" href="./Moduł_ 31. Zabezpieczona aplikacja_files/jquery.fancybox.min.css" type="text/css" media="screen">
    <link href="https://kodilla.com/static/css/libs/bootstrap-datetimepicker.min.css?00000">
    <link rel="stylesheet" href="./Moduł_ 31. Zabezpieczona aplikacja_files/content.css">

<script async="" src="./Moduł_ 31. Zabezpieczona aplikacja_files/hotjar-2404285.js"></script><script src="./Moduł_ 31. Zabezpieczona aplikacja_files/OneSignalPageSDKES6.js" async=""></script><style type="text/css">.fancybox-margin{margin-right:15px;}</style><script async="" src="./Moduł_ 31. Zabezpieczona aplikacja_files/modules.2ec2062e86adda67b2fe.js" charset="utf-8"></script><style type="text/css">iframe#_hjRemoteVarsFrame {display: none !important; width: 1px !important; height: 1px !important; opacity: 0 !important; pointer-events: none !important;}</style><link href="./Moduł_ 31. Zabezpieczona aplikacja_files/esw.min.css" type="text/css" rel="stylesheet"><style id="inert-style">
[inert] {
	pointer-events: none;
	cursor: default;
}

[inert], [inert] * {
	user-select: none;
	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
}
</style><script type="text/javascript" charset="utf-8" src="./Moduł_ 31. Zabezpieczona aplikacja_files/saved_resource(2)" async=""></script><style type="text/css" data-fbcssmodules="css:fb.css.base css:fb.css.dialog css:fb.css.iframewidget css:fb.css.customer_chat_plugin_iframe">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_dialog_advanced{border-radius:8px;padding:10px}.fb_dialog_content{background:#fff;color:#373737}.fb_dialog_close_icon{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{left:5px;right:auto;top:5px}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent}.fb_dialog_close_icon:active{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #365899;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{height:100%;left:0;margin:0;overflow:visible;position:absolute;top:-10000px;transform:none;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{background:none;height:auto;min-height:initial;min-width:initial;width:auto}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{clear:both;color:#fff;display:block;font-size:18px;padding-top:20px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .4);bottom:0;left:0;min-height:100%;position:absolute;right:0;top:0;width:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_mobile .fb_dialog_iframe{position:sticky;top:0}.fb_dialog_content .dialog_header{background:linear-gradient(from(#738aba), to(#2c4987));border-bottom:1px solid;border-color:#043b87;box-shadow:white 0 1px 1px -1px inset;color:#fff;font:bold 14px Helvetica, sans-serif;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:linear-gradient(from(#4267B2), to(#2a4887));background-clip:padding-box;border:1px solid #29487d;border-radius:3px;display:inline-block;line-height:18px;margin-top:3px;max-width:85px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{background:none;border:none;color:#fff;font:bold 12px Helvetica, sans-serif;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #4a4a4a;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f5f6f7;border:1px solid #4a4a4a;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://static.xx.fbcdn.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);background-position:50% 50%;background-repeat:no-repeat;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}
.fb_mpn_mobile_landing_page_slide_out{animation-duration:200ms;animation-name:fb_mpn_landing_page_slide_out;transition-timing-function:ease-in}.fb_mpn_mobile_landing_page_slide_out_from_left{animation-duration:200ms;animation-name:fb_mpn_landing_page_slide_out_from_left;transition-timing-function:ease-in}.fb_mpn_mobile_landing_page_slide_up{animation-duration:500ms;animation-name:fb_mpn_landing_page_slide_up;transition-timing-function:ease-in}.fb_mpn_mobile_bounce_in{animation-duration:300ms;animation-name:fb_mpn_bounce_in;transition-timing-function:ease-in}.fb_mpn_mobile_bounce_out{animation-duration:300ms;animation-name:fb_mpn_bounce_out;transition-timing-function:ease-in}.fb_mpn_mobile_bounce_out_v2{animation-duration:300ms;animation-name:fb_mpn_fade_out;transition-timing-function:ease-in}.fb_customer_chat_bounce_in_v2{animation-duration:300ms;animation-name:fb_bounce_in_v2;transition-timing-function:ease-in}.fb_customer_chat_bounce_in_from_left{animation-duration:300ms;animation-name:fb_bounce_in_from_left;transition-timing-function:ease-in}.fb_customer_chat_bounce_out_v2{animation-duration:300ms;animation-name:fb_bounce_out_v2;transition-timing-function:ease-in}.fb_customer_chat_bounce_out_from_left{animation-duration:300ms;animation-name:fb_bounce_out_from_left;transition-timing-function:ease-in}.fb_customer_chat_bubble_animated_no_badge{box-shadow:0 3px 12px rgba(0, 0, 0, .15);transition:box-shadow 150ms linear}.fb_customer_chat_bubble_animated_no_badge:hover{box-shadow:0 5px 24px rgba(0, 0, 0, .3)}.fb_customer_chat_bubble_animated_with_badge{box-shadow:-5px 4px 14px rgba(0, 0, 0, .15);transition:box-shadow 150ms linear}.fb_customer_chat_bubble_animated_with_badge:hover{box-shadow:-5px 8px 24px rgba(0, 0, 0, .2)}.fb_invisible_flow{display:inherit;height:0;overflow-x:hidden;width:0}.fb_new_ui_mobile_overlay_active{overflow:hidden}@keyframes fb_mpn_landing_page_slide_in{0%{border-radius:50%;margin:0 24px;width:60px}40%{border-radius:18px}100%{margin:0 12px;width:100% - 24px}}@keyframes fb_mpn_landing_page_slide_in_from_left{0%{border-radius:50%;left:12px;margin:0 24px;width:60px}40%{border-radius:18px}100%{left:12px;margin:0 12px;width:100% - 24px}}@keyframes fb_mpn_landing_page_slide_out{0%{margin:0 12px;width:100% - 24px}60%{border-radius:18px}100%{border-radius:50%;margin:0 24px;width:60px}}@keyframes fb_mpn_landing_page_slide_out_from_left{0%{left:12px;width:100% - 24px}60%{border-radius:18px}100%{border-radius:50%;left:12px;width:60px}}@keyframes fb_mpn_landing_page_slide_up{0%{bottom:0;opacity:0}100%{bottom:24px;opacity:1}}@keyframes fb_mpn_bounce_in{0%{opacity:.5;top:100%}100%{opacity:1;top:0}}@keyframes fb_mpn_fade_out{0%{bottom:30px;opacity:1}100%{bottom:0;opacity:0}}@keyframes fb_mpn_bounce_out{0%{opacity:1;top:0}100%{opacity:.5;top:100%}}@keyframes fb_bounce_in_v2{0%{opacity:0;transform:scale(0, 0);transform-origin:bottom right}50%{transform:scale(1.03, 1.03);transform-origin:bottom right}100%{opacity:1;transform:scale(1, 1);transform-origin:bottom right}}@keyframes fb_bounce_in_from_left{0%{opacity:0;transform:scale(0, 0);transform-origin:bottom left}50%{transform:scale(1.03, 1.03);transform-origin:bottom left}100%{opacity:1;transform:scale(1, 1);transform-origin:bottom left}}@keyframes fb_bounce_out_v2{0%{opacity:1;transform:scale(1, 1);transform-origin:bottom right}100%{opacity:0;transform:scale(0, 0);transform-origin:bottom right}}@keyframes fb_bounce_out_from_left{0%{opacity:1;transform:scale(1, 1);transform-origin:bottom left}100%{opacity:0;transform:scale(0, 0);transform-origin:bottom left}}@keyframes fb_bounce_out_v2_mobile_chat_started{0%{opacity:1;top:0}100%{opacity:0;top:20px}}@keyframes fb_customer_chat_bubble_bounce_in_animation{0%{bottom:6pt;opacity:0;transform:scale(0, 0);transform-origin:center}70%{bottom:18pt;opacity:1;transform:scale(1.2, 1.2)}100%{transform:scale(1, 1)}}@keyframes slideInFromBottom{0%{opacity:.1;transform:translateY(100%)}100%{opacity:1;transform:translateY(0)}}@keyframes slideInFromBottomDelay{0%{opacity:0;transform:translateY(100%)}97%{opacity:0;transform:translateY(100%)}100%{opacity:1;transform:translateY(0)}}</style><script type="text/javascript" charset="utf-8" src="./Moduł_ 31. Zabezpieczona aplikacja_files/t_prism_sitemessages.php" async=""></script></head>
<body class="student callus-enabled" cz-shortcut-listen="true">
<!-- Facebook Pixel Code -->
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=389137334769464&ev=PageView&noscript=1"/></noscript>
<!-- End Facebook Pixel Code -->
<script>
    document.getElementsByTagName('body')[0].classList.remove('no-js');
    if ( window.isDifferentZone ) {
        document.querySelector('body').classList.add('time-conversion-applied');
    }
    if ( window.hasWrongTime ) {
        document.querySelector('body').classList.add('wrong-hour');
    }
</script>

    <nav class="navbar-main hidden-sm-down dark navbar">
    <div class="nav-container">
        <div class="navbar-header clearfix">
            <button class="navbar-toggler hidden-md-up pull-right" type="button" data-toggle="collapse" data-target="#collapsingNavbarUpper"><i class="fa fa-bars"></i></button>
        </div>
        <div class="collapse navbar-toggleable-sm container" id="collapsingNavbarUpper">
            <ul class="nav navbar-nav navbar-nav-left">
                                    <li class="nav-item nav-contact">
    <span>Skontaktuj się z nami:</span>
    <a href="mailto:support@kodilla.com">
        <i class="fa fa-envelope-o"></i>
        support@kodilla.com
    </a>
    <span>lub</span>
    <a href="javascript:openChat();">
        <i class="fa fa-comments"></i>
        porozmawiaj na czacie
    </a>
</li>
                                </ul>
            <ul class="nav navbar-nav pull-right">
                                <li class="nav-item">
                    <a href="https://kodilla.com/pl/informator" class="nav-link" target="_blank">
        Informator
    </a>
                </li>
                <li class="nav-item hidden-sm-down">
    <a href="https://kodilla.com/pl/account" class="nav-link">Konto</a>
</li>
        <li class="nav-item">
    <a class="analytics-track nav-link nav-link-accent" data-event="account_logout" href="https://kodilla.com/pl/sign-out">Wyloguj</a>
</li>
                            </ul>
        </div>
    </div>
</nav>
<nav class="navbar-main light navbar">
    <div class="container clearfix">
        <a class="navbar-brand" href="https://kodilla.com/pl">
            <img src="./Moduł_ 31. Zabezpieczona aplikacja_files/kodilla-nav-logo.svg" alt="Kodilla - szkoła programowania">
        </a>
        <span class="contact-us-button-container"></span>
        <button class="navbar-toggler pull-right collapsed" type="button" data-toggle="collapse" data-target="#navbar-main">
            <i class="fa fa-bars navbar-ico-open"></i>
            <i class="fa fa-times navbar-ico-close"></i>
        </button>
        <ul id="navbar-main" class="nav navbar-nav pull-right collapse">
            <li class="nav-item hidden-sm-down">
    <a class="dropdown-toggle nav-link" href="https://kodilla.com/pl/poznaj-nasze-bootcampy">
        Szkolenia Bootcamp
    </a>
    <ul class="bootcamp-list">
                    <li class="list-sub list-sub-fe">
                <img src="./Moduł_ 31. Zabezpieczona aplikacja_files/menu_fer.svg" class="menu-svg" width="32px" height="32px" title="menu_fer_logo">
                <a href="https://kodilla.com/pl/bootcamp/front-end">
                    <h4 class="bootcamp-name">Front-end: React</h4>
                    <p>Naucz się tworzyć front-end aplikacji w 4 miesiące</p>
                </a>
            </li>
            <li class="list-sub">
                <img src="./Moduł_ 31. Zabezpieczona aplikacja_files/menu_wd.svg" class="menu-svg" width="32px" height="32px" title="menu_wd_logo">
                <a href="https://kodilla.com/pl/bootcamp/webdeveloper?type=wdp">
                    <h4 class="bootcamp-name">Web Developer</h4>
                    <p>Naucz&nbsp;się tworzyć aplikacje internetowe od&nbsp;podstaw</p>
                    <span class="bootcamp-label">FRONT-END i BACK-END</span>
                </a>
            </li>

            <li class="list-sub">
                <img src="./Moduł_ 31. Zabezpieczona aplikacja_files/menu_java.svg" class="menu-svg" width="32px" height="32px" title="menu_java_logo">
                <a href="https://kodilla.com/pl/bootcamp/java?type=jdp">
                    <h4 class="bootcamp-name">Java Developer</h4>
                    <p>Poznaj najpopularniejszy na&nbsp;świecie język programowania od&nbsp;zera</p>
                </a>
            </li>
            <li class="list-sub">
                <img src="./Moduł_ 31. Zabezpieczona aplikacja_files/menu_python.svg" class="menu-svg" width="32px" height="32px" title="menu_python_logo">
                <a href="https://kodilla.com/pl/bootcamp/python">
                    <h4 class="bootcamp-name">Python Developer</h4>
                    <p>Zdobądź kompetencje do tworzenia rozwiązań webowych</p>
                </a>
            </li>
            <li class="list-sub">
                <img src="./Moduł_ 31. Zabezpieczona aplikacja_files/menu_tester.svg" class="menu-svg" width="32px" height="32px" title="menu_tester_logo">
                <a href="https://kodilla.com/pl/bootcamp/tester-automatyzujacy">
                    <h4 class="bootcamp-name">Tester Automatyzujący</h4>
                    <p>Poznaj podstawy testowania automatycznego w Javie</p>
                </a>
            </li>
            <li class="list-sub">
                <img src="./Moduł_ 31. Zabezpieczona aplikacja_files/menu_game.svg" class="menu-svg" width="32px" height="32px" title="menu_mage_logo">
                <a href="https://kodilla.com/pl/bootcamp/game-dev">
                    <h4 class="bootcamp-name">Mobile Game Developer</h4>
                    <p>Zdobądź kompetencje do tworzenia gier</p>
                    <span class="bootcamp-label">nowość</span>
                </a>
            </li>
            </ul>
</li>

                        <li class="nav-item hidden-sm-down">
    <a class="dropdown-toggle nav-link" href="https://kodilla.com/pl/szkolenia-pro">
        Szkolenia Pro
    </a>
    <ul>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/mikroserwisy" class="nav-link">Mikroserwisy w Javie</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/spring-hibernate" class="nav-link">Spring i Hibernate</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/wielowatkowosc" class="nav-link">Wielowątkowość w Javie</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/django" class="nav-link">Aplikacje webowe z Django</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/wizualizacja-danych" class="nav-link">Analiza danych w Pythonie</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/machine-learning" class="nav-link">Podstawy Machine Learning</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/bigdata-pyspark" class="nav-link">Big Data z PySpark</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/automatyzacja-testow" class="nav-link">Automatyzacja testów</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/vanilla-js" class="nav-link">Advanced Vanilla JS</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/typescript" class="nav-link">TypeScript - kurs praktyczny</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/vue3" class="nav-link">Vue3 - kompletny przewodnik</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/zaawansowany-backend" class="nav-link">Backend zaawansowany</a></li>
    </ul>
</li>
            <li class="nav-item hidden-sm-down">
    <a class="dropdown-toggle nav-link">
        Strefa kursanta
    </a>
    <ul>
                    <li><a href="https://kodilla.com/pl/bootcamp-dashboard/407" class="nav-link">Bootcamp WD PLUS 2020-12</a></li>
                    <li><a class="nav-link" href="https://kodilla.com/pl/kursy">Samodzielne kursy</a></li>
                    <li><a class="nav-link" href="https://chat.kodilla.com/" target="_blank">Komunikator</a></li>
                    <li><a class="nav-link" href="https://kodilla.com/pl/projects">Moje projekty</a></li>
    </ul>
</li>
                            <li class="nav-item hidden-sm-down">
    <a class="dropdown-toggle nav-link">
        O nas
    </a>
    <ul class="about-us">
        <li><a href="https://kodilla.com/pl/mentorzy" class="nav-link">Mentorzy</a></li>
        <li><a href="https://kodilla.com/pl/zespol" class="nav-link">Zespół Kodilli</a></li>
        <li><a href="https://kodilla.com/pl/o-nas" class="nav-link">O firmie</a></li>
    </ul>
</li>
                                                                    <li class="nav-item hidden-md-up nav-group">
    <span class="mobile-menu-separator">Szkolenia Bootcamp</span>
    <ul>
                    <li class="nav-item list-sub-fe">
                <a class="nav-link nav-link-with-label" href="https://kodilla.com/pl/bootcamp/front-end">Bootcamp Front-end: React
                </a>
            </li>
                <li class="nav-item">
            <a class="nav-link nav-link-with-label" href="https://kodilla.com/pl/bootcamp/webdeveloper">Bootcamp Web Developer
                <span class="bootcamp-label">FRONT-END i BACK-END</span>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="https://kodilla.com/pl/bootcamp/java">Bootcamp Java</a>
        </li>
        <li class="nav-item list-sub-fe">
            <a class="nav-link nav-link-with-label" href="https://kodilla.com/pl/bootcamp/tester-automatyzuj%C4%85cy">Bootcamp Tester Automatyzujący
            </a>
        </li>
        <li class="nav-item list-sub-fe">
            <a class="nav-link nav-link-with-label" href="https://kodilla.com/pl/bootcamp/python">Python Developer
            </a>
        </li>
        <li class="nav-item list-sub-fe">
            <a class="nav-link nav-link-with-label" href="https://kodilla.com/pl/bootcamp/game-dev">Mobile Game Developer
                <span class="bootcamp-label">nowość</span>
            </a>
        </li>
    </ul>
</li>
<li class="nav-item hidden-md-up nav-group">
    <a class="nav-link-bold" href="https://kodilla.com/pl/szkolenia-pro">Szkolenia Pro</a>
</li>
            <li class="nav-item hidden-md-up nav-group">
            <span class="mobile-menu-separator">Strefa kursanta</span>
            <ul>
                <li class="nav-item ">
                                            <a class="nav-link" href="https://kodilla.com/pl/bootcamp-dashboard/407">
                            Bootcamp   WD PLUS 2020-12
                        </a>
                                    </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://kodilla.com/pl/kursy">Samodzielne kursy</a>
                </li>
                                    <li class="nav-item ">
                        <a class="nav-link" href="https://chat.kodilla.com/" target="_blank">Komunikator</a>
                    </li>
                                <li class="nav-item">
                    <a class="nav-link" href="https://kodilla.com/pl/projects">Moje projekty</a>
                </li>
            </ul>
        </li>
    
        
            <li class="nav-item hidden-md-up nav-group">
            <span class="mobile-menu-separator">O nas</span>
            <ul>
                <li class="nav-item">
                    <a href="https://kodilla.com/pl/mentorzy" class="nav-link">Mentorzy</a>
                </li>
                <li class="nav-item">
                    <a href="https://kodilla.com/pl/zespol" class="nav-link">Zespół Kodilli</a>
                </li>
                <li class="nav-item">
                    <a href="https://kodilla.com/pl/o-nas" class="nav-link">O firmie</a>
                </li>
            </ul>
        </li>
    
<li class="nav-item hidden-md-up nav-group">
    <span class="mobile-menu-separator">Pozostałe</span>
    <ul>
                                        
        <li class="nav-item">
            <a href="https://kodilla.com/pl/informator" class="nav-link" target="_blank">
        Informator
    </a>
        </li>
    </ul>

</li>

    <li class="nav-item hidden-md-up">
        <a class="nav-link" href="https://kodilla.com/pl/account">Konto</a>
    </li>
    <li class="nav-item hidden-md-up">
        <a class="nav-link analytics-track" data-event="account_logout" href="https://kodilla.com/pl/sign-out">Wyloguj</a>
    </li>

        
    <li class="nav-item hidden-md-up nav-group">
        <span class="mobile-menu-separator">Skontaktuj się z nami</span>
        <ul>
            <li class="nav-item">
                <a href="mailto:support@kodilla.com" class="nav-link">
                    <i class="fa fa-envelope-o"></i>
                    support@kodilla.com
                </a>
            </li>
            <li class="nav-item">
                <a href="javascript:openChat();" class="nav-link">
                    <i class="fa fa-comments"></i>
                    <span>Porozmawiaj na czacie</span>
                </a>
            </li>
        </ul>
    </li>
        </ul>
    </div>
</nav>
<main class="bootcamp module page-height-fix" id="bootcamp-module">
    <div class="aside-toggle hidden-md-up">
        <button class="navbar-toggler pull-left collapsed" type="button" data-toggle="collapse" data-target="#aside-sticky" aria-expanded="false">
            <i class="fa fa-bars navbar-ico-open"></i>
            <i class="fa fa-times navbar-ico-close"></i>
        </button>
    </div>
    <div class="table-of-contents aside-sticky collapsed collapse" id="aside-sticky">
        <section class="container">
            <div class="row">
                <aside class="module-nav col-md-4 col-md-offset-8">
                    <section class="card">
                        <div class="card-header">
                            <h4 class="card-title">Spis treści modułu</h4>
                        </div>
                        <ul class="list-group list-group-flush ps-container ps-theme-default ps-active-y" data-ps-id="35fb9e8b-e171-279d-7407-fa878a566a00">
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#submodule-1176" class="clearfix">
                                    <p>31.1. Dobre praktyki</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#311-dobre-praktyki-ukrywaj-wrazliwe-dane" class="clearfix">Ukrywaj wrażliwe dane</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#311-dobre-praktyki-nie-ufaj-klientowi" class="clearfix">Nie ufaj klientowi</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#311-dobre-praktyki-zawsze-waliduj-dane-rowniez-na-serwerze" class="clearfix">Zawsze waliduj dane również na serwerze</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#311-dobre-praktyki-obsluguj-potencjalne-bledy" class="clearfix">Obsługuj potencjalne błędy</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#311-dobre-praktyki-dokladnie-filtruj-wprowadzane-dane" class="clearfix">Dokładnie filtruj wprowadzane dane</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#311-dobre-praktyki-korzystaj-z-mongo-sanitize" class="clearfix">Korzystaj z Mongo-sanitize</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#311-dobre-praktyki-uwazaj-na-pakiety-zalezne" class="clearfix">Uważaj na pakiety zależne</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#311-dobre-praktyki-korzystaj-z-paczki-helmet" class="clearfix">Korzystaj z paczki Helmet</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#311-dobre-praktyki-podsumowanie" class="clearfix">Podsumowanie</a></li><li class="list-group-item list-group-flush sub task"><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#311-dobre-praktyki-zadanie-koniec-cwiczen" class="clearfix">Zadanie: koniec ćwiczeń</a></li>
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#submodule-1177" class="clearfix">
                                    <p>31.2. Neutralizacja zagrożeń</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#312-neutralizacja-zagrozen-injection" class="clearfix">Injection</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#312-neutralizacja-zagrozen-broken-authentication" class="clearfix">Broken Authentication</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#312-neutralizacja-zagrozen-sensitive-data-exposure" class="clearfix">Sensitive Data Exposure</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#312-neutralizacja-zagrozen-xml-external-entities-xxe" class="clearfix">XML External Entities (XXE)</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#312-neutralizacja-zagrozen-broken-access-control" class="clearfix">Broken Access Control</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#312-neutralizacja-zagrozen-security-misconfigurations" class="clearfix">Security Misconfigurations</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#312-neutralizacja-zagrozen-cross-site-scripting-xss" class="clearfix">Cross Site Scripting (XSS)</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#312-neutralizacja-zagrozen-insecure-deserialization" class="clearfix">Insecure Deserialization</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#312-neutralizacja-zagrozen-using-components-with-known-vulnerabilities" class="clearfix">Using Components with Known Vulnerabilities</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#312-neutralizacja-zagrozen-insufficient-logging-and-monitoring" class="clearfix">Insufficient Logging and Monitoring</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#312-neutralizacja-zagrozen-podsumowanie" class="clearfix">Podsumowanie</a></li>
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#submodule-1178" class="clearfix">
                                    <p>31.3. Autoryzacja aplikacji przy użyciu OAuth</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#313-autoryzacja-aplikacji-przy-uzyciu-oauth-wlasny-system-autoryzacji" class="clearfix">Własny system autoryzacji</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#313-autoryzacja-aplikacji-przy-uzyciu-oauth-czym-jest-protokol-oauth-20" class="clearfix">Czym jest protokół OAuth 2.0</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#313-autoryzacja-aplikacji-przy-uzyciu-oauth-dlaczego-warto-z-niego-skorzystac" class="clearfix">Dlaczego warto z niego skorzystać?</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#313-autoryzacja-aplikacji-przy-uzyciu-oauth-zasada-dzialania" class="clearfix">Zasada działania</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#313-autoryzacja-aplikacji-przy-uzyciu-oauth-krok-po-kroku" class="clearfix">Krok po kroku</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#313-autoryzacja-aplikacji-przy-uzyciu-oauth-podsumowanie" class="clearfix">Podsumowanie</a></li>
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#submodule-1179" class="clearfix">
                                    <p>31.4. OAuth i Passport w praktyce</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#314-oauth-i-passport-w-praktyce-co-zbudujemy" class="clearfix">Co zbudujemy?</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#314-oauth-i-passport-w-praktyce-zaczynamy" class="clearfix">Zaczynamy!</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#314-oauth-i-passport-w-praktyce-pobieramy-potrzebne-paczki" class="clearfix">Pobieramy potrzebne paczki</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#314-oauth-i-passport-w-praktyce-google-api-console" class="clearfix">Google API Console</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#314-oauth-i-passport-w-praktyce-przygotowujemy-serwer" class="clearfix">Przygotowujemy serwer</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#314-oauth-i-passport-w-praktyce-etap-1-przekierowujemy-uzytkownika-do-posrednika" class="clearfix">Etap 1 – przekierowujemy użytkownika do pośrednika</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#314-oauth-i-passport-w-praktyce-etap-2-autoryzacja" class="clearfix">Etap 2 – autoryzacja</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#314-oauth-i-passport-w-praktyce-etap-3-odbieramy-dane-od-posrednika" class="clearfix">Etap 3 – odbieramy dane od pośrednika</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#314-oauth-i-passport-w-praktyce-sprzatamy-w-naszym-kodzie" class="clearfix">Sprzątamy w naszym kodzie</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#314-oauth-i-passport-w-praktyce-podsumowanie" class="clearfix">Podsumowanie</a></li><li class="list-group-item list-group-flush sub task"><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#314-oauth-i-passport-w-praktyce-zadanie-praktyka-czyni-mistrza" class="clearfix">Zadanie: praktyka czyni mistrza</a></li>
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#submodule-1180" class="clearfix">
                                    <p>31.5. Po drugiej stronie barykady</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#315-po-drugiej-stronie-barykady-kogo-atakujemy" class="clearfix">Kogo atakujemy?</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#315-po-drugiej-stronie-barykady-co-chcemy-przetestowac" class="clearfix">Co chcemy przetestować?</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#315-po-drugiej-stronie-barykady-scenariusze-ataku" class="clearfix">Scenariusze ataku</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#315-po-drugiej-stronie-barykady-przygotowania-do-pracy" class="clearfix">Przygotowania do pracy</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#315-po-drugiej-stronie-barykady-zlosliwy-atak-konkurencji" class="clearfix">Złośliwy atak konkurencji</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#315-po-drugiej-stronie-barykady-nieuczciwy-uczestnik" class="clearfix">Nieuczciwy uczestnik</a></li><li class="list-group-item list-group-flush sub task"><a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#315-po-drugiej-stronie-barykady-zadanie-gotowe" class="clearfix">Zadanie: gotowe!</a></li>
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#submodule-1181" class="clearfix">
                                    <p>31.6. Podsumowanie</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li>
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#submodule-1191" class="clearfix">
                                    <p>31.7. Quiz powtórkowy</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li>
                                                    <div class="ps-scrollbar-x-rail" style="left: 0px; bottom: 3px;"><div class="ps-scrollbar-x" tabindex="0" style="left: 0px; width: 0px;"></div></div><div class="ps-scrollbar-y-rail" style="top: 0px; height: 606px; right: 3px;"><div class="ps-scrollbar-y" tabindex="0" style="top: 0px; height: 140px;"></div></div></ul>
                        <div class="card-block text-center">
                                                                                                <a href="https://kodilla.com/pl/bootcamp-dashboard/407">Powrót do dashboardu</a>
                                                                                    </div>
                    </section>
                </aside>
            </div>
        </section>
    </div>
    <section class="container module-content">
        <div class="row">
            <main class="col-md-8">
                <section class="card">
                    <div class="card-block module-header clearfix  completed ">
                        <h1 class="card-title">31. Zabezpieczona aplikacja</h1>
                                                <i class="fa fa-bookmark fa-3x" aria-hidden="true"></i>
                    </div>
                                        <div class="card-block challenge">
                        <h3>Wyzwania:</h3>
                        <ul>
<li>nauczysz się jak budować bezpieczne aplikacje,</li>
<li>poznasz sposoby ochrony przed najpopularniejszymi zagrożeniami,</li>
<li>dowiesz się, jak wykorzystać w praktyce system autoryzacji Auth0.</li>
</ul>
<p>Do tej pory uznawaliśmy, że wszyscy użytkownicy będą korzystać z naszych aplikacji poprawnie i zgodnie z założeniami, a jedynego zagrożenia spodziewaliśmy się ze strony... nas samych, na przykład w postaci błędów w kodzie.</p>
<p>Wszystkich użytkowników traktowaliśmy jako osoby, które są nastawione pozytywnie do naszej pracy i jedyną przeszkodą, którą przed nimi stawialiśmy, była przeważnie skromna walidacja formularzy. Tworzyliśmy ją jednak nie tyle w celu bronienia się przed jakąś złośliwą aktywnością, lecz bardziej przed zwykłą ludzką nieuwagą. Była to bardzo mała bariera bezpieczeństwa, tymczasem świat nie jest aż tak kolorowy.</p>
<p>Budując aplikację, <strong>musimy założyć, że przez cały czas będzie ona narażona na ataki hakerów, ale także nadużycia ze strony szeregowych odbiorców</strong>. Niebezpieczeństwo ze strony tej pierwszej grupy wydaje się oczywistością, ale jakim zagrożeniem są inni użytkownicy? Musisz wiedzieć, że próby "oszukania systemu" są dość nagminne, zwłaszcza w branży e-commerce. Istnieje grono użytkowników, które liczy np. na błędy przy naliczaniu rabatów albo ilości elementów. Możesz spodziewać się, że w przypadku posiadania sklepu internetowego, znajdzie się przynajmniej kilka osób, które będą próbowały korzystać z Twojej witryny w taki sposób, aby znaleźć jakąś lukę. Dlatego przy budowaniu aplikacji musimy być naprawdę uważni. Nie możemy liczyć, że wszyscy będą zachowywali się zgodnie z naszym planem. <strong>Bezpieczna aplikacja to taka, w której autor zakłada właśnie odwrotny scenariusz – taki, iż każdy chce znaleźć lukę w naszym systemie</strong>. Dopiero takie podejście, a następnie odpowiednia ochrona, może dać nam chociaż namiastkę bezpieczeństwa.</p>
<p>Właśnie tym zajmiemy się w niniejszym module. Opowiemy, czego należy się wystrzegać, jakie zagrożenia mogą na nas czyhać ze strony hakerów i jak się przed nimi bronić.</p>

                    </div>
                                    </section>
                                    
                <section id="submodule-1176" class="card submodule completed" data-bootcamp-user-submodule-id="670841">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">31.1. <span>Dobre praktyki</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Zanim zajmiemy się tematem obrony przed hakerami, postaramy się ugryźć temat od trochę łatwiejszej strony – jakie są dobre praktyki przy pisaniu aplikacji webowych?</p>
<p>Oczywiście nie poruszymy tu wszystkich możliwych kwestii. Bezpieczeństwo aplikacji jest tak szerokim tematem, że jeden moduł, a tym bardziej submoduł, to zdecydowanie za mało, aby przedstawić Ci wszystko. Niemniej jednak postaramy się zaprezentować najbardziej podstawowe zagadnienia, które powinny wystarczyć, by obronić się przynajmniej przed wścibskimi użytkownikami.</p>
<h3 id="311-dobre-praktyki-ukrywaj-wrazliwe-dane">Ukrywaj wrażliwe dane</h3>
<p>Może wydawać Ci się to oczywiste i nie do końca rozumiesz, dlaczego musimy o tym mówić. Z prostego powodu. Hasła do naszych kont są na tyle istotne, że powinniśmy ich strzec tak mocno, jak to możliwe. Czy jednak faktycznie zawsze to robiliśmy?</p>
<p>Wróćmy na chwilę do naszego przykładu z festiwalem muzycznym. W pewnym momencie łączyliśmy się ze zdalną bazą danych i wpisywaliśmy w Connection String login oraz hasło użytkownika,  aby umożliwić komunikację. Dane te były zapisane w kodzie. Czy aby na pewno jest to bezpieczne? W teorii serwer to miejsce, do którego zwykły użytkownik nie ma dostępu, nie zapomnij jednak, że cały nasz projekt wrzucaliśmy na GitHub. Tam każdy może podejrzeć nie tylko kod klienta, ale także serwera, czyli również... nasze hasło.</p>
<p>Oczywiście możesz powiedzieć, że to tylko aplikacja testowa, więc nie ma to znaczenia. Jednak, czy aby na pewno nie zdarzyło Ci się już użyć gdzieś tego hasła? Hakerzy dobrze wiedzą, że większość internautów korzysta często z dokładnie takiej samej kombinacji znaków. Możesz więc narazić się na to, że ktoś będzie próbował wykorzystać znalezione dane logowania np. na Facebooku albo poczcie internetowej. Możliwy jest jeszcze gorszy scenariusz, bo co jeśli nie zmienisz hasła przed wypuszczeniem aplikacji w świat? Nawet jeśli uczynisz od tego momentu repo prywatnym, nie masz gwarancji, że ktoś już wcześniej nie zapisał tych danych. Takie zaniedbanie mogłoby Cię sporo kosztować.</p>
<p>Może wyjściem jest po prostu ukrywanie repo? W końcu GitHub zezwala na darmową opcję <em>private</em>. Problem jest jednak taki, że często chcemy nasz kod pokazywać, np. aby rekruter mógł zobaczyć, jak sprawnie poruszamy się w Node.js czy MongoDB. Jak sobie z tym poradzić?</p>
<p>Odpowiedź jest prosta. Kod może być przechowywany na otwartym repo, jednak bez udostępniania hasła. W takich przypadkach najlepiej wrzucić aplikację na <strong>Heroku</strong>, bo w ten sposób rekruter zobaczy ją w akcji bez potrzeby kompilacji, a trzymanie hasła na GitHubie nie będzie już konieczne.</p>
<p>Możesz jednak powiedzieć, że przecież&nbsp;Heroku też opiera się na repo. Wydaje się więc, że musielibyśmy jeden kod wrzucać na ten serwis, a inny do GitHuba. Nic bardziej mylnego, bowiem Heroku oferuje <strong>mechanizm zmiennych środowiskowych</strong>. Jeśli w naszym kodzie zapiszemy, że hasło ma być brane np. z <code>env.dbpass</code>, a następnie już w samej konfiguracji Heroku nadamy tej zmiennej odpowiednią wartość, to przy kompilacji, właśnie ona będzie wykorzystywana. Tym samym w kodzie widzimy tylko nazwę zmiennej, ale już na Heroku połączenie z bazą będzie zrealizowane poprawnie, przy wykorzystaniu prawdziwego hasła czy loginu.</p>
<p>Oczywiście, mechanizm zmiennych środowiskowych, możemy też wykorzystać do innych haseł czy informacji, a nie tylko dla danych logowania do bazy.</p>
<div class="bc-note alert-warning">
<h4 class="alert-heading text-center">Uwaga!</h4>
<p>Nie zapomnij jednak, że trzymanie kodu serwera na repo, nawet bez haseł, może być ryzykowne. Jeśli Twój skrypt ma jakieś luki, to haker będzie mógł je łatwo wykryć, a następnie zaatakować opublikowaną na Heroku aplikację, tak aby np. pobrać za jej pomocą dane z bazy.</p>
<p>Pamiętaj, że <strong>publikując kod na publicznym repo</strong>, wystawiasz go na takie niebezpieczeństwo. Jeśli to tylko aplikacja testowa, do nauki, nie musisz się niczego obawiać. W przypadku poważniejszych aplikacji miej to na uwadze.</p>
</div>
<h4>Dobre hasło</h4>
<p>Ukrywanie hasła nic nie da, jeśli jest ono po prostu słabe. Pamiętaj, że hakerzy często operują wydajnym sprzętem, na którym aplikacje do łamania szyfrów działają niezwykle sprawnie.</p>
<p>Jak możemy się przed tym bronić? Po prostu staraj się, żeby Twoje hasło było w miarę długie, nieprzewidywalne oraz zawierało różnorodne znaki. To oczywiście bardzo ogólna odpowiedź. Jest to jednak minimum, którego powinniśmy się trzymać. Ciężko stworzyć dokładną listę wymagań, gdyż te często się zmieniają, np. do niedawna bardzo popularną praktyką było wymuszanie na użytkownikach cyklicznej zmiany hasła. Tymczasem firma Microsoft twierdzi, w oparciu o swoje doświadczenia, że takie podejście czyni więcej złego niż dobrego. Użytkownicy z lenistwa i tak wybierają prawie identyczne hasła, zmieniając tylko jeden z ostatnich znaków, dlatego też np. w swoich <a href="https://docs.microsoft.com/en-us/office365/admin/misc/password-policy-recommendations?view=o365-worldwide" target="_blank">nowych wytycznych dla Office 365</a> technologiczny gigant zaleca... odejście od tego pomysłu.</p>
<h5>Ćwiczenie</h5>
<p>W ramach praktyki spróbuj wykorzystać nową wiedzę. Wróć do naszej festiwalowej aplikacji i postaraj się ukryć dane logowania do bazy w zmiennych konfiguracyjnych Heroku. Możesz ustawić je w konsoli albo w panelu administracyjnym, wystarczy wejść w zakładkę opcji swojej aplikacji. Dokładną instrukcję znajdziesz <a href="https://devcenter.heroku.com/articles/config-vars#managing-config-vars" target="_blank">pod tym linkiem</a>.</p>
<p>Do zmiennych mamy dostęp w obiekcie <code>process.env</code>, więc jeśli dodasz nową np. o nazwie <code>test</code>, to Twoja aplikacja będzie miała do niej wgląd pod <code>process.env.test</code>.</p>
<p>W efekcie, przy połączeniu z bazą zdalną, aplikacja powinna korzystać ze zmiennych konfiguracyjnych i wciąż działać poprawnie. Dzięki temu na naszym repo nie będziemy musieli już przechowywać tak wrażliwych danych.</p>
<h3 id="311-dobre-praktyki-nie-ufaj-klientowi">Nie ufaj klientowi</h3>
<p>Ten podrozdział powinien nazywać się raczej – <strong>nie ufaj temu, co dostarcza Ci klient</strong>.</p>
<p>Przypuśćmy, że tworzymy panel administracyjny jakiejś aplikacji i zajmujemy się właśnie implementacją formularza do dodawania nowych użytkowników. Nie jest to nic wielkiego, załóżmy, że mamy dosłownie trzy pola – <code>login</code>, <code>password</code> i <code>role</code>. Nas najbardziej interesuje to ostatnie, które pozwala na wybranie opcji <code>user</code> albo <code>admin</code>. Nadana rola definiuje oczywiście poziom uprawnień, przy czym z panelu administracyjnego mogą korzystać zarówno użytkownicy o statusie <code>admin</code>, jak i <code>user</code>. Obie grupy mają prawo dodawać innych za pomocą naszego formularza, z tym zastrzeżeniem, że userzy mogą dołączać tylko tych, którzy mają tę samą rolę (<code>user</code>), a admini mogą dodawać również administratorów.</p>
<p>Nie będziemy wnikać, jak dokładnie zbudowany jest ten formularz. Załóżmy jednak, że korzystając z danych otrzymanych od serwera, klient zawsze wie, jaką rolę ma aktualnie zalogowany użytkownik. Na bazie tych uprawnień pozwala na wybranie jednej z ról (jeśli jesteśmy administratorem) albo z góry ustawia formularz jako <code>user</code>. Do tego mamy bardzo dokładną&nbsp;walidację i np. za krótkie hasło albo za długi login nie pozwala nawet na wysłanie formularza.</p>
<p>Skoro zakładamy, że klient połączy się z serwerem tylko wtedy, kiedy dane są dobre, to wydaje się, że ponowna walidacja na serwerze jest zbędna. Nasz endpoint mógłby więc wyglądać tak:</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> login<span class="token punctuation">,</span> password<span class="token punctuation">,</span> role <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span> login<span class="token punctuation">,</span> password<span class="token punctuation">,</span> role <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">await</span> user<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Czy to aby na pewno dobry pomysł?</p>
<p>Pamiętaj, że jeśli serwer API jest dostępny dla naszego klienta, to równie dobrze można się z nim połączyć z innego. W takiej sytuacji ktoś mógłby, nawet za pomocą Postmana, wysłać następujący request, oczywiście z pominięciem naszej aplikacji klienta:</p>
<pre class=" language-js"><code class=" language-js"><span class="token constant">POST</span> example<span class="token punctuation">.</span><span class="token property-access">com</span><span class="token operator">/</span>api<span class="token operator">/</span>user

<span class="token punctuation">{</span>
  <span class="token string">"login"</span><span class="token operator">:</span> <span class="token string">"Tooooo long login"</span><span class="token punctuation">,</span>
  <span class="token string">"password"</span><span class="token operator">:</span> <span class="token string">"123"</span><span class="token punctuation">,</span>
  <span class="token string">"role"</span><span class="token operator">:</span> <span class="token string">"admin"</span>
<span class="token punctuation">}</span></code></pre>
<p>Co by to dało atakującemu? Stworzyłby nowe konto, które miałoby uprawnienia admina, nawet jeśli sam nie miał nawet statusu użytkownika. Przy okazji złamałby jeszcze zasady co do trudności hasła i maksymalnej długości loginu, bo w końcu serwer sam już tego nie weryfikuje. Co więcej, backend nie sprawdza nawet, czy ktoś jest zalogowany.</p>
<p>Skąd atakujący wiedziałby jak ma skonstruować request? Wystarczy, że chociaż przez chwilę był użytkownikiem naszej aplikacji i zajrzał do zakładki "Network" w narzędziach developerskich.</p>
<p>Jak możemy się przed tym ustrzec? Najprostsze jest blokowanie połączenia z zewnątrz.</p>
<p>Dotychczas używaliśmy middleware <code>cors</code> przeważnie po to, by pozwalać na wszelką łączność z zewnątrz, ale możemy go wykorzystać także w przeciwnej sytuacji. Aby ograniczyć połączenia AJAX tylko do tych wysyłanych z naszej witryny, wystarczy wywołać <code>cors()</code> z odpowiednią opcją:</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  origin<span class="token operator">:</span> <span class="token string">'http://example.com'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Możemy również zezwolić na połączenia np. z dwóch albo trzech wspieranych adresów.</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">origin</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">origin<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>origin<span class="token punctuation">)</span> <span class="token keyword control-flow">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>allowedOrigins<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span>origin<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">'The CORS policy for this site does not allow external access...'</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>W taki sposób możemy zablokować kilku domorosłych hakerów, warto jednak pamiętać, że niestety nie jest to rozwiązanie idealne. Wciąż istnieje możliwość skonstruowania requestu, chociażby za pomocą funkcji <code>curl</code> w konsoli i stworzenia zapytania z ręcznie ustawionym <code>origin</code>. Tym samym bardziej wprawny atakujący może udawać, że połączenie pochodzi z tej samej witryny...</p>
<p><code>cors</code> jest więc jakimś buforem bezpieczeństwa, ale jednak da się go obejść. Rozwiązanie może być w takiej sytuacji tylko jedno – musimy sprawdzać również na serwerze, kim jest użytkownik i jakie dane wprowadza. Tutaj przechodzimy do kolejnej dobrej praktyki.</p>
<h3 id="311-dobre-praktyki-zawsze-waliduj-dane-rowniez-na-serwerze">Zawsze waliduj dane również na serwerze</h3>
<p>Przed chwilą pisaliśmy, że nie możemy ufać walidacji po stronie klienta, ponieważ użytkownik może obejść ją wysyłając requesty z innego źródła. Wiemy też, że <code>cors</code> nie da nam stuprocentowej gwarancji, że wszystkie takie próby będą zablokowane. Niemniej jednak, nawet gdyby było to możliwe i mielibyśmy pewność, że serwer przyjmowałby dane tylko od naszego własnego klienta, to i tak nie moglibyśmy czuć się bezpiecznie. Dlaczego?</p>
<p>Na tym etapie kursu wiesz już jak duże zmiany możemy wprowadzać, korzystając z narzędzi developerskich i podglądu strony, na której aktualnie jesteśmy. Co z tego, że pole tekstowe ma atrybut <code>required</code>? Możemy wejść do inspektora i to zmienić. Cóż, że jakiś <code>&lt;select&gt;</code> będzie dla nas zablokowany (<code>disabled</code>)? Jesteśmy w stanie wyłączyć ten atrybut w konsoli. Problemem nie jest nawet walidacja w JSie, bo ten kod też zmodyfikujemy "w locie". Ostatecznie możemy też po prostu wyłączyć obsługę JavaScriptu w przeglądarce.</p>
<p>Spójrz tylko na poniższy przykład:</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image1.gif" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image1.gif" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Mamy tutaj formularz, który przypomina ten wspomniany już w submodule. Zauważ, że w HTML-u ustaliliśmy, iż pola "E-mail" i "Hasło" są wymagane. Dodatkowo aktualnie zalogowany użytkownik nie ma prawa wskazać innej roli niż <code>user</code>. Pamiętamy bowiem, że w założeniu funkcję <code>admin</code> może wybrać tylko osoba, która sama jest administratorem.</p>
<p>Okazuje się jednak, że taka walidacja jest dziecinnie łatwa do ominięcia. Wystarczyło wejść do inspektora, zmienić kilka elementów i nagle formularz może zostać wysłany mimo kompletnego pogwałcenia warunków walidacji. Zauważ, że w powyższym przykładzie bez problemu wysłaliśmy go bez wypełnienia pola "E-mail" czy "Hasło", a do tego, mimo braku uprawnień, wybraliśmy rolę nowego użytkownika jako <code>admin</code>. Jak jest z tego wniosek? <strong>Nie ufaj walidacji po stronie klienta</strong>.</p>
<p>Nieważne jak bardzo wyrafinowana będzie taka kontrola, zawsze znajdzie się ktoś, kto łatwo ją wyłączy. Nigdy nie możemy wierzyć, że to, co dostajemy od klienta, faktycznie jest poprawne. Frontendową walidację traktuj raczej jako usprawnienie UX (User Experience), które ma być pomocą dla użytkownika. W końcu dzięki takiej funkcjonalności może od razu przekonać się, co robi nie tak, zamiast czekać na reakcję serwera na wysyłane dane. Pod względem bezpieczeństwa o wiele ważniejsza jest walidacja po stronie serwera. Użytkownik nie jest w stanie jej wyłączyć i co najwyżej może szukać luk, aby ją jakoś oszukać.</p>
<p>Podsumowując – <strong>walidacja po stronie klienta to tylko usprawnienie UX, zawsze weryfikuj dane również drugi raz, po stronie serwera</strong>.</p>
<p>Jak mógłby wyglądać nasz wcześniejszy przykład endpointu po modyfikacjach?</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> login<span class="token punctuation">,</span> password<span class="token punctuation">,</span> role <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>

    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>login <span class="token operator">||</span> <span class="token operator">!</span>password <span class="token operator">||</span> <span class="token operator">!</span>role<span class="token punctuation">)</span> <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Invalid data'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">userLogged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span> login<span class="token punctuation">,</span> password<span class="token punctuation">,</span> role <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">await</span> user<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Zapewne udało Ci się zauważyć, że w samym endpoincie nie sprawdzamy poprawności danych, czyli np. czy login nie jest za długi. To dlatego, że akurat takie reguły walidacji można wprowadzić w samym schemacie modelu. Robiliśmy to już w poprzednich modułach.</p>
<h3 id="311-dobre-praktyki-obsluguj-potencjalne-bledy">Obsługuj potencjalne błędy</h3>
<p>Bardzo często pracujemy przy użyciu zewnętrznych bibliotek, a te mogą mieć różne systemy powiadamiania o błędach. Niektóre "wyrzucają" po prostu <code>Error</code>, inne wypisują dokładne komunikaty (np. <code>Couldn't connect to cluster...</code>), a jeszcze inne same pozwalają nam zadecydować, jak mają zachowywać się w przypadku problemu. Różne nieprawidłowości mogą sygnalizować również niektóre z metod wbudowanych w JS-a. Wniosek jest jednak jeden – <strong>w przypadku błędu, użytkownik może zobaczyć komunikat, który niekoniecznie chcielibyśmy mu pokazywać</strong>.</p>
<p>Idea, aby informować użytkownika o błędzie oczywiście nie jest zła, niemniej jednak powinniśmy to robić w sposób dla niego zrozumiały. Często komunikaty są bardzo długie i enigmatyczne. Na przykład błąd <code>#23535, Error: Couldn\'t connect to cluster. Problem on line 5, cluster-connect.js. [ERR_WRONG_USERNAME]</code> dla nas byłby bardzo pomocy, bo dość dokładnie wskazywałby miejsce problemu, jednak czy użytkownika naprawdę to interesuje? Dla niego lepsza byłaby informacja w stylu <code>Couldn't connect to DB... Try again</code> – krótsza, ale nie zawierająca zbędnych technicznych szczegółów.</p>
<p>Inna sprawa, że komunikaty wyrzucane przez skrypty mogą też czasem ujawniać wrażliwe dane, na przykład przy łączeniu się z bazą danych: <code>Err: DB connection error. Couldn't connect with [username]=JohnDoe and [password]=admin1</code>. Taka informacja mogłaby pojawić się nawet po przypadkowym przeciążeniu serwera bazy danych, a naraziłby nas na ogromne ryzyko.</p>
<p>Podsumowując, nie chcemy, aby JS "wyrzucał" użytkownikowi domyślną treść błędów, ponieważ <strong>jest ona często niezrozumiała, a może nas narazić na wyciek wrażliwych danych</strong>.</p>
<p>Czy to oznacza, że musimy w ogóle zrezygnować z wyświetlania komunikatów użytkownikowi? Nie. Powinniśmy jednak wyłapywać błąd, który wskazuje nam dany skrypt i sami decydować, co pokażemy. Na przykład, gdy wykryjemy problem z połączeniem z bazą, to zamiast pozwolić JS-owi na wyrzucenie pełnego komunikatu, będziemy wypisywać coś sami. Taki efekt możemy osiągnąć przy użyciu bloku <code>try ... catch</code>, który jak zapewne pamiętasz, w przypadku wykrycia jakiegoś błędu, uruchamia kod umieszczony w <code>catch</code> (<em>catch</em> to z ang. łapać).</p>
<p>Podsumowując, <strong>w przypadku kodu, który może spowodować problem, powinniśmy wyłapywać potencjalne błędy, a następnie pokazywać zrozumiały dla użytkownika komunikat na ich temat</strong>. Oczywiście robimy to, o ile jest w ogóle sens o tym informować. Mogą zdarzyć się bowiem sytuacje, w których mimo problemów, aplikacja będzie działać normalnie, np. jeśli błąd pojawił się w module, który zapisuje statystki odwiedzin strony. Czy jego awaria powinna w ogóle interesować użytkownika? Raczej nie.</p>
<p>Z <code>try ... catch</code> już korzystaliśmy, ale dla przypomnienia przedstawiamy jeszcze jeden przykład.</p>
<pre class=" language-js"><code class=" language-js"><span class="token function">connectToDB</span><span class="token punctuation">(</span><span class="token string">'JohnDoe'</span><span class="token punctuation">,</span> <span class="token string">'admin1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Załóżmy, że <code>connectToDB</code> to funkcja, która stara się łączyć z bazą danych. W przypadku błędu oczywiście pokaże ona od razu jakiś komunikat i na razie nie mamy nad nim kontroli.</p>
<p>Gdybyśmy jednak skorzystali z bloku <code>try ... catch</code>, to ten błąd nie byłby od razu zwracany. Zamiast tego <code>catch</code> przyjmowałby go jako <code>err</code>, a my moglibyśmy decydować co z nim zrobić dalej – pokazać, zignorować, czy wyświetlić własny komunikat.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
  <span class="token function">connectToDB</span><span class="token punctuation">(</span><span class="token string">'JohnDoe'</span><span class="token punctuation">,</span> <span class="token string">'admin1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>albo</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
  <span class="token function">connectToDB</span><span class="token punctuation">(</span><span class="token string">'JohnDoe'</span><span class="token punctuation">,</span> <span class="token string">'admin1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Couldn\'t connect to db...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Przydatne komunikaty</h4>
<p>Dokładne komunikaty o błędach mogą być też bardzo pożyteczne. Użytkownik ich nie potrzebuje, ale my, jako twórcy kodu, często chcemy korzystać z ich pomocy. W końcu może nas to bardzo szybko prowadzić do rozwiązania. Dlatego też całkowite ich ignorowanie i wypisywanie własnych prostych komunikatów nie zawsze jest dobre.</p>
<p>Optymalnym rozwiązaniem może być pokazywanie różnych komunikatów zależnie od tego, w jaki sposób uruchomiliśmy nasz kod, opierając się np. na jakiejś zmiennej z <code>process.env</code>.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
  <span class="token function">connectToDB</span><span class="token punctuation">(</span><span class="token string">'JohnDoe'</span><span class="token punctuation">,</span> <span class="token string">'admin1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token property-access">debug</span> <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">else</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Couldn\'t connect to db...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>W powyższym kodzie ustawiliśmy wartość <code>true</code> dla zmiennej <code>debug</code>. W takim przypadku, jeśli pojawi się błąd, dostaniemy jego dokładną treść. Gdyby jednak skrypt był uruchamiany standardowo, bez <code>debug</code> ustawionego na <code>true</code>, to użytkownik przy błędzie zobaczyłby znacznie przyjaźniejszy komunikat.</p>
<p>Dzięki temu możemy w razie problemu uruchamiać nasze aplikacje w taki sposób, aby być informowanym na bieżąco o szczegółowych błędach, a sam użytkownik korzystający z "normalnej" wersji, wciąż widziałby tylko to, co dla niego zaplanowaliśmy.</p>
</div>
<h3 id="311-dobre-praktyki-dokladnie-filtruj-wprowadzane-dane">Dokładnie filtruj wprowadzane dane</h3>
<p>Często sprawdzenie samego typu danych nie wystarcza, bo np. string może być zarówno zwykłym tekstem (<code>Lorem Ipsum</code>), kodem HTML (<code>&lt;p&gt;Lorem Ipsum&lt;/p&gt;</code>), jak i wyrażeniem regularnym (<code>/^[A-Z]{3}$/)</code>). Weryfikowanie wyłącznie typu może więc przynieść opłakane skutki.</p>
<p>Aby lepiej Ci to zobrazować, postaramy się to przedstawić na przykładzie.</p>
<p>Powiedzmy, że na swojej stronie masz system komentarzy. Co istotne, chcesz aby były one prostymi wiadomościami tekstowymi, ewentualnie z pogrubieniem lub pochyleniem tekstu. Do wpisywania danych korzystasz z formularza wraz z elementem <code>&lt;textarea&gt;</code>. Sam formularz jest jednak jeszcze obsługiwany przez jakiś dodatkowy plugin, który pozwala właśnie na ustawienie pogrubienia czy też pochylenia. Po wysłaniu tego formularza Twój kod na serwerze odbiera treść komentarza, sprawdza, czy jest stringiem i jeśli tak, to dodaje go do bazy danych.</p>
<p>Kod na serwerze mógłby wyglądać mniej więcej tak:</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/comment'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> text <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>text <span class="token operator">||</span> <span class="token operator">!</span>text<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span> <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'"text" param is invalid!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> comment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Comment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      comment<span class="token punctuation">.</span><span class="token property-access">text</span> <span class="token operator">=</span> text<span class="token punctuation">;</span>
      <span class="token keyword control-flow">await</span> comment<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Something went wrong...'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Nie sprawdzamy tutaj typu bezpośrednio w endpoincie, bo jak zapewne pamiętasz, jest on ustalany w schemacie modelu. Jeśli więc typ danych byłby inny niż string, to Mongoose i tak zwróciłby nam błąd i zwyczajnie nie pozwoliłby na dodanie nowego dokumentu.</p>
<p>Oprócz tego jeden z komponentów na stronie pobiera te dane i wyświetla w następujący sposób:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> <span class="token function-variable function">comments</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> comments <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span><span class="token punctuation">{</span>comments<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">comment</span> <span class="token arrow operator">=&gt;</span> <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token punctuation">{</span>comment<span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>comment<span class="token punctuation">.</span><span class="token property-access">text</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Nic specjalnego, ma on po prostu pokazywać nasze komentarze w formie listy z elementami <code>li</code>. Oczywiście zakładamy, że w <code>comment.text</code> mogą być wykorzystywane proste tagi HTML (do pogrubiania albo pochylania tekstu). Dlatego też powinniśmy "powiedzieć" Reactowi, aby traktował atrybut <code>text</code> jako możliwy kod HTML.</p>
<pre class=" language-jsx"><code class=" language-jsx">const comments = ({ comments }) =&gt; (
  &lt;ul&gt;{comments.map(comment =&gt; &lt;li key={comment.id} dangerouslySetInnerHTML={{ __html: comment.text }}&gt;&lt;/li&gt;)}&lt;/ul&gt;
);</code></pre>
<p>I teraz, dopóki wszyscy użytkownicy będą poprawnie korzystali z naszego formularza, wszystko będzie dobrze. W naszej bazie będą zapisywać się dokumenty np. o takiej treści:</p>
<pre class=" language-js"><code class=" language-js"><span class="token operator">-</span> <span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span><span class="token maybe-class-name">Lorem</span><span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span> <span class="token maybe-class-name">Ipsum</span>
<span class="token operator">-</span> <span class="token operator">&lt;</span>em<span class="token operator">&gt;</span><span class="token maybe-class-name">Lorem</span><span class="token operator">&lt;</span><span class="token operator">/</span>em<span class="token operator">&gt;</span> <span class="token maybe-class-name">Ipsum</span>
<span class="token operator">-</span> <span class="token maybe-class-name">Lorem</span> <span class="token maybe-class-name">Ipsum</span></code></pre>
<p>A gdy będziemy je pobierać i pokazywać w HTML-u, to też zobaczymy poprawne komentarze:</p>
<ul>
<li><strong>Lorem</strong> Ipsum</li>
<li><em>Lorem</em> Ipsum</li>
<li>Lorem Ipsum</li>
</ul>
<p>Takie było założenie. Teraz jednak wyobraź sobie, że jakiś złośliwy użytkownik specjalnie wyłączył plugin do obsługi <code>textarea</code> i sam ręcznie, w inspektorze, wpisał taką treść:</p>
<pre class=" language-js"><code class=" language-js"><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span><span class="token maybe-class-name">Haha</span><span class="token punctuation">,</span> my comment is the most important<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span></code></pre>
<p>Gdyby następnie wysłał formularz do serwera, jak zareaguje na to nasz endpoint? Sprawdzi, czy <code>text</code> istnieje, czy nie jest pusty, oraz czy to w ogóle string. Mongoose uzna, że tak, więc zapisze go do bazy danych. Przez to, gdybyśmy odwiedzili po takim ataku naszą stronę, okazałoby się, że jeden z komentarzy jest nienaturalnie duży.</p>
<ul>
<li><strong>Lorem</strong> Ipsum</li>
<li><em>Lorem</em> Ipsum</li>
<li>Lorem Ipsum</li>
<li>
<h1>Haha, my comment is the most important!</h1>
</li>
</ul>
<p>Brak dokładnej walidacji i przefiltrowania otrzymanego stringu spowodował łatwą do wykorzystania lukę, która oczywiście daje znacznie większe pole do popisu. Wyobraź sobie, że atakujący dodał taki komentarz:</p>
<pre class=" language-js"><code class=" language-js"><span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token string">"background: black; width: 100%; height: 100%; position: fixed; top: 0; left: 0; color: #fff"</span><span class="token operator">&gt;</span><span class="token maybe-class-name">This</span> website has been hacked<span class="token spread operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span></code></pre>
<p>Znowu serwer przyjmie, że to string i zapisze go do bazy danych. Tymczasem, kiedy nasz klient wyrenderuje taki "komentarz", to <code>div</code>, który się pojawi, zakryje całą stronę...</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image2.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image2.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Mamy tu więc kilka wniosków. Po pierwsze słowo <code>dangerously</code> w nazwie funkcji <code>dangerouslySetInnerHTML</code> nie wzięło się znikąd. <strong>Renderując HTML pobrany z zewnątrz, powinniśmy być w stu procentach pewni, co do jego poprawności</strong>.</p>
<p>Po drugie, <strong>nawet mały błąd, czy luka w walidacji może pozwolić atakującemu na spektakularnie wyglądające "popsucie" naszej aplikacji</strong>. Zauważ, że mimo całkiem sensownej kontroli na serwerze, a więc sprawdzenia, czy dane zostały otrzymane oraz czy ich typ jest dobry, nasz bariera ochronna okazała się za słaba. To pokazuje, jak bardzo uważni musimy być podczas pisania kodu.</p>
<p>Po trzecie, już w formie podsumowania – <strong>przy walidacji danych sprawdzaj nie tylko typ, ale też jak ta wartość jest zbudowana</strong>. Jeśli mamy otrzymać np. nazwy kolorów po angielsku i mają być one pisane małą literą, to sprawdzajmy, czy wprowadzany tekst faktycznie spełnia te wymagania. Jeśli wiemy, że ma to być jedna z kilku ról, np. <code>admin</code> albo <code>user</code>, to sprawdźmy, czy to faktycznie jedna z nich. Musimy być jak najdokładniejsi. <strong>Przy tworzeniu walidacji, zakładaj z góry wszystkie możliwe złe scenariusze</strong>. Spodziewaj się, że atakujący postara się znaleźć wszelkie luki i nieścisłości.</p>
<p>Dobrze, ale jak w takim razie poradzić sobie z naszym problemem? Tego typu zagadnienia rozwiązujemy zazwyczaj przy użyciu wyrażeń regularnych.</p>
<p>W naszym przypadku mogłoby to wyglądać następująco:</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/comment'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> text <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> pattern <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(&lt;\s*(strong|em)*&gt;(([A-z]|\s)*)&lt;\s*\/\s*(strong|em)&gt;)|(([A-z]|\s|\.)*)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> textMatched <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>textMatched<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&lt;</span> text<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span> <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Invalid characters...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token spread operator">...</span></code></pre>
<p>Jak to działa?</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> pattern <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(&lt;\s*(strong|em)*&gt;(([A-z]|\s)*)&lt;\s*\/\s*(strong|em)&gt;)|(([A-z]|\s|\.)*)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Najpierw przygotowujemy odpowiedni <code>pattern</code>. Na pierwszy rzut oka może wydawać się on bardzo skomplikowany, ale jego idea jest prosta. Powinien dopasować się do tagów <code>&lt;strong&gt;&lt;/strong&gt;</code> lub <code>&lt;em&gt;&lt;/em&gt;</code>, o ile wewnątrz nich znajduje się tylko tekst albo spacje (<code>(([A-z]|\s)*)</code>). Odpowiada za to cała pierwsza część – <code>(&lt;\s*(strong|em)*&gt;(([A-z]|\s)*)&lt;\s*\/\s*(strong|em)&gt;)</code>. Oprócz tego pattern dopasuje się również do każdego pozostałego tekstu, spacji lub kropki (w końcu komentarz może być zbudowany z kilku zdań). Pamiętaj, że <code>&lt;</code> czy <code>&gt;</code> to już nie litery, więc ta część nie bierze pod uwagę żadnych tagów, odpowiada za to fragment <code>(([A-z]|\s|\.)*)</code>. Zatem pattern dopasuje się do tagów <code>&lt;strong&gt;</code> i <code>&lt;em&gt;</code> albo zwykłego tekstu.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> textMatched <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span>pattern<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>W kolejnej linijce staramy się sprawdzić, ile tekstu w <code>text</code> będzie zgodne z naszym patternem. W teorii powinniśmy liczyć na to, że od klienta otrzymamy właściwe dane, więc tak naprawdę do założeń powinien pasować cały tekst.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword control-flow">if</span><span class="token punctuation">(</span>textMatched<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">&lt;</span> text<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span> <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Invalid characters...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Na końcu sprawdzamy więc, czy <code>text</code> początkowy jest zgodny z tym, co otrzymaliśmy. Jak mówiliśmy już wcześniej, jeśli <code>text</code> był poprawny, to w teorii <code>textMatched</code> powinien być dokładnie tak sam, a więc obie dane powinny mieć identyczną długość. Jeśli nie mają, świadczy to o tym, że część tekstu musiała nie pasować do naszego patternu, więc ktoś starał się wprowadzić do naszego systemu nieprawidłowe dane. Stąd też zwracamy wtedy adekwatny komunikat.</p>
<p>Na końcu krótka symulacja.</p>
<p>Jeśli <code>text</code> byłby równy <code>&lt;strong&gt;Lorem&lt;/strong&gt; Ipsum</code>, to <code>text.match(pattern)</code> zwróciłoby nam następującą zawartość:</p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">[</span><span class="token string">'&lt;strong&gt;Lorem&lt;/strong&gt;'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'Ipsum'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>Udałoby się bowiem znaleźć trzy pasujące do patternu elementy. Po ich złączeniu (metoda <code>join</code>) otrzymalibyśmy:</p>
<pre class=" language-js"><code class=" language-js"><span class="token string">'&lt;strong&gt;Lorem&lt;/strong&gt; Ipsum'</span></code></pre>
<p>Porównując nowy "dopasowany" do patternu tekst ze starym, dowiedzielibyśmy się, że ich długość jest taka sama, a więc nie było w oryginale elementu niepasującego.</p>
<p>Gdyby jednak tekst startowy wyglądał np. tak <code>&lt;strong&gt;Lorem&lt;/strong&gt; &lt;h1&gt;Test&lt;/h1&gt;Ipsum</code>, to po próbie dopasowania w <code>textMatched</code> otrzymalibyśmy:</p>
<pre class=" language-js"><code class=" language-js"><span class="token string">'&lt;strong&gt;Lorem&lt;/strong&gt; h1Testh1Ipsum'</span></code></pre>
<p>Metoda <code>match</code> przepuściłaby same nazwy tagów (w końcu to zwykły tekst), ale to nie problem, bowiem nie dopasowałaby ani <code>&lt;</code> ani <code>&gt;</code>. Zatem <code>textMatched</code> byłby trochę inny od <code>text</code> (krótszy) i nasz serwer wyrzuciłby błąd.</p>
<p>W podobny sposób moglibyśmy testować również kompletnie inne przypadki, np. czy otrzymaliśmy od klienta tekst w formacie <code>imię nazwisko</code>. Co ciekawe, walidację z użyciem wyrażeń regularnych można "przykleić" również do samych modeli Mongoose. Wspominaliśmy o tym w poprzednich modułach. Dzięki temu nie musielibyśmy przeprowadzać tego procesu w samym endpoincie, bo mielibyśmy pewność, że Mongoose zrobi to za nas, przy próbie zapisania dokumentu do bazy.</p>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Niebezpieczny HTML</h4>
<p>Warto dodać, że najczęściej staramy się w ogóle nie zapisywać kodu HTML do bazy danych, a tylko tekst. Dlatego też samą treść najczęściej zwyczajnie się <strong>escape'uje</strong> przed dodaniem do bazy. Proces ten polega na podmianie cudzysłów, apostrofów oraz znaków <code>&amp;</code>, <code>&lt;</code> i <code>&gt;</code> na odpowiadający im zapis kodowy.</p>
<p>Poniżej przedstawiamy przykładową funkcję, która mogłaby się tym zajmować:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">function</span> <span class="token function">escape</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> html<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;amp;"</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;lt;"</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&gt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;gt;"</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">"</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;quot;"</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">'</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;#039;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Co istotne, tak skonwertowany kod jest już w pełni bezpieczny. Zapewne pamiętasz bowiem, że taki zapis (np. <code>&amp;lt;h1&amp;gt; &amp;lt;/h1&amp;gt;</code>) nie będzie odbierany przez przeglądarkę jako nagłówek <code>&lt;h1&gt;&lt;/h1&gt;</code>, tylko tekst <code>&lt;h1&gt;&lt;/h1&gt;</code>.</p>
</div>
<h3 id="311-dobre-praktyki-korzystaj-z-mongo-sanitize">Korzystaj z Mongo-sanitize</h3>
<p>Wyobraź sobie, że przygotowaliśmy następujący endpoint odpowiadający za logowanie:</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> loggedUser <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">User</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">email</span><span class="token punctuation">,</span> password<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">password</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>loggedUser<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Logged!'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Something went wrong'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Czy wszystko jest tutaj w porządku? Wydaje się, że tak. Staramy się znaleźć takiego użytkownika, którego e-mail i hasło będzie zgodne z tym, co otrzymaliśmy od klienta. Jeśli istnieje, możemy rozpocząć nową sesję. Oczywiście w naszym przykładzie tylko zwracamy komunikat o sukcesie, a w normalnej sytuacji jednak przeprowadzalibyśmy dalej proces inicjacji sesji dla tego użytkownika.</p>
<p>No dobrze, ale wracając do tematu – wydaje się, że wszystko jest w porządku. No cóż... nie jest. Wyobraź sobie, że użytkownik pomija aplikację klienta i sam generuje odpowiedni request (wiemy, że to możliwe). Jako dane w body podaje coś takiego:</p>
<pre class=" language-js"><code class=" language-js">body<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token string">"email"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">"$ne"</span><span class="token operator">:</span> <span class="token string">"123"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"password"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">"$ne"</span><span class="token operator">:</span> <span class="token string">"123"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<p>Jak zareagowałby na to nasz serwer? Skoro <code>req.body.email</code> to <code>{ "$ne": "123" }</code>, a <code>req.body.password</code> to <code>{ "$ne": "123" }</code>, w efekcie <code>findOne</code> otrzymałoby następujący warunek:</p>
<pre class=" language-js"><code class=" language-js"><span class="token maybe-class-name">User</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">"$ne"</span><span class="token operator">:</span> <span class="token string">"123"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> password<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">"$ne"</span><span class="token operator">:</span> <span class="token string">"123"</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Pewnie domyślasz się, jakie miałoby to skutki – chcemy znaleźć jeden dokument, którego <code>email</code> i <code>password</code> są inne niż <code>123</code>. Cóż... taki warunek spełnić bardzo łatwo. W końcu najprawdopodobniej żaden z użytkowników nie korzysta z hasła <code>123</code>, a już tym bardziej nie posiada takiego e-maila. Zapewne Mongoose zwróciłaby nam tu pierwszego użytkownika z kolekcji.</p>
<p>Jaki mamy efekt? Atakujący nie musiał znać loginu ani hasła żadnego z użytkowników, a udało mu się zalogować na jednego z nich. Jeśli weźmiemy pod uwagę, że bardzo często pierwszym użytkownikiem jest administrator, mamy jeszcze większy problem. Atakujący otrzymałby bowiem dostęp do konta z bardzo dużymi uprawnieniami!</p>
<h4>Użycie operatora <code>$eq</code></h4>
<p>Pierwszą linią oporu powinno być użycie operatora <code>$eq</code>.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> loggedUser <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">User</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token punctuation">{</span> $eq<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">email</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> password<span class="token operator">:</span> <span class="token punctuation">{</span> $eq<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">password</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Daje nam on gwarancję, że sprawdzimy, czy dany atrybut jest równy <strong>dokładnie temu, czego oczekujemy</strong>. Nie możemy jako wartości przekazać kolejnego operatora. Gdybyśmy więc nawet dalej pozwalali na wykonywanie requestów z takim body jak wcześniej, to otrzymany warunek</p>
<pre class=" language-js"><code class=" language-js"><span class="token maybe-class-name">User</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token string">"$ne"</span><span class="token operator">:</span> <span class="token string">"123"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> password<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string">"$ne"</span><span class="token operator">:</span> <span class="token string">"123"</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>nie byłby dla nas groźny. <code>$eq</code> po prostu nie znalazłoby elementów, których atrybut byłby równy operatorowi.</p>
<h4>Odpowiednio parsuj otrzymywane dane</h4>
<p>Pamiętaj, że w ogóle nie powinniśmy doprowadzić do sytuacji, gdzie w Twoim <code>req.body</code> są treści, które mogą być niebezpieczne. Skoro oczekujemy na dwa stringi, to sprawdźmy, czy <code>email</code> i <code>password</code> faktycznie nimi są. A jeśli tak, to ustalmy również, czy nie mają jakichś niepożądanych znaków, np. <code>$</code> czy klamerki. Podobną rzecz robiliśmy już w przypadku otrzymywania danych HTML. Dobrą praktyką jest ich escape'owanie. Warto byłoby odpowiednio parsować dane, które otrzymujemy.</p>
<p>Nie musisz jednak przygotowywać odpowiedniej funkcji od zera. Na rynku istnieje już bowiem paczka <code>mongo-sanitize</code> oferującą gotową funkcję <code>sanitize</code>. Jej zadaniem jest właśnie parsowanie wybranych danych. Działa ona w taki sposób, że pozbywa się niebezpiecznych znaków i zwraca nam wartość, której nie musimy się już obawiać i możemy spokojnie wykorzystać w dalszym kodzie.</p>
<h5>Ćwiczenie</h5>
<p>Spróbuj wykorzystać ten pakiet w naszym projekcie strony festiwalu.</p>
<p>Najpierw pobierz odpowiednią paczkę:</p>
<pre class=" language-js"><code class=" language-js">yarn add mongo<span class="token operator">-</span>sanitize@<span class="token number">1.0</span><span class="token number">.1</span></code></pre>
<p>Następnie spróbuj wykorzystać ją w jednym z endpointów typu <strong>POST</strong>. Instrukcję znajdziesz pod <a href="https://www.npmjs.com/package/mongo-sanitize" target="_blank">tym linkiem</a>.</p>
<h3 id="311-dobre-praktyki-uwazaj-na-pakiety-zalezne">Uważaj na pakiety zależne</h3>
<p>Idea korzystania w naszej pracy z zewnętrznych paczek towarzyszy nam od początku kursu. To dobra praktyka – skracamy czas produkcji, nie wymyślamy koła na nowo, a do tego niektóre z nich narzucają wykorzystywanie dobrych nawyków programistycznych. Niemniej jednak pamiętajmy, że nie każda paczka jest <em>dobra</em>. Istnieją takie, które są na rynku od lat, mają&nbsp;tylko pozytywne opinie, a do tego autorzy ciągle je wspierają i aktualizują. Trafiają się również takie, które są ich przeciwieństwem – mogą być słabo napisane, czy powodować błędy w niespodziewanych momentach. Jest jeszcze inna możliwość. Paczka sama w sobie nie jest zła, ale czas mija, nie była aktualizowana i w tej chwili stała się dziurawa i podatna na ataki. Pamiętaj, że zależności są często integralną częścią Twojej aplikacji i jeśli mają luki, Twój skrypt też nie jest w stu procentach bezpieczny.</p>
<h4>Podążaj za sprawdzonymi rozwiązaniami</h4>
<p>Staraj się&nbsp;korzystać z popularnych i cenionych paczek. Zwracaj uwagę na ilość wydań, pobrań oraz datę ostatniej aktualizacji. To bardzo ważne, aby dany pakiet był wciąż wspierany. Wtedy nawet w przypadku wykrycia luk, powinny być szybko załatane.</p>
<p>Unikaj paczek, które sam autor opisuje jako <code>deprecated</code> (przestarzałe). Nawet jeśli wydaje Ci się, że dana paczka jest idealna do Twoich potrzeb, to całkiem możliwe, że w wielu przypadkach nie będzie poprawnie współpracować z Twoim kodem. Do tego jest spora szansa, że ma jakieś luki bezpieczeństwa. Pamiętaj, że IT to niezwykle dynamiczna branża.</p>
<h4>Aktualizuj swoje pakiety zależne</h4>
<p>W razie wykrycia luk, autorzy paczek starają się je łatać. Aby Twoja aplikacja korzystała z tych zmian (fiksów), musisz je w razie potrzeby aktualizować. Niestety często posiadamy ich tak dużo, że ręcznie sprawdzanie każdej z nich byłoby dość karkołomnym zadaniem. Dobrym wyjściem może więc być skorzystanie z narzędzia o nazwie <strong>Snyk</strong>. Automatycznie sprawdza ono repozytorium GH i raportuje na temat ewentualnych niebezpieczeństw. Możesz z niego skorzystać online pod <a href="https://snyk.io/test/" target="_blank">tym linkiem</a>.</p>
<p>Istnieje też paczka <code>snyk</code> do terminala, która pozwala na sprawdzanie Twoich projektów lokalnie.</p>
<h5>Ćwiczenie</h5>
<p>Pobierz <code>snyk</code> globalnie:</p>
<pre class=" language-js"><code class=" language-js">yarn add snyk@<span class="token number">1.235</span><span class="token number">.0</span> <span class="token operator">-</span>g</code></pre>
<p>W ten sposób paczka będzie mogła być wykorzystywana w różnych projektach – wtedy, kiedy zapragniemy sprawdzić, jak wygląda sytuacja z naszymi pakietami.</p>
<p>Aby jednak korzystać z niej lokalnie, musisz jeszcze założyć konto w serwisie <a href="https://snyk.io/" target="_blank">snyk.io</a>.</p>
<p>Następnie wejdź do folderu ze swoim projektem strony festiwalu muzycznego i uruchom polecenie:</p>
<pre class=" language-js"><code class=" language-js">snyk auth</code></pre>
<p>Pozwoli Ci to zalogować się do swojego konta.</p>
<p>Następnie wpisz komendę:</p>
<pre class=" language-js"><code class=" language-js">snyk test</code></pre>
<p>Sprawdzi ona wszystkie pakiety zależne i odpowiednio zaaportuje Ci rezultat testów.</p>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Znajdź i napraw</h4>
<p>Oprócz komendy <code>snyk test</code>, w paczce istnieje również <code>snyk wizard</code>, dzięki której skorzystamy z bardziej zaawansowanej wersji narzędzia. Nie tylko wskaże ona ewentualne luki w bezpieczeństwie, ale pozwoli też na ich automatyczne rozwiązanie.</p>
</div>
<h3 id="311-dobre-praktyki-korzystaj-z-paczki-helmet">Korzystaj z paczki Helmet</h3>
<p>Oprócz powyższych dobrych praktyk standardem jest użycie paczki <code>helmet</code>. Jej zadanie polega na odpowiednim ustawieniu nagłówków HTTP, tak aby nasz serwer był mniej podatny na ataki. Opis wszystkich funkcjonalności znajdziesz na stronie <a href="https://helmetjs.github.io/" target="_blank">https://helmetjs.github.io/</a>. Potraktuj tę paczkę jako podstawę i coś, co w miarę możliwości utrudni ataki, które mogłyby wykorzystywać słabości ustawień nagłówków.</p>
<div class="bc-note alert-warning">
<h4 class="alert-heading text-center">Uwaga!</h4>
<p>Często programiści, zwłaszcza początkujący, traktują <code>helmet()</code> jako coś, co w pojedynkę obroni naszą aplikację. Nie do końca tak jest. To narzędzie, od którego warto zacząć, ale nie wystarczy, aby aplikacja była bezpieczna.</p>
<p>Przede wszystkim musimy zadbać o dobrze napisany, odporny kod, czego tyczyły się wcześniejszy podrozdziały. Pamiętaj o tym!</p>
</div>
<h5>Ćwiczenie</h5>
<p>W ramach ćwiczenie postaraj się wykorzystać <code>helmet</code> w naszej aplikacji festiwalu. Jego użycie jest bardzo proste.</p>
<p>Wystarczy pobrać tę paczkę:</p>
<pre class=" language-js"><code class=" language-js">yarn add helmet@<span class="token number">3.21</span><span class="token number">.1</span></code></pre>
<p>Następnie zaimportować i użyć jako middleware:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> helmet <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'helmet'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token spread operator">...</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">helmet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="311-dobre-praktyki-podsumowanie">Podsumowanie</h3>
<p>Czy podążanie za dobrymi praktykami z tego submodułu wystarczy? Niestety nie zawsze. Im bardziej rozbudowana i skomplikowana aplikacja, tym więcej luk może się w niej pojawić. Jeśli jej rola jest newralgiczna (np. tworzymy stronę banku), będziemy narażeni na więcej ataków, a te mogą być często niezwykle wyrafinowane. <strong>Nie jesteśmy więc w stanie przygotować się na zagrożenie w stu procentach</strong>. Nawet jeśli wydaje nam się, że wzięliśmy pod uwagę wszystko, może okazać się, że atakujący wymyśli jakiś nowy sposób, np. złamie używany przez nasz szyfr kodowania.</p>
<p>Mimo to musimy starać się <strong>maksymalnie zniwelować niebezpieczeństwo</strong>. Zabezpieczanie aplikacji to bardzo ważna sprawa, a branża ciągle się rozwija. Ważne systemy muszą być na bieżąco analizowane i w razie potrzeby korygowane, aby radzić sobie z nowymi formami ataków. Dopiero takie podejście daje nam relatywnie dużą&nbsp;gwarancję co do bezpieczeństwa.</p>

                        </div>
                    </div>
                                        <div class="card-block task-card">
                        <h3 id="311-dobre-praktyki-zadanie-koniec-cwiczen">Zadanie: <span class="task-title">koniec ćwiczeń</span></h3>
                        <div class="task-content">
                            <p>Wyślij swojemu Mentorowi link do aktualnego repo festiwalu muzycznego. Aplikacja ta powinna teraz zawierać wszystkie zmiany, które wprowadzono podczas ćwiczeń w tym submodule.</p>

                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <div class="clearfix">
                                                                                <a href="https://kodilla.com/pl/bootcamp-task/407/670841" target="_blank" class="btn btn-info-outline">Podgląd zadania</a>
                            <form target="_blank" class="form-inline project-link-form">
                                <div class="form-group">
                                    <input type="text" name="link" class="form-control" value="https://github.com/skwiryt/testimonials">
                                </div>
                                <button type="submit" class="btn  btn-primary ">Wyślij link <i class="fa fa-check"></i></button>
                            </form>
                                                                                                    </div>
                    </div>
                </section>
                                    
                <section id="submodule-1177" class="card submodule completed" data-bootcamp-user-submodule-id="670842">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">31.2. <span>Neutralizacja zagrożeń</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>W pierwszym submodule mówiliśmy o bezpieczeństwie i o czym warto pamiętać przy pisaniu naszego kodu. Teraz podejdziemy do tematu od drugiej strony i opowiemy, jakie są najpopularniejsze typy zagrożeń oraz jak się przed nimi bronić.</p>
<p>Co roku organizacja OWASP (Open Web Application Security Project), zajmująca się bezpieczeństwem aplikacji internetowych, sporządza ranking najbardziej powszechnych zagrożeń, czyli tych, których witryny doświadczają najczęściej. Lista jest budowana w oparciu o dużą ilość badań, ale też ankiety wypełniane przez ludzi pracujących w branży. Omówimy ją sobie w tym submodule.</p>
<p>W najnowszym wydaniu raportu lista ta wygląda następująco:</p>
<ol>
<li>Injection</li>
<li>Broken Authentication</li>
<li>Sensitive Data Exposure</li>
<li>XML External Entities (XXE)</li>
<li>Broken Access Control</li>
<li>Security Misconfigurations</li>
<li>Cross Site Scripting (XSS)</li>
<li>Insecure Deserialization</li>
<li>Using Components with Known Vulnerabilities</li>
<li>Insufficient Logging and Monitoring</li>
</ol>
<h3 id="312-neutralizacja-zagrozen-injection">Injection</h3>
<p>Pod hasłem <em>Injection</em> kryje się zwyczajnie idea "wstrzyknięcia" niebezpiecznego kodu. Akurat tym rodzajem zagrożenia już zajmowaliśmy się w pierwszym submodule. Atakujący stara się wykorzystać brak odpowiednich filtrów w aplikacji i próbuje wprowadzić wadliwy kod.</p>
<p>Intencja może być różna. Czasem chodzi o próbę wykradzenia danych użytkowników, np. poprzez popsucie warunku pobierającego dane za pomocą <code>find</code>. Innym razem celem jest po prostu zaburzenie działania strony, jak to miało miejsce w naszym przykładzie z komentarzami, gdzie atakujący po prostu zakrywał całą stronę swoim komunikatem. Mimo tego, że jest to zagrożenie znane od bardzo dawna, wciąż niektóre strony są na niego podatne.</p>
<h4>Jak sobie z tym radzić?</h4>
<p>Odpowiedź jest już znana. Należy walidować wszystkie dane nie tylko po stronie klienta, ale również serwera. Musimy sprawdzać ich zgodność z tym, czym powinny być. Powinniśmy je również odpowiednio parsować.</p>
<h3 id="312-neutralizacja-zagrozen-broken-authentication">Broken Authentication</h3>
<p>Chodzi tutaj o wadliwie działający system autoryzacji lub informacje o zalogowanym użytkowniku są zapisane w taki sposób, że można je modyfikować i podmieniać. Innym błędem może być pokazywanie linku do logowania dla administratorów na widoku dla wszystkich i brak ochrony przed atakiem typu <strong>brute-force</strong>. W takiej sytuacji haker przy użyciu jakiegoś narzędzia stara się tak długo testować multum kombinacji, aż w końcu trafi na dobry login i hasło. Dobry system autoryzacji powinien zablokować taką możliwość już po kilku pierwszych nieudanych próbach.</p>
<h4>Jak sobie z tym radzić?</h4>
<p>Najlepiej... w ogóle nie pisać własnego systemu autoryzacji. Zwyczajnie jest zbyt dużo aspektów, które musimy wziąć pod uwagę. Zamiast tego lepiej skorzystać z gotowych i uznanych rozwiązań, np. <strong>Auth0</strong> i <strong>Passport</strong>.</p>
<h3 id="312-neutralizacja-zagrozen-sensitive-data-exposure">Sensitive Data Exposure</h3>
<p>To temat, który już poruszaliśmy. Nie powinniśmy pozostawiać na widoku danych, które mogłyby zostać wykorzystywane przez hakera do przeprowadzenia ataku. Przykładem niech będzie wspomniane w pierwszym submodule przechowywanie kluczowych informacji na publicznym repozytorium. Nie powinniśmy również umieszczać wrażliwych danych w źle zabezpieczonej bazie. Chodzi tutaj o imiona, nazwiska, numery kart kredytowych itd.</p>
<h4>Jak sobie z tym radzić?</h4>
<p>Co do ustawień witryny (np. haseł do bazy), staraj się nie przetrzymywać takich danych w publicznych plikach. Jeśli musimy z nich korzystać, to wyjściem może być użycie zmiennych środowiskowych.</p>
<p>Jeśli chodzi o dane użytkowników, najlepiej korzystać z jakiejś popularnej i cenionej usługi, która zapewni im bezpieczeństwo. Gdy koniecznie musimy zająć się tym sami, szyfrujmy takie dane.</p>
<h3 id="312-neutralizacja-zagrozen-xml-external-entities-xxe">XML External Entities (XXE)</h3>
<p>Akurat tym punktem nie musimy się przejmować. Nie używaliśmy dotychczas w naszej pracy plików XML, bo w przypadku większej ilości danych, korzystamy ze znacznie łatwiejszego w parsowaniu formatu JSON. Nie będziemy więc poruszać tego tematu.</p>
<h3 id="312-neutralizacja-zagrozen-broken-access-control">Broken Access Control</h3>
<p>Chodzi tutaj o niepoprawne "ukrywanie" niektórych części witryny. Nie powinniśmy np. pozostawiać podstron dla adminów w taki sposób, żeby zabezpieczała je tylko nieznajomość adresu przez atakującego. Taka strona powinna sprawdzać przy requeście, czy prosi o nią rzeczywiście administrator. Tego typu błędy najczęściej są dziełem przypadku i nieuwagi.</p>
<p>Wyobraź sobie, że u Ciebie rolę bufora pełni np. funkcja <code>isAdmin()</code>, która sprawdza, czy użytkownik jest zalogowany. Jeśli nie, to przerywa aktualnie wykonywany kod i zwraca odpowiedni błąd. Jeśli jednak jest zalogowany, to pozwala mu działać dalej. Idea jest bardzo dobra, ale w sytuacji, gdy taką funkcję odpalalibyśmy każdorazowo w endpointach dla admina, to możliwe, że podczas pisania kodu, w którymś miejscu o tym zapomnimy. W taki sposób dalibyśmy atakującemu dostęp do jednej z wrażliwych podstron.</p>
<h4>Jak sobie z tym radzić?</h4>
<p>Przede wszystkim powinniśmy używać systemu autoryzacji, który nie ma luk bezpieczeństwa i potrafi dobrze ukrywać wrażliwe podstrony zależnie od posiadanych uprawnień. Niemniej jednak, oprócz tego sami musimy się pilnować, aby ustawić poprawne uprawnienia dla konkretnych części strony czy aplikacji. Nawet najlepsze narzędzie musi wiedzieć, co właściwie ma chronić i w jaki sposób.</p>
<h3 id="312-neutralizacja-zagrozen-security-misconfigurations">Security Misconfigurations</h3>
<p>Mowa tu o wszelkich błędach w konfiguracji serwera czy aplikacji. Możemy np. błędnie skorzystać z middleware <code>express.static</code> i serwer będzie udostępniał również pliki z katalogu głównego. Tym samym atakujący mógłby zajrzeć do <code>server.js</code> i uzyskać np. dostęp do hasła bazy danych. Nawet jeśli byłoby ono schowane w zmiennej konfiguracyjnej, to przynajmniej mógłby poznać strukturę aplikacji i przygotować bardziej zindywidualizowany atak.</p>
<p>Innym błędem podobnego typu mogłoby być np. ustawienie publicznej widoczności repo produkcyjnej aplikacji. Częstą pomyłką jest też korzystanie z domyślnego hasła dla gotowych usług. Gdy używamy np. systemów CMS do postawienia bloga, zdarza się, że korzystają one z prostego hasła w stylu <code>admin1</code>. Brak jego zmiany (sugerowanej zazwyczaj przez autorów), może dać atakującemu naprawdę łatwy dostęp do naszej strony.</p>
<h4>Jak sobie z tym radzić?</h4>
<p>Przede wszystkim nie traktować etapu konfiguracji usług czy aplikacji jako zła koniecznego. Często bowiem to błędy na tym etapie mogą stworzyć furtkę do zaatakowania naszej aplikacji. Zawsze podchodź ze starannością do początkowych etapów swojej pracy. Nawet zwykłe postawienie serwera za pomocą Expressu nie powinno być traktowane przez nas jak szablonowe zadanie, bo przy rutynie najłatwiej o błędy.</p>
<h3 id="312-neutralizacja-zagrozen-cross-site-scripting-xss">Cross Site Scripting (XSS)</h3>
<p>Wyobraź sobie następujący scenariusz. Włączasz przeglądarkę, a ta z automatu próbuje odpalić ten request na Twojej stronie:</p>
<pre class=" language-markup"><code class=" language-markup">POST

{
  "email": "tester@example.com",
  "password": "123",
  "role": "admin"
}</code></pre>
<p>Oczywiście nie wiemy o tym procederze. Załóż, że przeglądarka została wcześniej zhakowana.</p>
<p>Póki nie jesteśmy zalogowani, nie musimy się niczego obawiać. Request zostanie odrzucony przez nasz serwer. Powiedzmy jednak, że po godzinie pracy, postanawiasz zalogować się na swoją stronę, na której masz uprawnienia administratora. Przeglądarka szybko może to wykryć i powtórzyć request. Jak tym razem zareaguje serwer? Skoro request jest odpalany z Twojego komputera, z tej samej przeglądarki, to posiada aktywną sesję. Serwer rozpozna więc Ciebie i doda do strony nowego użytkownika... o uprawnieniach admina. Następnie przeglądarka może poinformować atakującego o sukcesie, a ten zaloguje się na Twoją stronę za pomocą nowego konta. To, co następnie zrobi ze swoimi nowymi uprawnieniami, zależy już tylko od niego.</p>
<p>Analogicznie mogłoby to wyglądać w przypadku witryny banku. Wyobraź sobie, że to bardzo prosta strona. Gdy chcemy przelać pieniądze na czyjeś konto, po prostu wykonujemy odpowiedni request do serwera (oczywiście przy użyciu normalnego formularza na stronie). Ponownie, gdyby nasza przeglądarka została zhakowana (np. przy użyciu pluginu, który by ją infekował), atakujący mógłby poczekać na moment zalogowania do banku i automatycznie odpaliłby request, który sugerowałby bankowi, że trzeba przelać jakieś pieniądze na jego konto. Oczywiście to bardzo abstrakcyjny przykład, bowiem banki mają jeszcze chociażby system autoryzacji SMS do potwierdzania przelewu. Rozumiesz jednak, jak dużym niebezpieczeństwem jest ta technika.</p>
<p>Ataki tego typu są przeważnie ciężkie do przygotowania, sprawca musi bowiem dokładnie wiedzieć, w jaki sposób należy korzystać z witryny. Dlatego też najbardziej narażone są tutaj popularne CMS-y (np. Wordpress), gdyż ich bazowy kod jest zawsze taki sam. Atakującemu łatwiej przygotować wtedy dobrą strategię, a odpowiedni skrypt może wykorzystywać wiele razy. W przypadku autorskich aplikacji jest to już znacznie trudniejsze, ale wciąż możliwe. Wymaga po prostu bardziej spersonalizowanego podejścia, bo atakujący musi poznać witrynę i odpowiednio przygotować skrypt.</p>
<h4>Jak sobie z tym radzić?</h4>
<p>Skrypty korzystające z tej techniki mogą być dostarczane w bardzo różny sposób, np. w postaci wtyczki do CMS-a, lub zainfekowanego pluginu do przeglądarki, który będzie wykorzystywał ją jako narzędzie. Może to być również... zainfekowana zależna paczka. Jak więc sobie z tym radzić? Musimy być po prostu uważni i nie korzystać z podejrzanych źródeł. To rady, które wiążą się trochę z tym, o czym już mówiliśmy w przypadku dobrych praktyk wybierania zależności. Warto też w przypadku krytycznych funkcjonalności sprawdzać skąd pochodzi request. Oczywiście atakujący może podrobić ten adres, ale to wymaga od niego kolejnej dawki wiedzy. Powinniśmy utrudniać każdy atak jak tylko to możliwe.</p>
<h3 id="312-neutralizacja-zagrozen-insecure-deserialization">Insecure Deserialization</h3>
<p>To trochę trudniejszy temat, bowiem nie mówiliśmy jeszcze o idei <strong>serializacji</strong> czy <strong>deserializacji</strong> danych, chociaż tak naprawdę już z niej korzystaliśmy. O co więc chodzi?</p>
<p>Serializacja to w skrócie <strong>proces konwertowania obiektu do formatu, który może być zapisany na dysku, czy w pamięci, jako zwykły ciąg znaków</strong>. Chodzi o przekształcenie do zapisu binarnego, ale też np. do trochę bardziej czytelnego formatu tekstowego (jak JSON). Idea nie jest nam obca, bo przecież już nie raz byliśmy zmuszani odpowiednio konwertować dane z obiektu JS-owego do formatu JSON, kiedy np. wysyłaliśmy requesty do API, używaliśmy funkcji <code>JSON.stringify</code>. Co ciekawe, serializować możemy nawet obiekty z metodami, oczywiście o ile mamy potem odpowiednie narzędzie do ich poprawnego zdeserializowania.</p>
<p>Deserializacja to, jak zapewne się domyślasz, proces odwrotny do serializacji. Tym też już się zajmowaliśmy – gdy otrzymywaliśmy dane z API, to po ich odebraniu, konwertowaliśmy je do obiektu JSowego, tak aby dało się z niego korzystać w naszej aplikacji. Był to właśnie proces deserializacji danych.</p>
<p>Kiedy chcemy zapisać obiekt poza aplikacją to go <strong>serializujemy</strong>, a w sytuacji, gdy chcemy wykorzystać tekst jako obiekt w aplikacji, to go <strong>deserializujemy</strong>. Oczywiście o ile to możliwe, bo np. tekstu w stylu <code>abc</code> nie będziemy w stanie skonwertować do obiektu JS-owego.</p>
<p>Jakie mamy zagrożenia z tym związane?</p>
<p>Jeden przykład pokazaliśmy już w poprzednim submodule. Jeśli zakładasz, że dane pomiędzy klientem a serwerem będą przesyłane poprzez requesty AJAX, to haker bardzo łatwo może takie dane podmienić. Wystarczy, że sam wyśle odpowiedni request i podszyje się pod klienta. Tym samym niczego nieświadomy serwer zdeserializuje takie fałszywe dane, a następnie z nich skorzysta.</p>
<p>Inny przykład. Niektórzy developerzy przechowują dane o użytkowniku w ciasteczkach. <em>Cookies</em> nie przyjmują obiektów jako wartości, dlatego takie informacje są oczywiście serializowane do binarnego ciągu znaków. Może wydawać się, że to dość bezpieczny zabieg i hakerzy raczej nie będą w stanie czegoś tutaj zmodyfikować. Nic bardziej mylnego. Haker może zdeserializować takie dane, podmienić ich zawartość, potem znowu zserializować i przypisać jako nową wartość ciasteczka.</p>
<h4>Jak sobie z tym radzić?</h4>
<p>Kilka rad już znasz. Musimy sprawdzać, co dokładnie otrzymujemy z zewnątrz. Nie powinniśmy też działać w taki sposób na istotnych danych. Przykładowo, nie możemy dopuścić do tego, aby to w requeście była przesyłana informacja o naszych uprawnieniach. Lepiej sprawdzić na serwerze, czy aby jesteśmy aktualnie poprawnie zalogowani. Tak samo, jak nie powinniśmy przetrzymywać informacji o loginie użytkownika w ciasteczku. Dodatkowo możemy też korzystać z sum kontrolnych, które pozwolą upewnić się nam, czy dane nie zostały przypadkiem po drodze sfałszowane.</p>
<h3 id="312-neutralizacja-zagrozen-using-components-with-known-vulnerabilities">Using Components with Known Vulnerabilities</h3>
<p>To zagrożenie, o którym już mówiliśmy. Zdarza się, że developerzy nie zwracają uwagi na wiarygodność paczek zewnętrznych, z których korzystają. Jeśli jej opis i zastosowanie ich zadowala, po prostu ją pobierają, nie zważając na potencjalne luki w bezpieczeństwie. Paczki mogą być też zwyczajnie źle napisane, przez co mimo idealnego kodu samej aplikacji, haker znajdzie do niej dostęp poprzez wadliwy pakiet zależny.</p>
<h4>Jak sobie z tym radzić?</h4>
<p>Należy wybierać tylko znane i wciąż wspierane paczki, w których nie stwierdzono jeszcze żadnych uchybień. Dodatkowo warto korzystać z narzędzi, za pomocą których co jakiś czas przejrzymy wszystkie zależności pod względem luk bezpieczeństwa. To, że paczka wydawała się godna zaufania w momencie jej pobrania, nie znaczy, że wciąż taka jest. Hakerzy co rusz wynajdują kolejne luki, a autorzy paczek muszą je na bieżąco naprawiać.</p>
<h3 id="312-neutralizacja-zagrozen-insufficient-logging-and-monitoring">Insufficient Logging and Monitoring</h3>
<p>W tym punkcie chodzi bardziej o monitorowanie zagrożeń niż bezpośrednie im zapobieganie. Aby dobrze planować ewentualne zmiany w aplikacji związane z bezpieczeństwem, musimy wiedzieć jakim atakom już&nbsp;podlegamy.</p>
<p>Wyobraź sobie, że haker starał się wielokrotnie logować na konto admina. Wygląda na to, że używa jakiegoś oprogramowania, gdyż jego próby przekraczają liczbę kilku tysięcy. Jeśli zdajemy sobie z tego sprawę, możemy zareagować i np. wprowadzić system blokowania adresu IP po trzech wadliwych próbach. Wymusiłoby to na atakującym ciągłe zmienianie swojego IP i znacznie utrudniłoby jego niecny proceder. Możemy też wprowadzić dodatkową ochronę – jeśli nie udało Ci się zalogować trzy razy, to potwierdź swoją tożsamość za pomocą e-maila. Bez wiedzy, że coś się dzieje, ciężko byłoby nam zareagować, tymczasem haker wykonałby kolejne 5000 prób, przy czym ta ostatnia mogłaby okazać się już udaną.</p>
<p>Druga sprawa to monitorowanie udanego ataku. Wyobraź sobie, że haker zalogował się na nasze konto, a my nic o tym nie wiemy. W takiej sytuacji atakujący może na spokojnie korzystać z naszych uprawnień, edytować dane, usuwać użytkowników, a nawet przeglądać ich wrażliwe informacje. Gdyby jednak na naszej stronie istniał jakiś system, który informowałby np. o zalogowaniu do aplikacji z nowego adresu IP, to od razu moglibyśmy reagować, wymusić zakończenie sesji i szybko zmienić hasło albo nawet zablokować działanie całej witryny, aby mieć czas na naprawę luki w bezpieczeństwie. Z takiego pomysłu korzysta np. poczta <strong>Gmail</strong>. Gdy wykrywa zalogowanie z innego urządzenia lub adresu IP, od razu nas o tym informuje i pozwala zareagować.</p>
<h4>Jak sobie z tym radzić?</h4>
<p>Powinniśmy zastosować w naszej aplikacji takie mechanizmy, które będą w jakiś sposób informowały nas o udanych i nieudanych próbach ataków. Forma jest dowolna, system może powiadamiać nas za pomocą e-maili, czy nawet SMS-ów, ważne jednak, abyśmy dzięki niemu zdawali sobie sprawę z potencjalnego zagrożenia. Możemy np. informować administratora o podejrzanym logowaniu, gdy aktualny adres IP użytkownika jest inny niż ten zapisany w bazie danych.</p>
<h3 id="312-neutralizacja-zagrozen-podsumowanie">Podsumowanie</h3>
<p>Zapewne udało Ci się zauważyć, że gdybyśmy zastosowali dobre praktyki z pierwszego submodułu, to większość z tych zagrożeń nie byłaby nam straszna. Niemniej jednak dobrze przeanalizować je krok po kroku, aby zdać sobie sprawę, przeciwko czemu tak naprawdę się bronimy.</p>
<p>Prawdopodobnie czujesz, że bezpieczeństwo aplikacji to skomplikowana sprawa, ale jeśli będziesz trzymać się dobrych praktyk i postarasz się pamiętać o obronie przed znanymi zagrożeniami, to pisanie bezpiecznego kodu może szybko wejść Ci w nawyk. Dodajmy – bardzo pozytywny nawyk :)</p>
<p>Problemem w zabezpieczaniu aplikacji jest też łatwość w zrobieniu błędu, czy przeoczeniu jakiejś luki. Na to receptą jest po prostu poważne podejście do tematu. <strong>Nie możemy traktować bezpieczeństwa aplikacji jako przykrego obowiązku</strong>. Bierz to raczej jako integralną część budowy oprogramowania. <strong>Dobra aplikacja to też bezpieczna aplikacja</strong>.</p>

                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <small>Jeśli masz wątpliwości do powyższego materiału, to - zanim zatwierdzisz - zapytaj na czacie :)</small>
                                                <div class="clearfix">
                                                                                <button class="btn  btn-primary "><i class="fa fa-check"></i><span>Zapoznałe(a)m się!</span></button>
                                                                                                    </div>
                    </div>
                </section>
                                    
                <section id="submodule-1178" class="card submodule completed" data-bootcamp-user-submodule-id="670843">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">31.3. <span>Autoryzacja aplikacji przy użyciu OAuth</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Dotychczas budowaliśmy aplikacje, które nie wymagały od użytkowników rejestracji ani logowania. Często jednak potrzebujemy, aby ten <strong>dostęp był trochę bardziej ograniczony</strong> albo przynajmniej różnorodny, np. kiedy chcemy wprowadzić możliwość edycji strony, czy też specjalne sekcje otwarte wyłącznie dla użytkowników premium. Takie opcje powinny być dostępne tylko dla osób z odpowiednimi uprawnieniami. Ponadto, bez kont użytkowników i modułu logowania nie bylibyśmy w stanie ustalić, kto nas tak naprawdę odwiedza.</p>
<p>Naturalnie idea autoryzacji to coś więcej – <strong>wiedząc, kim jest użytkownik, jesteśmy w stanie przypisywać do niego różne informacje</strong>. Prowadząc serwis wideo, moglibyśmy zapisywać obejrzane przez niego filmy, wystawione oceny, a także udostępniać spersonalizowane funkcjonalności, takie jak np. lista rekomendowanych filmów oraz strona główna, która proponowałaby wideo tylko z tych kanałów, które użytkownik polubił. Możliwości są ogromne, dlatego też właściciele witryn tak chętnie z nich korzystają.</p>
<p>Część stron traktuje funkcjonalność autoryzacji jako dodatek i mogłyby istnieć również bez niej. Są to np. serwisy informacyjne, które często pozwalają na przeglądanie treści nawet bez zalogowania. Istnieją też takie witryny, które bez modułu autoryzacji zwyczajnie nie mogłyby działać, jak np. <strong>Facebook</strong> czy <strong>Twitter</strong>. Każda z ich funkcjonalności opera się na tym, że użytkownik nie jest anonimowy. Zamiast tego ma swoje imię, nazwisko, awatar i własny profil, z którego może komunikować się z innymi użytkownikami. To pozwala m.in. na budowanie spersonalizowanego "walla" z postami na stronie głównej.</p>
<p>Niezależnie, czy będziemy budować więcej stron jednego, czy drugiego typu, nie sposób negować faktu, iż <strong>autoryzacja strony to jedna z podstawowych funkcjonalności</strong> każdej nowoczesnej witryny. Po prostu trzeba ją poznać i oczywiście umieć zaimplementować.</p>
<h3 id="313-autoryzacja-aplikacji-przy-uzyciu-oauth-wlasny-system-autoryzacji">Własny system autoryzacji</h3>
<p>Od razu pojawia się pierwsze pytanie – czy jesteśmy w stanie napisać system autoryzacji sami? Odpowiedź brzmi: tak. Wbrew pozorom nie jest to aż tak trudne, jak mogłoby się wydawać. Tak naprawdę wystarczą dwa formularze – do rejestracji i logowania. Pierwszy powinien dodawać nowego użytkownika do bazy danych, a drugi sprawdzać, czy istnieje tam już ktoś o podanym loginie i haśle. Jeśli nie, system powinien informować użytkownika o wpisaniu złych danych, a jeśli tak, to serwer mógłby rozpoczynać sesję. Następnie wystarczyłoby sprawdzić, czy ta jest aktywna, aby ustalać, czy użytkownik ma dostęp do zasobów, które próbuje załadować, np. czy może połączyć się z odpowiednim requestem. Proste?</p>
<p>Tutaj nasuwa się drugie pytanie, a mianowicie czy możemy sami napisać <strong>bezpieczny system autoryzacji</strong>? W większości przypadków, o ile nie jesteś specem w dziedzinie bezpieczeństwa IT, odpowiedź brzmi: <strong>nie</strong>. Już wcześniej wspominaliśmy, że kiedy tylko to możliwe, staraj się korzystać z gotowych rozwiązań. Podczas implementacji systemu autoryzacji możemy zrobić tak wiele błędów i pozostawić taki ogrom luk, że jeśli nie jesteśmy w stu procentach pewni, że sobie z tym poradzimy, lepiej w ogóle się za ten temat nie zabierać. <strong>Stworzenie dobrego i bezpiecznego systemu autoryzacji jest zwyczajnie bardzo trudne</strong>.</p>
<p>Nawet jeśli udałoby się nam stworzyć względnie dobry system, to bardzo możliwe, że w krótkim czasie stałby się on podatny na ataki. Na przykład kilkanaście lat temu standardem do kodowania hasła (aby w bazie nie przechowywać zwykłego tekstu) było szyfrowanie MD5. Wciąż możesz trafić na tutoriale sprzed paru lat, które z niego korzystają i zachwalają jego bezpieczeństwo. Tymczasem takie rozwiązanie jest już całkowicie skompromitowane. Tak naprawdę nie potrzeba żadnych specjalnych narzędzi, aby je złamać. Wystarczy, że wpiszesz zakodowane hasło w wyszukiwarkę i prawdopodobnie od razu otrzymasz wynik z rozszyfrowaną treścią. Wniosek jest taki, że nawet gdybyśmy stworzyli system autoryzacji, który byłby w danym momencie bezpieczny, to i tak musielibyśmy co jakiś czas do niego wracać, aby poprawiać, czy wręcz zmienić szyfrowanie na nowocześniejsze i silniejsze.</p>
<p>Podsumowując, <strong>własny system autoryzacji wiąże się z potrzebą modyfikacji w przyszłości</strong>. To dość kłopotliwe, bo wymaga od nas czasu i wymusza konieczność bycia na bieżąco z nowinkami w branży. W przypadku gotowych rozwiązań wciąż wspieranych i nowelizowanych wystarczy zaktualizować wersję paczki.</p>
<p>Jeszcze inny aspekt to samo przechowywanie haseł – trzeba je odpowiednio kodować i ukrywać. W przypadku własnego systemu <strong>musimy martwić się o to, aby dane były bezpieczne</strong>. Gdy dojdzie do włamania, mogą one zostać&nbsp;wykradzione i odkodowane, co narazi naszych użytkowników na ogromne niebezpieczeństwo. W końcu często korzystamy z takim samych haseł na wielu stronach. Dodatkowo bardzo negatywnie wpłynęłoby to na reputację naszego biznesu. W przypadku zewnętrznego systemu hasła nie są przechowywane przez nas, a chronią je twórcy tych rozwiązań, jak np. <strong>Google</strong> czy <strong>Facebook</strong>.</p>
<p>Podsumowując, <strong>jeśli tylko masz taką możliwość, korzystaj z gotowego systemu autoryzacji</strong>.</p>
<h3 id="313-autoryzacja-aplikacji-przy-uzyciu-oauth-czym-jest-protokol-oauth-20">Czym jest protokół OAuth 2.0</h3>
<p>Wiemy już, że warto skorzystać z jakiegoś gotowego rozwiązania, ale które będzie najlepsze? Obecnie na rynku jednym z najpopularniejszych wyborów jest <strong>OAuth 2.0</strong>. To właśnie z niego będziemy korzystać w następnym submodule.</p>
<p>OAuth 2.0 <strong>oferuje system autoryzacji umożliwiający logowanie za pomocą zewnętrznych serwisów</strong>, takich jak np. <strong>Google</strong> czy <strong>Facebook</strong>. Lista wspieranych witryn jest jeszcze dłuższa, możemy wykorzystywać również <strong>LinkedIn</strong>, <strong>Twitter</strong> czy <strong>GitHub</strong>.</p>
<p>Pomysł jest tutaj bardzo prosty. W naszej aplikacji umieszczamy buttony np. o treści "Login with Google", czy też "Login with FB". Ich kliknięcie przenosi nas do odpowiedniego zewnętrznego serwisu, gdzie następuje logowanie. Co istotne, zauważ, że ten proces odbywa się poza naszą aplikacją i w ogóle nie ingerujemy w to, jak dokładnie wygląda ten mechanizm. Oczywiście, jeśli wykorzystujemy np. Facebook jako pośrednika, to użytkownik musi zalogować się na swoje konto w tym serwisie. Następnie, po wszystkim zostaje on przeniesiony z powrotem do naszej aplikacji, przy czym pośrednik informuje nas, czy logowanie się udało, czy nie, a my decydujemy, co z tą wiedzą zrobimy. Jeśli proces przebiegł pozytywnie, możemy rozpocząć sesję użytkownika, a w przypadku niepowodzenia pokazujemy np. jakiś komunikat z błędem.</p>
<p>Zapewne udało Cię się spotkać z taką metodą&nbsp;logowania, gdyż OAuth jest bardzo popularny. Korzystają z niego twórcy mniejszych stron, którzy nie chcą brać na swoje braki tworzenia własnego systemu autoryzacji, ale też giganci z różnych branż. Bardzo często widujemy to rozwiązanie również w aplikacjach mobilnych.</p>
<p>Przykłady wykorzystania tej technologii możesz znaleźć na witrynach <a href="https://imdb.com/" target="_blank">imdb.com</a> oraz <a href="https://ebay.com/" target="_blank">ebay.com</a>.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image3.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image3.png" alt="image" style="width: auto; max-width: 50%;"></a>
<h3 id="313-autoryzacja-aplikacji-przy-uzyciu-oauth-dlaczego-warto-z-niego-skorzystac">Dlaczego warto z niego skorzystać?</h3>
<p>Jakie zalety ma wykorzystanie OAuth 2.0?</p>
<p>Po pierwsze, <strong>przyspiesza pracę</strong>. Jak mówiliśmy już wcześniej, budowa własnego systemu autoryzacji to trudna i czasochłonna sprawa. Korzystając z gotowego rozwiązania, oszczędzamy sporo czasu i nerwów.</p>
<p>Po drugie, <strong>gwarantuje nam większe bezpieczeństwo</strong>. Nie wiemy, jak dokładnie zbudowane są systemy autoryzacji Facebooka czy Google, ale możemy być pewni, że ciężko byłoby nam wykonać coś równie bezpiecznego i wyrafinowanego. Firmy te zatrudniają prawdziwych specjalistów, którzy dysponujących ogromną wiedzą i zasobami technicznymi. Nam samym ciężko byłoby zaoferować i utrzymywać system SMS do autoryzacji, a dla gigantów to dopiero początek listy możliwości.</p>
<p>Po trzecie, <strong>ułatwia dostęp użytkownikom</strong>. Potrzeba rejestracji nowego konta często odstrasza potencjalnych klientów. Możliwość szybkiego zalogowania za pomocą dosłownie jednego kliknięcia jest tutaj sporym atutem.</p>
<p>Dużym plusem jest też <strong>przechowywanie haseł użytkowników poza naszą aplikacją</strong>. Całkiem możliwe, że mimo rejestracji za pośrednictwem zewnętrznych serwisów i tak będziemy chcieli przechowywać dane o użytkowniku w naszym serwisie, np. jego komentarze lub informacje, jakie polubił filmy. Co jednak istotne, nie jesteśmy zmuszeni do przechowywania hasła, a to o nie najczęściej się boimy. Jedyne dane, które musimy magazynować u siebie, to tylko id użytkownika, wskazujące na niego w pośredniczącym serwisie. Chodzi po prostu o to, żeby po ponownym zalogowaniu np. przez Google, można było stwierdzić, jaki dokument w kolekcji <code>users</code> odpowiada właśnie naszemu użytkownikowi. Możemy to zrobić, porównując identyfikator otrzymany z zewnętrznego serwisu z identyfikatorami w naszej bazie.</p>
<p>Ostatnią zaletą jest <strong>poczucie bezpieczeństwa</strong> wszystkich stron. My nie martwimy się, że nasz system ma jakieś luki, a użytkownik nie boi się, że jego hasło zostanie ujawnione. Zaufanie do takich gigantów z branży jak FB czy Google w kwestiach bezpieczeństwa jest bowiem naturalnie wyższe niż do twórców pierwszego lepszego serwisu, czy aplikacji.</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Kiedy postawić na autorski system?</h4>
<p>Czy są jakieś wyjątki? Sytuacje, gdzie powinniśmy postawić na własny system autoryzacji?</p>
<p>Owszem, choć zdarza się to rzadko. Przykładem mogą być aplikacje bankowe, dla których możliwość logowania przez Google'a nie zda egzaminu, bo jest zwyczajnie... za prosta. Tego typu instytucje stawiają często na wielostopniową autoryzację, która jest bezpieczniejsza. Nie wystarczy im sam login i hasło, dodatkowo korzystają np. z kodów wysyłanych SMS-em, czy też proszą o wpisywanie tylko części słowa kluczowego. Taki system zabezpieczeń jest więc znacznie bardziej wyrafinowany.</p>
</div>
<h3 id="313-autoryzacja-aplikacji-przy-uzyciu-oauth-zasada-dzialania">Zasada działania</h3>
<p>Podstawowa koncepcja jest dość prosta. Mamy tu właściwie trzy etapy.</p>
<h5>Etap 1 – aplikacja prosi o autoryzację</h5>
<p>Użytkownik zamiast formularza do rejestracji czy logowania otrzymuje tylko button, np. o treści "Sign in with Google". Po kliknięciu na niego aplikacja przekierowuje go do zewnętrznego serwisu.</p>
<h5>Etap 2 – autoryzacja</h5>
<p>Tam następuje logowanie przy użyciu konta adekwatnej witryny. Po próbie zalogowania użytkownik jest kierowany z powrotem do aplikacji.</p>
<h5>Etap 3 – aplikacja otrzymuje wynik autoryzacji</h5>
<p>Przy okazji serwis pośredniczący informuje też o sukcesie lub porażce autoryzacji. Z tą wiedzą nasza aplikacja może np. powitać użytkownika i rozpocząć dla niego nową sesję.</p>
<p>Koncepcję tę podsumowuje poniższa grafika:</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image4.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image4.png" alt="image" style="width: auto;"></a>
<p>To oczywiście bardzo uproszczony zapis. Jak pewnie się domyślasz, "pod maską" naszej aplikacji będzie działo się trochę więcej.</p>
<h3 id="313-autoryzacja-aplikacji-przy-uzyciu-oauth-krok-po-kroku">Krok po kroku</h3>
<p>Teraz opowiemy już o całej idei dokładniej.</p>
<h4>Etap 1</h4>
<p>Wiemy, że wszystko zaczyna się od wybrania odpowiedniego guzika, ale co dzieje się dalej? Najczęściej przygotowujemy specjalny endpoint przeznaczony do logowania, pod który trafia użytkownik po kliknięciu na button. Przyjęło się, że nazywamy go w formacie <code>auth/pośrednik</code>, czyli jeśli ma odpowiadać za logowanie z wykorzystaniem Google'a, będzie to adres <code>auth/google</code>.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image5.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image5.png" alt="image" style="width: auto;"></a>
<p>Pod samym endpointem, kryje się już kod odpowiedzialny za połączenie z pośrednikiem, a więc serwerem Google'a, Facebooka, czy np. LinkedIn. Tę komunikację zapewni nam właśnie OAuth. Już teraz warto dodać, że najczęściej korzystamy też z pomocy dodatkowej paczki o nazwie Passport, która trochę ten proces upraszcza.</p>
<p>Wraz z samym połączeniem musimy wysłać do pośrednika kilka informacji. Zależnie od tego, z kim dokładnie się łączymy, mogą być różne. Najczęściej jednak są to przynajmniej trzy – klucz użytkownika, sekretny ciąg znaków potwierdzający jego tożsamość oraz adres callback do naszej aplikacji.</p>
<p>Pierwsze dwie informacje biorą się ze sposobu, w jaki pośrednicy udostępniają swoje "zasoby". Najczęściej chcą oni, aby przed skorzystaniem z ich usług założyć odpowiednie konto developerskie w ich serwisie. Jaki jest tego cel? Dzięki temu mogą wymagać od programistów komunikowania się przy użyciu danych identyfikujących (jak właśnie klucz użytkownika czy jego "sekretny" kod). To z kolei pozwala na dokładne śledzenie, kto korzysta z ich usług oraz w jaki sposób. Daje to chociażby możliwość analizy zachowań czy też zainteresowań użytkowników.</p>
<p>Co do ostatniej wymaganej informacji (adres callback), zapewne już domyślasz się, do czego jest potrzebna. Pośrednik po udanym bądź nieudanym zalogowaniu musi przekierować użytkownika z powrotem do naszej witryny. Adres callback powie mu, gdzie dokładnie należy go odesłać. Naturalnie nasz serwer (aplikacja) musi umieć ten adres obsługiwać, więc jeśli powiemy pośrednikowi, że po wszystkim ma odesłać użytkownika pod <code>auth/google/callback</code> (nazwa może być oczywiście inna), to musimy mieć taki endpoint przygotowany.</p>
<p>Oprócz tego, przy połączeniu możemy wskazać również, co dokładnie będzie nam potrzebne – tylko adres e-mail, czy może jeszcze awatar, lub inna kombinacja. Dlaczego nie poprosić od razu o wszystko? Z prostego powodu. Większość pośredników, przed próbą logowania, informuje użytkownika, jaki dostęp chce uzyskać dany serwis. Tym samym, jeśli użytkownik zobaczy, że prosimy o jakaś absurdalną ilość danych albo zwyczajnie o coś, czego na logikę nie potrzebujemy, może go to odstraszyć.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image6.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image6.png" alt="image" style="width: auto;"></a>
<p>Na grafikach przedstawiamy schemat połączenia z wykorzystaniem Google, niemniej jednak zasada działania dla pozostałych serwisów jest praktycznie identyczna.</p>
<h4>Etap 2</h4>
<p>Teraz władzę przejmuje już pośrednik. To on pokazuje użytkownikowi formularz logowania i przeprowadza go przez proces autoryzacji. Tak naprawdę ta część całego procesu interesuje nas najmniej, bo zwyczajnie nie mamy na nią wpływu. Zresztą to, w jaki sposób pośrednik sprawdzi tożsamość użytkownika, nie jest dla nas ważne, o ile zrobi to bezpiecznie. Pod tym względem gigantom branży raczej możemy zaufać.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image7.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image7.png" alt="image" style="width: auto;"></a>
<p>Po autoryzacji pośrednik przekieruje użytkownika z powrotem do aplikacji. Oczywiście nie będzie zgadywać adresu, tylko użyje tego, który wskazaliśmy jako callback. Najważniejsze są jednak dane dostarczane wraz z tym przekierowaniem. Pośrednik informuje nas o sukcesie lub porażce autoryzacji oraz przekazuje nam informacje o użytkowniku (oczywiście tylko te, o które prosiliśmy i tylko wtedy, kiedy faktycznie udało mu się zalogować).</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image8.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image8.png" alt="image" style="width: auto;"></a>
<h4>Etap 3</h4>
<p>Aby przyjąć te dane, aplikacja musi posiadać odpowiedni endpoint. Tutaj najczęściej renderujemy&nbsp;podstronę&nbsp;warunkowo, by po sukcesie użytkownik zobaczył np. komunikat "Udało się!", a po porażce "Brak dostępu!". Przy okazji aplikacja najczęściej rozpoczyna też sesję użytkownika (w końcu po to się logujemy), może także dodać go do swojej bazy danych, dzięki czemu jest w stanie przypisywać jego późniejsze działania do odpowiedniej osoby.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image9.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image9.png" alt="image" style="width: auto;"></a>
<h3 id="313-autoryzacja-aplikacji-przy-uzyciu-oauth-podsumowanie">Podsumowanie</h3>
<p>Oczywiście, to jak dokładnie nazwiemy nasze endpointy, z jakiego providera (pośrednika) skorzystamy, czy też co zrobimy z informacją od niego otrzymaną, zależy już tylko od nas. Niemniej jednak w przypadku sukcesu, zawsze będzie to wyglądało mniej więcej tak, jak na grafice poniżej.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image10.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image10.png" alt="image" style="width: auto;"></a>
<p>Możesz potraktować to jako przewodnik lub ściągę do wykorzystania w dalszej części modułu.</p>
<p>Jak podoba Ci się pomysł użycia OAuth 2.0? Przyznaj, że idea dodania do strony tak zaawansowanego mechanizmu logowania wydaje się bardzo kusząca, a w dodatku... będzie to stosunkowo proste, choć wymaga trochę pracy. Przekonasz się jednak, że ilość kodu nie będzie przytłaczająca, a efekt jest na pewno wart zachodu.</p>

                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <small>Jeśli masz wątpliwości do powyższego materiału, to - zanim zatwierdzisz - zapytaj na czacie :)</small>
                                                <div class="clearfix">
                                                                                <button class="btn  btn-primary "><i class="fa fa-check"></i><span>Zapoznałe(a)m się!</span></button>
                                                                                                    </div>
                    </div>
                </section>
                                    
                <section id="submodule-1179" class="card submodule completed" data-bootcamp-user-submodule-id="670844">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">31.4. <span>OAuth i Passport w praktyce</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Najlepszym sposobem na dogłębne poznanie tematu jest uczenie się w praktyce, dlatego też działanie OAuth 2.0 omówimy w czasie procesu implementacji.</p>
<h3 id="314-oauth-i-passport-w-praktyce-co-zbudujemy">Co zbudujemy?</h3>
<p>Nic wielkiego. W założeniu będzie to prosta witryna z zaledwie trzema elementami: stroną główną, podstroną sukcesu ("Zalogowano!") oraz porażki ("Brak uprawnień!").</p>
<p><strong>Strona główna</strong> będzie miała button, którego kliknięcie przeniesie nas do pośrednika, u którego nastąpi zalogowanie. My użyjemy Google'a, ale równie dobrze moglibyśmy wykorzystać innych providerów.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image11.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image11.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p><strong>Podstrona sukcesu</strong> ma za zadanie zakomunikować użytkownikowi, że autoryzacja się powiodła.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image12.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image12.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p><strong>Podstrona porażki</strong> będzie nam potrzebna w razie nieudanego zalogowania. Poinformuje użytkownika, że nie ma on wystarczających uprawnień do przebywania na naszej stronie.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image13.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image13.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Witryna ma więc pozwalać tylko na logowanie przy użyciu mechanizmu autoryzacji Google, a następnie pokazywać informację, że się to udało albo nie. Musisz przyznać, że brzmi to jak książkowy przykład wykorzystania OAuth, no cóż... tak właśnie jest. Dzięki takiej prostocie powinien on być łatwy do przyswojenia.</p>
<h3 id="314-oauth-i-passport-w-praktyce-zaczynamy">Zaczynamy!</h3>
<p>Nie musisz startować całkiem od zera. Przygotowaliśmy dla Ciebie bazę, na której będziemy się opierać. Możesz ją pobrać pod <a href="https://uploads.kodilla.com/bootcamp/wdp/31.authorization/AuthBase.zip" target="_blank">tym linkiem</a>.</p>
<p>Zacznij od analizy pliku <code>server.js</code>.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cors'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> hbs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-handlebars'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">engine</span><span class="token punctuation">(</span><span class="token string">'hbs'</span><span class="token punctuation">,</span> <span class="token function">hbs</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extname<span class="token operator">:</span> <span class="token string">'hbs'</span><span class="token punctuation">,</span> layoutsDir<span class="token operator">:</span> <span class="token string">'./layouts'</span><span class="token punctuation">,</span> defaultLayout<span class="token operator">:</span> <span class="token string">'main'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'.hbs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/user/logged'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">'logged'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/user/no-permission'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">'noPermission'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">'notFound'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Server is running on port: 8000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Jak widzisz, nie ma tu niczego specjalnie skomplikowanego. Tworzymy serwer, dodajemy obsługę szablonów Handlebars i przygotowujemy podstawowe endpointy. Wszystko to już robiliśmy wcześniej. Jedyne co może Cię dziwić, to pojawienie się systemu szablonów, ale akurat tutaj ma to sens. Skoro nie korzystamy z Reacta, nie możemy użyć jego mechanizmu routingu. Tym samym pozostaje nam tylko routing po stronie backendu i pokazywanie różnych plików zależnie od sytuacji. Korzystanie z szablonów znacznie nam ten proces ułatwia.</p>
<p>Pobierz teraz potrzebne paczki zależne (<code>yarn install</code>). Możesz też odpalić serwer <code>yarn start</code> i sprawdzić jak wygląda każdy z endpointów. Zauważ, że <code>/</code> pokazuje nam właśnie stronę główną, <code>/user/logged</code> podstronę sukcesu, a <code>/user/no-permission</code> porażki.</p>
<p>Mamy więc podwaliny serwera. Naszym zadaniem będzie teraz ożywienie przycisku "Login with Google", tak aby faktycznie pozwalał na autoryzację i w rezultacie przekierowywał użytkownika do odpowiedniej podstrony – <code>/user/logged</code> albo <code>/user/no-permission</code>.</p>
<h3 id="314-oauth-i-passport-w-praktyce-pobieramy-potrzebne-paczki">Pobieramy potrzebne paczki</h3>
<p>Żeby wykonać to zadanie, będziemy musieli skorzystać z pomocy zewnętrznych paczek. Oczywiście możemy użyć <a href="https://www.npmjs.com/package/auth0" target="_blank">auth0</a> dla Node'a, niemniej jednak lepszym pomysłem będzie <strong>Passport</strong>, który także służy do autoryzacji, ale oferuje dodatkowo przyjaźniejszy interfejs.</p>
<p>Zainstaluj więc teraz tę paczkę:</p>
<pre class=" language-js"><code class=" language-js">yarn add passport@<span class="token number">0.4</span><span class="token number">.0</span></code></pre>
<p>Dodatkowo musimy pobrać jeszcze dwie – <strong>passport-google-oauth20</strong> oraz <strong>express-session</strong>.</p>
<p>Pierwsza pozwoli na wykorzystanie mechanizmu logowania Google, a druga odpowiada za funkcjonalność inicjacji i obsługi sesji użytkownika.</p>
<pre class=" language-js"><code class=" language-js">yarn add passport<span class="token operator">-</span>google<span class="token operator">-</span>oauth20@<span class="token number">2.0</span><span class="token number">.0</span> express<span class="token operator">-</span>session@<span class="token number">1.17</span><span class="token number">.0</span></code></pre>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Jedna z wielu</h4>
<p>Dlaczego Passport nie wspiera autoryzacji Google od razu i potrzebne są dodatkowe paczki?</p>
<p>Powód jest prosty. Na rynku istnieje mnóstwo serwisów, udostępniających swoje systemy logowania dla stron trzecich, wystarczy wejść na <a href="http://www.passportjs.org/" target="_blank">http://www.passportjs.org/</a> i odwiedzić zakładkę "Strategies". Znajduje się tam lista wszystkich możliwych systemów autoryzacji, które potrafią współpracować z Passportem. Zauważ, że jest ich ponad 500.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image14.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image14.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Każdy pośrednik może mieć system, który działa trochę inaczej niż pozostałe. Gdyby Passport chciał udostępniać od razu wszystkie, wielkość jego paczki byłaby przeogromna. Zamiast tego zawiera tylko główną logikę oraz obsługę OAuth 2.0, a żeby skorzystać z wybranego pośrednika, wystarczy pobrać do tego dodatkowy pakiet.</p>
</div>
<h3 id="314-oauth-i-passport-w-praktyce-google-api-console">Google API Console</h3>
<p>Wspomnieliśmy już&nbsp;wcześniej, że większość pośredników wymaga odpowiedniego konta do korzystania z ich systemów autoryzacji. Najczęściej dostajemy wtedy jakiś identyfikator, który musimy następnie wykorzystywać przy komunikacji z nimi. Dzięki temu pośrednik jest w stanie zawsze ustalić, kto tak naprawdę inicjuje połączenie, bo nie są to anonimowe przekierowania.</p>
<p>Google ma dokładnie taką samą taktykę. Udostępnia swój mechanizm logowania za darmo, ale żeby z niego korzystać, musimy posiadać konto w serwisie <strong>Google APIs</strong> (możesz użyć konta Gmail). Dodatkowo należy wygenerować dla każdej aplikacji, w której będziemy go używać, indywidualny klucz. Zauważ więc, że Google nie tylko będzie wiedziało, że inicjatorem jest np. johndoe@example.com, ale również to, która z jego aplikacji prosi o autoryzację.</p>
<p>Wejdź więc teraz do serwisu <a href="https://console.developers.google.com/apis/" target="_blank"><strong>Google API Console</strong></a> i zacznij od utworzenia nowego projektu.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image15.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image15.png" alt="image" style="width: auto;"></a>
<p>Nazwa może być dowolna, podobnie jak lokalizacja.</p>
<h4>Ekran logowania</h4>
<p>Następnie przejdź do zakładki <strong>Ekran akceptacji OAuth 2.0</strong>. Google przy próbie logowania pokazuje użytkownikowi informacje o tym, kto prosi o autoryzację oraz do jakich danych potrzebuje dostępu. Często pozwala też na przeczytanie spersonalizowanej polityki prywatności dla danego serwisu. To, co dokładnie się tam pokaże, możemy ustalić właśnie w tej zakładce.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image16.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image16.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Przyjrzyjmy się dokładnie temu formularzowi.</p>
<p>W polu <strong>Nazwa aplikacji</strong> możesz wpisać dowolny ciąg znaków. W normalnych warunkach oczywiście podalibyśmy tytuł naszego serwisu, ale teraz wystarczy np. "UserPanel.app".</p>
<p><strong>Logo aplikacji</strong> to fakultatywna opcja, z której twórcy stron czasami korzystają. Jej ustawienie powodowałoby pokazywanie na etapie logowania nie tylko nazwy, ale też logo strony, do której użytkownik próbuje się dostać. Możesz zostawić to pole pustym.</p>
<p><strong>Adres e-mail pomocy</strong> to adres, pod który będzie kierował link "Pomoc".</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image17.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image17.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p><strong>Zakresy dla interfejsów API</strong> to coś, co interesuje nas najbardziej. Domyślnie Google oferuje dostęp do informacji o e-mailu i profilu (a więc np. nazwie użytkownika). Możemy to zmienić i prosić użytkownika o więcej, np. dostęp do jego dysku na Google Drive. Pamiętaj jednak, że informacja o tym, co nasza aplikacja chce wykorzystywać, będzie pokazywana użytkownikowi przy logowaniu, a prośba o podejrzanie duży wgląd może go odstraszyć. W naszym przypadku pozostaw te zakresy bez zmian – informacje o profilu i adresie e-mail zdecydowanie wystarczą.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image18.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image18.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Niżej pozostaje nam jeszcze kilka pól do wypełnienia.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image19.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image19.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>W polu <strong>Autoryzowane domeny</strong> musimy wpisać po prostu adres naszej strony. Informujemy tutaj Google, gdzie tak naprawdę dostępna jest aplikacja. Oczywiście na razie działa ona tylko pod adresem <code>localhost</code>, ale gdyby była hostowana gdzieś zdalnie, to wpisalibyśmy tutaj poprawną nazwę domeny, np. <code>example.com</code>.</p>
<p>Pozostałe trzy pola pozwalają na ustawienie adresów, do których będą prowadzić linki w oknie logowania. Chodzi tu między innymi o zakładkę "Warunki" czy "Prywatność", skąd możemy przekierowywać użytkownika np. pod adres <code>/privacy-policy</code>, gdzie opisujemy, jak wygląda nasza polityka prywatności. Możesz zostawić te pola puste.</p>
<p>Następnie kliknij przycisk <strong>Zapisz</strong>.</p>
<h4>Tworzymy klucz API</h4>
<p>Przechodzimy do istotniejszej kwestii – wygenerowania unikalnego klucza. Będzie on konieczny, by nasza aplikacja mogła łączyć się z Google. Pośrednik ten nie zezwala na anonimowe przekierowanie.</p>
<p>Przejdź więc do zakładki <strong>Dane logowania</strong>, a następnie kliknij na przycisk <strong>Utwórz dane logowania</strong>. Google dopyta Cię jeszcze, o jakie dane dokładnie chodzi. Wybierz <strong>Id klienta 0Auth</strong>.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image20.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image20.png" alt="image" style="width: auto;"></a>
<p>Naszym oczom ukaże się kolejny formularz. Musimy zacząć od określenia <strong>typu</strong>, więc wybierz opcję <strong>Aplikacja internetowa</strong>. Następnie nazwij klucz API, który będziemy generować, postaraj się zawrzeć informację, o jaką aplikację chodzi. Możliwość nazewnictwa kluczy w panelu Google to duża zaleta. Wyobraź sobie, że masz np. 20 aplikacji, a więc tyle samo kluczy i chcesz zmienić dane jednego z nich. Szukanie po samej wartości byłoby dość kłopotliwe, zwłaszcza że są to zawsze mało czytelne ciągi znaków.</p>
<p>Pozostaje nam jeszcze kwestia <strong>ograniczeń</strong>. To najważniejsza część tego formularza. W polu <strong>Autoryzowane źródła JavaScript</strong> musisz ustalić adres aplikacji, a więc <code>http://localhost:8000</code>. Informujemy tutaj Google, gdzie będą przechowywane skrypty, mogące korzystać z tego klucza. Wydaje się to zbędnym ograniczeniem, niemniej jednak wiemy już, że ważną częścią tworzenia bezpiecznych aplikacji jest właśnie blokowanie nieautoryzowanego dostępu. Wyobraź sobie, że Google nie ogranicza klucza API tylko do Twojej aplikacji. Gdybyśmy wtedy udostępnili jej kod na GH, Twój klucz mógłby zostać wykorzystany przez osoby trzecie do podszywania się pod Ciebie, nawet gdyby requesty były wysyłane z całkiem innych domen.</p>
<p>Drugie istotne pole to <strong>Autoryzowane identyfikatory URI przekierowania</strong>. Chodzi tu po prostu o adres callback – pośrednik musi wiedzieć, gdzie ma przekierować użytkownika po udanej autoryzacji. Pojawia się jednak pytanie, dlaczego robimy to w tym miejscu? W końcu mówiliśmy, że serwer będzie informował pośrednika o callbacku również w momencie, w którym przekierowuje do niego użytkownika. To prawda, jednak znowu chodzi o bezpieczeństwo. Dzięki temu, że Google ma zapisane, jaki powinien być adres callback, może sprawdzić, czy serwer aby na pewno prosi o przekierowanie pod wcześniej założony link. Dzięki temu upewnia się, że po drodze nie doszło do jakiejś niechcianej modyfikacji kodu. Wpisz tutaj po prostu <code>http://localhost:8000/auth/google/callback</code>. Tego endpointu jeszcze w naszej aplikacji oczywiście nie mamy, ale niedługo go przygotujemy.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image21.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image21.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Po wszystkim kliknij przycisk <strong>Utwórz</strong>.</p>
<p>Powinniśmy zobaczyć modal z wygenerowanym <code>clientID</code> oraz sekretnym kodem. Możesz zapisać gdzieś te wartości, ale zawsze istnieje szansa powrotu do panelu, skąd da się je w dowolnej chwili skopiować. Twój klucz będzie już na stałe zapisany w "Danych logowania" pod nazwą, którą dla niego wcześniej wybraliśmy.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image22.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image22.png" alt="image" style="width: auto;"></a>
<h4>Podsumowanie</h4>
<p>Trochę się napracowaliśmy, ale było warto. Udało nam się wygenerować <code>clientID</code> oraz sekretny klucz, który będziemy mogli wykorzystywać, aby łączyć się z systemem autoryzacji Google z poziomu naszej aplikacji. Do tego skonfigurowaliśmy odpowiednio ekran logowania, który będzie pojawiał się użytkownikowi po przekierowaniu.</p>
<h3 id="314-oauth-i-passport-w-praktyce-przygotowujemy-serwer">Przygotowujemy serwer</h3>
<p>Skoro mamy już odpowiednie dane, wróćmy do naszego serwera. Musimy go skonfigurować, by zainicjować działanie Passportu, a także poinformować, z jakiego pośrednika będziemy korzystać.</p>
<p>Zacznijmy od zaimportowania wszystkich pakietów – samego Passportu, paczki odpowiedzialnej za możliwość użycia Google jako providera (pośrednika) oraz tej do obsługi sesji.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> passport <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">GoogleStrategy</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport-google-oauth20'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Strategy</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Następnie poinformujemy Passport, że powinien korzystać z mechanizmu Google. Od razu możemy też skonfigurować obiekt, który będzie wysyłany wraz z przekierowaniem. Musimy przekazywać trzy informacje: nasz klucz klienta (<code>clientID</code>), sekretny ciąg znaków i adres callback. Jeśli tego nie zrobimy, to próba komunikacji Passportu zostanie zignorowana przez Google, a użytkownik zamiast ekranu logowania, zobaczy komunikat z błędem. Podobnie będzie, gdy wyślemy właściwe informacje, ale z nieodpowiednią&nbsp;wartością, np. <code>clientID</code> niezgodny z sekretnym kluczem.</p>
<p>Warto dodać, że brak wpisania którejś z wymaganych informacji będzie od razu odnotowany przez Passport, który poinformuje nas o tym w konsoli. Niestety jednak – błędna wartość nie zostanie przez niego wychwycona, dlatego sami musimy pilnować się, aby podawać poprawne dane.</p>
<p>Aby odpowiednio skonfigurować Passport, skorzystamy z jego metody middleware <code>passport.use</code>.</p>
<pre class=" language-js"><code class=" language-js">passport<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GoogleStrategy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    clientID<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token constant">GOOGLE_CLIENT_ID</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    clientSecret<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token constant">GOOGLE_CLIENT_SECRET</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    callbackURL<span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token constant">CALLBACK_ADDRESS</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">accessToken<span class="token punctuation">,</span> refreshToken<span class="token punctuation">,</span> profile<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Zarówno <code>clientID</code>, jak i <code>clientSecret</code>, możesz znaleźć w witrynie Google APIs. Jako adres callback wpisz po prostu ten, który już wcześniej sobie założyliśmy, czyli <code>http://localhost:8000/auth/google/callback</code>. Choć możesz go nazwać dowolnie, pamiętaj jednak, aby w tym miejscu był on zawsze taki sam, jak ten wpisany przy tworzeniu klucza w Google APIs.</p>
<p>Po wprowadzeniu Twoich danych ten kod może wyglądać mniej więcej tak:</p>
<pre class=" language-js"><code class=" language-js"><span class="token comment">// configure passport provider options</span>
passport<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GoogleStrategy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    clientID<span class="token operator">:</span> <span class="token string">'9754491gfdgfdg5fdalmg9111fe3ahrbu.apps.googleusercontent.com'</span><span class="token punctuation">,</span>
    clientSecret<span class="token operator">:</span> <span class="token string">'OfHsdfsdfgMZTLtlIMoe0'</span><span class="token punctuation">,</span>
    callbackURL<span class="token operator">:</span> <span class="token string">'http://localhost:8000/auth/callback'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">accessToken<span class="token punctuation">,</span> refreshToken<span class="token punctuation">,</span> profile<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Najlepiej umieść go zaraz po inicjacji <code>app</code>.</p>
<p>Zapewne udało Ci się zauważyć, że oprócz obiektu z opcjami konfiguracji, w <code>GoogleStrategy</code> mamy też drugi parametr. Jest to funkcja callback, którą pośrednik będzie odpalał po zakończeniu autoryzacji, dzięki czemu serwer odpowiednio na takie zdarzenie zareaguje. Na razie jednak jeszcze się nią nie przejmuj, opowiemy o niej później.</p>
<p>Na końcu musimy uruchomić w Expressie mechanizm sesji oraz zintegrować działanie Passportu z naszą aplikacją. Jak zawsze, użyjemy do tego konceptu middleware'u.</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span> secret<span class="token operator">:</span> <span class="token string">'anything'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>passport<span class="token punctuation">.</span><span class="token method function property-access">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>passport<span class="token punctuation">.</span><span class="token method function property-access">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Obsługę sesji w Expressie uruchamia <code>session({ secret: 'anything' })</code>. Parametr <code>secret</code> służy do jej bardziej unikalnego kodowania, ponieważ jest wykorzystywany przy generowaniu i odczytywaniu informacji o sesji. Jego nieprzewidywalność (sami decydujemy o treści) powoduje, że inne podmioty niż nasz serwer mają duży problem z jej odkodowaniem. Użyj tutaj dowolnej wartości.</p>
<p>Działanie paczki inicjuje <code>passport.initialize())</code>, natomiast <code>passport.session());</code> odpowiada za rozpoczynanie sesji po zalogowaniu użytkownika, która będzie trwała nawet po przejściu z jednej podstrony na drugą. Wystarczy zalogować się raz, a serwer będzie o tym pamiętał – tak długo aż sami w końcu tę sesję zakończymy, np. poprzez zamknięcie przeglądarki albo kliknięcie na jakiś button "Wyloguj".</p>
<p>Aby jednak mechanizm sesji mógł działać poprawnie, musimy uruchomić jeszcze funkcjonalności serializacji i deserializacji. Użytkownik, który będzie się u nas logował to obiekt, który posiada kilka atrybutów, np. e-mail czy nazwę użytkownika. Nie możemy jednak zapisywać w sesji bezpośrednio obiektów JS-owych, stąd też będziemy musieli serializować te informacje do ciągu znaków. Poniższy kod o to zadba.</p>
<pre class=" language-js"><code class=" language-js"><span class="token comment">// serialize user when saving to session</span>
passport<span class="token punctuation">.</span><span class="token method function property-access">serializeUser</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span> serialize</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// deserialize user when reading from session</span>
passport<span class="token punctuation">.</span><span class="token method function property-access">deserializeUser</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> deserialize</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Umieść go pod blokiem kodu z <code>passport.use</code>.</p>
<p>Nie będziemy wchodzić tutaj w szczegóły. Tak naprawdę nas, jako developerów, nie bardzo interesuje działanie tych funkcji pod maską. Ważne jest, by kod w razie potrzeby po prostu serializował albo deserializował informacje o użytkowniku w sesji, aby mechanizm mógł pracować poprawnie. Passport sam zadba o uruchamianie ich wtedy, kiedy będą potrzebne.</p>
<h3 id="314-oauth-i-passport-w-praktyce-etap-1-przekierowujemy-uzytkownika-do-posrednika">Etap 1 – przekierowujemy użytkownika do pośrednika</h3>
<p>Serwer jest już odpowiednio przygotowany, więc możemy przejść do istoty zadania.</p>
<p>Wspominaliśmy już, że najczęściej zaczyna się od kliknięcia na button połączony z endpointem, który przekieruje nas dalej do pośrednika. Tę część wykonamy właśnie teraz.</p>
<h4>Modyfikujemy button</h4>
<p>Zacznij od modyfikacji szablonu strony głównej <code>index.hbs</code>. Dodaj w nim atrybut <code>href</code> i spraw, aby kierował pod adres <code>/auth/google</code>. Takiego endpointu jeszcze nie ma, ale zaraz go dodamy. Oczywiście jak zawsze – sama nazwa jest dowolna, równie dobrze moglibyśmy tutaj użyć <code>/loginwithgoogle</code> albo <code>/login/google</code>.</p>
<h4>Dodajemy endpoint</h4>
<p>Teraz przejdźmy do serwera i dodajmy ten endpoint. Nie będzie on jednak zwykły jak te, które już są w naszym pliku. Jego celem jest bowiem od razu przekierowanie użytkownika do pośrednika. Osiągniemy to, korzystając z funkcji <code>passport.authenticate</code>.</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/auth/google'</span><span class="token punctuation">,</span>
  passport<span class="token punctuation">.</span><span class="token method function property-access">authenticate</span><span class="token punctuation">(</span><span class="token string">'google'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> scope<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token string">'profile'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Powyższy kod można rozumieć jako rozkaz: po wejściu na link <code>/auth/google</code> przekieruj użytkownika do systemu autoryzacji Google i powiedz mu, że interesuje nas e-mail oraz informacje o profilu. Naturalnie przy samym przekierowaniu, Passport wyśle też pośrednikowi informacje, które skonfigurowaliśmy wcześniej, a więc <code>clientID</code>, <code>clientSecret</code> i <code>callbackURL</code>. Wszystko to będzie wykorzystywane przez providera w celu ustalenia, skąd w ogóle pochodzi to przekierowanie i kto prosi o autoryzację.</p>
<p>Uruchom teraz serwer, wejdź pod adresem <code>localhost:8000</code> i spróbuj kliknąć na button "Login with Google".</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image23.gif" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image23.gif" alt="image" style="width: auto; max-width: 50%;"></a>
<p>No proszę, działa! Etap pierwszy mamy za sobą. Nasza aplikacja po kliknięciu na button poprawnie przekierowuje użytkownika do panelu autoryzacji Google. Przy okazji zauważ, że pośrednik poprawnie zinterpretował, kto przekierował użytkownika.</p>
<h3 id="314-oauth-i-passport-w-praktyce-etap-2-autoryzacja">Etap 2 – autoryzacja</h3>
<p>Etap drugi, czyli autoryzacja nie jest w naszych rękach i nie mamy na nią wpływu. Możemy od razu przejść do etapu trzeciego.</p>
<h3 id="314-oauth-i-passport-w-praktyce-etap-3-odbieramy-dane-od-posrednika">Etap 3 – odbieramy dane od pośrednika</h3>
<p>Po autoryzacji, udanej lub nie, provider ponownie przekierowuje użytkownika do naszego serwera. Oprócz tego, w razie sukcesu, wysyła też informacje, o które prosiliśmy. W naszym przypadku jest to e-mail oraz dane profilu i musimy odpowiednio się na nie przygotować.</p>
<h4>Przygotowujemy endpoint callback</h4>
<p>Zacznijmy od przygotowania endpointu, do którego pośrednik przekieruje użytkownika po procesie autoryzacji. U nas miał być to <code>/auth/google/callback</code>.</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/auth/google/callback'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I'm back from Google!</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Teraz ponownie spróbuj uruchomić serwer i kliknąć w button logowania. Po udanej autoryzacji powinniśmy być przekierowywani pod nasz nowy endpoint.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image24.gif" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image24.gif" alt="image" style="width: auto; max-width: 50%;"></a>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Sesja użytkownika</h4>
<p>Możesz zauważyć, że po jednokrotnym zalogowaniu Google nie prosi nas już o autoryzację, tylko od razu przekierowuje pod adres callback. To żaden błąd, tylko właśnie zasługa mechanizmu sesji.</p>
</div>
<p>Jednak czy to wystarczy? Nie do końca. Chcielibyśmy, aby ten endpoint był tylko decydentem. Powinien otrzymywać informację od pośrednika, czy logowanie się udało i zależnie od tego przekierowywać użytkownika do podstrony sukcesu albo porażki.</p>
<p>Możemy to osiągnąć dość łatwo, korzystając ponownie z metody <code>passport.authenticate</code>. Pozwala ona nie tylko na przekierowanie użytkownika do pośrednika, ale też samo <strong>sprawdzenie, czy to zalogowanie się udało</strong>. Wystarczy, że w <code>passport.authenticate</code> zdefiniujemy jeszcze normalną obsługę requestu, a wtedy metoda będzie traktowana jako zwykły middleware, który sprawdzi, czy użytkownik jest zalogowany i czy należy go "przepuścić".</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/auth/google/callback'</span><span class="token punctuation">,</span> passport<span class="token punctuation">.</span><span class="token method function property-access">authenticate</span><span class="token punctuation">(</span><span class="token string">'google'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> failureRedirect<span class="token operator">:</span> <span class="token string">'/user/no-permission'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">redirect</span><span class="token punctuation">(</span><span class="token string">'/user/logged'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Taki kod możemy rozumieć jak rozkaz: po powrocie użytkownika do <code>/auth/google/callback</code>, sprawdź czy udało się go zalogować; jeśli nie, to przekieruj go do <code>/user/no-permission</code>, jeśli tak to przekieruj go do <code>/user/logged</code>.</p>
<p>Zależnie od rezultatu autoryzacji, nasz serwer będzie od teraz kierował użytkownika do podstrony sukcesu albo porażki.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image25.gif" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image25.gif" alt="image" style="width: auto; max-width: 50%;"></a>
<h4>Odbieramy dane o użytkowniku</h4>
<p>Oprócz przygotowania endpointu callback, mamy jeszcze jedno zadanie. Wiemy, że pośrednik po udanej autoryzacji przesyła do serwera informacje o użytkowniku, które mogą być wykorzystywane do różnych celów – np. do imiennego powitania albo dodania nowego użytkownika do bazy. Tak czy inaczej, musimy je jednak odebrać. Jak możemy to zrobić?</p>
<p>Pomoże nam tutaj już wcześniej wspomniana funkcja callback, która na razie czeka na nas prawie pusta w middleware <code>passport.use</code>. W przypadku udanej autoryzacji jest ona wywoływana od razu z odpowiednimi argumentami, w których kryją się informacje o użytkowniku. Musimy więc po prostu odpowiednio tę funkcję przygotować, aby miała parametry, do których te dane przyjmiemy.</p>
<p>Parametry mamy już gotowe, ale nie wiemy jeszcze, co tak naprawdę się w nich kryje.</p>
<pre class=" language-js"><code class=" language-js">passport<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GoogleStrategy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token spread operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">accessToken<span class="token punctuation">,</span> refreshToken<span class="token punctuation">,</span> profile<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Zacznijmy od <code>accessToken</code>. Po udanej autoryzacji Google generuje dla nas unikalny klucz, który może być wykorzystywany przez serwer do swobodnego pobierania informacji o użytkowniku. Serwer nie musi się autoryzować, po prostu łączy się (przy użyciu Passport) z Google kiedy chce, a serwis rozpoznawszy <code>accessToken</code> od razu zwraca dane.</p>
<p>To właśnie jest <code>accessToken</code> – unikalny kod, dzięki któremu serwer może w każdej chwili pobrać informację o danym użytkowniku.</p>
<p>A czym jest <code>refreshToken</code>? <code>accessToken</code> po jakimś czasie wygasa, dlatego Google dostarcza nam również <code>refreshToken</code>. Posiadając go, możemy poprosić o wygenerowanie nowego <code>accessToken</code>. Po co taka kombinacja? Dzięki temu nawet jeśli ktoś zdobędzie Twój <code>accessToken</code>, będzie mógł z niego korzystać tylko przez ograniczony czas.</p>
<p>W <code>profile</code> otrzymamy po prostu dane o użytkowniku, o które prosiliśmy.</p>
<p>Parametr <code>done</code> jest dla nas najbardziej enigmatyczny. To po prostu funkcja, której wywołanie poinformuje Passport, że może zająć się już inicjacją sesji. Przekazujemy tutaj informację o profilu użytkownika, bo właśnie na jego bazie utworzymy sesję. Oczywiście, jak zapewne się domyślasz, zanim ten profil będzie zapisany do sesji, Passport skorzysta z mechanizmu serializacji. Przy okazji zauważ, że to kolejna część konceptu, o którym mówiliśmy na początku. Serwer otrzymuje od pośrednika dane o użytkowniku i inicjuje sesję.</p>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Pośrednik wywołuje funkcję? Ale jak?!</h4>
<p>Mówiąc, że pośrednik wywołuje naszą funkcję callback w <code>passport.use</code>, posłużyliśmy się dość dużym skrótem myślowym. Jak zapewne się domyślasz, nie jest to możliwe, aby zewnętrzny serwer mógł wykonać jakąś funkcję schowaną w kodzie naszej aplikacji. Wygląda więc to trochę inaczej.</p>
<p>Tak naprawdę pośrednik po sukcesie autoryzacji tylko przekierowuje użytkownika z powrotem do strony pod adres callback. Jednak, co istotne, przekazuje przy tym w linku również <code>accessToken</code>. Dzięki temu Passport może sam połączyć się z Google i poprosić o dokładne dane o użytkowniku, a kiedy je otrzyma, odpala właśnie naszą funkcję callback w <code>passport.use</code>.</p>
<p>Nie jest więc prawdą, że pośrednik wywołuje tę funkcję po sukcesie autoryzacji, ale faktem jest, że właśnie po tym sukcesie i po przekierowaniu funkcja jest wywoływana. Inicjuje ją nie pośrednik, tylko nasz serwer po skomunikowaniu się z Google i pobraniu danych o użytkowniku.</p>
</div>
<p>W ramach treningu możesz dodać do funkcji callback linijkę <code>console.log(profile)</code>. Wtedy, po udanej autoryzacji będziemy mogli zobaczyć w konsoli, jak dokładnie wygląda ten obiekt z danymi.</p>
<h3 id="314-oauth-i-passport-w-praktyce-sprzatamy-w-naszym-kodzie">Sprzątamy w naszym kodzie</h3>
<p>Wygląda na to, że założenia, o których mówiliśmy na początku, zostały spełnione. Aplikacja po kliknięciu na button "Login with Google" faktycznie przekierowuje nas do autoryzacji Google, a potem odpowiednio do podstrony sukcesu albo porażki. Dodatkowo potrafi inicjować sesję, tak aby nie trzeba było ciągle powtarzać logowania. Wydaje się więc, że nasza praca dobiegła końca. To prawda, chociaż dobrym pomysłem, byłoby trochę w tym kodzie posprzątać.</p>
<p>Zauważ bowiem, że po dodaniu wszystkich funkcjonalności związanych z Passportem, nasz plik <code>server.js</code> ogromnie się rozrósł. Pomyśl tylko, jak wyglądałoby to przy dodaniu większej ilości endpointów.</p>
<h4>Wyciągamy na zewnątrz dane konfiguracyjne</h4>
<p>Zacznijmy od wyciągnięcia na zewnątrz naszych danych konfiguracyjnych. Mowa tutaj o <code>clientID</code>, <code>clientSecret</code> oraz <code>callbackURL</code>.</p>
<p>Pierwsze co przychodzi nam do głowy, to utworzenie nowego pliku (np. o nazwie <code>config.js</code>), przeniesienie tych informacji tam, a następnie ich zaimportowanie. Czy to na pewno najlepszy pomysł?</p>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Ukrywaj wrażliwe dane</h4>
<p>Za nami submoduł, w którym omawialiśmy dobre praktyki pisania kodu, więc od razu może zapalić Ci się lampka ostrzegawcza. Jak to – chcemy przechowywać wrażliwe dane w zwykłym pliku? Faktycznie, nie jest to dobry pomysł. O wiele lepiej byłoby skorzystać ze zmiennych środowiskowych.</p>
<p>Używając Node'a, zawsze możemy zapisywać je w pliku <code>.env</code>. Jeśli jednak do uruchamiania serwera zastosujemy Nodemona, to istnieje również opcja umieszczenia ich w <code>nodemon.json</code>, w obiekcie <code>env</code>. Ten drugi sposób jest trochę bardziej wygodny w użyciu. Nie musimy importować niczego nowego do pliku, w którym chcemy korzystać z tych zmiennych, a same dane są zapisywane w przyjaznym formacie JSON.</p>
</div>
<p>Właśnie z tej drugiej opcji skorzystamy. Utwórz więc teraz nowy plik w swoim katalogu i nazwij go <code>nodemon.json</code>. Następnie wypełnij go następującymi danymi:</p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">{</span>
  <span class="token string">"env"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">"clientID"</span><span class="token operator">:</span> <span class="token string">"my-client-id"</span><span class="token punctuation">,</span>
    <span class="token string">"clientSecret"</span><span class="token operator">:</span> <span class="token string">"my-client-secret"</span><span class="token punctuation">,</span>
    <span class="token string">"callbackURL"</span><span class="token operator">:</span> <span class="token string">"my-callback-url"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Oczywiście wpisz tutaj swoje dane.</p>
<p>Następnie możemy wykorzystać te zmienne już bezpośrednio w pliku <code>server.js</code>.</p>
<pre class=" language-js"><code class=" language-js">passport<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GoogleStrategy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    clientID<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token property-access">clientID</span><span class="token punctuation">,</span>
    clientSecret<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token property-access">clientSecret</span><span class="token punctuation">,</span>
    callbackURL<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token property-access">callbackURL</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">accessToken<span class="token punctuation">,</span> refreshToken<span class="token punctuation">,</span> profile<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Na końcu dodaj jeszcze nowy wpis do <code>.gitignore</code>, tak aby ignorował przy commitach plik <code>nodemon.json</code>. Jest to koniecznie, inaczej bowiem cała operacja nie miałaby sensu. Co z tego, że konfiguracja byłaby zapisywana w zmiennych środowiskowych, jeśli plik z nimi i tak byłby dostępny na publicznym repo...</p>
<p>Co dały nam ostatecznie te zmiany? Po pierwsze, plik <code>server.js</code> minimalnie się odchudził, a po drugie i ważniejsze, nasza aplikacja wciąż działa poprawnie, natomiast wrażliwe dane są już ukryte przed innymi.</p>
<h4>Wyciągamy na zewnątrz konfigurację Passportu</h4>
<p>Mimo zmian bardzo dużą część naszego pliku <code>server.js</code> zajmuje wciąż część dotycząca konfiguracji Passportu. Chodzi dokładnie o ten kod:</p>
<pre class=" language-js"><code class=" language-js">passport<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GoogleStrategy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    clientID<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token property-access">clientID</span><span class="token punctuation">,</span>
    clientSecret<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token property-access">clientSecret</span><span class="token punctuation">,</span>
    callbackURL<span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token property-access">callbackURL</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">accessToken<span class="token punctuation">,</span> refreshToken<span class="token punctuation">,</span> profile<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">done</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> profile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// serialize user when saving to session</span>
passport<span class="token punctuation">.</span><span class="token method function property-access">serializeUser</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span> serialize</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// deserialize user when reading from session</span>
passport<span class="token punctuation">.</span><span class="token method function property-access">deserializeUser</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> deserialize</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Dobrze byłoby go wyciągnąć na zewnątrz.</p>
<p>Stwórz nowy folder o nazwie <code>config</code> i dodaj do niego plik <code>passport.js</code>. Następnie umieść w nim cały kod wspominany przed chwilą. Potrzebne będą też odpowiednie importy.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> passport <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">GoogleStrategy</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport-google-oauth20'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Strategy</span></span><span class="token punctuation">;</span></code></pre>
<p>Następnie wróć do pliku <code>server.js</code>, usuń niepotrzebny skrypt i zamień na odpowiednie importy. Możesz też pozbyć się importu <code>GoogleStrategy</code>, z którego już nie korzystamy bezpośrednio w tym pliku.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> passportConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config/passport'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Serwer powinien działać tak samo, a udało nam się dzięki temu znacząco odchudzić plik <code>server.js</code>.</p>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Jak to w ogóle działa?</h4>
<p>To, co zrobiliśmy przed chwilą, mogło Cię wprawić w zakłopotanie. Jeszcze większe zdziwienie mogło się pojawić po uruchomieniu serwera, gdyż nasz nowy kod... faktycznie działa.</p>
<p>Zawsze mówiliśmy, że aby dało się zaimportować jakąś funkcję czy obiekt, trzeba je najpierw wyeksportować. Jak to możliwe, że teraz wystarczyło zaimportować plik, i ten mimo braku jakiekolwiek eksportu, zwyczajnie się wykonał?</p>
<p>No cóż... Node.js tak po prostu działa.</p>
<p>Gdy zaimportujemy plik, to jeśli jest w nim jakiś "luźny" kod (a więc nieschowany w funkcji czy obiekcie), zostanie on automatycznie skompilowany. To prawie tak samo, jak przy ładowaniu plików JS w HTML-u za pomocą tagu <code>&lt;script&gt;</code>. Wystarczyło dodać odpowiedni tag z dobrą ścieżką do pliku i po wejściu na stronę, kod wewnątrz niego automatycznie się kompilował.</p>
<p>Node.js daje nam możliwość eksportowania funkcji czy obiektów i importowania ich potem pod odpowiednią nazwą, ale to tylko przydatna funkcjonalność, a nie wymóg.</p>
<p>Pojawia się więc pytanie, dlaczego w takim razie tak chętnie korzystamy z idei eksportów? Odpowiedź jest prosta. Daje nam to możliwość czytelnego przypisania jakichś funkcjonalności (lub danych) do stałych i wykorzystania ich potem w dalszym kodzie, w miejscu, gdzie jest to nam potrzebne.</p>
<p>Tymczasem w przypadku ładowania bez eksportu, wykonywanie tego "luźnego" kodu następuje od razu w miejscu, gdzie ten plik jest zaimportowany (więc w miejscu wywołania <code>require</code>). W większości sytuacji byłaby to ogromna wada, nie wspominając już o zwyczajnie gorszej czytelności.</p>
<p>Zauważ, że gdy ktoś wejdzie do naszego <code>server.js</code>, nie jest w stanie od razu stwierdzić, do czego w ogóle jest nam potrzebny plik <code>config/passport</code>. Można to sprawdzić dopiero po wejściu do tego pliku. Często wolimy postawić więc na większą przejrzystość.</p>
<p>Podsumowując, gdy używamy <code>require</code> wcale nie musimy korzystać z idei eksportów, lecz najczęściej będzie to zwyczajnie lepszym pomysłem – czytelniejszym i bardziej funkcjonalnym.</p>
</div>
<h4>Wydzielamy endpointy</h4>
<p>Nasz <code>server.js</code> jest coraz mniejszy, możemy zrobić jednak jeszcze jedną rzecz.</p>
<p>W poprzednich modułach standardem było wydzielanie grup endpointów do zewnętrznych plików. Możemy to zrobić również teraz, bo w końcu mamy dwie specjalne grupy – <code>auth</code> i <code>user</code>.</p>
<p>Stwórz więc nowy folder (<code>routes</code>), a w nim dwa nowe pliki (<code>auth.routes.js</code> i <code>user.routes.js</code>).</p>
<p>Pierwszy powinien mieć następującą zawartość:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> passport <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/google'</span><span class="token punctuation">,</span>
  passport<span class="token punctuation">.</span><span class="token method function property-access">authenticate</span><span class="token punctuation">(</span><span class="token string">'google'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> scope<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token string">'profile'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/google/callback'</span><span class="token punctuation">,</span> passport<span class="token punctuation">.</span><span class="token method function property-access">authenticate</span><span class="token punctuation">(</span><span class="token string">'google'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> failureRedirect<span class="token operator">:</span> <span class="token string">'/user/no-permission'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">redirect</span><span class="token punctuation">(</span><span class="token string">'/user/logged'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre>
<p>Tak powinien wyglądać drugi:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/logged'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">'logged'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/no-permission'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">'noPermission'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre>
<p>Czy są tu jakieś nowości? Na razie nie, bo robiliśmy już takie wydzielanie route'ów. Czymś nowym jest tylko potrzeba zaimportowania Passportu do pierwszego z plików. Niemniej jednak, akurat to pewnie jest dla Ciebie zupełnie logiczne. Jeśli chcemy skorzystać z metody wbudowanej w paczkę <code>passport</code>, musimy mieć do niej dostęp.</p>
<p>Teraz wystarczy jeszcze zaimportować te endpointy z powrotem do <code>server.js</code>:</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/auth'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/auth.routes'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/user.routes'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Taki zapis to oczywiście skrót od:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> authRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/auth.routes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> userRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/user.routes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token spread operator">...</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/auth'</span><span class="token punctuation">,</span> authRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> userRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Ostatecznie udało nam się całkiem nieźle odchudzić plik <code>server.js</code>, a serwer – co najważniejsze – wciąż działa dobrze. Ostatecznie ten plik powinien wyglądać mniej więcej tak:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cors'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> hbs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-handlebars'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> passport <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'passport'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express-session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> passportSetup <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./config/passport'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// set handlebars as view engine</span>
app<span class="token punctuation">.</span><span class="token method function property-access">engine</span><span class="token punctuation">(</span><span class="token string">'hbs'</span><span class="token punctuation">,</span> <span class="token function">hbs</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extname<span class="token operator">:</span> <span class="token string">'hbs'</span><span class="token punctuation">,</span> layoutsDir<span class="token operator">:</span> <span class="token string">'./layouts'</span><span class="token punctuation">,</span> defaultLayout<span class="token operator">:</span> <span class="token string">'main'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'.hbs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// init session mechanism</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span> secret<span class="token operator">:</span> <span class="token string">'anything'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// init passport</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>passport<span class="token punctuation">.</span><span class="token method function property-access">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>passport<span class="token punctuation">.</span><span class="token method function property-access">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// standard middleware</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/auth'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/auth.routes'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/user.routes'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">'notFound'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Server is running on port: 8000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="314-oauth-i-passport-w-praktyce-podsumowanie">Podsumowanie</h3>
<p>Jak widzisz, ostatecznie nasz kod dość dobrze pokrył się z tym, jak opisywaliśmy koncept działania OAuth 2.0. Owszem, całość była trochę bardziej skomplikowana w implementacji, ale jest to stosunkowo niewielka cena za korzystanie z tak zaawansowanego systemu autoryzacji.</p>
<p>Warto zauważyć, że było to z pewnością łatwiejsze niż zaimplementowanie takiego systemu od zera. Po początkowej integracji Passportu z naszym serwerem korzystanie z autoryzacji jest już stosunkowo proste, o czym zresztą przekonasz się za chwilę, wykonując zestaw kilku praktycznych zadań.</p>

                        </div>
                    </div>
                                        <div class="card-block task-card">
                        <h3 id="314-oauth-i-passport-w-praktyce-zadanie-praktyka-czyni-mistrza">Zadanie: <span class="task-title">praktyka czyni mistrza</span></h3>
                        <div class="task-content">
                            <p>Czas na przećwiczenie nowej wiedzy. Poniżej mamy dla Ciebie kilka zadań, które rozwiną naszą prostą aplikację. Postaraj się wykonać je najpierw bez naszej pomocy, korzystając z materiału submodułu, <a href="http://www.passportjs.org/docs/" target="_blank">dokumentacji Passportu</a> oraz zdrowego rozsądku ;)</p>
<h4>Zadanie 1</h4>
<p>Twoim zadaniem jest dodanie dwóch nowych podstron – <code>/user/profile/</code> oraz <code>/user/profile/settings</code>. Ich treść może być dowolna, wystarczą proste nagłówki. Co istotne jednak, obie strony powinny być <strong>dostępne tylko po zalogowaniu</strong>. Przy próbie wejścia pod ich adresy przez nieautoryzowanych gości, serwer musi przekierowywać takie osoby do podstrony <code>/user/no-permission</code>.</p>
<p>Dodatkowo, taką samą taktykę zastosuj również dla <code>user/logged</code>. Ta podstrona nie powinna być widoczna dla niezalogowanych użytkowników.</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#collapse-xiqGmbxHm-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż wskazówkę</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#collapse-xiqGmbxHm-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj wskazówkę</a>
  </span>
</p>
<div id="collapse-xiqGmbxHm-toggle" class="collapse">
<p>Z dokumentacji możesz się dowiedzieć, że Passport inicjując sesję użytkownika, zapisuje informacje o nim do <code>req.user</code>. Jest to dla nas bardzo ważna wskazówka. Możemy bowiem wywnioskować, że wystarczy sprawdzić <code>req.user</code>, aby stwierdzić jaki jest status użytkownika. Jeśli nie będzie puste to możemy być pewni, że gość został zautoryzowany. Proste, prawda? ;)</p>
<p>Teraz wystarczy połączyć tę wiedzę z informacją, że możemy przekierowywać użytkownika do innych podstron za pomocą <code>res.redirect</code>.</p>
</div>
<h5>Dla ambitnych</h5>
<p>Istnieje możliwość ograniczenia powtarzalności kodu. Wystarczy stworzyć własny middleware, który będzie po prostu sprawdzać, czy <code>req.user</code> nie jest puste i zależnie od tego, przekierowywać użytkownika do <code>/user-no-permisson</code> albo pozwalać mu przejść dalej do właściwego endpointu (<code>next()</code>). Wtedy zamiast pisać warunkowy kod ciągle od nowa, moglibyśmy wykorzystywać w wybranych endpointach nasz nowy middleware.</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#collapse-7_bROj8-AX-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż wskazówkę</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#collapse-7_bROj8-AX-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj wskazówkę</a>
  </span>
</p>
<div id="collapse-7_bROj8-AX-toggle" class="collapse">
<p>Nasz middleware powinien wyglądać mniej więcej tak:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> <span class="token function-variable function">isLogged</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">redirect</span><span class="token punctuation">(</span><span class="token string">'/proper-url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Pamiętaj, że middleware możesz wykorzystywać dla grup endpointów, a więc np.</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/some-url'</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">redirect</span><span class="token punctuation">(</span><span class="token string">'/proper-url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>ale także dla pojedynczych endpointów:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> <span class="token function-variable function">isLogged</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">redirect</span><span class="token punctuation">(</span><span class="token string">'/proper-url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/admin'</span><span class="token punctuation">,</span> isLogged<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//do something after being authorized</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Właśnie o tę drugą chodzi nam w tym zadaniu.</p>
</div>
<h4>Zadanie 2</h4>
<p>Kolejne zadanie jest już trochę krótsze. Do aplikacji należy dodać nowy endpoint <code>/auth.logout</code>, który będzie kończył sesję użytkownika. Link do niego powinien zostać dodany do podstrony <code>user/logged</code>.</p>
<p>Przy wykonaniu zadania wspomóż się dokumentacją Passport.js.</p>
<h4>Zadanie 3</h4>
<p>Ostatnie wyzwanie również będzie stosunkowo krótkie. Twoim zadaniem jest taka modyfikacja pliku <code>user/logged</code>, aby zamiast komunikatu <code>You have been successfully logged in!</code>, pokazywał awatar użytkownika oraz napis <code>Hello username!</code>. Oczywiście w miejscu <code>username</code> ma być po prostu imię i nazwisko logującego się użytkownika, a więc np. <code>Hello John Doe!</code>.</p>
<p>Ma to wyglądać mniej więcej tak:</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image26.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image26.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Aby ułatwić Ci pracę, poniżej mamy dla Ciebie klasę stylującą obrazek:</p>
<pre class=" language-css"><code class=" language-css"><span class="token selector"><span class="token class">.avatar</span></span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token unit">rem</span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token unit">rem</span><span class="token punctuation">;</span>
  <span class="token property">border-radius</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token unit">%</span><span class="token punctuation">;</span>
  <span class="token property">box-shadow</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">10</span><span class="token unit">px</span> <span class="token number">10</span><span class="token unit">px</span> <span class="token color"><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
  <span class="token property">object-fit</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#collapse-7q6bvwDE5D-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż wskazówkę</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#collapse-7q6bvwDE5D-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj wskazówkę</a>
  </span>
</p>
<div id="collapse-7q6bvwDE5D-toggle" class="collapse">
<ol>
<li>Pamiętaj, że wszystkie dane o zalogowanym użytkowniku znajdziesz w <code>req.user</code>.</li>
<li>Dane otrzymane od Google i przechowywane w <code>req.user</code> mają strukturę, której nie znamy. Możesz więc dla ułatwienia wypisać sobie zawartość tego obiektu w konsoli. Pomoże Ci to dojść do odpowiednich atrybutów.</li>
<li>W aplikacji zastosowano system szablonów Handlebars, możesz więc wykorzystać jego ideę placeholderów, aby przekazać przy renderowaniu odpowiednie informacje do widoku. W razie problemu wróć po pomoc do modułu o Expressie.</li>
</ol>
</div>

                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <div class="clearfix">
                                                                                <a href="https://kodilla.com/pl/bootcamp-task/407/670844" target="_blank" class="btn btn-info-outline">Podgląd zadania</a>
                            <form target="_blank" class="form-inline project-link-form">
                                <div class="form-group">
                                    <input type="text" name="link" class="form-control" value="https://github.com/skwiryt/authBase">
                                </div>
                                <button type="submit" class="btn  btn-primary ">Wyślij link <i class="fa fa-check"></i></button>
                            </form>
                                                                                                    </div>
                    </div>
                </section>
                                    
                <section id="submodule-1180" class="card submodule completed" data-bootcamp-user-submodule-id="670845">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">31.5. <span>Po drugiej stronie barykady</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Do tej pory, gdy mówiliśmy o bezpieczeństwie aplikacji, zawsze stawialiśmy się w roli broniących, czyli osób, które muszą przewidzieć zagrożenia i odpowiednio się na nie przygotować. Tym razem podejdziemy do tematu od drugiej strony i... wcielimy się w rolę atakującego.</p>
<p>Zakładamy (a przynajmniej mamy nadzieję), że nie jest to droga, którą chcesz podążać. Niemniej jednak poznanie wszystkiego również od drugiej strony, powinno uświadomić Ci, na co musimy być przygotowani. Dobre praktyki to tylko teoria, a teraz chcemy przekonać&nbsp;się, jak jej zignorowanie czyni naszą aplikację bezbronną. To podejście rodem z policyjnych podręczników – jeśli chcesz złapać przestępcę, naucz się myśleć jak on. Gdy chcesz dobrze zabezpieczyć aplikację i poprawnie przewidzieć zagrożenia, musisz umieć wcielić się w atakującego.</p>
<p>Dlatego też w tym submodule na chwilę zmienimy barwy i staniemy się "hakerem". Zajmiemy się próbą znalezienia luk bezpieczeństwa w gotowej aplikacji, jednak aby nauka nie szła w las, każdą znalezioną dziurę postaramy się załatać. Brzmi ekscytująco, prawda? ;)</p>
<h3 id="315-po-drugiej-stronie-barykady-kogo-atakujemy">Kogo atakujemy?</h3>
<p>Naszym celem będzie witryna konkursu fotograficznego. Główną funkcjonalnością tej aplikacji jest pokazywanie prac na stronie głównej oraz formularz do dodawania zgłoszeń na podstronie "Submit a photo".</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image27.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image27.png" alt="image" style="width: auto;"></a>
<h3 id="315-po-drugiej-stronie-barykady-co-chcemy-przetestowac">Co chcemy przetestować?</h3>
<p>Nie będziemy interesować się wszystkimi możliwymi lukami. Postaramy się zbadać bezpieczeństwo w tych obszarach, gdzie jest ona dla twórców najbardziej istotne.</p>
<p>Przetestujemy dwa aspekty:</p>
<ol>
<li><strong>Poprawność działania formularza</strong> – czy użytkownik jest ograniczony zgodnie z założeniami, a więc, czy np. formularz wymusza wpisanie e-maila, nazwy użytkownika i nie pozwala na dodawanie zgłoszenia bez wysłania zdjęcia.</li>
<li><strong>Poprawność działania systemu "lajków"</strong> – każde zdjęcie może zostać polubione, jednak twórcy witryny chcą, aby można to było zrobić tylko raz. W przeciwnym razie uczestnicy byliby w stanie sztucznie pobijać sobie statystyki.</li>
</ol>
<h3 id="315-po-drugiej-stronie-barykady-scenariusze-ataku">Scenariusze ataku</h3>
<p>Jak podejdziemy do tych testów? Postaramy się zasymulować dwa scenariusze ataków.</p>
<h4>Złośliwy atak konkurencji</h4>
<p>W pierwszym z nich postaramy się zasymulować klasyczny atak na "wyniszczenie". Wcielimy się w atakującego, który ma powiązania z konkurencją i chce po prostu w jakiś sposób zaburzyć działanie strony. Nie jest to atak nastawiony na kradzież danych czy jakieś korzyści finansowe. Bardziej chodzi o zaszkodzenie w taki sposób, aby strona przestała działać poprawnie. Przykładem takiego ataku, może być np. próba dodania wadliwych opisów zdjęć, aby "wepchnąć" do nich jakiś kod HTML z atrybutem <code>style</code>, który następnie mógłby powodować np. zakrycie całej strony czarnym tłem. Tego typu przykład już nawet w tym module pokazywaliśmy.</p>
<p>W przypadku takiego uderzenia będziemy pracować głównie z formularzem dodawania zdjęć oraz z samym serwerem, bo to właśnie te części strony są odpowiedzialne za przyjmowanie danych.</p>
<h4>Nieuczciwy uczestnik</h4>
<p>Drugi przykład jest jeszcze bardziej życiowy. Będzie symulować sytuację, w której atakującym jest jeden z uczestników, chcący nieuczciwie zwiększyć ilość polubień swojego zdjęcia. Tutaj motyw jest typowo finansowy, organizatorzy konkursu przygotowali bowiem ciekawe nagrody.</p>
<p>W tym przypadku najprawdopodobniej skupimy się na stronie głównej i analizie tego, co dzieje się w przypadku kliknięcia na "serduszko". Następnie będziemy starali się oszukać aplikację, żeby pozwalała na wielokrotne głosowanie na to samo zdjęcie.</p>
<h3 id="315-po-drugiej-stronie-barykady-przygotowania-do-pracy">Przygotowania do pracy</h3>
<p>Zacznij od pobrania całej aplikacji. Możesz to zrobić pod <a href="https://uploads.kodilla.com/bootcamp/wdp/31.authorization/PortraitMaster-v2.zip" target="_blank">tym linkiem</a>.</p>
<p>Uruchom komendę <code>yarn install</code>, aby pobrać potrzebne paczki i odpal podgląd aplikacji za pomocą tasku <code>start</code>.</p>
<p>W tym miejscu musimy jeszcze poruszyć dwie kwestie.</p>
<h4>Ślepy atak</h4>
<p>Mimo że masz dostęp do kodu źródłowego, podczas ataku staraj się do niego nie zaglądać. Mamy w końcu udawać hakera, a ten zazwyczaj nie ma o nim żadnej wiedzy i uderza na ślepo.</p>
<h4>Poprawki bezpieczeństwa</h4>
<p>Jak już mówiliśmy, po każdej wykrytej luce przeznaczymy chwilę na jej naprawę. Będzie to wymagało modyfikacji w kodzie źródłowym aplikacji, warto więc powiedzieć o niej kilka słów.</p>
<p>Część kliencka jest zbudowana za pomocą Reacta, wykorzystuje również Reduksa i React Router. Backend został oparty o framework Express.js, dane przechowywane są w bazie MongoDB, a dostęp do nich jest realizowany poprzez Mongoose. Brzmi znajomo, prawda?</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Jeden cel, wiele dróg</h4>
<p>Uwaga! Mimo tego, że aplikacja jest zbudowana w znanych Ci już technologiach, niektóre jej części mogą być zakodowane w trochę inny sposób niż znany nam z kursu. To celowy zabieg. W swojej pracy bardzo często natrafisz na sytuację, w której różne osoby czy teamy trochę inaczej pochodzą do pewnych aspektów aplikacji albo znają inne "dobre" praktyki. To wcale nie znaczy, że jedne czy drugie są gorsze. W programowaniu jest wiele dróg do osiągnięcia jednego celu. Nasz przykład pozwoli Ci sprawdzić, jak dobrze rozumiesz dotychczasowy materiał.</p>
</div>
<h3 id="315-po-drugiej-stronie-barykady-zlosliwy-atak-konkurencji">Złośliwy atak konkurencji</h3>
<p>Wiemy już, co chcemy przetestować i jak do tego podejdziemy. Możemy więc brać się do pracy. Zaczniemy od pierwszego scenariusza, a więc symulacji ataku złośliwej konkurencji.</p>
<p>Przypomnijmy, że mamy tutaj na celu wprowadzenie takich danych, które w jakiś sposób "popsują" stronę. Możemy spróbować dodać np. zdjęcie z za długą nazwą, tak aby wystawała poza boksy z grafikami, albo dodać jakiś złośliwy kod HTML z atrybutem <code>style</code>, który wykorzystując <code>position: fixed</code> i <code>background</code> zakryje całą stronę czarnym tłem. Musimy jakoś złamać aplikację, by pozwoliła nam wysłać wadliwe dane do serwera, który je przyjmie.</p>
<p>Zacznijmy od przejścia na podstronę "Submit a photo".</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image28.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image28.png" alt="image" style="width: auto;"></a>
<h4>Próby do przeprowadzenia</h4>
<p>Zaplanujmy ataki, które możemy sprawdzić:</p>
<ol>
<li><strong>Dodawanie pustych zgłoszeń</strong> – puste boksy na stronie, bez zdjęcia i bez napisu dość mocno kompromitowałyby konkurs.</li>
<li><strong>Dodawanie zgłoszeń bez zdjęcia</strong> – jeśli aplikacja nie pozwoli nam na puste pola tekstowe, możemy spróbować dodać zgłoszenia bez zdjęć. To też dałoby kompromitujący efekt.</li>
<li><strong>Dodawanie zgłoszeń z wadliwym plikiem</strong> – jeśli plik musi być wysłany, to możemy chociaż spróbować załączyć coś innego niż obrazek.</li>
<li><strong>Dodawanie zgłoszeń z bardzo długim tytułem</strong> – jeśli wcześniejsze ataki się nie powiodą, możemy spróbować przynajmniej tego.</li>
<li><strong>Dodawanie zgłoszeń ze złośliwym HTML</strong> – o tym już mówiliśmy. To warte spróbowania, zważywszy na duże możliwości manipulacji stroną w razie sukcesu.</li>
</ol>
<p>A więc do dzieła!</p>
<h4>Dodawanie pustych zgłoszeń</h4>
<p>Zacznijmy od najprostszego sposobu. Kliknij na <strong>Submit your work</strong> bez wypełniania formularza. Wiara, że twórcy w ogóle go nie walidują jest dość naiwna, ale... i tak warto spróbować. Kto wie, może akurat ktoś o tym zapomniał?</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image29.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image29.png" alt="image" style="width: auto;"></a>
<p>No cóż... Mogliśmy się tego spodziewać :) Da się tu jednak zauważyć istotną rzecz. Ten komunikat nie wygląda jak dodatkowy HTML, tylko coś, co jest pokazywane przez przeglądarkę. Może to sugerować, że zatrzymała nas zwykła podstawowa walidacja, którą przeglądarka oferuje w HTML5. To z kolei sugerowałoby, że za blokowanie nas odpowiada po prostu atrybut <code>required</code> tego pola.</p>
<p>Spróbujmy więc znaleźć ten formularz w inspektorze.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image30.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image30.png" alt="image" style="width: auto;"></a>
<p>Faktycznie. Powstrzymał nas zwykły atrybut <code>required</code>, a z tym możemy sobie bardzo łatwo poradzić. Wiesz, że inspektor pozwala na modyfikację podglądu strony, usuń więc ten atrybut z każdego z pól formularza i spróbuj ponownie wysłać zgłoszenie bez jego wypełniania.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image31.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image31.png" alt="image" style="width: auto;"></a>
<p>Coś udało nam się osiągnąć. Aplikacja nie zwróciła nam uwagi, że pola autor czy e-mail są puste, ale niestety zauważyła, że nie wybraliśmy obrazka. Wygląda na to, że przy wysyłaniu formularza sprawdza jeszcze za pomocą JS-a, czy to pole jest wybrane.</p>
<p>Co z tym zrobić? Możemy wyłączyć JS-a, ale całkiem możliwe, że przechwycenie przez niego eventu submit odpowiada też za samą wysyłkę formularza. Wyeliminowanie JavaScriptu blokowałoby więc też sam request do serwera. Lepszym wyborem może być więc próba oszukania kodu i zrobienie z inputu plikowego dla obrazka, inputu tekstowego. W teorii mogłoby to zadziałać, bo sama wartość nie byłaby już pusta. Spróbujmy.</p>
<p>Input dla obrazka jest tutaj trochę "zaszyty". Bez problemu możesz go jednak znaleźć w prawej kolumnie.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image32.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image32.png" alt="image" style="width: auto;"></a>
<p>Gdy już go zlokalizujesz, zmień jego <code>type</code> na <code>text</code> i wpisz jako <code>value</code> dowolny tekst.</p>
<p>Niestety okazuje się, że aplikacja jest na taką zmianę odporna. Wciąż pokazuje, że zdjęcie jest niewybrane...</p>
<p>Postarajmy się więc dotrzeć do serwera naokoło. Nie musimy przecież polegać na aplikacji klienta, aby to ona wysyłała odpowiedni request. Jeśli dowiemy się, z jakim adresem łączy się przy dodawaniu zgłoszenia klient, to będziemy mogli zasymulować taki request sami, poza aplikacją, np. przy użyciu Postmana. Wtedy nic nie będzie nas już blokowało.</p>
<p>Musimy zacząć od ustalenia właściwego adresu. Jak możemy to zrobić? Wystarczy, że otworzysz zakładkę <strong>Network</strong> w narzędziach developerskich, a następnie postarasz się dodać poprawne zgłoszenie. Wtedy zobaczysz w niej informację o wysyłanym requeście.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image33.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image33.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Wiemy już, z jakim adresem mamy się połączyć, jakie dane wysyłać wraz z requestem, a nawet jaki ma być ich typ (formData). W takim razie nie pozostaje nam nic innego jak z tego skorzystać.</p>
<p>Otwórz <strong>Postmana</strong> i przygotuj odpowiedni request.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image34.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image34.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Następnie spróbuj go wysłać.</p>
<p>Niestety okazuje się, że serwer jest na taki atak odporny. Najwidoczniej sprawdza on, czy otrzymane dane nie są puste. Pierwsza próba ataku zakończyła się naszą porażką.</p>
<h4>Dodawanie zgłoszeń bez zdjęcia</h4>
<p>No dobrze, ale może przepuści nas chociaż bez zdjęcia?</p>
<p>Skoro jesteś już w Postmanie, to postaraj się teraz poprawnie wypełnić dane tekstowe, a więc <code>author</code>, <code>title</code> i <code>email</code>. Pozostaw jednak puste pole <code>file</code>. Następnie znowu wyślij request.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image35.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image35.png" alt="image" style="width: auto;"></a>
<p>I znowu serwer nas nie przepuścił... Ponownie dał sobie z nami radę.</p>
<h4>Dodawanie zgłoszeń z wadliwym plikiem</h4>
<p>No dobrze... Wygląda na to, że plik musi być wysłany. Niemniej jednak zawsze jest szansa, że serwer nie sprawdza, czy to faktycznie plik graficzny. Spróbuj w Postmanie wybrać tutaj jakiś inny plik, np. tekstowy.</p>
<p>I okazuje się, że mamy sukces!</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image36.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image36.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Jak widzisz, twórcy aplikacji nie zignorowali całkiem kwestii bezpieczeństwa. Wzięli pod uwagę, że klient niekoniecznie musi dostarczyć bezpieczne dane. Spodziewali się, że po drodze, ktoś może nimi manipulować. Mimo tego jednak, że pojawiła się jakaś walidacja na serwerze, która poradziła sobie z naszymi dwoma pierwszymi próbami, okazało się, że znalezienie luki nie było aż takie trudne. Najwyraźniej serwer sprawdza, czy został przesłany plik, ale nie waliduje jego rozszerzenia.</p>
<p>Niby to nie duża luka, ale dzięki niej udało nam się wprowadzić na stronę element bez obrazka.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image37.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image37.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Spójrz tylko. Wystarczy teraz wysłać taki request kilka razy i strona zacznie wyglądać na całkowicie popsutą.</p>
<h5>Ćwiczenie 1</h5>
<p>Pamiętaj, że mamy nie tylko szukać luk w zabezpieczeniach, ale też je łatać. Twoim zadaniem jest więc odnalezienie właściwego pliku na serwerze, który obsługuje ten endpoint i zadbanie o to, aby sprawdzał, czy rozszerzenie pliku to gif, jpg lub png. W przypadku innego formatu serwer powinien działać tak samo, jak przy próbie wysłania pustych danych.</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#collapse-VwsR-5lUz-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż wskazówkę</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/280/5935#collapse-VwsR-5lUz-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj wskazówkę</a>
  </span>
</p>
<div id="collapse-VwsR-5lUz-toggle" class="collapse">
<p>Zauważ, że stała <code>fileName</code> powinna dać Ci całą nazwę pliku wraz z rozszerzeniem, np. <code>test.jpg</code>.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> fileName <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token property-access">path</span><span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>Wystarczy więc użyć komendy <code>.split</code>, tak aby podzielić całość na dwie części. Ostatnia z nich będzie właśnie rozszerzeniem.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> fileExt <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
</div>
<h4>Dodawanie zgłoszeń z bardzo długim tytułem</h4>
<p>Po zmianach request bez poprawnego pliku już nie przejdzie, ale być może wciąż da się skorzystać z innych luk? Sprawdźmy, jak sprawa ma się z długością tytułu. Łatwo możesz zorientować się, że wpisując go w formularz, blokowane jest wszystko powyżej 25 znaków. Niemniej jednak korzystając z Postmana od razu mamy to ograniczenie z głowy. Sprawdźmy, czy serwer będzie walidował poprawność długości tytułu.</p>
<p>Spróbuj wybrać teraz dobry plik obrazka (<code>file</code>), ale zmień w swoim requeście tytuł na dłuższy niż 25 znaków.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image38.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image38.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Wygląda na to, że mamy kolejną lukę...</p>
<h5>Ćwiczenie 2</h5>
<p>Naprawienie tej dziury to kolejne Twoje zdanie. Musisz ponownie zmodyfikować endpoint odpowiedzialny za dodawanie zgłoszenia, tak aby sprawdzał, czy długość tytułu jest mniejsza lub równa 25 znaków. Jeśli jest większa, to serwer powinien pokazać błąd. Warto podobną walidację zastosować też dla autora. Tutaj ustaw maksymalną ilość znaków na 50.</p>
<h4>Dodawanie zgłoszeń ze złośliwym HTML</h4>
<p>Po zmianach serwer powinien już radzić sobie z próbą wprowadzania przydługich tytułów. Wciąż nie wiemy jednak, czy poradzi sobie z kolejną próbą ataku – wadliwym HTML-em. Spróbuj znowu zmodyfikować request, ale tym razem w taki sposób, że w tytule wpiszesz jakiś kod HTML. Na razie może to być cokolwiek. Po prostu sprawdźmy, czy serwer w ogóle na takie coś pozwoli, np. dodaj zgłoszenie o tytule <code>&lt;h1&gt;Lorem Ipsum&lt;/h1&gt;</code>.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image39.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image39.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Okazuje się, że ponownie serwer nie podołał. Wygląda na to, że radził sobie tylko z klasycznymi próbami ataku. Kiedy jednak proponujemy coś bardziej wyrafinowanego, serwer bardzo szybko ujawnia swoje braki w bezpieczeństwie.</p>
<p>Co prawda, akurat tutaj całość trochę ratuje React.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image40.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image40.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Widzimy bowiem, że nie renderuje kodu HTML otrzymanego od serwera. Tym samym nie musimy się też bać, że wzięty byłby pod uwagę element ze złośliwym atrybutem <code>style</code>. Niemniej jednak i tak nie wygląda to za dobrze...</p>
<h5>Ćwiczenie 3</h5>
<p>Na szczęście Ty, po lekturze pierwszych podrozdziałów z tego modułu, już wiesz, jak można sobie z tym radzić. Dlatego też Twoim zadaniem jest ponownie taka naprawa wadliwego endpointu, aby właściwie escape'ował wszystkie otrzymywane od klienta dane. Możesz również po prostu sprawdzać za pomocą wyrażenia regularnego, czy otrzymuje odpowiednie informacje, np. e-mail powinien być tylko ciągiem liter lub kropek, rozdzielonych do tego znakiem <code>@</code>.</p>
<h4>Wnioski</h4>
<p>Pierwsza część naszych testów bezpieczeństwa przynosi dwa ważne wnioski.</p>
<p>Po pierwsze, <strong>przy pisaniu aplikacji naprawdę łatwo o luki w bezpieczeństwie</strong>. Nawet jeśli staramy się chociaż podstawowo walidować otrzymywane od klienta dane, często jest to zbyt mało.</p>
<p>Po drugie, <strong>dobre praktyki omawiane w pierwszym podrozdziale... naprawdę mają sens</strong>. Zauważ, że wszystkie luki wzięły się stąd, że autor kodu nie zastosował się do kilku podstawowych zasad. Zwróć uwagę, że trzymając się standardu podwójnej dokładnej walidacji, nieufania klientowi oraz escape'owania wszystkich otrzymywanych danych, autor stworzyłby aplikację, która dałaby sobie radę z każdą z naszych prób.</p>
<h3 id="315-po-drugiej-stronie-barykady-nieuczciwy-uczestnik">Nieuczciwy uczestnik</h3>
<p>Czas na drugi scenariusz ataku. Tym razem wcielimy się w rolę nieuczciwego uczestnika konkursu. Postaramy się znaleźć i wykorzystać niedoskonałości systemu w taki sposób, aby pozwolił na wielokrotne głosowanie na naszą pracę. Dzięki temu będziemy w stanie osiągnąć nieuczciwą przewagę nad konkurencją, na którą każdy odwiedzający może oddać tylko jeden głos.</p>
<h4>Analiza funkcjonalności</h4>
<p>Zacznijmy od przeanalizowania, jak mniej więcej działa cała funkcjonalność. Oczywiście mówimy wyłącznie o części klienta, bo tylko do niej atakujący ma w normalnej sytuacji dostęp.</p>
<p>Rozpoczniemy od sprawdzenia tego, co widzi zwykły użytkownik.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image41.gif" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image41.gif" alt="image" style="width: auto;"></a>
<p>Po najechaniu na zdjęcie otrzymuje on opcję kliknięcia serduszka, co pozwala dodać polubienie. Naciśnięcie powoduje zwiększenie widocznej liczby lajków (z 7 do 8 na naszym przykładzie), ale też zniknięcie samego przycisku. Użytkownik nie ma już nawet fizycznej opcji spróbowania po raz kolejny. Co istotne, po odświeżeniu stan rzeczy się utrzymuje, a więc liczba głosów wciąż jest zwiększona, a serduszko na zdjęciu nadal jest niewidoczne. Możemy więc przypuszczać, że klient w jakiś sposób komunikuje się z serwerem, by poinformować o lajkowaniu.</p>
<p>Jesteśmy w stanie to łatwo ustalić. Wystarczy, że otworzysz zakładkę <strong>Network</strong> i pozostawisz ją otwartą podczas próby polubienia kolejnego zdjęcia.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image42.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image42.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Zgodnie z naszymi przypuszczeniami, kliknięcie na serduszko inicjuje request do serwera, ale wygląda on bardzo prosto. Nie są wysyłane żadne dodatkowe informacje, a serwer wie, o jaki obrazek chodzi dzięki przekazaniu id poprzez adres. Pojawia się tylko jedno pytanie. Czy wraz ze zwiększeniem liczby głosów, serwer zapisuje też gdzieś informację o tym, że to właśnie my zagłosowaliśmy? Jeśli tak, to ciężko będzie nam go oszukać, że jesteśmy kimś innym. Możliwe jednak, że autor kodu wcale nie wykorzystuje do tego zadania serwera, tylko np. używa zwykłych ciasteczek. To znacznie ułatwiłoby nam sprawę. Postaramy się to sprawdzić.</p>
<h4>Próby do przeprowadzenia</h4>
<p>Zaplanujmy naszą pracę. Postaramy się sprawdzić kilka możliwych luk:</p>
<ol>
<li><strong>Ciasteczka</strong> – możliwe, że autor strony zdecydował o tym, że to ciasteczka będą trzymały informację o zdjęciach, na które zagłosowaliśmy. Ich usunięcie powinno wtedy pozwolić nam na ponowne zagłosowanie.</li>
<li><strong>localStorage</strong> – trochę ciekawszym, ale również łatwym do obejścia pomysłem, byłoby wykorzystanie <code>localStorage</code>, który także możemy wyczyścić. W razie porażki z ciasteczkami warto to sprawdzić.</li>
<li><strong>Request poza klientem</strong> – jeśli okaże się, że to coś innego, czego nie możemy wykryć, zawsze jest nadzieja, że blokada znajduje się w aplikacji klienta. Wtedy możemy liczyć, że request poza klientem to obejdzie.</li>
</ol>
<p>Do dzieła!</p>
<h4>Ciasteczka</h4>
<p>Zacznijmy od sprawdzenia pierwszej możliwości. Najprostsze zablokowanie ponownego głosowania rzeczywiście może być zrobione przy użyciu ciasteczek, ale ma to sens tylko wtedy, gdy zakładamy, że nasi użytkownicy są zwykłymi internautami. Zawsze znajdą&nbsp;się jednak bardziej zaznajomieni z tematem, więc nie powinniśmy opierać istotnych funkcjonalności na ciasteczkach.</p>
<p>Tak czy inaczej, sprawdźmy to. Wejdź do narzędzi developerskich swojej przeglądarki i odnajdź zakładkę <strong>Application</strong>, a w niej samą opcję <strong>Cookies</strong>. Rozwiń ją i wskaż, że chodzi dokładnie o <code>localhost:3000</code>.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image43.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image43.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Okazuje się, że w istocie jakieś ciasteczka na naszej witrynie są. Niestety akurat <code>_ga</code> to nazwa używana przez Google Analytics, serwis obsługujący statystki witryn. Raczej wątpliwe, by autor strony chciał nas oszukać i skorzystał właśnie z takiej nazwy. Drugie, czyli <code>io</code> też nie sugerują nam tego, po co przyszliśmy. Mimo to jednak możesz spróbować je usunąć.</p>
<p>Jaki jest efekt? Nic się nie zmieniło. Wygląda więc na to, że w taki sposób serwera nie oszukamy.</p>
<h4>LocalStorage</h4>
<p>Skoro już jednak jesteśmy w zakładce <strong>Application</strong>, warto sprawdzić również drugą możliwość, a więc <strong>localStorage</strong>. Tutaj sytuacja jest już znacznie bardziej optymistyczna.</p>
<a href="./Moduł_ 31. Zabezpieczona aplikacja_files/image44.png" class="img-modal-group"><img src="./Moduł_ 31. Zabezpieczona aplikacja_files/image44.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Wśród wielu pozornie bezużytecznych dla nas informacji, znajduje się prawdopodobnie ta, której szukaliśmy – tablica <code>votes</code>. Spójrz na jej wartość. Wygląda na to, że przechowuje informacje o tym, na kogo głosowaliśmy.</p>
<p>Sprawdźmy ten trop. Usuń wpis <code>votes</code> z <code>localStorage</code> i odśwież stronę. Jeśli nasze podejrzenia się sprawdzą, powinniśmy móc ponownie polajkować te same zdjęcia.</p>
<p>Wygląda na to, że... trafiliśmy! Autor zapomniał o jednej ważnej zasadzie – nie ufaj klientowi. Jak widzisz zarówno idea z ciasteczkami, jak i localStorage, to słaby pomysł, łatwy do obejścia. Zauważ, że wystarczyło wyczyścić te informacje i po sprawie. Można było również wykonać request spoza klienta i osiągnęlibyśmy taki sam efekt. Nie musimy więc nawet sprawdzać tej trzeciej możliwości.</p>
<h5>Ćwiczenie 1</h5>
<p>Skoro mamy już lukę, musimy ją teraz załatać. To będzie właśnie Twoje zadanie.</p>
<p>Postaramy się wykorzystać serwer do pilnowania lajków. Idea będzie całkiem prosta. Przy kliknięciu na serduszko, serwer najpierw sprawdzi, czy użytkownik o danym IP już głosował. Jeśli tak było, to proces lajkowania zostanie zablokowany.</p>
<p>Jak powinno wyglądać to w praktyce? Wykorzystamy w zadaniu bazę danych. Przy każdym kliknięciu na serce zapiszemy informację z jakiego IP zagłosowano na jakie zdjęcie. Dzięki temu przy procesie polubienia zawsze będziemy w stanie sprawdzić w bazie, czy głos na dane zdjęcie został już&nbsp;oddany.</p>
<p>Oczywiście adres IP to nie jest coś, czego nie da się oszukać, ale jednak taki bufor powinien odstraszyć już pewną rzeszę śmiałków.</p>
<p><strong>Etap 1</strong></p>
<p>Dodaj do serwera nowy model danych <code>Voter</code> (kolekcja <code>voters</code>), który będzie posiadał dwa pola – <code>user</code> oraz <code>votes</code>. Pierwsze zapisze adres IP użytkownika, jakiego tyczy się dany dokument, a drugie będzie tablicą zawierającą informacje, na jakie fotografie ta osoba zagłosowała, w postaci listy identyfikatorów tych zdjęć.</p>
<p><strong>Etap 2</strong></p>
<p>Przy próbie lajkowania zdjęcia, sprawdzaj czy w kolekcji <code>voters</code> znajduje się już wpis dla danego adresu IP. Jeśli nie, to stwórz go i dodaj od razu do jego atrybutu <code>votes</code> identyfikator polubionego zdjęcia. Pozwól też na normalną modyfikację ilości głosów, czyli krótko mówiąc, jeśli osoba jeszcze nigdy nie głosowała, zapisz informację o niej w bazie oraz to, że właśnie zagłosowała na dane zdjęcie, a następnie faktycznie dodaj głos.</p>
<p><strong>Etap 3</strong></p>
<p>Zmodyfikuj endpoint do lajkowania po raz kolejny. Dodaj warunek, który zakłada, że dany adres IP jednak już jest w bazie. W takiej sytuacji dodaj kod sprawdzający, czy głosowano na wybrane zdjęcie. Jeśli nie, dodaj identyfikator zdjęcia do <code>votes</code> tego użytkownika oraz normalnie zwiększ liczbę głosów. Jeśli jednak okaże się, że już głosowano na to zdjęcie, to zwróć błąd serwera (<code>500</code>).</p>
<p>Od tej chwili serwer będzie przechowywał informacje jacy użytkownicy (o jakim IP) głosowali na zdjęcia, i na które dokładnie. Jeśli wykryje próbę zagłosowania na fotografię jeszcze raz, to po prostu zwróci błąd.</p>
<p>Do wykonania zadania możesz wykorzystać paczkę <a href="https://github.com/pbojinov/request-ip" target="_blank">request-ip</a>.</p>
<h4>Wnioski</h4>
<p>Luki dałoby się uniknąć, gdyby autor stosował się do dobrych praktyk. Podobnie jak wcześniej, twórca zapomniał o zasadzie ograniczonego zaufania względem klienta.</p>
<p>Ten submoduł powinien uświadomić Ci, że dla osoby obeznanej w temacie tego typu manipulacje są naprawdę łatwym zadaniem.</p>

                        </div>
                    </div>
                                        <div class="card-block task-card">
                        <h3 id="315-po-drugiej-stronie-barykady-zadanie-gotowe">Zadanie: <span class="task-title">gotowe!</span></h3>
                        <div class="task-content">
                            <p>Stwórz nowe repozytorium na GitHubie i wyślij tam projekt, nad którym pracowaliśmy w niniejszym submodule. Na tym etapie powinien on być już zabezpieczony przed znalezionymi zagrożeniami, a więc wszystkie ćwiczenia powinny być na nim wykonane.</p>

                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <div class="clearfix">
                                                                                <a href="https://kodilla.com/pl/bootcamp-task/407/670845" target="_blank" class="btn btn-info-outline">Podgląd zadania</a>
                            <form target="_blank" class="form-inline project-link-form">
                                <div class="form-group">
                                    <input type="text" name="link" class="form-control" value="https://github.com/skwiryt/portraitMaster">
                                </div>
                                <button type="submit" class="btn  btn-primary ">Wyślij link <i class="fa fa-check"></i></button>
                            </form>
                                                                                                    </div>
                    </div>
                </section>
                                    
                <section id="submodule-1181" class="card submodule completed" data-bootcamp-user-submodule-id="670846">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">31.6. <span>Podsumowanie</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Moduł był dość nietypowy. Poprzednio ciągle poznawaliśmy nowe technologie, a tym razem nie uświadczyliśmy wielu nowości. Zamiast tego skupiliśmy się na czymś ważniejszym, czyli bezpieczeństwie. Dobra aplikacja to nie tylko taka, która zaoferuje wiele sprawnie działających funkcjonalności, <strong>dobra aplikacja przede wszystkim musi być bezpieczna</strong>.</p>
<p>Dopóki pracowaliśmy nad projektami do nauki, nie wiedzieliśmy, jak bardzo jest to ważne. W końcu, gdyby ktoś zaatakował którąś z naszych aplikacji, straty z tym związane byłyby niewielkie.</p>
<p>Staraliśmy się uświadomić Ci, jak łatwo można wyrządzić wiele krzywd słabo zabezpieczonej witrynie, gdy ma się chociaż trochę wiedzy na ten temat, a złych ludzi, czy wojującej konkurencji na rynku nigdy nie brakuje.</p>
<p>W swojej pracy będziesz zajmować się głównie komercyjnymi projektami, a tam bezpieczeństwo to temat numer jeden.</p>
<p>Jeśli zawiedziemy, <strong>możemy narazić klientów na wyciek wrażliwych danych, ogromne starty finansowe oraz wizerunkowe</strong>. Mimo że poruszyliśmy temat bezpieczeństwa tak późno w kursie, musisz traktować go jako priorytet przy budowaniu aplikacji.</p>

                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <small>Jeśli masz wątpliwości do powyższego materiału, to - zanim zatwierdzisz - zapytaj na czacie :)</small>
                                                <div class="clearfix">
                                                                                <button class="btn  btn-primary "><i class="fa fa-check"></i><span>Zapoznałe(a)m się!</span></button>
                                                                                                    </div>
                    </div>
                </section>
                                    
                <section id="submodule-1191" class="card submodule completed" data-bootcamp-user-submodule-id="670847">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">31.7. <span>Quiz powtórkowy</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Na koniec przygotowaliśmy dla Ciebie quiz powtórkowy. Pomoże Ci on utrwalić wiedzę z poprzednich modułów.</p>
<p>Odpowiedzi nie są nigdzie zapisywane, więc pozostaną tylko do Twojej wiadomości. Ten quiz ma Ci posłużyć jako pomoc w nauce – dlatego pod każdym pytaniem znajdziesz guzik, który sprawdzi poprawność Twoich odpowiedzi oraz poda Ci wyjaśnienie poruszanego zagadnienia.</p>

        <div class="kodilla-quiz">
      
        <article class="question initiated" data-type="multiple-choice">
      
        <header>
          <p><em>1.</em> Pomówmy o testowaniu kodu w backendzie:</p>

        </header>
        <ol type="a" class="answers" data-correct="1,3">
          <li><label><input type="checkbox"> jest ono mniej ważne niż frontendowe, ponieważ większość logiki naszych aplikacji umieściliśmy po stronie klienta</label></li>
<li><label><input type="checkbox"> do testów możemy użyć&nbsp;Postmana i MongoDB Compass</label></li>
<li><label><input type="checkbox"> testy automatyczne są mniej wiarygodne niż te przeprowadzane "ręcznie"</label></li>
<li><label><input type="checkbox"> na testowanie w backendzie składa się m.in. weryfikowanie operacji CRUD oraz sprawdzanie działania endpointów</label></li>
        </ol>
        <div class="buttons text-center">
          <button class="button-ok btn btn-primary">Sprawdź odpowiedź</button>
        </div>
      
      
        <div class="explanation">
          <div class="bc-note alert-success">
            <h4 class="alert-heading text-center">Wyjaśnienie</h4>
      <p>Testy w backendzie są tak samo ważne, jak te przeprowadzane po stronie klienta. Każda aplikacja webowa łączy w sobie te dwie dziedziny i działa poprawnie, tylko jeśli wszystkie elementy są&nbsp;napisane właściwie.
Oczywiście możemy użyć narzędzi typu Postman czy MongoDB Compass, choć na dłuższą metę jest to uciążliwe i mozolne. Przy większej ilości zmian i elementów do sprawdzenia, o wiele lepszym rozwiązaniem jest tworzenie testów automatycznych, które (jeśli dobrze napisane) są równie wiarygodne, jak te "ręczne", a z pewnością wygodniejsze.
Na testowanie w backendzie składa się m.in. sprawdzanie modeli Mongoose (jeśli używamy tej biblioteki), testowanie operacji CRUD oraz weryfikacja działania endpointów. Jeśli mamy taką potrzebę, możemy testować również działanie WebSocketów.</p>

          </div>
        </div>
      
        </article>
      
        <article class="question initiated" data-type="multiple-choice">
      
        <header>
          <p><em>2.</em> Załóżmy, że mamy funkcję <code>cutText</code>, która przyjmuje dwa argumenty: <code>content</code> i <code>maxLength</code> oraz zwraca błąd, gdy <code>content</code> nie jest stringiem.</p>
<pre class=" language-markup"><code class=" language-markup">if(typeof content !== 'string') return 'Error';</code></pre>

        </header>
        <ol type="a" class="answers" data-correct="1,4">
          <li><label><input type="checkbox"> taki skrypt nie może działać błędnie, więc nie jesteśmy w stanie go przetestować</label></li>
<li><label><input type="checkbox"> testy tworzymy w bloku <code>describe</code></label></li>
<li><label><input type="checkbox"> do przetestowania tej funkcji za pomocą <code>expect</code> wystarczy pakiet Mocha</label></li>
<li><label><input type="checkbox"> w teście nie musimy przekazywać&nbsp;do funkcji obydwu argumentów</label></li>
<li><label><input type="checkbox"> funkcję powinniśmy zbadać na różne sposoby, m.in. podając jako argument <code>content</code> nie tylko zwykły <code>string</code>, ale także <code>number</code> czy <code>object</code></label></li>

        </ol>
        <div class="buttons text-center">
          <button class="button-ok btn btn-primary">Sprawdź odpowiedź</button>
        </div>
      
      
        <div class="explanation">
          <div class="bc-note alert-success">
            <h4 class="alert-heading text-center">Wyjaśnienie</h4>
      <p>Każdy skrypt powinien być&nbsp;przetestowany i nie możemy zakładać z góry, że działa bezbłędnie.
Testy w backendzie wykonujemy np. za pomocą pakietu Mocha, jednak jest on tylko task runnerem i nie ma wbudowanej biblioteki asercji. Dlatego, by skorzystać z dobrodziejstw funkcji <code>expect</code>, wraz z Mochą używa się też Chai.
Same testy konstruujemy w bloku <code>describe</code> i powinniśmy w nich przekazywać do funkcji wszystkie wymagane argumenty. Jeśli chcemy przetestować, jak funkcja poradzi sobie przy ich braku, możemy zastosować <code>undefined</code>, np. <code>expect(cutText(undefined, 20)).to.equal('Error');</code>. W tym przykładzie pierwszy argument jest niezdefiniowany, a drugi właściwy (<code>20</code>).
W przypadku tej funkcji nie wystarczy sprawdzenie jak poradzi sobie ze stringiem. Musimy jeszcze skontrolować co stanie się w sytuacji, gdy pojawią się&nbsp;inne typy danych, jak liczby czy obiekty.</p>

          </div>
        </div>
      
        </article>
      
        <article class="question initiated" data-type="multiple-choice">
      
        <header>
          <p><em>3.</em> Załóżmy, że nasz serwer będzie komunikował się z bazą danych MongoDB, a do modelowania danych użyliśmy Mongoose.</p>

        </header>
        <ol type="a" class="answers" data-correct="1">
          <li><label><input type="checkbox"> sprawdzenie działania schematu struktur danych w modelach gwarantuje, że komunikacja z bazą danych będzie funkcjonować bez zarzutu</label></li>
<li><label><input type="checkbox"> przy testach metod CRUD możemy symulować bazę danych za pomocą paczki <code>mongodb-memory-server</code></label></li>
<li><label><input type="checkbox"> dobrą praktyką jest praca na tej samej bazie danych, z której korzystają obecnie użytkownicy, bo w ten sposób mamy wiarygodniejsze testy</label></li>

        </ol>
        <div class="buttons text-center">
          <button class="button-ok btn btn-primary">Sprawdź odpowiedź</button>
        </div>
      
      
        <div class="explanation">
          <div class="bc-note alert-success">
            <h4 class="alert-heading text-center">Wyjaśnienie</h4>
      <p>Testowanie schematu struktur danych to dobra praktyka. Zapewnia nas bowiem, że Mongoose będzie w stanie dbać o poprawność danych wprowadzanych do bazy, niemniej jednak w żaden sposób nie daje nam gwarancji, że sama komunikacja z nią działa bez zarzutów.
Najlepszą praktyką jest praca poza bazą, która jest w użyciu, ponieważ wyniki testów mogą być&nbsp;zafałszowane, gdy użytkownicy dodają w czasie ich trwania swoje dane. Dlatego do testowania metod CRUD możemy posłużyć się symulacją bazy za pomocą np. <code>mongodb-memory-server</code>.</p>

          </div>
        </div>
      
        </article>
      
        <article class="question initiated" data-type="multiple-choice">
      
        <header>
          <p><em>4.</em> Testujemy endpointy.</p>

        </header>
        <ol type="a" class="answers" data-correct="1,2">
          <li><label><input type="checkbox"> jesteśmy w stanie symulować requesty za pomocą&nbsp;wbudowanej w Chai funkcji <code>request</code></label></li>
<li><label><input type="checkbox"> możemy do testów użyć&nbsp;prawdziwej bazy danych, ale najbezpieczniej jest pracować na jej lokalnej kopii</label></li>
<li><label><input type="checkbox"> w czasie testów, możemy dodać próbne dane w hooku <code>before</code>, a potem usunąć je w <code>after</code></label></li>

        </ol>
        <div class="buttons text-center">
          <button class="button-ok btn btn-primary">Sprawdź odpowiedź</button>
        </div>
      
      
        <div class="explanation">
          <div class="bc-note alert-success">
            <h4 class="alert-heading text-center">Wyjaśnienie</h4>
      <p>Owszem, by symulować requesty musimy użyć funkcji <code>request</code>, ale nie jest ona wbudowana w Chai. Do tego potrzebujemy jeszcze pluginu o nazwie <code>chai-http</code>.
By nie ingerować w kod serwera, możemy pracować nie na symulacji, a na prawdziwej bazie danych. Najbezpieczniej jednak korzystać z jej lokalnej kopii.
Używanie hooków <code>before</code> i <code>after</code> znacznie ułatwi nam pracę i sprawi, że będziemy mogli przeprowadzać testy na danych, które sami wprowadzimy.</p>

          </div>
        </div>
      
        </article>
      
        </div>
        
<style>
  .kodilla-quiz .question {
    margin-bottom: 1.5em;
  }
  .kodilla-quiz .explanation {
    display: none;
  }
  .kodilla-quiz li>label {
    display: inline-block;
    padding-top: 1px;
    vertical-align: top;
  }
</style>
<script>
  if(typeof initQuizzes == 'undefined'){
    function initQuizzes(){
      var types = {
        'multiple-choice': initMultipleChoice,
      };

      var questions = document.querySelectorAll('.kodilla-quiz .question');

      for(var i=0; i<questions.length; i++){
        var question = questions[i];
        var initFunc = types[question.dataset.type];

        if(typeof(initFunc) != 'undefined' && !question.classList.contains('initiated')){
          question.classList.add('initiated');
          initFunc(question);
        }
      }
    }

    function initMultipleChoice(question){
      var answers = question.querySelector('.answers');
      var inputs = answers.querySelectorAll('input');
      var buttons = question.querySelector('.buttons');
      var buttonOK = buttons.querySelector('.button-ok');
      var explanation = question.querySelector('.explanation');
      var correct = question.querySelector('[data-correct]').dataset.correct.split(',');

      buttonOK.addEventListener('click', function(e){
        e.preventDefault();

        var inputsChecked = answers.querySelectorAll('input:checked');
        if(inputsChecked.length == 0){
          alert('Wybierz co najmniej jedna odpowiedź');
          return;
        }

        correct.forEach(function(index){
          inputs[index].parentNode.parentNode.classList.add('text-success', 'text-bold');
        });

        for (var i = 0; i < inputs.length; i++) {
          var input = inputs[i];
          var li = input.parentNode.parentNode;
          input.setAttribute('disabled', true);
          
          if(input.checked){
            li.classList.add('text-bold');
            
            if(!li.classList.contains('text-success')){
              li.classList.add('text-danger');
            }
          }

        }
        
        if(explanation) explanation.style.display = 'block';
        buttons.setAttribute('hidden', true);
      });
    }
  }
  initQuizzes();
</script>

      
                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <small>Jeśli masz wątpliwości do powyższego materiału, to - zanim zatwierdzisz - zapytaj na czacie :)</small>
                                                <div class="clearfix">
                                                                                <button class="btn  btn-primary "><i class="fa fa-check"></i><span>Zapoznałe(a)m się!</span></button>
                                                                                                    </div>
                    </div>
                </section>
                            </main>
        </div>
    </section>
</main>
;
<script async="" src="./Moduł_ 31. Zabezpieczona aplikacja_files/ei.js"></script>
<script type="text/x-translation" data-translation-name="SentBootcampLinkReviewFormMessage">Wysłano link do zatwierdzenia</script>
    <div id="alerts">
    <div class="alert alert-danger" role="alert" style="display: none;">
        <i class="fa fa-exclamation" aria-hidden="true"></i>
        <button type="button" class="close" data-hide="alert" aria-label="Zamknij">
            <span aria-hidden="true">×</span>
            <span class="sr-only">Zamknij</span>
        </button>
        <ul>
                        </ul>
    </div>
    <div class="alert alert-success" role="alert" style="display: none;">
        <i class="fa fa-check" aria-hidden="true"></i>
        <button type="button" class="close" data-hide="alert" aria-label="Zamknij">
            <span aria-hidden="true">×</span>
            <span class="sr-only">Zamknij</span>
        </button>
        <ul>
                </ul>
    </div>
    <div class="alert alert-warning" role="alert" style="display: none;">
        <i class="fa fa-warning" aria-hidden="true"></i>
        <button type="button" class="close" data-hide="alert" aria-label="Zamknij">
            <span aria-hidden="true">×</span>
            <span class="sr-only">Zamknij</span>
        </button>
        <ul>
                </ul>
    </div>
    <div class="alert alert-info" role="alert" style="display: none;">
        <i class="fa fa-info" aria-hidden="true"></i>
        <button type="button" class="close" data-hide="alert" aria-label="Zamknij">
            <span aria-hidden="true">×</span>
            <span class="sr-only">Zamknij</span>
        </button>
        <ul>
                    </ul>
    </div>
    <div class="container">
        <div class="alert alert-notify" role="alert" style="display: none;">
            <i class="fa fa-info" aria-hidden="true"></i>
            <button type="button" class="close" data-hide="alert" aria-label="Zamknij">
                <span aria-hidden="true">×</span>
                <span class="sr-only">Zamknij</span>
            </button>
            <ul>
                            </ul>
        </div>
    </div>
</div>
    <div class="modal fade informator-modal" id="informator" tabindex="-1" role="dialog" aria-labelledby="informatorModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <img src="./Moduł_ 31. Zabezpieczona aplikacja_files/logo-menu.png" alt="Logo Kodilla" class="brand-logo">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i class="fa fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body content-container">
                <h3>Zamów szczegółowy informator</h3>
                <form class="row js-ajax-form" data-view-class="InformatorForm" action="https://kodilla.com/pl/download-informator" method="post">
                    <input type="hidden" name="ga-pobieranie-informatora-z-modala" value="wypelnienie">
                    <input type="hidden" name="tags[0]" value="informator">
                                        <div class="user-data-container">
                        <input type="text" class="form-control" name="firstname" placeholder="Imię">
                        <input type="text" class="form-control" name="surname" placeholder="Nazwisko">
                    </div>
                    <div class="user-data-container">
                        <input type="email" class="form-control" name="email" placeholder="Email" required="">
                        <input type="tel" class="form-control" name="phone" placeholder="Numer telefonu" pattern="^([\+][0-9]{1,3}([ \.\-])?)?([\(]{1}[0-9]{3}[\)])?([0-9 \.\-]{1,15})$" title="Wpisz poprawny numer telefonu, np. 453 674 897" minlength="9" maxlength="15" data-custom-message="Wpisz poprawny numer telefonu, np. 453 674 897">
                    </div>
                    <div class="terms-box">
                        <label>
                            <input name="accept_terms" value="true" data-custom-message="Prosimy o zaakceptowanie regulaminu" type="checkbox" class="form-control input-checkbox" required="">
                            <span>Akceptuję <a target="_blank" href="https://kodilla.com/pl/regulamin">regulamin</a>  i nie wnoszę zastrzeżeń</span>
                        </label>
                    </div>
                    <div class="personal-terms-box">
                        <label>
                            <input name="accept_marketing" value="true" data-custom-message="Jeśli chcesz otrzymać dostęp do materiałów, konieczna jest akceptacja obydwu zgód" type="checkbox" class="form-control input-checkbox" required="">
                            <span>Chcę otrzymywać newsletter, informacje o promocjach i produktach dostępnych w Kodilla.
                                <span class="details-button" data-action="show-details" data-identifier="personal-terms-details-informator">Czytaj więcej</span>
                                <span class="display-none" data-identifier="personal-terms-details-informator">Wyrażam zgodę na otrzymywanie informacji handlowych od Kodilla na podany przeze mnie adres e-mail. Zgoda jest dobrowolna, jednakże niezbędna do otrzymywania informacji o produktach, promocjach i o tym, co u nas słychać. Administratorem danych jest Codemy S.A. z siedzibą we Wrocławiu, Plac Powstańców Śląskich 13/4. Mam prawo cofnąć zgodę w każdym czasie, jednak wtedy nie będę otrzymywać informacji. Dane mogą być przetwarzane pomimo cofnięcia zgody wyłącznie w takim zakresie i celu, w jakim ich przetwarzanie jest niezbędne do ustalenia, dochodzenia lub obrony roszczeń Administratora w związku z udzieloną zgodą. Mam prawo dostępu do danych, sprostowania, usunięcia, ograniczenia przetwarzania, prawo wniesienia sprzeciwu, skargi do organu nadzorczego i przeniesienia danych. Szczegółowe informacje znajdują się na stronie kodilla.com, zakładka "Polityka Prywatności".</span>
                            </span>
                        </label>
                    </div>
                    <div class="display-none">
                        <input type="text" name="myName" value="">
                    </div>
                    <div class="">
                        <button type="submit" class="btn btn-primary">
                            Pobierz Informator
                            <i data-role="loading-icon" class="fa fa-spinner fa-spin fa-1x fa-fw display-none"></i>
                        </button>
                    </div>
                </form>
                <a href="https://kodilla.com/pl/informator" id="informator-link" target="_blank" class="display-none"></a>
            </div>
            <div class="modal-footer">
                <p>Pobranie informatora do niczego nie zobowiązuje</p>
            </div>
        </div>
    </div>
</div>
<footer class="site-footer">
                <section class="footer-lower">
            <nav class="container">
                <a class="navbar-img" href="https://kodilla.com/pl">
                    <svg id="kodilla-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 168 29.553" width="168" height="30">
                        <defs>
                            <style>
                                .footer-logo-fill {
                                    fill: #fff;
                                }
                            </style>
                        </defs>
                        <g id="Group_1" data-name="Group 1" transform="translate(23.59)">
                            <path id="KODILLA_copy_5_1_" class="footer-logo-fill" d="M78.058,0a14.758,14.758,0,1,0,.075,0Zm0,23.739a8.939,8.939,0,0,1-8.944-8.907V14.8c0-4.957,4.584-.708,8.907-.708,4.919,0,9.019-4.211,9.019.708a8.978,8.978,0,0,1-8.981,8.944Z" transform="translate(-63.3)"></path>
                            <ellipse id="eye_copy_4_1_" class="footer-logo-fill" cx="3.876" cy="3.876" rx="3.876" ry="3.876" transform="translate(9.462 13.2) rotate(-28.436)"></ellipse>
                        </g>
                        <path id="Path_1" data-name="Path 1" class="footer-logo-fill" d="M0,29.819V.9H6.671V13.347L17.255.9h7.491L13.938,13.794,25.491,29.819h-7.6l-8.2-11.665-3.019,3.13v8.5H0Z" transform="translate(0 -0.565)"></path>
                        <path id="Path_2" data-name="Path 2" class="footer-logo-fill" d="M151.4,29.819V.9h10.807a15.515,15.515,0,0,1,6.261,1.155,12.966,12.966,0,0,1,4.509,3.093A12.918,12.918,0,0,1,175.7,9.732a17.245,17.245,0,0,1,.932,5.59,16.821,16.821,0,0,1-1.006,5.963,12.227,12.227,0,0,1-2.907,4.547,13.484,13.484,0,0,1-4.547,2.944,15.964,15.964,0,0,1-5.925,1.043Zm18.41-14.5a11.274,11.274,0,0,0-.522-3.466,7.723,7.723,0,0,0-1.491-2.72,6.616,6.616,0,0,0-2.385-1.752,8.055,8.055,0,0,0-3.205-.6h-4.1v17.18h4.1a7.985,7.985,0,0,0,3.242-.634,6.8,6.8,0,0,0,2.385-1.826,8.286,8.286,0,0,0,1.453-2.72A11.634,11.634,0,0,0,169.81,15.322Z" transform="translate(-94.978 -0.565)"></path>
                        <path id="Path_3" data-name="Path 3" class="footer-logo-fill" d="M228.3,29.819V.9h6.671V29.819Z" transform="translate(-143.219 -0.565)"></path>
                        <path id="Path_4" data-name="Path 4" class="footer-logo-fill" d="M259.9,29.819V.9h6.671V23.968h14.012v5.851Z" transform="translate(-163.043 -0.565)"></path>
                        <path id="Path_5" data-name="Path 5" class="footer-logo-fill" d="M327.371,23.931V.9H320.7V29.819h18.522l2.124-5.851H327.371Z" transform="translate(-201.185 -0.565)"></path>
                        <path id="Path_6" data-name="Path 6" class="footer-logo-fill" d="M388.547.9h6.037L405.13,29.819h-6.857l-2.236-6.484h-9.019l-2.2,6.484H378Zm6.373,17.851L391.528,8.54l-3.466,10.211Z" transform="translate(-237.13 -0.565)"></path>
                    </svg>
                </a>
                <ul class="nav">
                    <li>
                        <a href="https://kodilla.com/pl/regulamin" rel="nofollow">Regulamin</a>
                    </li>
                    <li>
                        <a href="https://kodilla.com/pl/polityka-prywatnosci" rel="nofollow">Polityka prywatności</a>
                    </li>
                    <li class="nav-item nav-item-last">© 2021 Kodilla</li>
                </ul>
            </nav>
        </section>
    </footer>

<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KN2WWBH" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <script src="./Moduł_ 31. Zabezpieczona aplikacja_files/jquery-2.1.4.min.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/js.cookie-2.1.0.min.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/jquery-dateFormat.min.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/bootstrap.min.js"></script>
<script>
    (function () {
        $(document).ready(function () {
            if (window.location.hash === '#informator-modal') {
                showInformator();
            }
        });

        $('[data-action="show-modal"]').click(function() {
            showInformator();
        });

        function showInformator() {
            $('#informator').modal('show');
        }
    })();
</script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/fb-412414a519.js" async=""></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/call-us-261b222cf4.js"></script>
<script>
    if (document.querySelector('main.editor')) {
        document.querySelector('body').classList.add('editor');
    }
</script>

<script type="text/javascript" async="">
  setTimeout(function (){
      (function(e,t,o,n,p,r,i){e.visitorGlobalObjectAlias=n;e[e.visitorGlobalObjectAlias]=e[e.visitorGlobalObjectAlias]||function(){(e[e.visitorGlobalObjectAlias].q=e[e.visitorGlobalObjectAlias].q||[]).push(arguments)};e[e.visitorGlobalObjectAlias].l=(new Date).getTime();r=t.createElement("script");r.src=o;r.async=true;i=t.getElementsByTagName("script")[0];i.parentNode.insertBefore(r,i)})(window,document,"https://diffuser-cdn.app-us1.com/diffuser/diffuser.js","vgo");
      vgo('setAccount', '649095895');
      vgo('setTrackByDefault', true);

      vgo('process');
  }, 3000);

</script>

<script>
    document.addEventListener("DOMContentLoaded", yall);
    window.environment = 'production';
    window.loggedIn = true;
    window.domain = 'https://kodilla.com';
            window.fbAppId = 1449248938627896;
    window.chatService = 'LiveAgent';
    window.useMessenger = window.chatService === 'Messenger';
    window.locale = 'pl';
    window.lang = 'pl';

    window.serverUTC       = 1627846070000;
    window.serverOffset    = 120;
    window.userDate        = new Date();
    window.userUTC         = userDate.getTime();
    window.userOffset      = userDate.getTimezoneOffset() * (-1);
    window.userClockDiff   = userUTC - serverUTC;
    window.diffRounded     = Math.round( userClockDiff / ( 1000 * 60 * 15 ) );
    window.isDifferentZone = ( userOffset - serverOffset !== 0 ) ? 1 : 0;
    window.hasWrongTime    = ( diffRounded !== 0 ) ? 1 : 0;
    window.dateTooltipText = 'Data i godzina są podane dla Twojej strefy czasowej GMT. <br>W razie wątpliwości napisz: <u>support@kodilla.com</u>.';
    window.wrongHourNotice = 'Godzina na Twoim urządzeniu r&oacute;żni się od godziny obowiązującej w strefie czasowej wybranej w ustawieniach Twojego urządzenia.';

    window.PAYU_HASH_ALGORITHM = 'SHA-256';
    window.PAYU_POS_ID = 1429452;
    window.PAYU_MD5_SECOND_KEY = 'f3627be5fab5a4238c8474936f057908';

    var moment = undefined,
        momentReady = function( method, method2, count ){
            var c = ( count ) ? count : 0;

            if      ( isDifferentZone && moment !== undefined ){
                if      ( method ) { method(); }
                else    { return false; }
            }
            else if ( isDifferentZone && moment === undefined ) {
                if ( c < 20 ) {
                    c++;
                    setTimeout( function() { momentReady( method, method2, c ); }
                        , 300 );
                } else {
                    if      ( method2 === true && method )  { method(); }
                    else if ( method2 !== true && method2 ) { method2(); }
                }
            }
            else {
                if      ( method2 === true && method )  { method(); }
                else if ( method2 !== true && method2 ) { method2(); }
                else    { return false; }
            }
        };

    if ( window.isDifferentZone && moment === undefined ) {
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = '/static/js/libs/moment.timezone.locales.min.js?v=2.22.2';
        document.getElementsByTagName("head")[0].appendChild(script);
    }
</script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/OneSignalSDK.js" async=""></script>
<script>
    var OneSignal = window.OneSignal || [];
    OneSignal.push(function() {
        OneSignal.init({
            appId: "92552bb5-b477-4ea2-8260-dba65be198d9",
        });
    });
</script>
<script data-ad-client="ca-pub-9483216428129091" async="" src="./Moduł_ 31. Zabezpieczona aplikacja_files/f.txt"></script>
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:2404285,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
        <script src="./Moduł_ 31. Zabezpieczona aplikacja_files/underscore-min.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/backbone-min.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/backbone-relational.min.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/backbone-super.min.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/handlebars-v4.0.5.min.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/handlebars-ifCond-139a2339f7.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/application-0dcfdc1306.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/main-cf3b73d734.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/settings-5fc44a761b.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/delete-account-da2b3de486.js"></script>
<script type="text/x-translation" data-translation-name="checkAccountDeleteCalculationMessage">Wynik jest nieprawidłowy</script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/forms-222ea01b08.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/alerts-66650c3acb.js"></script>
<script>
    App.Views.InpageAlertManager = Backbone.View.extend({
        events: {
            'click [data-alert-type][data-alert-text]': 'showAlert'
        },
        showAlert: function(e) {
            var $el = $(e.currentTarget);
            App.alertsView['show'+$el.data('alertType')]([App.Translations($el.data('alertText'))]);
        }
    });
</script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/collections-c07e1162e2.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/models-4e0e4fcffb.js"></script>
<script src="./Moduł_ 31. Zabezpieczona aplikacja_files/knowledge-base-61f71273c9.js"></script>
<script>
    App.Views.LearningProgram = Backbone.View.extend({
        events: {
            'click [data-technology-desc-expander]' : 'expandTechnologyDesc'
        },

        initialize: function() {
            this.$allTechnologyDesc = this.$el.find('[data-technology-desc]');
            this.$allTechnologyExpanderIcons = this.$el.find('[data-technology-expander-icon]');
        },

        expandTechnologyDesc: function() {
            this.$allTechnologyDesc.each(function(){
                var $desc = $(this);
                $desc.slideToggle('fast');
            });
            this.$allTechnologyExpanderIcons.each(function(){
                var $icon = $(this);
                $icon.toggleClass("fa-minus");
            });
        },
    });
</script>

    <script src="./Moduł_ 31. Zabezpieczona aplikacja_files/tether.min.js"></script>
    <script src="./Moduł_ 31. Zabezpieczona aplikacja_files/prism.min.js"></script>

    <script src="./Moduł_ 31. Zabezpieczona aplikacja_files/bootcamp-1522c7c010.js"></script>
    <script src="./Moduł_ 31. Zabezpieczona aplikacja_files/jquery.seourl.min.js"></script>
    <script src="./Moduł_ 31. Zabezpieczona aplikacja_files/perfect-scrollbar.jquery.min.js"></script>
    <script src="./Moduł_ 31. Zabezpieczona aplikacja_files/jquery.fancybox.min.js"></script>
    <script src="./Moduł_ 31. Zabezpieczona aplikacja_files/moment.timezone.locales.min.js"></script>
    <script src="./Moduł_ 31. Zabezpieczona aplikacja_files/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $("a.img-modal-group").fancybox();
        });
    </script>

<div class="modal fade" tabindex="-1" role="dialog" id="call-us-modal">
    <div class="modal-dialog modal-dialog-callus" role="document">
        <div class="modal-content call-modal">
            <div id="call-us-step1">
                <h2>Umów się na rozmowę z doradcą Kodilli</h2>
                <p>Krok <span>1/2:</span> Podaj numer telefonu</p>
                <form action="https://kodilla.com/pl/call-center/dates/phone_calls" method="post" id="call-us-form1">
                    <input type="tel" name="phone" id="call-us-input-phone" class="call-center-input" placeholder="731771787">
                    <p class="error-message display-none" id="validation-message-phone">Pole Numer Telefonu jest wymagane. Nieprawidłowy format.</p>
                    <button class="btn btn-success" id="call-us-submit-phone">Zarezerwuj rozmowę</button>
                </form>
                <p id="call-us-counter-holder" style="display: none;">Dzisiaj już  <span id="call-us-counter" class="call-counter" data-url="https://kodilla.com/pl/call-center/counter/phone_calls">-</span> <span id="call-us-counter-text" data-one=" osoba zamówiła rozmowę z nami." data-few=" osoby zamówiły rozmowę z nami." data-more=" osób zamówiło rozmowę z nami."></span></p>
                <div class="data-protection">
                    <p>Twój numer telefonu nie będzie wykorzystywany w celach marketingowych ani przekazany dalej. Tylko oddzwonimy. Dane są przetwarzane zgodnie z <a href="https://kodilla.com/pl/polityka-prywatnosci">Polityką Prywatności</a>.</p>
                </div>
            </div>

            <div id="call-us-step2" style="display: none;">
                <h2>Wybierz dogodny termin i godzinę na rozmowę z doradcą</h2>
                <p>Krok <span>2/2:</span>
                </p><form action="https://kodilla.com/pl/call-center/step2/phone_calls" method="post" id="call-us-form2">
                    <div class="select-date">
                        <select name="date" id="call-us-input-date">
                        </select>
                        <select name="time" id="call-us-input-time">
                        </select>
                    </div>
                    <button class="btn btn-success" id="call-us-submit-call">Oddzwońcie do mnie!</button>
                </form>
            </div>

            <div id="call-us-step3" style="display: none;">
                <div class="thanks">
                    <i class="fa fa-check-circle" aria-hidden="true"></i>
                    <h2>Dziękujemy za zamowienie rozmowy! Do usłyszenia w wybranym terminie!</h2>
                </div>
            </div>
        </div>
    </div>
</div>



                <style type="text/css">
    .embeddedServiceHelpButton .helpButton .uiButton {
        background-color: #1EA71C;
        font-family: "Arial", sans-serif;
    }
    .embeddedServiceHelpButton .helpButton .uiButton:focus {
        outline: 1px solid #1EA71C;
    }
</style>
<script>
    function openChat(){
        $('.helpButtonEnabled').trigger('click');
    }
</script>
<script type="text/javascript" src="./Moduł_ 31. Zabezpieczona aplikacja_files/esw.min.js"></script>

<script type="text/javascript">
    var initESW = function(gslbBaseURL) {
        let firstName = 'Marek Baberowski'.split(" ")[0];
        let lastName = 'Marek Baberowski'.split(" ")[1];
        console.log(name);
        embedded_svc.settings.displayHelpButton = true;
        embedded_svc.settings.language = '';

        embedded_svc.settings.defaultMinimizedText =  'Skontaktuj się z nami';
        embedded_svc.settings.disabledMinimizedText = ' ';

        embedded_svc.settings.loadingText = 'Ładowanie';
        embedded_svc.settings.storageDomain = 'kodilla.com';

        embedded_svc.settings.prepopulatedPrechatFields = {
            'FirstName': firstName,
            'LastName': lastName,
            'Email': 'm.z.baberowski@gmail.com'
        };
        embedded_svc.settings.offlineSupportMinimizedText = 'Napisz do nas';

        embedded_svc.settings.enabledFeatures = ['LiveAgent'];
        embedded_svc.settings.entryFeature = 'LiveAgent';

        embedded_svc.init(
            'https://kodilla.my.salesforce.com',
            'https://kodillacommunity.force.com',
            gslbBaseURL,
            '00D1i000000VBFH',
            'Support_Kodilla',
            {
                baseLiveAgentContentURL: 'https://c.la1-c2-fra.salesforceliveagent.com/content',
                deploymentId: '5721i00000009s9',
                buttonId: '5731i0000000AJN',
                baseLiveAgentURL: 'https://d.la1-c2-fra.salesforceliveagent.com/chat',
                eswLiveAgentDevName: 'Support_Kodilla',
                isOfflineSupportEnabled: true
            }
        );
    };

    if (!window.embedded_svc) {
        var s = document.createElement('script');
        s.setAttribute('src', 'https://kodilla.my.salesforce.com/embeddedservice/5.0/esw.min.js');
        s.onload = function() {
            initESW(null);
        };
        document.body.appendChild(s);
    } else {
        initESW('https://service.force.com');
    }
</script><script id="common-script" type="text/javascript" src="./Moduł_ 31. Zabezpieczona aplikacja_files/common.min.js"></script>
        <div data-role="notifications-wrapper" class="notifications-wrapper"></div>
<!-- Facebook Pixel Code -->
    <script>
        setTimeout(function(){
            !function(f,b,e,v,n,t,s)
            {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
                n.callMethod.apply(n,arguments):n.queue.push(arguments)};
                if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
                n.queue=[];t=b.createElement(e);t.async=!0;
                t.src=v;s=b.getElementsByTagName(e)[0];
                s.parentNode.insertBefore(t,s)}(window, document,'script',
                'https://connect.facebook.net/en_US/fbevents.js');
            fbq('init', 389137334769464 );
            fbq('track', 'PageView');
        }, 3000);
    </script>
    <!-- End Facebook Pixel Code -->

    <!-- Google Tag Manager -->
    <script>
        setTimeout(function () {
            (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','GTM-KN2WWBH');
        }, 3000);

    </script>
    <!-- End Google Tag Manager -->

    
    

<iframe name="_hjRemoteVarsFrame" title="_hjRemoteVarsFrame" id="_hjRemoteVarsFrame" src="./Moduł_ 31. Zabezpieczona aplikacja_files/box-25a418976ea02a6f393fbbe77cec94bb.html" style="display: none !important; width: 1px !important; height: 1px !important; opacity: 0 !important; pointer-events: none !important;"></iframe><script id="liveagent-esw-script" type="text/javascript" src="./Moduł_ 31. Zabezpieczona aplikacja_files/liveagent.esw.min.js"></script><form id="fileUploadForm" enctype="multipart/form-data" method="post" target="fileUploadIframe"><input type="file" id="fileSelector" name="file" style="display: none;"><input name="filename" type="hidden"></form><iframe id="fileUploadIframe" name="fileUploadIframe" title="FileUploadFrame" style="display: none;" src="./Moduł_ 31. Zabezpieczona aplikacja_files/saved_resource.html"></iframe><iframe id="esw_storage_iframe" src="./Moduł_ 31. Zabezpieczona aplikacja_files/esw.html" title="Live Chat Metadata" style="display: none;"></iframe><script type="text/javascript" src="./Moduł_ 31. Zabezpieczona aplikacja_files/EmbeddedServiceConfig.jsonp"></script><script id="invite-esw-script" type="text/javascript" src="./Moduł_ 31. Zabezpieczona aplikacja_files/invite.esw.min.js"></script><div class="embeddedServiceHelpButton"><div class="helpButton"><button class="helpButtonEnabled uiButton" href="javascript:void(0)"><span class="embeddedServiceIcon" aria-hidden="true" data-icon="" style="display: inline-block;"></span><span class="helpButtonLabel" id="helpButtonSpan" aria-live="polite" aria-atomic="true"><span class="assistiveText">Live chat:</span><span class="message">Napisz do nas</span></span></button></div></div><script id="inert-script" type="text/javascript" src="./Moduł_ 31. Zabezpieczona aplikacja_files/inert.min.js"></script><script type="text/javascript" src="./Moduł_ 31. Zabezpieczona aplikacja_files/EmbeddedServiceConfig(1).jsonp"></script><div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; width: 0px; height: 0px;"><div></div></div></div>
<script type="text/javascript" id="">window._tfa=window._tfa||[];window._tfa.push({notify:"event",name:"page_view",id:1209537});!function(a,b,d,c){document.getElementById(c)||(a.async=1,a.src=d,a.id=c,b.parentNode.insertBefore(a,b))}(document.createElement("script"),document.getElementsByTagName("script")[0],"//cdn.taboola.com/libtrc/unip/1209537/tfa.js","tb_tfa_script");</script>
<noscript>
  <img src="//trc.taboola.com/1209537/log/3/unip?en=page_view" width="0" height="0" style="display:none">
</noscript>


<script type="text/javascript" id="">window._adftrack=Array.isArray(window._adftrack)?window._adftrack:window._adftrack?[window._adftrack]:[];window._adftrack.push({pm:2049944});(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src="https://track.adform.net/serving/scripts/trackpoint/async/";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();</script>
<noscript>
    <p style="margin:0;padding:0;border:0;">
        <img src="https://track.adform.net/Serving/TrackPoint/?pm=2049944" width="1" height="1" alt="">
    </p>
</noscript>

<script type="text/javascript" id="">(function(){window.__insp=window.__insp||[];__insp.push(["wid",794470694]);var c=function(){if("undefined"==typeof window.__inspld){window.__inspld=1;var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.id="inspsync";a.src=("https:"==document.location.protocol?"https":"http")+"://cdn.inspectlet.com/inspectlet.js?wid\x3d794470694\x26r\x3d"+Math.floor((new Date).getTime()/36E5);var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}};setTimeout(c,0)})();</script>
</body></html>