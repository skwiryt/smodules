<!DOCTYPE html>
<!-- saved from url=(0051)https://kodilla.com/pl/bootcamp-module/407/278/5935 -->
<html lang="pl" class=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="ahrefs-site-verification" content="c2d3c04b9f125c5b8c98d89f738d343f69d841f035150344a932150235c5639a">
    
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="csrf-token" content="RtYZFGj83q4iSrSPWWX0bG3bzYwVu4VNaOaoyGGq">

<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="https://kodilla.com/static/img/icons/apple-touch-icon-60x60.png?00000">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://kodilla.com/static/img/icons/apple-touch-icon-76x76.png?00000">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://kodilla.com/static/img/icons/apple-touch-icon-120x120.png?00000">
<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://kodilla.com/static/img/icons/apple-touch-icon-152x152.png?00000">
<link rel="icon" type="image/png" sizes="32x32" href="https://kodilla.com/static/img/icons/favicon-32x32.png?00000">
<link rel="icon" type="image/png" sizes="96x96" href="https://kodilla.com/static/img/icons/favicon-96x96.png?00000">
<link rel="icon" type="image/png" sizes="16x16" href="https://kodilla.com/static/img/icons/favicon-16x16.png?00000">

    <link rel="canonical" href="https://kodilla.com/pl/bootcamp-module/407/278/5935">

    <meta name="robots" content="noindex, follow">
    <title>    Moduł: 29. MongoDB – baza danych dla backendu
</title>
        <script type="text/javascript" async="" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/js"></script><script type="text/javascript" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/saved_resource"></script><script type="text/javascript" async="" id="inspsync" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/inspectlet.js"></script><script type="text/javascript" async="" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/saved_resource(1)"></script><script async="" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/tfa.js" id="tb_tfa_script"></script><script type="text/javascript" async="" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/insight.min.js"></script><script type="text/javascript" async="" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/analytics.js"></script><script type="text/javascript" async="" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/analytics.js"></script><script type="text/javascript" async="" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/js(1)"></script><script async="" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/gtm.js"></script><script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/389137334769464" async=""></script><script async="" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/fbevents.js"></script><script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/sdk.js" async="" crossorigin="anonymous"></script><script id="facebook-jssdk" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/sdk(1).js"></script><script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/diffuser.js" async=""></script><script>document.documentElement.classList.remove("no-js")</script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/yall.min.js"></script>
<link rel="stylesheet" href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/bootstrap.min.css" as="style" onload="this.rel=&#39;stylesheet&#39;">
<link href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/main-b3cf79332c.css" as="style" onload="this.rel=&#39;stylesheet&#39;">
            
    <link href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/prism.min.css" rel="stylesheet">

    <link href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/bootcamp-6d0888d826.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/perfect-scrollbar.css">
    <link rel="stylesheet" href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/jquery.fancybox.min.css" type="text/css" media="screen">
    <link href="https://kodilla.com/static/css/libs/bootstrap-datetimepicker.min.css?00000">
    <link rel="stylesheet" href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/content.css">

<script async="" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/hotjar-2404285.js"></script><script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/OneSignalPageSDKES6.js" async=""></script><style type="text/css">.fancybox-margin{margin-right:15px;}</style><script async="" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/modules.2ec2062e86adda67b2fe.js" charset="utf-8"></script><style type="text/css">iframe#_hjRemoteVarsFrame {display: none !important; width: 1px !important; height: 1px !important; opacity: 0 !important; pointer-events: none !important;}</style><link href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/esw.min.css" type="text/css" rel="stylesheet"><style id="inert-style">
[inert] {
	pointer-events: none;
	cursor: default;
}

[inert], [inert] * {
	user-select: none;
	-webkit-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
}
</style><script type="text/javascript" charset="utf-8" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/saved_resource(2)" async=""></script><style type="text/css" data-fbcssmodules="css:fb.css.base css:fb.css.dialog css:fb.css.iframewidget css:fb.css.customer_chat_plugin_iframe">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_dialog_advanced{border-radius:8px;padding:10px}.fb_dialog_content{background:#fff;color:#373737}.fb_dialog_close_icon{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{left:5px;right:auto;top:5px}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent}.fb_dialog_close_icon:active{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #365899;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{height:100%;left:0;margin:0;overflow:visible;position:absolute;top:-10000px;transform:none;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{background:none;height:auto;min-height:initial;min-width:initial;width:auto}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{clear:both;color:#fff;display:block;font-size:18px;padding-top:20px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .4);bottom:0;left:0;min-height:100%;position:absolute;right:0;top:0;width:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_mobile .fb_dialog_iframe{position:sticky;top:0}.fb_dialog_content .dialog_header{background:linear-gradient(from(#738aba), to(#2c4987));border-bottom:1px solid;border-color:#043b87;box-shadow:white 0 1px 1px -1px inset;color:#fff;font:bold 14px Helvetica, sans-serif;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:linear-gradient(from(#4267B2), to(#2a4887));background-clip:padding-box;border:1px solid #29487d;border-radius:3px;display:inline-block;line-height:18px;margin-top:3px;max-width:85px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{background:none;border:none;color:#fff;font:bold 12px Helvetica, sans-serif;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #4a4a4a;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f5f6f7;border:1px solid #4a4a4a;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://static.xx.fbcdn.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);background-position:50% 50%;background-repeat:no-repeat;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}
.fb_mpn_mobile_landing_page_slide_out{animation-duration:200ms;animation-name:fb_mpn_landing_page_slide_out;transition-timing-function:ease-in}.fb_mpn_mobile_landing_page_slide_out_from_left{animation-duration:200ms;animation-name:fb_mpn_landing_page_slide_out_from_left;transition-timing-function:ease-in}.fb_mpn_mobile_landing_page_slide_up{animation-duration:500ms;animation-name:fb_mpn_landing_page_slide_up;transition-timing-function:ease-in}.fb_mpn_mobile_bounce_in{animation-duration:300ms;animation-name:fb_mpn_bounce_in;transition-timing-function:ease-in}.fb_mpn_mobile_bounce_out{animation-duration:300ms;animation-name:fb_mpn_bounce_out;transition-timing-function:ease-in}.fb_mpn_mobile_bounce_out_v2{animation-duration:300ms;animation-name:fb_mpn_fade_out;transition-timing-function:ease-in}.fb_customer_chat_bounce_in_v2{animation-duration:300ms;animation-name:fb_bounce_in_v2;transition-timing-function:ease-in}.fb_customer_chat_bounce_in_from_left{animation-duration:300ms;animation-name:fb_bounce_in_from_left;transition-timing-function:ease-in}.fb_customer_chat_bounce_out_v2{animation-duration:300ms;animation-name:fb_bounce_out_v2;transition-timing-function:ease-in}.fb_customer_chat_bounce_out_from_left{animation-duration:300ms;animation-name:fb_bounce_out_from_left;transition-timing-function:ease-in}.fb_customer_chat_bubble_animated_no_badge{box-shadow:0 3px 12px rgba(0, 0, 0, .15);transition:box-shadow 150ms linear}.fb_customer_chat_bubble_animated_no_badge:hover{box-shadow:0 5px 24px rgba(0, 0, 0, .3)}.fb_customer_chat_bubble_animated_with_badge{box-shadow:-5px 4px 14px rgba(0, 0, 0, .15);transition:box-shadow 150ms linear}.fb_customer_chat_bubble_animated_with_badge:hover{box-shadow:-5px 8px 24px rgba(0, 0, 0, .2)}.fb_invisible_flow{display:inherit;height:0;overflow-x:hidden;width:0}.fb_new_ui_mobile_overlay_active{overflow:hidden}@keyframes fb_mpn_landing_page_slide_in{0%{border-radius:50%;margin:0 24px;width:60px}40%{border-radius:18px}100%{margin:0 12px;width:100% - 24px}}@keyframes fb_mpn_landing_page_slide_in_from_left{0%{border-radius:50%;left:12px;margin:0 24px;width:60px}40%{border-radius:18px}100%{left:12px;margin:0 12px;width:100% - 24px}}@keyframes fb_mpn_landing_page_slide_out{0%{margin:0 12px;width:100% - 24px}60%{border-radius:18px}100%{border-radius:50%;margin:0 24px;width:60px}}@keyframes fb_mpn_landing_page_slide_out_from_left{0%{left:12px;width:100% - 24px}60%{border-radius:18px}100%{border-radius:50%;left:12px;width:60px}}@keyframes fb_mpn_landing_page_slide_up{0%{bottom:0;opacity:0}100%{bottom:24px;opacity:1}}@keyframes fb_mpn_bounce_in{0%{opacity:.5;top:100%}100%{opacity:1;top:0}}@keyframes fb_mpn_fade_out{0%{bottom:30px;opacity:1}100%{bottom:0;opacity:0}}@keyframes fb_mpn_bounce_out{0%{opacity:1;top:0}100%{opacity:.5;top:100%}}@keyframes fb_bounce_in_v2{0%{opacity:0;transform:scale(0, 0);transform-origin:bottom right}50%{transform:scale(1.03, 1.03);transform-origin:bottom right}100%{opacity:1;transform:scale(1, 1);transform-origin:bottom right}}@keyframes fb_bounce_in_from_left{0%{opacity:0;transform:scale(0, 0);transform-origin:bottom left}50%{transform:scale(1.03, 1.03);transform-origin:bottom left}100%{opacity:1;transform:scale(1, 1);transform-origin:bottom left}}@keyframes fb_bounce_out_v2{0%{opacity:1;transform:scale(1, 1);transform-origin:bottom right}100%{opacity:0;transform:scale(0, 0);transform-origin:bottom right}}@keyframes fb_bounce_out_from_left{0%{opacity:1;transform:scale(1, 1);transform-origin:bottom left}100%{opacity:0;transform:scale(0, 0);transform-origin:bottom left}}@keyframes fb_bounce_out_v2_mobile_chat_started{0%{opacity:1;top:0}100%{opacity:0;top:20px}}@keyframes fb_customer_chat_bubble_bounce_in_animation{0%{bottom:6pt;opacity:0;transform:scale(0, 0);transform-origin:center}70%{bottom:18pt;opacity:1;transform:scale(1.2, 1.2)}100%{transform:scale(1, 1)}}@keyframes slideInFromBottom{0%{opacity:.1;transform:translateY(100%)}100%{opacity:1;transform:translateY(0)}}@keyframes slideInFromBottomDelay{0%{opacity:0;transform:translateY(100%)}97%{opacity:0;transform:translateY(100%)}100%{opacity:1;transform:translateY(0)}}</style><script type="text/javascript" charset="utf-8" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/t_prism_sitemessages.php" async=""></script></head>
<body class="student callus-enabled" cz-shortcut-listen="true">
<!-- Facebook Pixel Code -->
<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=389137334769464&ev=PageView&noscript=1"/></noscript>
<!-- End Facebook Pixel Code -->
<script>
    document.getElementsByTagName('body')[0].classList.remove('no-js');
    if ( window.isDifferentZone ) {
        document.querySelector('body').classList.add('time-conversion-applied');
    }
    if ( window.hasWrongTime ) {
        document.querySelector('body').classList.add('wrong-hour');
    }
</script>

    <nav class="navbar-main hidden-sm-down dark navbar">
    <div class="nav-container">
        <div class="navbar-header clearfix">
            <button class="navbar-toggler hidden-md-up pull-right" type="button" data-toggle="collapse" data-target="#collapsingNavbarUpper"><i class="fa fa-bars"></i></button>
        </div>
        <div class="collapse navbar-toggleable-sm container" id="collapsingNavbarUpper">
            <ul class="nav navbar-nav navbar-nav-left">
                                    <li class="nav-item nav-contact">
    <span>Skontaktuj się z nami:</span>
    <a href="mailto:support@kodilla.com">
        <i class="fa fa-envelope-o"></i>
        support@kodilla.com
    </a>
    <span>lub</span>
    <a href="javascript:openChat();">
        <i class="fa fa-comments"></i>
        porozmawiaj na czacie
    </a>
</li>
                                </ul>
            <ul class="nav navbar-nav pull-right">
                                <li class="nav-item">
                    <a href="https://kodilla.com/pl/informator" class="nav-link" target="_blank">
        Informator
    </a>
                </li>
                <li class="nav-item hidden-sm-down">
    <a href="https://kodilla.com/pl/account" class="nav-link">Konto</a>
</li>
        <li class="nav-item">
    <a class="analytics-track nav-link nav-link-accent" data-event="account_logout" href="https://kodilla.com/pl/sign-out">Wyloguj</a>
</li>
                            </ul>
        </div>
    </div>
</nav>
<nav class="navbar-main light navbar">
    <div class="container clearfix">
        <a class="navbar-brand" href="https://kodilla.com/pl">
            <img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/kodilla-nav-logo.svg" alt="Kodilla - szkoła programowania">
        </a>
        <span class="contact-us-button-container"></span>
        <button class="navbar-toggler pull-right collapsed" type="button" data-toggle="collapse" data-target="#navbar-main">
            <i class="fa fa-bars navbar-ico-open"></i>
            <i class="fa fa-times navbar-ico-close"></i>
        </button>
        <ul id="navbar-main" class="nav navbar-nav pull-right collapse">
            <li class="nav-item hidden-sm-down">
    <a class="dropdown-toggle nav-link" href="https://kodilla.com/pl/poznaj-nasze-bootcampy">
        Szkolenia Bootcamp
    </a>
    <ul class="bootcamp-list">
                    <li class="list-sub list-sub-fe">
                <img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/menu_fer.svg" class="menu-svg" width="32px" height="32px" title="menu_fer_logo">
                <a href="https://kodilla.com/pl/bootcamp/front-end">
                    <h4 class="bootcamp-name">Front-end: React</h4>
                    <p>Naucz się tworzyć front-end aplikacji w 4 miesiące</p>
                </a>
            </li>
            <li class="list-sub">
                <img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/menu_wd.svg" class="menu-svg" width="32px" height="32px" title="menu_wd_logo">
                <a href="https://kodilla.com/pl/bootcamp/webdeveloper?type=wdp">
                    <h4 class="bootcamp-name">Web Developer</h4>
                    <p>Naucz&nbsp;się tworzyć aplikacje internetowe od&nbsp;podstaw</p>
                    <span class="bootcamp-label">FRONT-END i BACK-END</span>
                </a>
            </li>

            <li class="list-sub">
                <img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/menu_java.svg" class="menu-svg" width="32px" height="32px" title="menu_java_logo">
                <a href="https://kodilla.com/pl/bootcamp/java?type=jdp">
                    <h4 class="bootcamp-name">Java Developer</h4>
                    <p>Poznaj najpopularniejszy na&nbsp;świecie język programowania od&nbsp;zera</p>
                </a>
            </li>
            <li class="list-sub">
                <img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/menu_python.svg" class="menu-svg" width="32px" height="32px" title="menu_python_logo">
                <a href="https://kodilla.com/pl/bootcamp/python">
                    <h4 class="bootcamp-name">Python Developer</h4>
                    <p>Zdobądź kompetencje do tworzenia rozwiązań webowych</p>
                </a>
            </li>
            <li class="list-sub">
                <img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/menu_tester.svg" class="menu-svg" width="32px" height="32px" title="menu_tester_logo">
                <a href="https://kodilla.com/pl/bootcamp/tester-automatyzujacy">
                    <h4 class="bootcamp-name">Tester Automatyzujący</h4>
                    <p>Poznaj podstawy testowania automatycznego w Javie</p>
                </a>
            </li>
            <li class="list-sub">
                <img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/menu_game.svg" class="menu-svg" width="32px" height="32px" title="menu_mage_logo">
                <a href="https://kodilla.com/pl/bootcamp/game-dev">
                    <h4 class="bootcamp-name">Mobile Game Developer</h4>
                    <p>Zdobądź kompetencje do tworzenia gier</p>
                    <span class="bootcamp-label">nowość</span>
                </a>
            </li>
            </ul>
</li>

                        <li class="nav-item hidden-sm-down">
    <a class="dropdown-toggle nav-link" href="https://kodilla.com/pl/szkolenia-pro">
        Szkolenia Pro
    </a>
    <ul>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/mikroserwisy" class="nav-link">Mikroserwisy w Javie</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/spring-hibernate" class="nav-link">Spring i Hibernate</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/wielowatkowosc" class="nav-link">Wielowątkowość w Javie</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/django" class="nav-link">Aplikacje webowe z Django</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/wizualizacja-danych" class="nav-link">Analiza danych w Pythonie</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/machine-learning" class="nav-link">Podstawy Machine Learning</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/bigdata-pyspark" class="nav-link">Big Data z PySpark</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/automatyzacja-testow" class="nav-link">Automatyzacja testów</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/vanilla-js" class="nav-link">Advanced Vanilla JS</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/typescript" class="nav-link">TypeScript - kurs praktyczny</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/vue3" class="nav-link">Vue3 - kompletny przewodnik</a></li>
        <li><a href="https://kodilla.com/pl/szkolenia-pro/zaawansowany-backend" class="nav-link">Backend zaawansowany</a></li>
    </ul>
</li>
            <li class="nav-item hidden-sm-down">
    <a class="dropdown-toggle nav-link">
        Strefa kursanta
    </a>
    <ul>
                    <li><a href="https://kodilla.com/pl/bootcamp-dashboard/407" class="nav-link">Bootcamp WD PLUS 2020-12</a></li>
                    <li><a class="nav-link" href="https://kodilla.com/pl/kursy">Samodzielne kursy</a></li>
                    <li><a class="nav-link" href="https://chat.kodilla.com/" target="_blank">Komunikator</a></li>
                    <li><a class="nav-link" href="https://kodilla.com/pl/projects">Moje projekty</a></li>
    </ul>
</li>
                            <li class="nav-item hidden-sm-down">
    <a class="dropdown-toggle nav-link">
        O nas
    </a>
    <ul class="about-us">
        <li><a href="https://kodilla.com/pl/mentorzy" class="nav-link">Mentorzy</a></li>
        <li><a href="https://kodilla.com/pl/zespol" class="nav-link">Zespół Kodilli</a></li>
        <li><a href="https://kodilla.com/pl/o-nas" class="nav-link">O firmie</a></li>
    </ul>
</li>
                                                                    <li class="nav-item hidden-md-up nav-group">
    <span class="mobile-menu-separator">Szkolenia Bootcamp</span>
    <ul>
                    <li class="nav-item list-sub-fe">
                <a class="nav-link nav-link-with-label" href="https://kodilla.com/pl/bootcamp/front-end">Bootcamp Front-end: React
                </a>
            </li>
                <li class="nav-item">
            <a class="nav-link nav-link-with-label" href="https://kodilla.com/pl/bootcamp/webdeveloper">Bootcamp Web Developer
                <span class="bootcamp-label">FRONT-END i BACK-END</span>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="https://kodilla.com/pl/bootcamp/java">Bootcamp Java</a>
        </li>
        <li class="nav-item list-sub-fe">
            <a class="nav-link nav-link-with-label" href="https://kodilla.com/pl/bootcamp/tester-automatyzuj%C4%85cy">Bootcamp Tester Automatyzujący
            </a>
        </li>
        <li class="nav-item list-sub-fe">
            <a class="nav-link nav-link-with-label" href="https://kodilla.com/pl/bootcamp/python">Python Developer
            </a>
        </li>
        <li class="nav-item list-sub-fe">
            <a class="nav-link nav-link-with-label" href="https://kodilla.com/pl/bootcamp/game-dev">Mobile Game Developer
                <span class="bootcamp-label">nowość</span>
            </a>
        </li>
    </ul>
</li>
<li class="nav-item hidden-md-up nav-group">
    <a class="nav-link-bold" href="https://kodilla.com/pl/szkolenia-pro">Szkolenia Pro</a>
</li>
            <li class="nav-item hidden-md-up nav-group">
            <span class="mobile-menu-separator">Strefa kursanta</span>
            <ul>
                <li class="nav-item ">
                                            <a class="nav-link" href="https://kodilla.com/pl/bootcamp-dashboard/407">
                            Bootcamp   WD PLUS 2020-12
                        </a>
                                    </li>
                <li class="nav-item ">
                    <a class="nav-link" href="https://kodilla.com/pl/kursy">Samodzielne kursy</a>
                </li>
                                    <li class="nav-item ">
                        <a class="nav-link" href="https://chat.kodilla.com/" target="_blank">Komunikator</a>
                    </li>
                                <li class="nav-item">
                    <a class="nav-link" href="https://kodilla.com/pl/projects">Moje projekty</a>
                </li>
            </ul>
        </li>
    
        
            <li class="nav-item hidden-md-up nav-group">
            <span class="mobile-menu-separator">O nas</span>
            <ul>
                <li class="nav-item">
                    <a href="https://kodilla.com/pl/mentorzy" class="nav-link">Mentorzy</a>
                </li>
                <li class="nav-item">
                    <a href="https://kodilla.com/pl/zespol" class="nav-link">Zespół Kodilli</a>
                </li>
                <li class="nav-item">
                    <a href="https://kodilla.com/pl/o-nas" class="nav-link">O firmie</a>
                </li>
            </ul>
        </li>
    
<li class="nav-item hidden-md-up nav-group">
    <span class="mobile-menu-separator">Pozostałe</span>
    <ul>
                                        
        <li class="nav-item">
            <a href="https://kodilla.com/pl/informator" class="nav-link" target="_blank">
        Informator
    </a>
        </li>
    </ul>

</li>

    <li class="nav-item hidden-md-up">
        <a class="nav-link" href="https://kodilla.com/pl/account">Konto</a>
    </li>
    <li class="nav-item hidden-md-up">
        <a class="nav-link analytics-track" data-event="account_logout" href="https://kodilla.com/pl/sign-out">Wyloguj</a>
    </li>

        
    <li class="nav-item hidden-md-up nav-group">
        <span class="mobile-menu-separator">Skontaktuj się z nami</span>
        <ul>
            <li class="nav-item">
                <a href="mailto:support@kodilla.com" class="nav-link">
                    <i class="fa fa-envelope-o"></i>
                    support@kodilla.com
                </a>
            </li>
            <li class="nav-item">
                <a href="javascript:openChat();" class="nav-link">
                    <i class="fa fa-comments"></i>
                    <span>Porozmawiaj na czacie</span>
                </a>
            </li>
        </ul>
    </li>
        </ul>
    </div>
</nav>
<main class="bootcamp module page-height-fix" id="bootcamp-module">
    <div class="aside-toggle hidden-md-up">
        <button class="navbar-toggler pull-left collapsed" type="button" data-toggle="collapse" data-target="#aside-sticky" aria-expanded="false">
            <i class="fa fa-bars navbar-ico-open"></i>
            <i class="fa fa-times navbar-ico-close"></i>
        </button>
    </div>
    <div class="table-of-contents aside-sticky collapsed collapse fixed" id="aside-sticky" style="transform: translateY(0px);">
        <section class="container">
            <div class="row">
                <aside class="module-nav col-md-4 col-md-offset-8">
                    <section class="card">
                        <div class="card-header">
                            <h4 class="card-title">Spis treści modułu</h4>
                        </div>
                        <ul class="list-group list-group-flush ps-container ps-theme-default ps-active-y" data-ps-id="9074689c-c5b0-a374-3889-edccaa866fa1">
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#submodule-1154" class="clearfix">
                                    <p>29.1. Poznajemy MongoDB</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#291-poznajemy-mongodb-instalacja-mongodb" class="clearfix">Instalacja MongoDB</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#291-poznajemy-mongodb-dostep-do-mongodb" class="clearfix">Dostęp do MongoDB</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#291-poznajemy-mongodb-tworzymy-nowa-baze" class="clearfix">Tworzymy nową bazę</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#291-poznajemy-mongodb-operacje-crud" class="clearfix">Operacje CRUD</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#291-poznajemy-mongodb-podsumowanie" class="clearfix">Podsumowanie</a></li>
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#submodule-1155" class="clearfix">
                                    <p>29.2. MongoDB w Node.js</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#292-mongodb-w-nodejs-pierwsze-kroki" class="clearfix">Pierwsze kroki</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#292-mongodb-w-nodejs-do-dziela" class="clearfix">Do dzieła</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#292-mongodb-w-nodejs-opakowujemy-serwer-w-funkcje-callback" class="clearfix">Opakowujemy serwer w funkcję callback</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#292-mongodb-w-nodejs-praktyczne-przyklady" class="clearfix">Praktyczne przykłady</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#292-mongodb-w-nodejs-mongodb-compass" class="clearfix">MongoDB Compass</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#292-mongodb-w-nodejs-praktyczne-przyklady-cd" class="clearfix">Praktyczne przykłady cd.</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#292-mongodb-w-nodejs-rozwijamy-aplikacje" class="clearfix">Rozwijamy aplikację</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#292-mongodb-w-nodejs-testujemy-endpointy" class="clearfix">Testujemy endpointy</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#292-mongodb-w-nodejs-podsumowanie" class="clearfix">Podsumowanie</a></li><li class="list-group-item list-group-flush sub task"><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#292-mongodb-w-nodejs-zadanie-endpointy" class="clearfix">Zadanie: endpointy</a></li>
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#submodule-1156" class="clearfix">
                                    <p>29.3. Mongoose – pierwsze starcie</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#293-mongoose-pierwsze-starcie-instalacja-mongoose" class="clearfix">Instalacja Mongoose</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#293-mongoose-pierwsze-starcie-modyfikacja-serverjs" class="clearfix">Modyfikacja server.js</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#293-mongoose-pierwsze-starcie-modelowanie-danych" class="clearfix">Modelowanie danych</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#293-mongoose-pierwsze-starcie-pierwszy-schemat-danych" class="clearfix">Pierwszy schemat danych</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#293-mongoose-pierwsze-starcie-pierwszy-model" class="clearfix">Pierwszy model</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#293-mongoose-pierwsze-starcie-wykorzystujemy-model-w-praktyce" class="clearfix">Wykorzystujemy model w praktyce</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#293-mongoose-pierwsze-starcie-kolejne-endpointy" class="clearfix">Kolejne endpointy</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#293-mongoose-pierwsze-starcie-testujemy" class="clearfix">Testujemy</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#293-mongoose-pierwsze-starcie-podsumowanie" class="clearfix">Podsumowanie</a></li><li class="list-group-item list-group-flush sub task"><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#293-mongoose-pierwsze-starcie-zadanie-trenujemy" class="clearfix">Zadanie: trenujemy</a></li>
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#submodule-1157" class="clearfix">
                                    <p>29.4. Mongoose – relacje między kolekcjami</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#294-mongoose-relacje-miedzy-kolekcjami-metoda-populate" class="clearfix">Metoda populate</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#294-mongoose-relacje-miedzy-kolekcjami-podsumowanie" class="clearfix">Podsumowanie</a></li><li class="list-group-item list-group-flush sub task"><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#294-mongoose-relacje-miedzy-kolekcjami-zadanie-wykorzystujemy-wiedze-w-praktyce" class="clearfix">Zadanie: wykorzystujemy wiedzę w praktyce</a></li>
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#submodule-1158" class="clearfix">
                                    <p>29.5. Mongoose w praktyce</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#295-mongoose-w-praktyce-etap-1-przygotowanie-bazy-danych" class="clearfix">Etap 1 – przygotowanie bazy danych</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#295-mongoose-w-praktyce-etap-2-przygotowanie-polaczenie-z-baza-danych" class="clearfix">Etap 2 – przygotowanie połączenie z bazą danych</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#295-mongoose-w-praktyce-etap-3-przygotowanie-modeli" class="clearfix">Etap 3 – przygotowanie modeli</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#295-mongoose-w-praktyce-etap-4-modyfikacja-endpointow" class="clearfix">Etap 4 – modyfikacja endpointów</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#295-mongoose-w-praktyce-etap-5-wydzielenie-controllerow" class="clearfix">Etap 5 – wydzielenie controllerów</a></li><li class="list-group-item list-group-flush sub task"><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#295-mongoose-w-praktyce-zadanie-gotowe" class="clearfix">Zadanie: gotowe!</a></li>
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#submodule-1159" class="clearfix">
                                    <p>29.6. MongoDB Atlas – zdalna baza danych</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#296-mongodb-atlas-zdalna-baza-danych-mongodb-atlas-zdalna-baza-danych" class="clearfix">MongoDB Atlas – zdalna baza danych</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#296-mongodb-atlas-zdalna-baza-danych-konfiguracja" class="clearfix">Konfiguracja</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#296-mongodb-atlas-zdalna-baza-danych-dodajemy-uzytkownika-bazy" class="clearfix">Dodajemy użytkownika bazy</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#296-mongodb-atlas-zdalna-baza-danych-akceptowanie-polaczen-z-zewnatrz" class="clearfix">Akceptowanie połączeń z zewnątrz</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#296-mongodb-atlas-zdalna-baza-danych-ladowanie-poczatkowych-danych" class="clearfix">Ładowanie początkowych danych</a></li><li class="list-group-item list-group-flush sub "><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#296-mongodb-atlas-zdalna-baza-danych-mongodb-atlas-integracja-z-nasza-aplikacja" class="clearfix">MongoDB Atlas – integracja z naszą aplikacją</a></li><li class="list-group-item list-group-flush sub task"><a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#296-mongodb-atlas-zdalna-baza-danych-zadanie-zmieniamy-baze-danych" class="clearfix">Zadanie: zmieniamy bazę danych</a></li>
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#submodule-1160" class="clearfix">
                                    <p>29.7. Podsumowanie</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li>
                                                        <li class="list-group-item completed">
                                <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#submodule-1161" class="clearfix">
                                    <p>29.8. Quiz powtórkowy</p>
                                    <i class="fa fa-check-circle-o"></i>
                                    <i class="fa fa-play-circle-o"></i>
                                    <i class="fa fa-send-o"></i>
                                    <i class="fa fa-exclamation-circle"></i>
                                </a>
                            </li>
                                                    <div class="ps-scrollbar-x-rail" style="left: 0px; bottom: 3px;"><div class="ps-scrollbar-x" tabindex="0" style="left: 0px; width: 0px;"></div></div><div class="ps-scrollbar-y-rail" style="top: 0px; height: 606px; right: 3px;"><div class="ps-scrollbar-y" tabindex="0" style="top: 0px; height: 148px;"></div></div></ul>
                        <div class="card-block text-center">
                                                                                                <a href="https://kodilla.com/pl/bootcamp-dashboard/407">Powrót do dashboardu</a>
                                                                                    </div>
                    </section>
                </aside>
            </div>
        </section>
    </div>
    <section class="container module-content">
        <div class="row">
            <main class="col-md-8">
                <section class="card">
                    <div class="card-block module-header clearfix  completed ">
                        <h1 class="card-title">29. MongoDB – baza danych dla backendu</h1>
                                                <i class="fa fa-bookmark fa-3x" aria-hidden="true"></i>
                    </div>
                                        <div class="card-block challenge">
                        <h3>Wyzwania:</h3>
                        <ul>
<li>dowiesz się, dlaczego warto korzystać z baz danych,</li>
<li>poznasz technologie MongoDB oraz Mongoose,</li>
<li>dowiesz się czym jest relacyjność danych,</li>
<li>wykorzystasz nową wiedzę w praktyce.</li>
</ul>
<p>W poprzednich modułach wszelkie dane przechowywaliśmy w zwykłych tablicach. Takie rozwiązanie sprawdzało się podczas robienia ćwiczeń i prostych zadań, ale zapewne domyślasz się, że ma też swoje ograniczenia.</p>
<p>Po pierwsze, <strong>dane przechowywane w tablicy są ulotne</strong>. Możesz wykonać na nich mnóstwo operacji, a wszystko i tak zniknie po wyłączeniu aplikacji. Przykładem jest nasza witryna festiwalu z poprzedniego modułu. Po uruchomieniu mogliśmy rezerwować miejsca i dopóki serwer działał, wszystko było w porządku – odnotowywał on rezerwacje i zapisywał je w tablicy. Wystarczył jednak restart serwera i... wszystko wracało do stanu początkowego. W takiej sytuacji tablica jest inicjowana od nowa, z domyślnymi danymi.</p>
<p>Po drugie, <strong>wyszukiwanie oraz modyfikowanie danych w skomplikowanych zbiorach jest bardzo niewygodne</strong>. Powiedzmy, że chcesz znaleźć w tablicy <code>db.persons</code> tylko takie obiekty, które odpowiadają kilku warunkom – np. szukamy mężczyzn w wieku powyżej 18 lat, o imieniu innym niż John. Aby to osiągnąć, musielibyśmy wykorzystać metodę <code>filter</code>:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> filteredPersons <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">person</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">&gt;</span> <span class="token number">18</span> <span class="token operator">&amp;&amp;</span> person<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">!==</span> <span class="token string">'John'</span> <span class="token operator">&amp;&amp;</span> person<span class="token punctuation">.</span><span class="token property-access">gender</span> <span class="token operator">===</span> <span class="token string">'M'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Nie ma tu tragedii, ale pewnie czujesz w głębi duszy, że istnieje jakieś lepsze rozwiązanie.</p>
<p>Jeszcze gorzej wyglądałoby to w przypadku próby usuwania danych. Jeśli chcielibyśmy modyfikować tablicę bezpośrednio, to użycie <code>filter</code> nie wchodziłoby w grę. Zamiast tego, musielibyśmy użyć np. <code>forEach</code>, tak aby sprawdzić każdy element z osobna i usunąć odpowiedni za pomocą <code>splice</code>. W tej sytuacji skrypt byłby jeszcze dłuższy:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">person<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">&gt;</span> <span class="token number">18</span> <span class="token operator">&amp;&amp;</span> person<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">!==</span> <span class="token string">'John'</span> <span class="token operator">&amp;&amp;</span> person<span class="token punctuation">.</span><span class="token property-access">gender</span> <span class="token operator">===</span> <span class="token string">'M'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Chcemy tylko usunąć kilka elementów z naszej "bazy danych" (tablicy), a otrzymujemy aż pięć linijek kodu. W przypadku bardziej skomplikowanych zbiorów danych i zaawansowanych operacji skrypt mógłby być jeszcze dłuższy.</p>
<p>Po trzecie, <strong>nie możemy z góry narzucić, jak powinny wyglądać dane w tablicy</strong>. Bardzo często chcielibyśmy, aby atrybuty wszystkich obiektów, jak i typy danych, były identyczne. Żeby osiągnąć taką spójność, musimy jednak pilnować się sami.</p>
<p>Poprzednio każdy obiekt w naszej kolekcji <code>concerts</code> posiadał dokładnie takie same atrybuty:</p>
<pre class=" language-js"><code class=" language-js">concerts<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> performer<span class="token operator">:</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span> genre<span class="token operator">:</span> <span class="token string">'Rock'</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> image<span class="token operator">:</span> <span class="token string">'/img/uploads/1fsd324fsdg.jpg'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> performer<span class="token operator">:</span> <span class="token string">'Rebekah Parker'</span><span class="token punctuation">,</span> genre<span class="token operator">:</span> <span class="token string">'R&amp;B'</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> image<span class="token operator">:</span> <span class="token string">'/img/uploads/2f342s4fsdg.jpg'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> performer<span class="token operator">:</span> <span class="token string">'Maybell Haley'</span><span class="token punctuation">,</span> genre<span class="token operator">:</span> <span class="token string">'Pop'</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> image<span class="token operator">:</span> <span class="token string">'/img/uploads/hdfh42sd213.jpg'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span></code></pre>
<p>Jeśli jednak przypadkiem zrobilibyśmy błąd i zamiast <code>day</code> wpisali np. <code>dat</code>, to tablica przyjęłaby takie dane. Co więcej, zapisałaby również każde inne...</p>
<p>Dobrą opcją byłoby narzucenie z góry schematu atrybutów i typów, którego dane powinny się trzymać, tak aby nie można było wprowadzić niepoprawnego elementu do kolekcji. Niestety, tablice tego nie umożliwiają.</p>
<p>Po czwarte, <strong>tablice nie oferują nam żadnej relacyjności</strong>. Co mamy tu na myśli? Przypomnij sobie przykład z witryną festiwalu. Mieliśmy tam kolekcje <code>concerts</code> i <code>seats</code>, które w pewien sposób są ze sobą powiązane. Spójrz tylko:</p>
<pre class=" language-js"><code class=" language-js"><span class="token spread operator">...</span>
concerts<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> performer<span class="token operator">:</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span> genre<span class="token operator">:</span> <span class="token string">'Rock'</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> image<span class="token operator">:</span> <span class="token string">'/img/uploads/1fsd324fsdg.jpg'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> performer<span class="token operator">:</span> <span class="token string">'Rebekah Parker'</span><span class="token punctuation">,</span> genre<span class="token operator">:</span> <span class="token string">'R&amp;B'</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> image<span class="token operator">:</span> <span class="token string">'/img/uploads/2f342s4fsdg.jpg'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> performer<span class="token operator">:</span> <span class="token string">'Maybell Haley'</span><span class="token punctuation">,</span> genre<span class="token operator">:</span> <span class="token string">'Pop'</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> image<span class="token operator">:</span> <span class="token string">'/img/uploads/hdfh42sd213.jpg'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
seats<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> seat<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> client<span class="token operator">:</span> <span class="token string">'Amanda Doe'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'amandadoe@example.com'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> seat<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span> client<span class="token operator">:</span> <span class="token string">'Curtis Johnson'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'curtisj@example.com'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> seat<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> client<span class="token operator">:</span> <span class="token string">'Felix McManara'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'felxim98@example.com'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> seat<span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span> client<span class="token operator">:</span> <span class="token string">'Fauna Keithrins'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'mefauna312@example.com'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> seat<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> client<span class="token operator">:</span> <span class="token string">'Felix McManara'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'felxim98@example.com'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> seat<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> client<span class="token operator">:</span> <span class="token string">'Molier Lo Celso'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'moiler.lo.celso@example.com'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p>Każde miejsce ma atrybut <code>day</code>, który odpowiada elementowi z tablicy <code>concerts</code> – np. <code>day</code> równy <code>1</code> wskazuje, że dane miejsce jest zarezerwowane na koncert Johna Doe. My jesteśmy w stanie zauważyć takie powiązanie, ale JS niekoniecznie – dla niego są to dwie kompletnie różne kolekcje.</p>
<p>Z łatwością możemy wyobrazić sobie jednak sytuację, w której takie powiązanie byłoby praktyczne. Przydałaby się np. metoda, która potrafiłaby połączyć nasze dane tak, iż przy pobraniu <code>seats</code>, w miejscu atrybutu <code>day</code> pojawiałoby się imię wykonawcy.</p>
<p>W takiej sytuacji moglibyśmy łatwo pobierać różne dane w formie jednej tablicy, mimo tego, że rzeczywisty podział jest trochę bardziej skomplikowany. Tablice niestety nie zaoferują nam takiej opcji.</p>
<p>Na te wszystkie bolączki jest jednak odpowiedź – bazy danych <strong>MongoDB</strong> wraz ze wsparciem <strong>Mongoose</strong>.</p>

                    </div>
                                    </section>
                                    
                <section id="submodule-1154" class="card submodule completed" data-bootcamp-user-submodule-id="666334">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">29.1. <span>Poznajemy MongoDB</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Odpowiedzią na ograniczenia zwykłych tablic jest użycie <strong>baz danych</strong>, które z założenia przechowują&nbsp;informacje <strong>niezależnie od aplikacji</strong>, a ich zasoby <strong>nie są ulotne</strong>.</p>
<p>Ponadto każdy silnik bazy danych oferuje interfejs, dzięki któremu można łatwo pobierać, wyszukiwać czy modyfikować informacje. Nie mówimy tutaj o zwykłym "przechodzeniu" po liście obiektów, tylko o gotowych metodach, które najczęściej bardzo dużo robią za nas.</p>
<p><strong>MongoDB</strong> jest jednym z wielu silników dostępnych na rynku, wyróżnia się jednak konstrukcją oraz sposobem przechowywania danych. Komunikacja z bazą bardzo przypomina to, co znamy już z JS-a (niedługo się o tym przekonasz). W dodatku same dane są przechowywane w formacie podobnym do znanego nam już JSON-a (tzw. BSON). Powoduje to, że <strong>MongoDB jest idealnym wyborem w przypadku aplikacji pisanych w Node.js</strong>. Potrafi dobrze z nimi współpracować, a z racji podobnej budowy, jest stosunkowo łatwy w nauce.</p>
<p>Przy okazji – nie bez powodu napisaliśmy "Node.js", a nie "JS". Wiesz już po poprzednich modułach, że klient nie komunikuje się z bazą danych. To rola serwera, który tworzymy w końcu z wykorzystaniem Node.js (nie zapominaj, że Express jest tylko frameworkiem).</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Alternatywny wybór</h4>
<p>Jeśli tematyka baz danych nie jest Ci obca, to bardzo możliwe, że było Ci dane pracować z dwoma innymi popularnymi technologiami – SQL lub MySQL. Moglibyśmy wykorzystać je zamiast MongoDB, jednak z racji tego, że dane są w nich przechowywane w trochę inny sposób, a sam interfejs do komunikacji to kompletnie nowa idea (język deklaratywny), byłoby to o wiele mniej wygodne. Nawet sama podstawowa konfiguracja zajęłaby nam o wiele więcej czasu.</p>
</div>
<p>Podsumujmy, do czego przyda się MongoDB?</p>
<p>Po pierwsze, <strong>da nam możliwość przechowywania dużej ilości danych w nieulotny sposób</strong>, więc restart aplikacji nie będzie oznaczać utraty wprowadzonych zmian. Do tego <strong>dane będą przechowywane niezależnie od aplikacji</strong>. Owszem, będzie miała do nich dostęp i możliwość modyfikacji, ale jej wyłączenie lub ponownie uruchomienie nie wpłynie na spójność naszych danych.</p>
<p>Po drugie, MongoDB oferuje nam również przyjazny interfejs do komunikacji. Oznacza to, że <strong>wyszukiwanie danych czy ich modyfikacja będą możliwe przy użyciu prostych komend</strong>. Usunięcie osób z kolekcji <code>persons</code>, których wiek jest równy 18 lat, wyglądałoby tak: <code>db.persons.remove({ age: 18 })</code> – tylko jedna komenda. W przypadku tablic, jak zapewne pamiętasz, tych linijek byłoby 5.</p>
<p>Brzmi dobrze? Już wkrótce przekonasz się, że w praktyce również nie powinno sprawić Ci to problemu.</p>
<p>Tak naprawdę możemy traktować <strong>MongoDB jako bardziej zaawansowaną i niezależną alternatywę dla zwykłych tablic</strong>.</p>
<p>Pojawia się tylko jedno pytanie. Powiedzieliśmy o kilku zaletach MongoDB, ale nie rozwiązują one wszystkich problemów, o których była mowa we wprowadzeniu. Nie wspomnieliśmy, czy zaoferuje nam możliwość narzucania z góry struktury danych. Nie zająknęliśmy się również o relacyjności. Dlaczego? Dlatego, że akurat takich funkcjonalności samo MongoDB nie oferuje. Do tego będzie nam jeszcze potrzebna dodatkowa biblioteka – <strong>Mongoose</strong>. Na razie nie zawracaj sobie jednak tym głowy. Mongoose zajmiemy się później, teraz czas na poznanie MongoDB.</p>
<h3 id="291-poznajemy-mongodb-instalacja-mongodb">Instalacja MongoDB</h3>
<p>Zaczniemy od instalacji. Wejdź na <a href="https://www.mongodb.com/download-center/community" target="_blank">stronę mongodb.com</a> i wybierz zakładkę "Server", następnie wskaż wersję <strong>4.2.0</strong> oraz swój system i kliknij przycisk "Download". Możesz wybrać nowszą edycję, jeśli w momencie czytania tego materiału będzie dostępna, aczkolwiek wszystkie snippety z kodem, które pojawią się niniejszym module, były sprawdzone w wersji 4.2.0. Zalecamy więc użycie właśnie jej.</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">MongoDB Compass</h4>
<p>Wraz z MongoDB domyślnie pobierany jest również <strong>MongoDB Compass</strong>. To przyjazna aplikacja, która pozwala na przeglądanie baz danych za pomocą graficznego interfejsu. Opowiemy o niej trochę więcej później.</p>
</div>
<div class="bc-note alert-warning">
<h4 class="alert-heading text-center">Uwaga!</h4>
<p>Możesz natrafić na dwa problemy.</p>
<p>Pierwszy z dokończeniem instalacji. Proces czasami potrafi zatrzymać się na punkcie "Installing Compass". W takiej sytuacji po prostu przerwij działanie instalatora (sam MongoDB powinien być już w tym momencie zainstalowany) i pobierz Compass indywidualnie. Możesz to zrobić pod <a href="https://www.mongodb.com/download-center/compass" target="_blank">tym linkiem</a>. Wybierz koniecznie <strong>Community Edition Stable</strong>.</p>
<p>Drugi z brakiem katalogu <code>data/db</code>. MongoDB chce przechowywać dane w folderze <code>/data/db</code>, który powinien znajdować w katalogu domowym (np. <code>C:\data\db</code> dla Windowsa). Musisz go więc utworzyć, aby MongoDB był w stanie uruchomić serwer bazy danych.</p>
<p>Pamiętaj, że katalog <code>/data/db</code> musi być stworzony w głównym katalogu systemu (root). Konieczne może być więc skorzystanie z komendy <code>sudo</code> przy tworzeniu folderu oraz nadanie mu potem odpowiednich uprawnień (za pomocą komendy <code>chown</code>). Muszą to być na tyle duże uprawnienia, aby MongoDB mogło odczytywać, zapisywać, modyfikować i usuwać dane z tego folderu. W przypadku Maca alternatywą może być pobranie całego pakietu za pomocą Homebrew.</p>
</div>
<h3 id="291-poznajemy-mongodb-dostep-do-mongodb">Dostęp do MongoDB</h3>
<p>Aby dodać nową bazę albo wyszukiwać i modyfikować dane, musimy w jakiś sposób komunikować się z MongoDB. Możemy to robić na kilka sposobów.</p>
<ul>
<li><strong>Graficzny interfejs</strong> – mowa tu np. o wcześniej wspomnianym Compassie, który umożliwia łatwą modyfikację bazy danych.</li>
<li><strong>Node.js</strong> – wiemy, że serwery komunikują się z bazami danych, zatem jest to możliwe z poziomu aplikacji Node.js.</li>
<li><strong>Konsola</strong> – wraz z samym MongoDB na naszym komputerze instaluje się prosta aplikacja konsolowa (tzw. Mongo Shell), która pozwala na bezpośrednią komunikację z bazami danych za pomocą prostych komend.</li>
</ul>
<p>Pierwszy sposób pełni głównie rolę kontrolną. Przyda nam się, gdy będziemy np. chcieli sprawdzić, czy nasza aplikacja Node.js poprawnie zapisuje dane w bazie, albo czy dobrze je zmodyfikowała.</p>
<p>Jak się&nbsp;domyślasz, najczęściej sięgniemy po drugi sposób. W końcu po to nam bazy danych – mają być zbiornikiem informacji dla naszych zaawansowanych aplikacji. Chcemy sprawdzić ilość wolnych miejsc na koncercie albo zrobić rezerwację? Serwer połączy się z bazą danych, pobierze informacje i je nam przekaże, albo zrobi odpowiedni wpis w bazie.</p>
<p>Sposób z konsolą&nbsp;raczej nie będzie przez nas wykorzystywany w normalnej pracy. Użyjemy go jednak teraz, aby pokazać Ci, jeszcze bez aplikacji, jakie komendy udostępnia MongoDB w celu komunikacji z bazą danych.</p>
<h3 id="291-poznajemy-mongodb-tworzymy-nowa-baze">Tworzymy nową bazę</h3>
<p>Najczęściej będziemy porozumiewać się z bazą danych z poziomu samego serwera naszej aplikacji. Na razie jednak poznamy MongoDB, komunikując się z nim przez konsolę.</p>
<p>Odnajdź teraz folder, w którym zainstalowano MongoDB, a w nim katalog <code>bin</code> oraz dwa pliki: <code>mongod.exe</code> i <code>mongo.exe</code>.</p>
<p>Zadaniem <code>mongod.exe</code> jest uruchomienie serwera bazy danych i powinien on włączać się automatycznie wraz ze startem systemu. Gdy działa, możemy komunikować się z bazą z poziomu aplikacji, Compassa, czy też po prostu konsoli. To ważne, <strong>zawsze kiedy chcesz łączyć się z lokalną bazą danych, ten proces musi być uruchomiony</strong>. Gdy pojawi się w przyszłości problem przy połączeniu, to upewnij się, że ten proces jest włączony – jeśli nie, wystartuj go ręcznie.</p>
<p>Teraz uruchom drugi plik, <code>mongo.exe</code>, czyli konsolową aplikację do komunikacji z bazami danych MongoDB.</p>
<p>Zacznijmy od sprawdzenia, jakie zasoby aktualnie znajdują się na naszym dysku, warto wiedzieć bowiem, że <strong>na jednym komputerze możemy przechowywać więcej niż jedną bazę danych</strong>. To istotne, bo przecież każda aplikacja może mieć swoją własną. Na przykład nasza witryna festiwalu mogłaby korzystać z bazy o nazwie <code>NewWaveApp</code> i posiadać dwie kolekcje – <code>seats</code> i <code>concerts</code>, a aplikacja listy zadań – <code>columns</code> i <code>cards</code>.</p>
<p>Komenda, która wskaże nam aktualnie dostępne bazy to:</p>
<pre class=" language-js"><code class=" language-js">show dbs</code></pre>
<p>Pewnie spodziewasz się, że dostaniemy komunikat o braku jakiejkolwiek bazy danych. Nic bardziej mylnego. Do zapisywania informacji o swojej konfiguracji, użytkownikach bazy i hasłach, MongoDB używa... baz danych, stąd od razu lista trzech istniejących – <code>admin</code>, <code>config</code> oraz <code>local</code>. Nie musimy się nimi przejmować. Po prostu pamiętaj, że nie są one Twoim wytworem, a MongoDB wykorzystuje je do zapisywania własnych danych.</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo1.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo1.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Teraz czas na dodanie nowej, testowej bazy danych. Nazwiemy ją <code>companyDB</code>. Powiedzmy, że będzie ona zawierała informacje o jakiejś firmie i pomieści kolekcje na temat pracowników, stanowisk, działów itd.</p>
<p>Co ciekawe, w MongoDB nie istnieje komenda do samego tworzenia nowej bazy danych. Zamiast tego używamy:</p>
<pre class=" language-markup"><code class=" language-markup">use <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>db-name</span><span class="token punctuation">&gt;</span></span></code></pre>
<p>Polecenie to służy do wskazania bazy danych, na której aktualnie chcemy działać, ale jednocześnie potrafi utworzyć nową, jeśli jeszcze jej nie ma. Gdy baza już istnieje, zostanie wybrana i udostępniona nam w obiekcie <code>db</code>.</p>
<p>Wpisz teraz następującą komendę w konsoli (<code>mongo.exe</code>):</p>
<pre class=" language-markup"><code class=" language-markup">use companyDB</code></pre>
<p>Skoro jeszcze takiej bazy danych nie ma, MongoDB ją utworzy, a następnie wybierze (stąd też komunikat "Switched to...").</p>
<p>Od razu możemy przygotować również kolekcję danych. Służy do tego metoda <code>createCollection</code>, która wygląda tak:</p>
<pre class=" language-markup"><code class=" language-markup">db.createCollection(<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>collection-name</span><span class="token punctuation">&gt;</span></span>)</code></pre>
<p>My wygenerujemy trzy kolekcje danych <code>employees</code>, <code>deparatments</code> i <code>products</code>. Utworzenie pierwszej z nich nastąpi dzięki komendzie:</p>
<pre class=" language-markup"><code class=" language-markup">db.createCollection('employees')</code></pre>
<p>Możesz to potraktować jak rozkaz: do aktualnie wybranej bazy danych (<code>db</code> = <code>companyDB</code>) dodaj nową kolekcję o nazwie <code>employees</code>.</p>
<p>Analogicznie dodaj też nowe kolekcje <code>departments</code> i <code>products</code>.</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Upewnij się</h4>
<p>Aby sprawdzić, czy kolekcje faktycznie zostały dodane poprawnie, możesz skorzystać z komendy <code>show collections</code>. Pokaże Ci ona wszystkie kolekcje dostępne w aktualnie wybranej bazie.</p>
</div>
<p>Nasza baza danych <code>companyDB</code> ma w tej chwili następujący układ:</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo2.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo2.png" alt="image" style="width: auto;"></a>
<p>Jak zapewne udało Ci się zauważyć na grafice – aktualne dane z każdej kolekcji to puste tablice. Wspomnieliśmy już wcześniej, że MongoDB został zbudowany z myślą o komforcie developerów zaznajomionych z JS-em oraz formatem JSON. Kolekcje są więc zapisane jako tablice, a same konkretne elementy (w MongoDB nazywane dokumentami) w formacie BSON, który jest bardzo podobny do znanego Ci już JSON-a.</p>
<p>Tak naprawdę niewiele zmieni się w naszym podejściu do pracy z danymi, teraz będą już jednak nieulotne, przechowywane niezależnie od aplikacji i dostaniemy się do nich za pomocą prostych komend.</p>
<h3 id="291-poznajemy-mongodb-operacje-crud">Operacje CRUD</h3>
<p>Podstawą każdego silnika bazy danych jest oferowanie interfejsu komunikacyjnego, który pozwoli na kontakt z bazą i jej modyfikację. MongoDB daje nam takie możliwości przy użyciu zwykłych komend. Kilka z nich udało Ci się już poznać. Wiesz, że <code>show dbs</code> pokazuje listę baz danych na komputerze, <code>use &lt;db-name&gt;</code> pozwala wybrać bazę, na której chcemy aktualnie pracować, a <code>db.createCollection</code> utworzy nową kolekcję ("kolekcja" odnosi się po prostu do tablicy danych).</p>
<p>Oprócz tego każdy silnik musi oferować obowiązkowo zestaw poleceń do modyfikacji samych danych. W końcu, jaki sens miałaby baza danych, w której nie można nic zmieniać? Zestaw komend do wprowadzania, usuwania, modyfikacji oraz przeszukiwania określamy mianem <strong>CRUD</strong>.</p>
<p><strong>CRUD</strong> to po prostu akronim od:</p>
<ul>
<li><strong>C</strong>reate – baza danych musi oferować możliwość dodawania nowych danych,</li>
<li><strong>R</strong>ead – musi mieć także możliwość ich odczytu,</li>
<li><strong>U</strong>pdate – niezbędna jest również opcja aktualizacji,</li>
<li><strong>D</strong>elete – koniecznie musimy mieć też możliwość usuwania danych.</li>
</ul>
<p>Oczywiście każdy silnik bazy danych może oferować o wiele więcej możliwości, ale <strong>operacje typu CRUD to absolutna podstawa</strong>. Bez tych czterech funkcjonalności obsługa bazy danych byłaby zwyczajnie niemożliwa, dlatego teraz właśnie nimi się zajmiemy.</p>
<h4>Create</h4>
<p>Zaczniemy od tworzenia danych.</p>
<p>MongoDB oferuje nam od razu dwie możliwości:</p>
<ul>
<li><code>insertOne</code> – służy do wstawienia jednego nowego dokumentu (elementu) do wybranej kolekcji (tablicy),</li>
<li><code>insertMany</code> – pozwala na wstawienie wielu dokumentów do kolekcji.</li>
</ul>
<p>Każdej z metod zestawu CRUD będziemy używać w następujący sposób:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection<span class="token operator">-</span>name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token operator">&lt;</span>method<span class="token operator">&gt;</span></code></pre>
<p>czyli np.</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> firstName<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> lastName<span class="token operator">:</span> <span class="token string">'Doe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Przyznaj, że to dość intuicyjny zapis. Wybieramy kolekcję i mówimy, co chcemy z nią zrobić. Brzmi to niczym rozkaz: w aktualnie wybranej bazie danych odnajdź kolekcję <code>employees</code> i wstaw do niej nowy dokument (<code>{ firstName: 'John', lastName: 'Doe' }</code>).</p>
<p>Jak widzisz, <code>insertOne</code> przyjmuje po prostu jeden obiekt i wprowadza go do danej kolekcji. W przypadku <code>insertMany</code> jako argument przekazywalibyśmy tablicę obiektów do wprowadzenia. Na przykład:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> firstName<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> lastName<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> firstName<span class="token operator">:</span> <span class="token string">'Amanda'</span><span class="token punctuation">,</span> lastName<span class="token operator">:</span> <span class="token string">'Doe'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Teraz czas na Ciebie. Przy wykorzystaniu metod <code>insertMany</code> lub <code>insertOne</code>, bazując na powyższych przykładach, dodaj do kolekcji następujące dokumenty:</p>
<p><strong>employees</strong></p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">{</span>
  firstName<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
  lastName<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span>
  department<span class="token operator">:</span> <span class="token string">'IT'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  firstName<span class="token operator">:</span> <span class="token string">'Amanda'</span><span class="token punctuation">,</span>
  lastName<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span>
  department<span class="token operator">:</span> <span class="token string">'Marketing'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  firstName<span class="token operator">:</span> <span class="token string">'Jonathan'</span><span class="token punctuation">,</span>
  lastName<span class="token operator">:</span> <span class="token string">'Wilson'</span><span class="token punctuation">,</span>
  department<span class="token operator">:</span> <span class="token string">'IT'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  firstName<span class="token operator">:</span> <span class="token string">'Thomas'</span><span class="token punctuation">,</span>
  lastName<span class="token operator">:</span> <span class="token string">'Jefferson'</span><span class="token punctuation">,</span>
  department<span class="token operator">:</span> <span class="token string">'Testing'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  firstName<span class="token operator">:</span> <span class="token string">'Emma'</span><span class="token punctuation">,</span>
  lastName<span class="token operator">:</span> <span class="token string">'Cowell'</span><span class="token punctuation">,</span>
  department<span class="token operator">:</span> <span class="token string">'Testing'</span>
<span class="token punctuation">}</span></code></pre>
<p><strong>departments</strong></p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Marketing'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Testing'</span> <span class="token punctuation">}</span></code></pre>
<p><strong>products</strong></p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'New Wave Festival'</span><span class="token punctuation">,</span>
  client<span class="token operator">:</span> <span class="token string">'MyMusicWave Corp.'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'ImRich Banking official website'</span><span class="token punctuation">,</span>
  client<span class="token operator">:</span> <span class="token string">'ImRich LTD'</span>
<span class="token punctuation">}</span></code></pre>
<div class="bc-note alert-warning">
<h4 class="alert-heading text-center">Uwaga!</h4>
<p>MongoDB stara się być bardzo pomocne, do tego stopnia, że nawet jeśli pomylisz się i zrobisz literówkę w nazwie kolekcji, a więc zwyczajnie wybierzesz kolekcję nieistniejącą, to podobnie jak było to z wybraniem samej bazy danych, zostanie ona automatycznie utworzona.</p>
<p>Jeśli doszło do takiej sytuacji, zawsze możesz skorzystać z komendy <code>drop</code>. Potrafi ona usunąć wybraną (i np. błędnie nazwaną) kolekcję.</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">emplyes</span><span class="token punctuation">.</span><span class="token method function property-access">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
</div>
<p>Po wszystkich operacjach Twoja baza danych powinna wyglądać następująco:</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo3.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo3.png" alt="image" style="width: auto;"></a>
<p>Jak sprawdzić, czy rzeczywiście tak wygląda? Przyda się nam do tego metoda <code>find</code>.</p>
<h4>Read</h4>
<p>Drugą operacją, którą się zajmiemy, jest odczytywanie danych. Tutaj MongoDB daje nam bardzo szerokie możliwości, aby łatwo i precyzyjnie wybierać informacje nawet z ogromnych zbiorów.</p>
<p>Zacznijmy od początku. Interesują nas przede wszystkim dwie komendy:</p>
<ul>
<li><code>find</code> – służy do wyszukiwania wielu dokumentów,</li>
<li><code>findOne</code> – szuka tylko jednego pasującego elementu.</li>
</ul>
<p>W przypadku <code>find</code> dostaniemy tablicę z jednym elementem, wieloma lub pustą – w zależności od tego ile elementów spełni nasze warunki wyszukiwania. Można kojarzyć sobie rolę tej funkcji z <code>filter</code>, którą znasz z JS-a. Zadanie tamtej metody było bardzo podobne.</p>
<p>Stosując <code>findOne</code>, szukamy tylko jednego elementu. Jeśli baza zawiera jeden pasujący, to właśnie on zostanie zwrócony. W sytuacji, gdy będzie ich więcej, zwrócony zostanie pierwszy, który spełnia wymagania. Jeśli nie uda się znaleźć odpowiedniego elementu, metoda <code>find</code> zwróci po prostu <code>null</code>.</p>
<p>Jeśli chodzi o samo użycie metody, nie będzie się ono różniło od tego, co znamy już z <code>insertOne</code> czy <code>insertMany</code>. To wciąż ten sam koncept – <code>db.&lt;collection-name&gt;.&lt;method&gt;</code>.</p>
<p>Na przykład:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>Pozostaje nam jeszcze kwestia warunków. Jeśli użyjemy <code>findOne</code> i <code>find</code> bez argumentu, to pierwsza metoda zwróci nam po prostu pierwszy dokument z kolekcji, a druga wszystkie. Przekonaj się o tym na własną rękę.</p>
<p>W ramach ćwiczenia uruchom po kolei:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">departments</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">products</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>Konsola powinna zwrócić Ci całą zawartość każdej z kolekcji (tablicy).</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Automatyczne id</h4>
<p>Zapewne udało Ci się zauważyć, że zwrócone dane są trochę inne niż te, które dodawaliśmy. Każdy dokument otrzymał jedno nowe pole (atrybut), w postaci <code>_id</code>. Jest ono automatycznie nadawane dla każdego dokumentu jako unikalny identyfikator. To bardzo pożyteczna opcja, bo zazwyczaj i tak sami chcielibyśmy dodawać taki atrybut. MongoDB robi to za nas.</p>
</div>
<p>Opcja <code>find()</code>, która pokazuje nam wszystkie rekordy, jest przydatna, gdy np. chcemy zobaczyć całą zawartość danej kolekcji. Często zdarza się jednak, że potrzebujemy tylko jakąś część wyników, np. w aplikacji do zarządzania firmą, chcielibyśmy listować pracowników działu IT. Wtedy wolelibyśmy pobrać z bazy tylko dokumenty dotyczące tej grupy osób, a nie wszystkie. Na szczęście MongoDB daje nam takie możliwości. Co więcej, są one naprawdę szerokie. Nasze filtry mogą być bardzo precyzyjne, a wszystkie będziemy umieszczać jako atrybuty w argumencie funkcji.</p>
<p>Na przykład:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  firstName<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
  department<span class="token operator">:</span> <span class="token punctuation">{</span> $ne<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Argumentem metody jest po prostu obiekt, w którym możemy ustalić jakie atrybuty chcemy sprawdzać i w jaki sposób. Powyższy przykład powinien szukać pracowników o imieniu <code>John</code>, pracujących w dziale innym niż IT (<code>$ne</code> to skrót od "negacji").</p>
<p>Poniżej omówimy dokładnie jak budować prostsze i trudniejsze warunki.</p>
<h5>Konkretny warunek</h5>
<p>Najprostsza sytuacja jest wtedy, kiedy chcemy wyszukać element, którego atrybuty mają jakąś konkretną wartość – nie większą czy mniejszą, albo "podobną", tylko <strong>dokładnie taką samą</strong>. W takim przypadku jako szukaną wartość atrybutu wystarczy wskazać konkretną informację. Robiliśmy to już wyżej, szukając pracowników o imieniu John.</p>
<p>Na przykład:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> department<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>zwróci nam tylko pracowników działu IT.</p>
<p>A taka instrukcja:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> firstName<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> department<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>będzie szukała pracownika, który nie tylko należy do działu IT, lecz również ma na imię <code>John</code>.</p>
<p>Przyznaj – to dość intuicyjne, prawda?</p>
<h5>Mniej jasna sytuacja – używamy operatorów</h5>
<p>Oczywiście nie zawsze sytuacja jest aż tak prosta. Często chcielibyśmy, aby te warunki były mniej konkretne, np. poszukujemy osoby poniżej 18 lat, czy też szukamy pracowników, którzy zarabiają od 2000 do 4000 tysięcy, albo – to, co już pokazaliśmy wcześniej – chcemy wyszukać dokumenty, których jakiś atrybut ma wartość inną niż wskazana przez nas (przykład z negacją).</p>
<p>W takich sytuacjach skorzystamy z szerokiej gamy dostarczonych przez MongoDB <strong>operatorów</strong>. Całą ich listę możesz znaleźć <a href="https://docs.mongodb.com/manual/reference/operator/query/" target="_blank">pod tym linkiem</a>.</p>
<p>Poniżej przedstawiamy tylko niektóre z nich:</p>
<ul>
<li><code>$eq</code>	– wartość atrybutu musi być <strong>dokładnie taka</strong> jak wskażemy, np. <code>{ age: { $eq: 21 }}</code>. Oczywiście <code>{ age: 21 }</code> też byłby tutaj poprawnym wyborem. <code>$eq</code> ma pewną przewagę nad zapisem bez operatora w kwestii bezpieczeństwa, ale nie będziemy poruszać tego tematu w tym module.</li>
<li><code>$gt</code>	– wartość atrybutu musi być <strong>większa</strong> niż podana, np. <code>{ age: { $gt: 18 }}</code> zadziała jak warunek <code>if(age &gt; 18)</code>.</li>
<li><code>$gte</code> – wartość atrybutu musi być <strong>większa lub równa</strong> podanej, np. <code>age: { $gte: 18 }</code> (warunek <code>if(age &gt;= 18)</code>).</li>
<li><code>$in</code>	– wartość atrybutu musi być <strong>równa jednemu z możliwych wyborów</strong>. Możemy wskazać tablicę kilku opcji i jeśli chociaż jedna z nich odpowiada wartości atrybutu dokumentu, to będzie on zwrócony przy wyszukiwaniu, np. <code>{ hobby: { $in: ['sports', 'movies'] }}</code> (to jak warunek <code>if(hobby === 'sports' || hobby === 'movies')</code>.</li>
<li><code>$lt</code>	– wartość atrybutu musi być <strong>mniejsza</strong> niż podana, np. <code>{ age: { $lt: 18 }}</code> (to jak warunek <code>if(age &lt; 18)</code>).</li>
<li><code>$lte</code> – wartość atrybutu musi być <strong>mniejsza lub równa</strong> podanej, np. <code>{ age: { $lte: 18 }}</code> (to jak warunek <code>if(age &lt;= 18)</code>).</li>
<li><code>$ne</code>	– wartość musi być <strong>inna niż podana</strong> (negacja), np. <code>{ firstName: { $ne: 'John' }}</code> (to jak warunek <code>if(firstName !== 'John')</code>).</li>
<li><code>$nin</code> – negacja <code>$in</code>. Wartość atrybutu <strong>nie może pasować do żadnego z podanych wyborów</strong>. Wskazujemy tablicę elementów i jeśli dany atrybut ma wartość pasującą do jednego z nich, to element nie będzie zwrócony.</li>
</ul>
<p>Samo użycie operatorów pokazywaliśmy już wyżej w przykład z <code>$ne</code>. Dla jasności napiszmy to jednak jeszcze raz. W przypadku użycia operatorów, zamiast konkretnej wartości przy atrybucie, wstawiamy po prostu obiekt z operatorem.</p>
<p>Na przykład:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  department<span class="token operator">:</span> <span class="token string">'IT'</span><span class="token punctuation">,</span>
  salary<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>W tym przypadku znajdziemy pracowników, których atrybut <code>department</code> jest równy <code>IT</code>, ale pensja może być dowolna, o ile jest większa od 2000. Oczywiście ten przykład nie miałby sensu w naszej bazie danych, bo nie ma takiego pola jak <code>salary</code>.</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  department<span class="token operator">:</span> <span class="token punctuation">{</span> $nin<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'IT'</span><span class="token punctuation">,</span> <span class="token string">'Marketing'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Powyższa instrukcja wyszuka pracowników każdego innego działu niż <code>IT</code> czy <code>Marketing</code>.</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Zwiększamy czytelność</h4>
<p>Domyślnie <code>find</code> oraz <code>findOne</code> pokazuje rezultat w formie długiego ciągu bez żadnego formatowania. Jeśli chcesz, żeby MongoDB przedstawił Ci znalezione dane w trochę ładniejszy sposób, to wystarczy po pierwszej metodzie użyć jeszcze kolejnej – <code>pretty</code>. Zadba ona o odpowiednie wcięcia i podział na linie.</p>
<p>Wykorzystuje się ją w ten sposób:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">pretty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<p>W ramach treningu wykonaj następujące ćwiczenia.</p>
<h6>Ćwiczenie 1</h6>
<p>Wyszukaj w kolekcji <code>employees</code> wszystkich pracowników marketingu i działu IT, którzy nie mają na imię John.</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-t9AXp6DKi-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż odpowiedź</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-t9AXp6DKi-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj odpowiedź</a>
  </span>
</p>
<div id="collapse-t9AXp6DKi-toggle" class="collapse">
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  department<span class="token operator">:</span> <span class="token punctuation">{</span> $<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'IT'</span><span class="token punctuation">,</span> <span class="token string">'Marketing'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  firstName<span class="token operator">:</span> <span class="token punctuation">{</span> $ne<span class="token operator">:</span> <span class="token string">'John'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<h6>Ćwiczenie 2</h6>
<p>Znajdź wszystkich pracowników działu IT z kolekcji <code>employees</code>.</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-QZSRBrorf9-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż odpowiedź</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-QZSRBrorf9-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj odpowiedź</a>
  </span>
</p>
<div id="collapse-QZSRBrorf9-toggle" class="collapse">
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  department<span class="token operator">:</span> <span class="token punctuation">{</span> $eq<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>lub</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">employees</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  department<span class="token operator">:</span> <span class="token string">'IT'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<h6>Ćwiczenie 3</h6>
<p>Znajdź wszystkie projekty (<code>products</code>), w których klient jest kimś innym niż <code>MyMusicWave Corp.</code>.</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-pLNA3IQD_r-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż odpowiedź</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-pLNA3IQD_r-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj odpowiedź</a>
  </span>
</p>
<div id="collapse-pLNA3IQD_r-toggle" class="collapse">
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">products</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  client<span class="token operator">:</span> <span class="token punctuation">{</span> $ne<span class="token operator">:</span> <span class="token string">'MyMusicWave Corp.'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<h5>Więcej warunków</h5>
<p>Czy warunki mogą być&nbsp;jeszcze bardziej szczegółowe? Na przykład, gdybyśmy szukali osób w wieku z przedziału 18-40, lub chcieli sprawdzić pracowników, którzy np. zarabiają od 2000 do 4000 i od 6000 do 8000? Możemy to zrobić&nbsp;w MongoDB i wygląda to bardzo podobnie jak w zwykłych pętlach warunkowych. W takiej sytuacji używamy po prostu operatorów koniunkcji (<code>&amp;&amp;</code> – tutaj <code>$and</code>) oraz alternatywy (<code>||</code> – tutaj <code>$or</code>).</p>
<p>Podobnie jak przy wcześniejszych instrukcjach, użycie <code>$and</code> oraz <code>$or</code> jest bardzo intuicyjne.</p>
<p>Składnia operatora <code>$and</code> wygląda tak:</p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">{</span> $and<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>array<span class="token operator">-</span><span class="token keyword">of</span><span class="token operator">-</span>conditions<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></code></pre>
<p>W miejscu <code>&lt;array-of-conditions&gt;</code> możemy wstawiać tablicę tylu warunków, ilu tylko chcemy.</p>
<p>Na przykład wyszukiwanie osób, które mają więcej niż 18 lat, a mniej niż 40, mogłoby wyglądać następująco:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $and<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span>  $lt<span class="token operator">:</span> <span class="token number">40</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Taki zapis możemy rozumieć jak rozkaz: znajdź osoby, których wiek (<code>age</code>) spełnia dwa warunki – jest większy niż 18 i mniejszy niż 40. W zwykłej pętli warunkowej wyglądałoby to mniej więcej tak: <code>if(age &gt; 18 &amp;&amp; age &lt; 40)</code>.</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Zapis bez $and</h4>
<p>Warto dodać, że często istnieje również możliwość bezpośredniego użycia kilku operatorów dla danej właściwości, co dałoby nam taki sam efekt:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span> $lt<span class="token operator">:</span> <span class="token number">40</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Jednak <code>$and</code> ma jedną ważną zaletę, której taki zapis nam nie daje – możemy kilkukrotnie warunkować jakiś jeden atrybut. Na przykład taki kod:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token punctuation">{</span> $ne<span class="token operator">:</span> <span class="token string">'John'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token punctuation">{</span> $ne<span class="token operator">:</span> <span class="token string">'Amanda'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>sprawi, że dla MongoDB istotny będzie tylko ostatni warunek, a więc znajdziemy wszystkie osoby, których imię jest inne niż Amanda. Natomiast</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> $and<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token punctuation">{</span> $ne<span class="token operator">:</span> <span class="token string">'John'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token punctuation">{</span> $ne<span class="token operator">:</span> <span class="token string">'Amanda'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>będzie pilnować, aby szukało nam osób, które mają imię inne od Johna, ale i Amandy.</p>
<p>Często <code>$and</code> używa się dla samej czytelności przekazu, ale warto stosować go przede wszystkim wtedy, kiedy właśnie mamy taką sytuację jak wyżej.</p>
</div>
<h6>Ćwiczenie</h6>
<p>W ramach ćwiczenia zajmijmy się&nbsp;taką przykładową kolekcją danych:</p>
<p><strong>db.persons</strong></p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> salary<span class="token operator">:</span> <span class="token number">5000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Amanda Doe'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> salary<span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Thomas Jefferson'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span> salary<span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'William Haze'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span> salary<span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p>Zastanów się, jak wyglądałaby instrukcja, która znajdowałaby wszystkie osoby będące w przedziale wiekowym od 20 do 50 lat i zarabiające od 2500 do 4000.</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-CGRW1hdUKh-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż odpowiedź</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-CGRW1hdUKh-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj odpowiedź</a>
  </span>
</p>
<div id="collapse-CGRW1hdUKh-toggle" class="collapse">
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  $and<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    age<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> $lt<span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    salary<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">2500</span><span class="token punctuation">,</span> $lt<span class="token operator">:</span> <span class="token number">4000</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Całkiem logiczne, prawda? ;)</p>
</div>
<p>Podobnie możemy wykorzystywać <code>$or</code>.</p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">{</span> $or<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>array<span class="token operator">-</span><span class="token keyword">of</span><span class="token operator">-</span>conditions<span class="token operator">&gt;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></code></pre>
<p><code>$or</code> to oczywiście alternatywa, więc wystarczy, aby tylko jedna opcja pasowała.</p>
<p>Przykładowo wyszukiwanie osób, które zarabiają mniej niż 2500 lub więcej niż 4000, mogłoby wyglądać tak:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  $or<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> salary<span class="token operator">:</span> <span class="token punctuation">{</span> $lt<span class="token operator">:</span> <span class="token number">2500</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> salary<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">4000</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Możemy to rozumieć jako rozkaz: znajdź takie osoby, których pensja (<code>salary</code>) jest mniejsza od 2500 albo większa od 4000.</p>
<h6>Ćwiczenie</h6>
<p>Spróbuj zastanowić się, jak wyglądałaby analogiczna instrukcja dla tej samej kolekcji co w poprzednim ćwiczeniu (<code>db.persons</code>), która znajdowałaby wszystkie osoby będące w przedziale wiekowym powyżej 45 lub poniżej 20 lat i zarabiające od 1000 do 3000.</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-Rdk92lHjpK-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż odpowiedź</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-Rdk92lHjpK-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj odpowiedź</a>
  </span>
</p>
<div id="collapse-Rdk92lHjpK-toggle" class="collapse">
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  $or<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $lt<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">45</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  $and<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> salary<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">1000</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> salary<span class="token operator">:</span> <span class="token punctuation">{</span> $lt<span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<p>Podobnie jak w samym JS-ie możemy ze sobą łączyć <code>$and</code> i <code>$or</code>, aby stworzyć bardziej zaawansowane warunki.</p>
<p>Na przykład:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  $or<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> $and<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $lt<span class="token operator">:</span> <span class="token number">50</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $eq<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Ten kod wyszukałby osoby, których wiek mieści się w przedziale 20-50, albo mają równo 18 lat.</p>
<p>Możemy również używać <code>$and</code> i <code>$or</code> szerzej, na przykład:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  $or<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
      salary<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      age<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">25</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Powyższy kod wyszukiwałby osoby, które albo mają 18 lat i zarabiają więcej niż 3000, albo mają więcej niż 25 lat.</p>
<p>Oczywiście tego typu przykłady, mimo że wciąż w miarę intuicyjne, mogą być dla Ciebie zbyt skomplikowane. Nie obawiaj się, nieczęsto będziemy potrzebować aż tak dokładnych warunków, aby wybrać potrzebne dane. Chcieliśmy Ci po prostu pokazać jakie możliwości drzemią w metodach <code>find</code> i <code>findOne</code>. Przyznaj, że takie wybieranie jest o wiele lepsze niż "przechodzenie" po zwykłej tablicy za pomocą <code>filter</code> czy <code>forEach</code>, co robiliśmy w czystym JS-ie.</p>
<h4>Update</h4>
<p>Czas na aktualizację danych. MongoDB oferuje tutaj dwie metody:</p>
<ul>
<li><code>updateMany</code> – służy do aktualizacji wielu dokumentów,</li>
<li><code>updateOne</code> – służy do aktualizacji tylko jednego pasującego dokumentu.</li>
</ul>
<p>Pierwsza (<code>updateMany</code>) ma za zadanie znaleźć wszystkie elementy pasujące do warunku, który ustalimy i zmodyfikować je zgodnie z naszym życzeniem. Może to być jeden pasujący element, dwa, albo nawet wszystkie z danej kolekcji.</p>
<p>Druga (<code>updateOne</code>) szuka tylko jednego elementu pasującego do założonego warunku i tylko jego aktualizuje. Jeśli dokumentów pasujących jest więcej, to metoda ta zmodyfikuje po prostu pierwszy, który znajdzie. Jeśli żaden dokument nie pasuje, to zwyczajnie nic nie zostanie zrobione.</p>
<p>Ich składnia, podobnie jak w przypadku wcześniejszych metod, jest bardzo intuicyjna. Wygląda to następująco:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection<span class="token operator">-</span>name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token method function property-access">updateMany</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>condition<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>data<span class="token operator">-</span>to<span class="token operator">-</span>update<span class="token operator">&gt;</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection<span class="token operator">-</span>name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>condition<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>data<span class="token operator">-</span>to<span class="token operator">-</span>update<span class="token operator">&gt;</span><span class="token punctuation">)</span></code></pre>
<p>Pierwszy parametr będzie wyglądał tak samo, jak w przypadku <code>find</code>. Możemy więc ustalać w nim, że szukamy dokumentów, których np. <code>name</code> to <code>John</code> (<code>{ name: 'John' }</code>), albo wiek jest większy od 18 <code>{ age: { $gt: 18 }}</code>. Możemy używać prostych warunków lub korzystać z wszelkich znanych Ci już operatorów. To po prostu parametr, który mówi, jakich elementów szukamy.</p>
<p>Drugi parametr ma za to ustalić, w jaki sposób chcemy zmodyfikować te dokumenty. Przyjmuje on następującą składnię:</p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">&lt;</span>attrs<span class="token operator">-</span>to<span class="token operator">-</span>update<span class="token operator">&gt;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span></code></pre>
<p>Jest to obiekt z atrybutem o nazwie <code>$set</code>. Wartością tego atrybutu powinien być nowy obiekt, który będzie wskazywać jakie właściwości pasujących dokumentów powinny być zmodyfikowane (nie musimy bowiem aktualizować koniecznie całego dokumentu) i jaka ma być ich nowa wartość.</p>
<p>Spójrzmy na przykład:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span> salary<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> salary<span class="token operator">:</span> <span class="token number">2500</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Powyższy kod znalazłby wszystkie osoby zarabiające powyżej 3000 i zmniejszył ich pensję do 2500. Taka instrukcja brzmiałaby bowiem jak rozkaz: znajdź wszystkie elementy, których atrybut <code>salary</code> ma wartość większą od 3000 i zmniejsz ich atrybut <code>salary</code> do 2500.</p>
<p>Oczywiście nie musimy modyfikować akurat tego atrybutu, po którym wyszukiwaliśmy pasujące rekordy.</p>
<p>Na przykład:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> salary<span class="token operator">:</span> <span class="token number">5000</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Tutaj szukalibyśmy pierwszej osoby z kolekcji, która ma więcej niż 18 lat i ustawialibyśmy jej atrybut <code>salary</code> (a więc pensję) na 5000.</p>
<p>Naturalnie liczba atrybutów, po których szukamy dokumentów, może być dowolna, podobnie zresztą jak w <code>find</code>. Dowolna może być również liczba modyfikacji, które chcemy do nich wprowadzić.</p>
<p>W tym momencie może pojawić się jeszcze jedno pytanie – a co jeśli w <code>$set</code> wstawilibyśmy atrybut, który w dokumencie nie istnieje? Cóż, znasz już trochę MongoDB, więc możesz się domyślać. W takiej sytuacji silnik zwyczajnie dodałby nowy atrybut do dokumentu/dokumentów.</p>
<h6>Ćwiczenie</h6>
<p>W ramach ćwiczenia przeszukamy taką przykładową kolekcję danych:</p>
<p><strong>db.persons</strong></p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> salary<span class="token operator">:</span> <span class="token number">5000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Amanda Doe'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> salary<span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Thomas Jefferson'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span> salary<span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'William Haze'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span> salary<span class="token operator">:</span> <span class="token number">2000</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p>Zastanów się, jak wyglądałaby instrukcja, która znajdowałaby wszystkie osoby będące w przedziale wiekowym od 18 do 30 lat i zarabiające od 2500 do 4000, a następnie zmieniała ich pensje na sztywne 3000.</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-I_FMblEsJZ-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż odpowiedź</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-I_FMblEsJZ-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj odpowiedź</a>
  </span>
</p>
<div id="collapse-I_FMblEsJZ-toggle" class="collapse">
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    $and<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span> $lt<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> salary<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">2500</span><span class="token punctuation">,</span> $lt<span class="token operator">:</span> <span class="token number">4000</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    $set<span class="token operator">:</span> <span class="token punctuation">{</span> salary<span class="token operator">:</span> <span class="token number">3000</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<h4>Remove</h4>
<p>Pozostała nam ostatnia funkcjonalność do omówienia – usuwanie danych. MongoDB oferuje nam tutaj dwie możliwości:</p>
<ul>
<li><code>deleteOne</code> – służy do usuwania jednego dokumentu,</li>
<li><code>deleteMany</code> - służy do usuwania wielu dokumentów.</li>
</ul>
<p>Składnia nie będzie tutaj dla Ciebie żadną nowością:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection<span class="token operator">-</span>name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>condition<span class="token operator">&gt;</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token operator">&lt;</span>collection<span class="token operator">-</span>name<span class="token operator">&gt;</span><span class="token punctuation">.</span><span class="token method function property-access">deleteMany</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>condition<span class="token operator">&gt;</span><span class="token punctuation">)</span></code></pre>
<p>W miejscu <code>&lt;condition&gt;</code> wstawiamy po prostu warunek, po którym chcemy szukać pasujących dokumentów. Ponownie, wygląda to dokładnie tak samo, jak w <code>find</code> i pierwszym parametrze <code>updateOne</code>/<code>updateMany</code>. Może to być prosty warunek (np. <code>{ age: 18 }</code>) albo bardziej skomplikowany z operatorami. Na dobrą sprawę, składnia jest wręcz identyczna jak <code>find</code>, z tym, że <code>find</code> wyszukuje pasujące elementy i tylko je zwraca, a tutaj nie tylko ich szukamy, ale również usuwamy.</p>
<p>Zauważ, że podobny warunek możemy zapisać także bez <code>$and</code>. Na przykład:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">deleteMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token punctuation">{</span> $gt<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span> $lt<span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Powyższy kod znalazłby i usunął wszystkie osoby w przedziale wiekowym 18-30.</p>
<p>Drugi przykład:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">persons</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Tutaj usunęlibyśmy pierwszą osobę z kolekcji, której wiek byłby równy 18.</p>
<h3 id="291-poznajemy-mongodb-podsumowanie">Podsumowanie</h3>
<p>Zanim poznaliśmy MongoDB, mógł Ci się jawić jako kolejne skomplikowane narzędzie, które pewnie wspomoże pracę nad dużymi zbiorami danych, ale też dołoży sporą dawkę wiedzy do przyswojenia.</p>
<p>Mamy nadzieję, że teraz jego odbiór jest już trochę inny.</p>
<p>Mimo nowej wiedzy i potrzeby zapamiętania kilku metod nie można odmówić MongoDB intuicyjności. Bardzo podobny sposób przechowywania danych do tego, który znamy już z JS-a oraz prosta konstrukcja metod powoduje, że z MongoDB pracuje się podobnie jak przy użyciu zwykłych tablic, a może nawet prościej.</p>
<p>Oczywiście trochę nauki jeszcze przed nami. Musimy dowiedzieć się, jak korzystać z MongoDB w aplikacjach Node.js, poznamy też Mongoose i jej ideę modeli danych. Początek sugeruje jednak, że nie będzie to aż tak trudne, jak mogło się wydawać.</p>
<p>Zarówno MongoDB, jak i Mongoose, to bardzo intuicyjne technologie, które po tym module z pewnością umieścisz w swoim programistycznym arsenale.</p>

                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <small>Jeśli masz wątpliwości do powyższego materiału, to - zanim zatwierdzisz - zapytaj na czacie :)</small>
                                                <div class="clearfix">
                                                                                <button class="btn  btn-primary "><i class="fa fa-check"></i><span>Zapoznałe(a)m się!</span></button>
                                                                                                    </div>
                    </div>
                </section>
                                    
                <section id="submodule-1155" class="card submodule completed" data-bootcamp-user-submodule-id="666335">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">29.2. <span>MongoDB w Node.js</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Operowanie na danych z bazy przy użyciu konsoli było stosunkowo proste, wiemy jednak, że nie jest to technika, z której będziemy korzystać na co dzień.</p>
<p>W tym submodule zajmiemy się komunikacją serwera Node.js z bazą danych MongoDB.</p>
<p>Postaramy się pracować od razu na praktycznym przykładzie, a będzie to serwer API dla aplikacji do zarządzania firmą, przy wykorzystaniu bazy danych <code>CompanyDB</code>, którą przygotowaliśmy w pierwszym submodule. Co ważne, zajmiemy się tylko i wyłącznie warstwą serwera, a więc stworzeniem dobrych endpointów i połączeniem z bazą danych. Warstwa klienta tym razem nas nie interesuje.</p>
<h3 id="292-mongodb-w-nodejs-pierwsze-kroki">Pierwsze kroki</h3>
<p>Zacznijmy od założeń. Nasza aplikacja powinna obsługiwać REST-owe endpointy dla trzech kolekcji danych:</p>
<ul>
<li>employees</li>
<li>departments</li>
<li>products</li>
</ul>
<p>Od razu mamy dla Ciebie niespodziankę. Serwer API jest już gotowy i możesz go pobrać pod <a href="https://uploads.kodilla.com/bootcamp/wdp/29.mongo/CompanyApp.zip" target="_blank">tym linkiem</a>.</p>
<p>Jeśli zajrzysz w kod, to nie ma tu dla Ciebie niczego nowego. Bardzo podobne, a wręcz identyczne serwery API, pisaliśmy już na etapie modułu o Expressie. Nasz gotowiec poprawnie obsługuje wszystkie endpointy, lecz ma jedną wadę... dane przechowuje w zwykłych tablicach. Zadanie będzie więc bardzo krótkie. <strong>Musimy tak zmodyfikować tę aplikację (serwer API), aby zamiast zwykłych tablic, korzystała z zewnętrznej bazy danych MongoDB</strong>.</p>
<h3 id="292-mongodb-w-nodejs-do-dziela">Do dzieła</h3>
<p>Zacznij od rozpakowania gotowca i odpalenia komendy <code>yarn install</code>. Chcemy bowiem, aby Yarn ściągnął wszystkie potrzebne zależności.</p>
<p>Oprócz paczek zapisanych w <code>package.json</code> będziemy musieli pobrać jeszcze jedną – <code>mongodb</code>. Jest to oficjalny pakiet twórców MongoDB, który – jak sama nazwa sugeruje – będzie służył do łatwej komunikacji z bazami danych Mongo.</p>
<p><code>yarn add mongodb@3.3.2</code></p>
<p>Następnie zaimportuj tę paczkę w pliku <code>server.js</code>:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> mongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">MongoClient</span></span><span class="token punctuation">;</span></code></pre>
<p>Zauważ, że potrzebujemy tylko części modułu <code>mongodb</code>, a mianowicie <code>mongoClient</code>, dającej dostęp do operacji CRUD. Podobnie robiliśmy, pracując z WebSocketami. Oczywiście, jeśli się uprzemy, możemy załadować po prostu cały moduł, tylko po co? ;)</p>
<p>Pozostaje nam teraz wykorzystać tę paczkę do utworzenia połączenia. MongoDB oferuje tutaj gotową funkcję <code>connect</code>:</p>
<pre class=" language-js"><code class=" language-js">mongoClient<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> client</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Successfully connected to the database'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Pierwszy parametr tej funkcji wskazuje na adres serwera MongoDB (u nas to lokalne <code>localhost:27017</code>), a drugi umożliwia opcjonalną konfigurację. Ustawienia, które wybraliśmy nie są konieczne do działania, ale pozwalają na wykorzystywanie nowszych możliwości silnika i twórcy zalecają ich stosowanie. Nie będziemy tutaj wchodzić w szczegóły. Trzeci parametr to po prostu funkcja callback, która ma uruchomić się już po próbie połączenia. Oczywiście połączenie to może się czasem nie udać. W takiej sytuacji treść błędu będzie dostępna w pierwszym parametrze funkcji callback (u nas to <code>err</code>). Jeśli jednak wszystko pójdzie dobrze, to obiekt klienta MongoDB zostanie zapisany w drugim parametrze (u nas <code>client</code>).</p>
<p>Wewnątrz funkcji callback możemy robić już co tylko chcemy, zarówno z bazą, jak i ewentualnym powiadomieniem o błędzie. Na razie sprawdzamy tylko, czy komunikat o niepowodzeniu istnieje. Jeśli tak, to pokazujemy go w konsoli, a jeśli nie, wypisujemy <code>Successfully connected to the database</code>.</p>
<p>Dodaj powyższy kod do swojej aplikacji i zobacz, czy po uruchomieniu serwera pokaże się poprawny komunikat. Jeśli dostaniesz informację o błędzie, to sprawdź, czy aby na pewno proces <code>mongod</code> jest uruchomiony.</p>
<h3 id="292-mongodb-w-nodejs-opakowujemy-serwer-w-funkcje-callback">Opakowujemy serwer w funkcję callback</h3>
<p>Zwróć uwagę, że tak naprawdę serwer Express w tej chwili kompletnie nie wykorzystuje nowego kodu. Co więcej, samo połączenie z bazą danych jest asynchroniczne, więc zwyczajnie funkcja callback wykona się niezależnie od reszty skryptu. Obiekt <code>client</code> jest dostępny tylko w callbacku, a w reszcie kodu, gdzie inicjujemy też serwer, już nie. Tak naprawdę, serwer nie korzysta z naszej bazy, ale nawet nie ma takiej możliwości. Co z tym zrobić?</p>
<p>Najprostszym rozwiązaniem jest umieszczenie całego kodu inicjacji serwera Express w funkcji callback. Da nam to gwarancję, że zostanie on uruchomiony dopiero, gdy połączenie z bazą będzie gotowe. Uzyskamy też pewność, że serwer będzie miał w niej dostęp do obiektu <code>client</code>.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cors'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mongoClient <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">MongoClient</span></span><span class="token punctuation">;</span>

<span class="token keyword">const</span> employeesRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/employees.routes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> departmentsRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/departments.routes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> productsRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/products.routes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

mongoClient<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> client</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Successfully connected to the database'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> employeesRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> departmentsRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> productsRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found...'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Server is running on port: 8000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Od tej chwili nasz <code>server.js</code> nie tylko łączy się z bazą, ale też pozwala na dostęp do niej z poziomu serwera Express, poprzez obiekt <code>db</code>.</p>
<h3 id="292-mongodb-w-nodejs-praktyczne-przyklady">Praktyczne przykłady</h3>
<p>Czas na sprawdzenie, czy faktycznie dostęp do bazy jest taki, jakiego oczekiwaliśmy. Działanie na danych nie będzie różniło się bardzo od tego, co znasz już z konsoli i przykładów z pierwszego submodułu.</p>
<h4>Wybieranie bazy danych</h4>
<p>Zacznijmy od wybrania bazy danych, na której chcemy pracować, bo jak zapewne pamiętasz, MongoDB może utrzymywać ich wiele na swoim serwerze. W terminalu wystarczyło wpisać po prostu <code>use companyDB</code>, ale nie jest to format zapisu, który kiedykolwiek widywaliśmy w JS-ie, prawda? ;)</p>
<p>Tutaj prezentuje się to następująco:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">'companyDB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Wygląda trochę inaczej, ale równie intuicyjnie. Efekt jest dokładnie taki sam – otrzymujemy dostęp do wybranej bazy danych, a referencję do niej przechowujemy w stałej <code>db</code>.</p>
<p>Zapis <code>const db = client.db('companyDB');</code> możemy rozumieć więc jako rozkaz: na serwerze MongoDB znajdź bazę danych o nazwie <code>companyDB</code> i przypisz referencję do niej do stałej <code>db</code>.</p>
<p>Wpisz powyższy kod na samym początku bloku <code>else</code> w funkcji callback metody <code>connect</code>.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Successfully connected to the database'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">'companyDB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token spread operator">...</span></code></pre>
<p>Teraz czas na operacje CRUD. Tutaj też zapis będzie bardzo podobny, choć wybranie kolekcji wygląda nieco inaczej. Zamiast <code>db.&lt;collection-name&gt;.&lt;method&gt;</code> (np. <code>db.employees.find()</code>) będziemy używali zapisu <code>db.collection(&lt;collection-name&gt;).&lt;method&gt;</code> (np. <code>db.collection('employees').find()</code>).</p>
<p>Sama składnia metod CRUD-owych będzie identyczna. Na przykład, wyszukiwanie osób poniżej wieku 18 lat wciąż mogłoby wyglądać tak – <code>db.collection('persons').find({ age: { $lt: 18 } })</code>. Składnia w <code>find</code> nie różni się niczym od tego, co znasz z przykładów testowanych w poprzednim submodule w terminalu.</p>
<p>Dobrze, przejdźmy do praktyki. Spróbujmy wykonać w pliku <code>server.js</code> kilka prostych operacji na bazie danych. Oczywiście wszystkie muszą być wywoływane wewnątrz funkcji callback naszego połączenia z bazą, bo tylko tam mamy do niej dostęp pod stałą <code>db</code>.</p>
<h4>Wyszukiwanie danych</h4>
<p>Spróbujmy teraz pobrać wszystkich pracowników (kolekcja <code>employees</code>), którzy pracują w dziale IT. Mogłoby to wyglądać następująco:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'employees'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> department<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//do something with data</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Początek jest faktycznie bardzo podobny, ale mamy też jedną nowość – funkcję callback jako drugi parametr. Ma to swoje uzasadnienie. Przy użyciu konsolowego skryptu, wszystkie wyniki były wypisywane od razu w terminalu, co mogło być dla nas dość wygodne. W przypadku aplikacji Node.js chcielibyśmy jednak sami decydować, co zrobimy z wynikiem lub błędem. Możemy ustalić – pokażemy pobrane dane w podstawowej formie, czy jednak chcemy nad nimi jeszcze popracować. Wykorzystanie callbacków daje nam taką szansę.</p>
<p>Jak zapewne się domyślasz, pierwszy parametr (<code>err</code>) przechowywałby ewentualny błąd, a drugi (<code>data</code>) po prostu dane, które udało się odnaleźć. Tutaj pojawia się pytanie – czym jest właściwie <code>data</code>? Z terminalu pamiętamy, że <code>find</code> zwracało coś, co wyglądało jak zwykła tablica. Spróbujmy więc na razie wykorzystać zwykły <code>console.log</code>, który powinien być w stanie pokazać jej zawartość.</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'employees'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> department<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Sprawdź, co otrzymasz teraz w konsoli.</p>
<p>Jak widzisz, nie jest to tablica... tylko Cursor.</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo4.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo4.png" alt="image" style="width: auto; max-width: 50%;"></a>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Czym jest Cursor?</h4>
<p>Kolekcje mogą być gigantyczne, a przesyłanie danych w formie ogromnych tablic byłoby niepraktyczne, zwłaszcza że często działamy tylko na ich części. Dlatego też zamiast całego zbioru, MongoDB zwraca nam coś w rodzaju wskaźnika do pierwszego elementu z grupy wszystkich pasujących. Co ważne, z tego pierwszego elementu łatwo możemy przejść do kolejnych. To daje możliwość iteracji jak w zwykłych tablicach i pozwala na wydajniejsze działanie na zbiorach.</p>
<p>Nie będziemy tu wchodzić w szczegóły. Jeśli interesuje Cię dokładne działanie Cursora, znajdziesz o nim wiele informacji w sieci. Wystarczy jednak, że zapamiętasz, iż <strong>to mechanizm, który ma pozwolić na wydajne pobieranie danych</strong>, przy czym w ostateczności <strong>pozwala nawet na zwykłe iterowanie, jak w każdej tablicy</strong>, mimo, że tak naprawdę sam <strong>nie jest tablicą</strong>.</p>
</div>
<p>Powiedzieliśmy, że <code>find</code> zwraca nam Cursor i możemy po nim iterować. Tylko jak? Nie użyjemy oczywiście żadnej z wbudowanych metod tyczących się tablic (jak np. <code>forEach</code>), bo w końcu Cursor != tablica. Możemy jednak użyć metody wbudowanej w sam Cursor. Jest nią <code>each</code>, a jej działanie przedstawia się analogicznie do tablicowych <code>forEach</code>.</p>
<p>Jak to wygląda w praktyce?</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'employees'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> department<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">.</span><span class="token method function property-access">each</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> employee</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Drugą opcją jest po prostu przekonwertowanie danych do tablicy za pomocą <code>toArray</code>.</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'employees'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> department<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Znacząco poprawia nam to czytelność. Pracując na zwykłej tablicy, możemy np. korzystać z wbudowanych metod, jak <code>forEach</code> czy <code>filter</code>. Niestety tracimy w ten sposób trochę z wydajności, którą zaoferowałby Cursor, bo od razu ładujemy cały zestaw danych. Jeśli jednak wiesz, że i tak będziesz potrzebować wszystkich informacji, spokojnie możesz pójść tą drogą.</p>
<p>W naszym przykładzie zastosuj dowolną opcję z podanych wyżej. Sprawdź, czy w konsoli rzeczywiście pojawią się poprawne dane.</p>
<p>Co do <code>findOne</code>, to używalibyśmy jej analogicznie do <code>find</code>, tylko że <code>data</code> byłoby od razu jednym znalezionym elementem (lub nullem, jeśli nic nie znajdziemy).</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'employees'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> department<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4>Dodawanie danych</h4>
<p>Tutaj także zapis będzie analogiczny do tego, który znasz już z konsoli Mongo Shell.</p>
<p>Na przykład taki kod dodałby do kolekcji <code>departments</code> nowy element <code>{ name: 'Management' }</code>:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Management'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Podobnie jak w przypadku wyszukiwania danych, możemy tutaj użyć jeszcze funkcji callback, która wykonywałaby się po zakończeniu próby dodania elementu.</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Management'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'err'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Teraz, gdyby pojawił się jakiś problem, zostaniemy poinformowani o nim w konsoli.</p>
<p>Spróbuj wkleić ten kod do naszego przykładu i uruchom serwer. Pojawia się jednak pytanie – nawet jeśli w konsoli nie wyświetli się żaden błąd, to czy mamy pewność, że wszystko poszło dobrze?</p>
<p>Najlepiej w takich sytuacjach sprawdzić po prostu, co aktualnie znajduje się w bazie danych i czy faktycznie pojawił się w niej np. nowy element w kolekcji <code>departments</code>. Możemy to zrobić w konsoli Mongo Shell (wiesz już, że nie jest to zbyt wygodne), albo w jakimś graficznym programie (np. we wspomnianym wcześniej MongoDB Compass, czy Robomongo). Z konsoli nie będziemy już raczej korzystać, bo taka praca jest mało wydajna. Warto za to zapoznać się z jakimś graficznym programem, który w roli "kontrolera" mógłby pokazywać nam, czy aplikacja faktycznie dobrze modyfikuje bazę danych. Z dwóch wspomnianych programów trochę większe możliwości ma Robo 3T (Robomongo), niemniej jednak nam wystarczy nawet prostsza alternatywa – już zainstalowany <strong>MongoDB Compass</strong>.</p>
<h3 id="292-mongodb-w-nodejs-mongodb-compass">MongoDB Compass</h3>
<p>Nazwa tego programu dość dobrze opisuje jego rolę. Ma on być tylko kompasem, który wskaże poprawność działania naszej aplikacji i pozwoli lepiej zrozumieć, gdzie mamy szukać ewentualnych błędów. Jego możliwości nie są bardzo zaawansowane, ale w pełni wystarczające – potrafi on bowiem łączyć się z serwerem MongoDB, pokazywać listę kolekcji, baz danych i ich zawartość, zarządzać nimi (dodawać, usuwać, edytować) oraz importować dane do kolekcji z plików zewnętrznych, jak np. JSON. Idealnie spełni się więc w swojej roli.</p>
<p>Uruchom teraz MongoDB Compass.</p>
<p>Na stronie startowej otworzy się formularz do połączenia z serwerem bazy danych.</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo5.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo5.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Nas interesuje przede wszystkim "Hostname" i "Port", gdzie możemy wskazać adres dostępu do serwera bazy danych. W naszej sytuacji wykorzystujemy domyślny <code>localhost:27017</code>, więc nie musimy nic wpisywać. Pozostałe opcje nie są dla nas teraz istotne, kliknij więc przycisk <strong>"Connect"</strong>.</p>
<p>Po chwili program powinien pokazać listę wszystkich lokalnych baz danych:</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo6.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo6.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Oczywiście już wiemy, że nasza jest tylko jedna – <code>companyDB</code>, a reszta to po prostu bazy wykorzystywane przez MongoDB.</p>
<p>Przy okazji, w tym miejscu możemy też bardzo łatwo dodać nową bazę danych. Wystarczy kliknąć w opcję "Create Database".</p>
<p>Z listy wybierz teraz <code>companyDB</code>.</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo7.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo7.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>MongoDB wskaże Ci listę kolekcji z wybranej bazy. Możemy usunąć dowolną z nich (ikonka kosza), dodać nową ("Create Collection"), albo sprawdzić jej zawartość. Zajrzyjmy do <code>departments</code>, bo chcemy się upewnić, czy nasza aplikacja dodała do tej kolekcji nowy element (<code>{ name: 'Management' }</code>).</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo8.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/Mongo8.png" alt="image" style="width: auto; max-width: 50%;"></a>
<p>Okazało się, że nasz kod w aplikacji faktycznie działa i możemy dodawać w ten sposób elementy do kolekcji.</p>
<p>Z poziomu tej zakładki możemy też usuwać dokumenty, modyfikować je, czy dodawać nowe. Operacje te są dość intuicyjne, nieczęsto jednak będziemy z nich korzystać. Głównie zależy nam, by wykorzystywać&nbsp;ten program właśnie do tego, co teraz – aby upewnić się, czy dana aplikacja serwera działa poprawnie i dobrze modyfikuje bazę danych.</p>
<h3 id="292-mongodb-w-nodejs-praktyczne-przyklady-cd">Praktyczne przykłady cd.</h3>
<p>Wróćmy do naszej aplikacji. Wykorzystaliśmy już w praktyce <code>find</code> i <code>insertOne</code>. Czas na kolejne przykłady.</p>
<h4>Modyfikacja elementów</h4>
<p>W przypadku modyfikacji danych sytuacja jest bardzo podobna jak przy ich dodawaniu. Możemy użyć prostej komendy (niczym w konsoli Mongo Shell), np.:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'employees'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> department<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> salary<span class="token operator">:</span> <span class="token number">6000</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Możemy też dołożyć funkcję callback, jako kolejny parametr, który pozwoli nam wychwycić ewentualny błąd, np.:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'employees'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> department<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> salary<span class="token operator">:</span> <span class="token number">6000</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4>Usuwanie elementów</h4>
<p>Usuwanie będzie również bardzo podobne. Na przykład:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Management'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Analogicznie do wcześniejszych przykładów, możemy też dołożyć – jako kolejny parametr – funkcję callback:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'Management'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="292-mongodb-w-nodejs-rozwijamy-aplikacje">Rozwijamy aplikację</h3>
<p>Wiemy już mniej więcej jak wygląda współpraca MongoDB z serwerem Node.js. Omówiliśmy kilka przykładów, udało nam się połączyć z bazą na serwerze, wykonaliśmy nawet małą zmianę w kolekcji <code>employees</code>. Nasz cel jest jednak inny – chcemy zmodyfikować wszystkie endpointy, które oferuje serwer, tak aby zamiast zwykłej tablicy, korzystały z naszej bazy danych <code>companyDB</code>.</p>
<p>Wydaje się, że zadanie jest stosunkowo proste, musimy tylko lekko zmodyfikować każdy z endpointów. Na starcie pojawia się jednak pewien problem. Nasza stała <code>db</code> z dostępem do bazy danych jest dostępna tylko w pliku <code>server.js</code>, a same endpointy są przecież wydzielone do zewnętrznych plików. Jak możemy to obejść?</p>
<p>Identyczny problem pojawił się już przy module z WebSocketami i obiekcie <code>io</code>. Wtedy też inicjowaliśmy go w <code>server.js</code>, a chcieliśmy go potem wykorzystywać w zewnętrznych plikach z endpointami. Pamiętasz, jak wtedy to rozwiązaliśmy?</p>
<p>Wyglądało to następująco:</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">io</span> <span class="token operator">=</span> io<span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>W pliku <code>server.js</code> dodaliśmy przed wszystkimi endpointami nowy middleware i "przypięliśmy" obiekt <code>io</code> do <code>req</code>. Dzięki temu był on potem dostępny w każdym endpoincie, nawet w tych umieszczonych w zewnętrznych plikach, wystarczyło bowiem odwołać się do <code>req.io</code>.</p>
<p>Dokładnie to samo zrobimy z naszą bazą danych – referencję do obiektu <code>db</code> przypniemy do <code>req</code>. Teraz każdy endpoint będzie mógł łatwo odwołać się do bazy danych poprzez <code>req.db</code>, nawet jeśli będzie znajdował się w innym pliku niż <code>server.js</code>.</p>
<p>Dodaj więc następujący kod przed middleware ładującym zewnętrzne endpointy:</p>
<pre class=" language-js"><code class=" language-js">app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span> <span class="token operator">=</span> db<span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Od tej chwili będziemy mieli dostęp do obiektu <code>db</code> w każdym endpoincie.</p>
<p>Na końcu usuń jeszcze kod, wyszukujący dane w <code>employees</code> i dodający nowy obiekt do <code>departments</code>. Był to w końcu tylko kod testowy, na którym uczyliśmy się podstaw działania MongoDB w Node.js.</p>
<p>Od tej chwili funkcja callback w <code>connect</code> powinna wyglądać tak:</p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> client</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Successfully connected to the database'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> db <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token method function property-access">db</span><span class="token punctuation">(</span><span class="token string">'companyDB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      req<span class="token punctuation">.</span><span class="token property-access">db</span> <span class="token operator">=</span> db<span class="token punctuation">;</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> employeesRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> departmentsRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> productsRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found...'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Server is running on port: 8000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4>Modyfikujemy pierwszy endpoint</h4>
<p>Czas w końcu na poważnie zmodyfikować aplikację. Już chwilę pracujemy nad naszym serwerem API, a tak naprawdę on wciąż działa na zwykłej tablicy. Czas to zmienić.</p>
<p>Zacznijmy od endpointów w <code>departments.routes.js</code>, a konkretnie od pierwszego z nich:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token property-access">departments</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Jak na razie zwraca on po prostu zawartość tablicy <code>departments</code> z obiektu <code>db</code>, który jest bazą danych tylko z nazwy. Jeśli zajrzysz do pliku, z którego go importujemy, przekonasz się, że to zwykły obiekt z kilkoma właściwościami. Musimy tak zmodyfikować ten endpoint, żeby zamiast danych z <code>db.departments</code> zwracał wszystkie dokumenty z kolekcji <code>departments</code> naszej bazy danych.</p>
<p>Zakładając, że w pliku <code>departments.routes.js</code> każdy endpoint ma dostęp do bazy poprzez <code>req.db</code>, modyfikacja powinna być stosunkowo łatwa do wykonania:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Początek jest prosty. Odwołujemy się do naszej bazy danych (przez <code>req.body</code>), następnie wyszukujemy bezwarunkowo wszystkie dokumenty z kolekcji <code>departments</code>, a na końcu konwertujemy wynik do tablicy. Dlaczego? Ponieważ efekt ma być taki sam jak wcześniej – wciąż chcemy, żeby ten endpoint zwracał tablicę danych (a nie Cursor). Po prostu powinien pobierać ją teraz z bazy danych.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Powyższy kod sprawdza, czy nie ma czasem jakiegoś błędu – jeśli tak, to zwracamy go wraz z kodem statusu informującym o problemie (500). Gdy wszystko jest w porządku, zwracamy po prostu znalezione dane.</p>
<p>Jeśli wszystko poszło dobrze, to endpoint <code>/api/departments</code> pod metodą <code>GET</code> wciąż powinien zwracać tablicę z dobrymi danymi, tylko że teraz są one już pobierane z bazy danych.</p>
<h4>Kolejne endpointy</h4>
<p>Kolejny endpoint w kolejce to taki, który ma zwracać losowy element z kolekcji. Jeszcze nie mówiliśmy, jak możemy wprowadzić to w MongoDB, więc zostawimy go sobie na koniec. Teraz zajmiemy się tymi teoretycznie prostszymi.</p>
<h5>GET /departments/:id</h5>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token property-access">departments</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">==</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>możemy przerobić na:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token function"><span class="token maybe-class-name">ObjectId</span></span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Tym razem <code>.toArray</code> nie jest nam potrzebne, <code>findOne</code> zwróci bowiem od razu tylko jeden obiekt (dokument) lub <code>null</code>.</p>
<p><code>else if(!data)</code> sprawdza, czy w ogóle coś znaleziono. Jeśli żaden dokument nie będzie pasować do warunku, MongoDB nie zwróci błędu, tylko <code>null</code>. Wysłanie w takiej sytuacji komunikatu <code>Not found</code> będzie bardziej eleganckim rozwiązaniem.</p>
<p>Dlaczego korzystamy z <code>_id</code>, a nie <code>id</code>? Przypomnij sobie. Gdy wprowadzaliśmy nasze dane do <code>companyDB</code>, żaden z elementów nie otrzymywał identyfikatora, bowiem MongoDB sam dodaje do każdego dokumentu losowe id (właśnie pod atrybutem <code>_id</code>).</p>
<p>Jednak czym jest <code>ObjectId</code> i do czego służy? Nadawane przez MongoDB <code>_id</code> nie jest stringiem, jednak <code>req.params.id</code> już tak. Pojawia się więc problem, bo nawet jeśli ciąg znaków w jednym i drugim będzie identyczny, to dla MongoDB pozostaną&nbsp;różne i dokument nie zostanie zwrócony. Pamiętasz, jak mówiliśmy, że <code>===</code> sprawdza typ i wartość, więc np. <code>5 === '5'</code> daje nam <code>false</code>? Tak samo możemy tłumaczyć sobie tę sytuację. Wartość może wydawać się taka sama, ale jednak typ jest inny. Należy więc skonwertować <code>req.params.id</code> do typu ObjectId właśnie za pomocą funkcji <code>ObjectId</code>. Aby jej użyć, musimy ją jeszcze zaimportować. Dodaj więc na górze pliku:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">ObjectId</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">ObjectId</span></span><span class="token punctuation">;</span></code></pre>
<p>Powyższy kod po prostu zaimportuje tę metodę z naszej pobranej już wcześniej biblioteki <code>mongodb</code>.</p>
<h5>POST /departments</h5>
<p>Przyszedł czas na Ciebie. Wzorując się na dwóch poprawionych endpointach, postaraj się modyfikować kolejne już bez naszej pomocy. Jeśli nie czujesz się jeszcze na siłach, pod każdym przykładem możesz zajrzeć do gotowego kodu.</p>
<p>W przypadku problemów z naszym wyzwaniem nie przejmuj się. To jeszcze nie jest moment, w którym "musisz" dać sobie radę z takim zadaniem. Niemniej warto spróbować swoich sił.</p>
<p>Zacznijmy od <code>POST</code> <code>/departments</code>.</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/departments'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  db<span class="token punctuation">.</span><span class="token property-access">departments</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Powyższy kod możemy przerobić na:</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-jq1N5Q7wS-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż odpowiedź</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-jq1N5Q7wS-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj odpowiedź</a>
  </span>
</p>
<div id="collapse-jq1N5Q7wS-toggle" class="collapse">
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/departments'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<p>Aby sprawdzić, czy endpoint na pewno działa poprawnie, po zasymulowania requestu w Postmanie, możesz skorzystać z Compassu i przejrzeć zmienianą kolekcję.</p>
<h5>PUT /departments/:id</h5>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  db <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token property-access">departments</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">==</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token spread operator">...</span>item<span class="token punctuation">,</span> name <span class="token punctuation">}</span> <span class="token operator">:</span> item <span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Ten fragment mógłby wyglądać tak:</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-L1K2FJjv6n-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż odpowiedź</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-L1K2FJjv6n-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj odpowiedź</a>
  </span>
</p>
<div id="collapse-L1K2FJjv6n-toggle" class="collapse">
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token function"><span class="token maybe-class-name">ObjectId</span></span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Powyższy kod jest wystarczający. Moglibyśmy jeszcze przed aktualizacją sprawdzić za pomocą <code>find</code> czy element w ogóle istnieje i w razie problemu po prostu zwrócić komunikat <code>Not found</code>. Nie jest to jednak wymagane. W końcu mamy tylko zmodyfikować nasz serwer API, a nie zmieniać jego funkcjonalności.</p>
</div>
<h5>DELETE /departments/:id</h5>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  db <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token property-access">departments</span><span class="token punctuation">.</span><span class="token method function property-access">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token arrow operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">!=</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Możemy przerobić to na:</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-3iAfs9KXJb-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż odpowiedź</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-3iAfs9KXJb-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj odpowiedź</a>
  </span>
</p>
<div id="collapse-3iAfs9KXJb-toggle" class="collapse">
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token function"><span class="token maybe-class-name">ObjectId</span></span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<h4>Losowanie dokumentu</h4>
<p>Pozostaje nam endpoint, który wcześniej ominęliśmy, czyli:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments/random'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span><span class="token property-access">departments</span><span class="token punctuation">[</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">floor</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> db<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Powinien on losować jeden dokument z kolekcji <code>departments</code>. Nie jest to wielkie wyzwanie, ale jeszcze nie wspominaliśmy jak tego dokonać.</p>
<p>Otóż możemy tutaj wykorzystać funkcję <code>aggregate</code> wraz z opcją <code>$sample</code>.</p>
<p>Używa się jej następująco:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>collection<span class="token operator">-</span>name<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span> $sample<span class="token operator">:</span> <span class="token punctuation">{</span> size<span class="token operator">:</span> <span class="token operator">&lt;</span>documents<span class="token operator">-</span>amount<span class="token operator">&gt;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span></code></pre>
<p>Zobaczmy taki przykład:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'employees'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">{</span> $sample<span class="token operator">:</span> <span class="token punctuation">{</span> size<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Ten kod zwróci nam trzy losowe dokumenty z kolekcji <code>employees</code>.</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Uwaga!</h4>
<p><code>aggregate</code> służy generalnie do pobierania "próbek" całych kolekcji. Można wybrać ich rozmiar, sposób grupowania itd. Dużą zaletą jest też to, że próbki są randomowe. Tym samym ustawiając jednoelementową próbę <code>$sample</code>, otrzymamy pojedynczy losowy element.</p>
<p>Jeśli chcesz wiedzieć o niej więcej, zajrzyj do <a href="https://docs.mongodb.com/manual/aggregation/" target="_blank">dokumentacji</a>.</p>
</div>
<p>Dobrze, ale jak będzie wyglądał w takim razie nasz endpoint po zmianach?</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments/random'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">{</span> $sample<span class="token operator">:</span> <span class="token punctuation">{</span> size<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Po co nam <code>toArray</code>? <code>aggregate</code> nawet przy pobieraniu jednego elementu zwraca zbiór danych. To nic nowego – podobny mechanizm znamy np. z podstaw JSa i <code>querySelectorAll</code>, który zawsze zwracał NodeList, nawet jeśli tylko jeden element pasował do selektora. Teraz mamy dokładnie taką samą ideę – <code>aggregate</code> może zwrócić zbiór jedno, dwu, lub stuelementowy, ale zawsze będzie to zbiór danych, a nie pojedynczy dokument.</p>
<h4>Usuwamy zbędny import</h4>
<p>Gotowe! Wystarczy teraz usunąć zbędny import <code>db</code>, bo już nie korzystamy z tego obiektu.</p>
<p>Kod naszego pliku <code>departments.routes.js</code> powinien wyglądać mniej więcej tak:</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-Lype1byAhg-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż efekt</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-Lype1byAhg-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj efekt</a>
  </span>
</p>
<div id="collapse-Lype1byAhg-toggle" class="collapse">
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">ObjectId</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongodb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">ObjectId</span></span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments/random'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">{</span> $sample<span class="token operator">:</span> <span class="token punctuation">{</span> size<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token function"><span class="token maybe-class-name">ObjectId</span></span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/departments'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token function"><span class="token maybe-class-name">ObjectId</span></span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token function"><span class="token maybe-class-name">ObjectId</span></span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre>
</div>
<h3 id="292-mongodb-w-nodejs-testujemy-endpointy">Testujemy endpointy</h3>
<p>Na etapie modyfikacji endpointów nie wymagaliśmy od Ciebie ich testowania. Kod, który Ci na końcu zaprezentowaliśmy, powinien być poprawny. Często jednak będziesz go pisać bez naszej pomocy, a wtedy warto sprawdzić, czy wszystko działa. W module o Expressie do testowania endpointów używaliśmy Postmana, wciąż będziemy z niego korzystać, tylko że teraz dodatkowo możemy sprawdzać na bieżąco efekty zmian, które wprowadza serwer. Jest to możliwe dzięki podglądowi bazy danych w MongoDB Compass. Możesz z niego korzystać, aby upewnić się, czy dane na pewno dobrze się modyfikują.</p>
<p>Jeśli boisz się, że "popsujesz" jakieś dane, to proponujemy Ci testować endpointy na dokumencie <code>{ name: 'Management' }</code>. Możemy zdradzić już teraz, że nie będzie on istotny w kolejnych modułach. Nic nie stoi na przeszkodzie, by go nawet usunąć z kolekcji.</p>
<h3 id="292-mongodb-w-nodejs-podsumowanie">Podsumowanie</h3>
<p>Korzystanie z biblioteki <code>mongodb</code> na serwerze może zostawiać po sobie słodko-gorzki posmak. Z jednej strony samo utworzenie połączenia jest bardzo proste, a z metod korzysta się identycznie jak w terminalu, co jest dość wygodne. Z drugiej strony można odnieść wrażenie, że co chwila pojawia się jakieś "ale". Połączenie z bazą jest proste, ale... musisz przenieść inicjację serwera do funkcji callback metody <code>connect</code>. Dostęp do bazy jest w obiekcie <code>db</code>, ale... żeby mieć do niego wgląd w zewnętrznych plikach, trzeba dodać middleware. Możemy wyszukiwać dokumenty po automatycznie nadawanym <code>_id</code>, ale... musimy konwertować przyrównywaną wartość do typu ObjectId, co wymaga od nas importu specjalnej metody z paczki.</p>
<p>To prawda, pakiet <code>mongodb</code> jest stosunkowo surowy. Jego zadanie polega przede wszystkim na oferowaniu dostępu do bazy danych, a nie funkcji "pomocniczych", które będą dbały o nasz komfort pracy. Warto wiedzieć, że na rynku istnieją gotowe paczki, które są o wiele wygodniejsze w działaniu, a również pozwalają na pracę z MongoDB. Jedną z nich jest wcześniej wspomniana biblioteka <strong>Mongoose</strong>, którą poznamy w kolejnej części.</p>

                        </div>
                    </div>
                                        <div class="card-block task-card">
                        <h3 id="292-mongodb-w-nodejs-zadanie-endpointy">Zadanie: <span class="task-title">endpointy</span></h3>
                        <div class="task-content">
                            <p>Twoim zadaniem jest dokończenie modyfikacji naszej aplikacji. Do zmiany pozostają dwa pliki <code>employees.routes.js</code> i <code>products.routes.js</code>. Przebuduj je analogicznie do <code>departments.routes.js</code>.</p>
<p>Po zakończeniu pracy usuń zbędny plik <code>db.js</code> z głównego katalogu. Następnie stwórz repozytorium zdalne na GitHub, wyślij do niego swoje pliki, a link podaj Mentorowi.</p>

                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <div class="clearfix">
                                                                                <a href="https://kodilla.com/pl/bootcamp-task/407/666335" target="_blank" class="btn btn-info-outline">Podgląd zadania</a>
                            <form target="_blank" class="form-inline project-link-form">
                                <div class="form-group">
                                    <input type="text" name="link" class="form-control" value="https://github.com/skwiryt/companyApp">
                                </div>
                                <button type="submit" class="btn  btn-primary ">Wyślij link <i class="fa fa-check"></i></button>
                            </form>
                                                                                                    </div>
                    </div>
                </section>
                                    
                <section id="submodule-1156" class="card submodule completed" data-bootcamp-user-submodule-id="666336">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">29.3. <span>Mongoose – pierwsze starcie</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Poprzedni submoduł uświadomił Ci, że prostota paczki <code>mongodb</code> wymaga od nas dodatkowej pracy. W tym momencie z pomocą przyjdzie nam <strong>Mongoose</strong>, czyli biblioteka, która <strong>opakowuje możliwości</strong> <code>mongodb</code> <strong>w bardziej przyjazny interfejs</strong>.</p>
<p>Dzięki tej paczce <strong>nasz kod będzie znacznie krótszy i czytelniejszy, a dane lepiej zorganizowane</strong>. Po kilku projektach, zwłaszcza bardziej skomplikowanych, na pewno to docenisz.</p>
<p>Skoro to wszystko brzmi tak pięknie, dlaczego od razu nie skorzystaliśmy z tej paczki? Otóż ważne jest, by poznać i zrozumieć&nbsp;działanie MongoDB, oraz sposób komunikacji z bazą, zanim przejdziemy dalej i zaczniemy używać&nbsp;innych narzędzi.</p>
<p>Mongoose ułatwia wykonywanie podstawowych operacji, ale też dodaje funkcjonalność, której w samym MongoDB brakuje, a więc <strong>modelowanie danych</strong>. W skrócie polega to na tym, że każda kolekcja będzie musiała mieć z góry ustalony schemat dokumentów – jakie właściwości powinny mieć dane w konkretnej kolekcji oraz jakie są ich typy. Narzuca to na MongoDB pewne ograniczenia (celowo) i wymusza walidację poprawności danych. Tym samym sposób komunikacji z bazą będzie znacząco różnił się od tego, co już znamy. Dlatego też rozpoczęcie pracy z aplikacjami Node.js + MongoDB od razu z Mongoose, mogłoby okazać się rzuceniem Cię na zbyt głęboką wodę. Często towarzyszyłoby Ci bowiem wrażenie, że "przecież to kompletnie coś innego niż w terminalu". Teraz jednak, gdy wiesz już, jak działa najprostsze komunikowanie się z bazą z poziomu Node.js, wejście w Mongoose powinno być trochę łatwiejsze i na pewno docenisz komfort pracy, który nam zapewni.</p>
<p>Kod zmieni się, ale "pod maską" Mongoose nadal będzie wykorzystywać dokładnie te same proste komendy, które znamy już z poprzedniego submodułu.</p>
<p>Wciąż będziemy pracować na naszym serwerze API. Wcześniej zajmowaliśmy się modyfikacją endpointów, by używały bazy danych zamiast zwykłej tablicy. Teraz wprowadzimy kolejne zmiany i zaczniemy korzystanie z dobrodziejstw Mongoose. Pozwoli to na zwiększenie czytelności aplikacji, ale też dodanie modelowania danych, co naprawdę jest bardzo przydatną funkcjonalnością (powiemy o tym więcej za chwilę).</p>
<h3 id="293-mongoose-pierwsze-starcie-instalacja-mongoose">Instalacja Mongoose</h3>
<p>Dość gadania, czas na praktykę. Mamy dużo to omówienia :)</p>
<p>Zacznijmy od pobrania paczki:</p>
<pre class=" language-markup"><code class=" language-markup">yarn add mongoose@5.7.1</code></pre>
<h3 id="293-mongoose-pierwsze-starcie-modyfikacja-serverjs">Modyfikacja server.js</h3>
<p>Czas na modyfikację <code>server.js</code>. Zacznij od importu:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Następnie usuń odwołanie do <code>mongodb</code>, bo choć&nbsp;jest potrzebny, Mongoose importuje go "pod maską" i nie musimy tego robić jeszcze raz. Podobnie działał Express – wykorzystywał wbudowany w Node.js moduł <code>http</code>, ale importował go sam.</p>
<p>Czas na modyfikację połączenia z bazą danych. Tutaj zmieni się najwięcej. Pamiętasz, jak narzekaliśmy na to, że inicjacja serwera musiała być umieszczana w funkcji callback połączenia? W Mongoose nie ma takiej potrzeby i wygląda to o wiele prościej:</p>
<pre class=" language-js"><code class=" language-js"><span class="token comment">// connects our backend code with the database</span>
mongoose<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/companyDB'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token property-access">connection</span><span class="token punctuation">;</span></code></pre>
<p>Wyjaśnijmy, co się tu dzieje.</p>
<pre class=" language-js"><code class=" language-js">mongoose<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/companyDB'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> useUnifiedTopology<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Pierwsza linijka otwiera połączenie z serwerem bazy danych (<code>mongodb://localhost:27017/</code>) i przypisuje go do obiektu <code>mongoose.connection</code>, który jest od razu dostępny wszędzie, a nie tylko w funkcji callback, jak to miało miejsce w paczce <code>mongodb</code>. Zresztą, tutaj funkcji <code>callback</code> nie ma w ogóle, co sprawia, że nasz kod jest jeszcze bardziej czytelny. Dodatkowo zauważ, że tym razem nie łączymy się z serwerem bazy danych, aby dopiero potem wybrać konkretną bazę. Zamiast tego, wybór bazy możemy określić od razu w adresie (<code>mongodb://localhost:27017/companyDB</code>). Wygodne prawda?</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token property-access">connection</span><span class="token punctuation">;</span></code></pre>
<p>Druga linijka to już nic specjalnego. Skracamy sobie dostęp do naszej bazy danych, przypisując referencję do stałej <code>db</code>.</p>
<p>No dobrze, ale teraz skąd mamy wiedzieć, czy połączenie się udało? W callbacku <code>connect</code> w paczce <code>mongodb</code> mieliśmy dostęp do ewentualnego błędu i łatwo mogliśmy ustalić, czy po drodze na pewno wszystko poszło, jak trzeba. W Mongoose będzie to wyglądało inaczej, choć prawdopodobnie nawet lepiej.</p>
<p>Mongoose wykorzystuje w swojej pracy technikę emitowania zdarzeń (eventów), pozwala również na dodawanie nasłuchiwaczy do obiektu połączenia (<code>mongoose.connection</code>). Idea eventów, emiterów i nasłuchiwaczy nie jest Ci obca. Poniższy kod powinien być więc zrozumiały, nawet bez dłuższego komentarza z naszej strony.</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">once</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Connected to the database'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Error '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Co robimy w tym miejscu?</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">once</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Connected to the database'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Ustawiamy nasłuchiwacz na nasze połączenie i mówimy, że kiedy JS wykryje zdarzenie <code>open</code>, to w konsoli powinien wypisać komunikat <code>Connected to the database</code>. Zdarzenie jest emitowane w przypadku sukcesu połączenia, mamy więc pewność, że kiedy nasłuchiwacz je wykryje, to na pewno wszystko się udało. Dziwna może być tylko nazwa metody, której użyliśmy do przypięcia nasłuchiwacza, a mianowicie <code>once</code>. W nasłuchiwaczu niżej widzimy przecież metodę <code>on</code> i taka nazwa zastosowana przez twórców wydaje się bardziej sensowna. <code>once</code>, jak sama nazwa wskazuje, ma nam po prostu sugerować, że to wyjątkowy nasłuchiwacz, taki, który dane zdarzenie otrzyma tylko raz i potem nie ma już sensu na niego oczekiwać. Oczywiście użycie <code>on</code> (w Mongoose to już normalny nasłuchiwacz) również by zadziałało, ale zwyczajnie nie ma sensu nasłuchiwać ciągle na zdarzenie, które na pewno wykona się co najwyżej raz.</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Error '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Drugi nasłuchiwacz jest już znacznie prostszy w odbiorze. Gdy Mongoose natrafi na błąd, to emituje zdarzenie <code>error</code> i wysyła z nim także komunikat o błędzie. Gdy wykryjemy takie zdarzenie, po prostu pokażemy błąd w konsoli. Tym razem użyliśmy <code>on</code>, a nie <code>once</code>, bo <code>error</code> może emitować się wiele razy, nie tylko przy połączeniu, ale zawsze, gdy coś pójdzie nie tak.</p>
<p>Jak powinien wyglądać nasz <code>server.js</code> po zmianach?</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cors'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> employeesRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/employees.routes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> departmentsRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/departments.routes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> productsRoutes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes/products.routes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> employeesRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> departmentsRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> productsRoutes<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found...'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// connects our backend code with the database</span>
mongoose<span class="token punctuation">.</span><span class="token method function property-access">connect</span><span class="token punctuation">(</span><span class="token string">'mongodb://localhost:27017/companyDB'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> useNewUrlParser<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token property-access">connection</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span><span class="token method function property-access">once</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Connected to the database'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Error '</span> <span class="token operator">+</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token string">'8000'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Server is running on port: 8000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Trochę czytelniej, prawda?</p>
<p>Przy okazji, zapewne udało Ci się zauważyć, że zniknął również nasz middleware z poprzedniego submodułu. Już nam się nie przyda, bo Mongoose będzie dostępna w plikach zewnętrznych w inny, przystępniejszy sposób.</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Inaczej, znaczy lepiej</h4>
<p>Kod pisany w Mongoose odchodzi trochę od tego, co pamiętamy z bezpośredniej modyfikacji bazy danych za pomocą terminala.</p>
<p>Paczka <code>mongodb</code> była w tym względzie bardziej konserwatywna, bo np. jeśli w terminalu najpierw łączymy się z serwerem bazy danych (włączając Mongo Shell), a dopiero potem wybieramy konkretną bazę – tak samo robimy to w <code>mongodb</code>.</p>
<p>Mongoose nie ma problemu z innym podejściem, o ile zwiększy się nasz komfort pracy. Ma to odzwierciedlenie w połączeniu z bazą danych (gdzie od razu wybieramy konkretną), ale jeszcze bardziej widoczne stanie się to później, przy modyfikacjach kolekcji.</p>
<p>Taki jest zamysł Mongoose – ma ona maksymalnie ułatwiać pracę z MongoDB, często proponując nawet kompletnie inną składnię.</p>
</div>
<h3 id="293-mongoose-pierwsze-starcie-modelowanie-danych">Modelowanie danych</h3>
<p>Przebudowaliśmy już <code>server.js</code>, więc czas na modyfikację plików z endpointami. Zanim jednak to zrobimy, opowiedzmy trochę o modelowaniu danych, bowiem w Mongoose <strong>każda kolekcja musi posiadać własny model z opisanym schematem struktury danych</strong>. Bez modelu, a więc i bez schematu, nie możemy nic z nimi zrobić.</p>
<p>Po co w ogóle to "modelowanie"?</p>
<p>MongoDB domyślnie nie blokuje nas żadnymi ograniczeniami podczas dodawania danych, zatem do jednej kolekcji możemy wrzucać różne dane, nawet kompletnie inne.</p>
<p>Na przykład, gdybyśmy w ramach testu wykonali następujące instrukcje w terminalu Mongo Shell:</p>
<pre class=" language-js"><code class=" language-js">db<span class="token punctuation">.</span><span class="token property-access">departments</span><span class="token punctuation">.</span><span class="token method function property-access">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> depart<span class="token operator">:</span> <span class="token string">'abc'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token property-access">departments</span><span class="token punctuation">.</span><span class="token method function property-access">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> rating<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> employeees<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>to nie napotkalibyśmy ze strony MongoDB żadnego oporu. Nasza kolekcja wyglądałby teraz tak:</p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token string">'423534346546457fs4tt5'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token string">'423534rw3246457fs4tt5'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Marketing'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token string">'434534346546457fs4tt5'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Testing'</span> <span class="token punctuation">}</span>
  <span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token string">'143534346546457fs4tt5'</span><span class="token punctuation">,</span> depart<span class="token operator">:</span> <span class="token string">'abc'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token string">'4332fdgd4335457fs4tt5'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> rating<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> employees<span class="token operator">:</span> <span class="token number">5</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p>Spójrz tylko. Niektóre dokumenty zawierają jeden atrybut poza <code>_id</code>, a inne dwa, czasami mają <code>name</code>, a czasami nie, ponadto raz <code>name</code> jest tekstem, a innym razem liczbą. Nie ma tu żadnej spójności danych.</p>
<p>Z jednej strony możemy zrozumieć twórców MongoDB. Kolekcje miały jak najbardziej przypominać zwykłe tablice w JS-ie, a te przecież nie ograniczają nas w dodawaniu informacji. Niemniej jednak w przypadku baz danych, wolelibyśmy, aby każdy dokument miał taki sam schemat.</p>
<p>Gdyby np. nasza kolekcja <code>departments</code> miała być pokazywana w aplikacji klienta jako zwykła lista z nazwami, to pragnęlibyśmy założyć z góry, że konkretny atrybut (np. <code>name</code>), da nam zawsze właśnie nazwę. Nie chcielibyśmy, żeby ta informacja raz była dostępna pod atrybutem <code>name</code>, a innym razem np. pod <code>depart</code>. Pisanie kodu obsługującego takie dane byłoby przecież straszną katorgą.</p>
<p>Jednak czy to naprawdę&nbsp;konieczne? Możesz powiedzieć, że rozumiesz problem, ale nie widzisz potrzeby stosowania modeli, bo przecież sami możemy się pilnować, aby dodawać poprawne dane. Robiliśmy tak dotychczas i nawet nieźle nam to wychodziło.</p>
<p>To prawda, moglibyśmy, ale przyznaj, że byłoby lepiej, gdyby jednak ktoś pilnował nas z boku. Przecież zawsze istnieje możliwość przypadkowej pomyłki – możemy zrobić literówkę w <code>name</code> albo nasza aplikacja źle obsłuży jakiś formularz i zamiast wartości tekstowej zapisze w bazie <code>undefined</code>. Takie sytuacje mogą się zdarzyć, a MongoDB przyjąłby wadliwe dane.</p>
<p>Potrzebę istnienia modeli w bazie danych możemy tłumaczyć tak samo jak przydatność <code>propTypes</code> w komponentach reactowych. Niby nie musimy z nich korzystać, ale jednak warto je mieć, bo nawet jeśli coś pomylimy, szybko się o tym dowiemy.</p>
<p>Wymuszanie modelowania przez Mongoose powinniśmy więc odczytywać tylko jako plus.</p>
<h3 id="293-mongoose-pierwsze-starcie-pierwszy-schemat-danych">Pierwszy schemat danych</h3>
<p>Zanim przejdziemy do modyfikacji samych endpointów, musimy przygotować modele. Zaczniemy od tego dla kolekcji <code>departments</code>.</p>
<p>Załóż folder <code>models</code>, a następnie stwórz w nim <code>department.model.js</code>. Co prawda, wcale nie musimy umieszczać modeli w osobnych plikach i indywidualnym katalogu, ale jest to dobra praktyka, która pozwoli nam utrzymać porządek.</p>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Prosta analogia</h4>
<p>Aby uświadomić Ci, jak prosta jest idea modeli w Mongoose, wrócimy na chwilę do czystego JS-a. Wcześniej mówiliśmy, że kolekcje w MongoDB nie sprawdzają spójności danych, bo nie robią tego też zwykłe tablice w JS-ie, a na nich się wzorowano. Być może pamiętasz jednak, że czasami udawało nam się taką spójność osiągać – dokonywaliśmy tego za pomocą klas.</p>
<p>Na przykład w poniższym kodzie łatwo moglibyśmy wprowadzić do tablicy niespójne dane:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> persons <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

persons<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> firstName<span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> lastName<span class="token operator">:</span> <span class="token string">'Doe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
persons<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> firstNam<span class="token operator">:</span> <span class="token string">'Amanda'</span><span class="token punctuation">,</span> lastName<span class="token operator">:</span> <span class="token string">'Doe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Spójrz tylko. Zrobiliśmy małą literówkę przy pushowaniu drugiego obiektu. Czy to spowoduje jakiś błąd? Nie, do tablicy zostanie wprowadzony wadliwy obiekt.</p>
<p>Wystarczy jednak użyć klasy:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">firstName<span class="token punctuation">,</span> lastName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">firstName</span> <span class="token operator">=</span> firstName<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">lastName</span> <span class="token operator">=</span> lastName<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> persons <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
persons<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token string">'Doe'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
persons<span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Amanda'</span><span class="token punctuation">,</span> <span class="token string">'Doe'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Od teraz istnieje gwarancja, że oba obiekty będą miały dokładnie te same atrybuty. Oczywiście wciąż możemy się pomylić w samej informacji (wartości) i zrobić np. literówkę, ale obiekty będą spójne pod względem struktury.</p>
<p>Dokładnie taką ideę wykorzystuje w funkcjonalności modelowania również Mongoose. Wprowadza jednak nieco bardziej zaawansowany zamysł schematów struktury danych. Będziemy w nim bowiem mogli, a nawet musieli, ustalać nie tylko ilość i nazwę atrybutów, ale też ich typ. Wszystko to sprowadza się do jednego – pilnowania poprawności wprowadzanych danych.</p>
</div>
<p>Bierzmy się do pracy. Wejdź do pliku <code>department.model.js</code> i zacznij od importu <code>mongoose</code>:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Co dalej? Czas na ustalenie schematu struktury danych. Do tego potrzebna będzie nam specjalna klasa <code>Schema</code>, którą dostarcza Mongoose. Na razie nie mówimy jeszcze o tworzeniu modelu, a przygotowujemy schemat struktury danych, który potem będziemy mogli wykorzystać w modelu dowolnej kolekcji. Składnia wygląda następująco:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  attr<span class="token operator">:</span> type<span class="token punctuation">,</span>
  attr<span class="token operator">:</span> type<span class="token punctuation">,</span>
  attr<span class="token operator">:</span> type<span class="token punctuation">,</span>
  attr<span class="token operator">:</span> type
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Jeśli chcemy, aby dane atrybuty były wymagane w dokumencie, możemy to osiągnąć tak:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  attr<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> required <span class="token punctuation">}</span><span class="token punctuation">,</span>
  attr<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> required <span class="token punctuation">}</span><span class="token punctuation">,</span>
  attr<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> required <span class="token punctuation">}</span><span class="token punctuation">,</span>
  attr<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> required <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Zatem w naszej kolekcji <code>departments</code> odpowiedni mógłby być następujący zapis:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> departmentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  _id<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> mongoose<span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Types</span></span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">ObjectId</span></span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>W powyższym schemacie ustalamy, że dane powinny mieć dwa atrybuty. Oba są obowiązkowe (dba o to <code>required: true</code>). Pierwszy będzie nazywać się <code>_id</code>, a jego oczekiwany typ to ObjectId, drugi to <code>name</code> i ma mieć wartość tekstową. Całość może Ci przypominać obiekt konfiguracyjny <code>propTypes</code> z komponentów reactowych i faktycznie – idea jest podobna.</p>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center"><code>_id</code> w schemacie</h4>
<p>Jedynym atrybutem, którego nie musimy tak naprawdę sprawdzać jest <code>_id</code>. Wiemy, że jego wartość jest nadawana automatycznie przez MongoDB, a zatem powinna zawsze być poprawna. Dlatego też możemy go w ogóle pominąć w schemacie:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> departmentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Wyjątkiem są sytuacje, w których z jakiegoś powodu, decydujemy się sami nadawać wartość <code>_id</code>. Wtedy warto sprawdzić, czy nasz kod zawsze wykonuje to poprawnie. My nie będziemy jednak tego robić w niniejszym module i zawsze oprzemy się na domyślnych zachowaniu MongoDB.</p>
</div>
<p>Oczywiście to na razie tylko schemat struktury danych i żeby Mongoose z niego korzystał, będziemy musieli go o tym powiadomić. Użyjemy do tego metody <code>mongoose.model</code>, która ustali, by dla konkretnej kolekcji używany był model danych z konkretnym schematem.</p>
<p>Zajmiemy się tym za chwilę, a teraz pomówmy jeszcze o samych typach.</p>
<p>Mongoose oferuje domyślnie wsparcie następujących typów:</p>
<ul>
<li>String</li>
<li>Number</li>
<li>Date</li>
<li>Buffer</li>
<li>Boolean</li>
<li>Mixed</li>
<li>ObjectId</li>
<li>Array</li>
<li>Decimal128</li>
<li>Map</li>
</ul>
<p>Mówiąc wsparcie, mamy na myśli to, że możemy wpisywać te typy w schemacie danych Mongoose, ale też to, że paczka będzie w stanie poprawnie zwalidować dokument w przypadku próby wprowadzania danych do bazy. Zamysł jest bowiem taki, że Mongoose sprawdzi dane pod kątem ilości i nazw atrybutów, ale walidowane będą też same wartości, czy ich typ jest zgodny z tym, co założyliśmy.</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Nietypowe typy</h4>
<p>Naturalnie w pracy będziemy wykorzystywać tylko niektóre typy z powyższej listy. Jeśli będziesz potrzebować innego, nieobsługiwanego przez Mongoose, istnieje możliwość zainstalowania dodatkowych pluginów. Możesz ich szukać pod <a href="https://plugins.mongoosejs.io/" target="_blank">tym linkiem</a>.</p>
</div>
<p>Dla praktyki spróbuj zastanowić się, jak mógłby wyglądać schemat dla kolekcji <code>employees</code>, a następnie porównaj swój pomysł z naszym:</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-SUssjgHte-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż odpowiedź</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-SUssjgHte-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj odpowiedź</a>
  </span>
</p>
<div id="collapse-SUssjgHte-toggle" class="collapse">
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> employeesSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  firstName<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  lastName<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  department<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Tablica lub obiekt jako atrybut</h4>
<p>MongoDB pozwala również na typowanie bardziej skomplikowanych struktur. Przydaje się to w sytuacji, kiedy atrybutem ma być np. kolejna tablica albo kolejny obiekt. Wygląda to wtedy następująco:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  field1<span class="token operator">:</span> <span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  field2<span class="token operator">:</span> <span class="token punctuation">{</span>
    type <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      subField1<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      subField2<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token known-class-name class-name">Number</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<h3 id="293-mongoose-pierwsze-starcie-pierwszy-model">Pierwszy model</h3>
<p>Czas na utworzenie modelu na bazie naszego schematu. Jak mówiliśmy już wcześniej, skorzystamy tutaj z metody <code>mongoose.model</code>.</p>
<pre class=" language-js"><code class=" language-js">mongoose<span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">'Department'</span><span class="token punctuation">,</span> departmentSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Pierwszy parametr mówi nam, jak będzie nazywał się nasz model, a drugi określa, z jakiego schematu struktury danych ma korzystać.</p>
<p>Gdy model jest gotowy, możemy go wyeksportować, aby można było go zaimportować i wykorzystać w dowolnym pliku.</p>
<p>Nasz plik <code>department.model.js</code> na końcu powinien wyglądać tak:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mongoose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> departmentSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token method function property-access">model</span><span class="token punctuation">(</span><span class="token string">'Department'</span><span class="token punctuation">,</span> departmentSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Skąd Mongoose wie jakiej kolekcji tyczy się model?</h4>
<p>Cóż, to jest akurat bardzo sprytne. Mongoose zakłada, że model tyczy się tej kolekcji, której nazwa jest równa nazwie modelu, ale pisanej z małych liter i zakończonej literą "s". Zatem jeśli nasz model nazywa się <code>Department</code>, to Mongoose powiąże go z kolekcją danych <code>departments</code>. Jeśli taka kolekcja jeszcze by nie istniała, to zostałaby automatycznie utworzona.</p>
<p>Analogicznie, gdybyśmy nazwali model <code>Test</code>, to Mongoose powiązałoby go z kolekcją <code>tests</code>.</p>
</div>
<h3 id="293-mongoose-pierwsze-starcie-wykorzystujemy-model-w-praktyce">Wykorzystujemy model w praktyce</h3>
<p>Nasz model jest już gotowy, dzięki czemu Mongoose wie już jakie dane powinny być przechowywane w kolekcji <code>departments</code>. Możemy więc teraz zabrać się za modyfikację endpointów w <code>departments.routes.js</code>.</p>
<p>Zaczniemy, nie po kolei, od endpointu:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/departments'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Z użyciem Mongoose będzie on wyglądał następująco:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/departments'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> newDepartment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Department</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">await</span> newDepartment<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Podmieńmy go.</p>
<p>Początek wydaje się dość ciekawy, ale też jasny.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> newDepartment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Department</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Możemy to zrozumieć jako rozkaz: utwórz nowy obiekt typu <code>Department</code>. Zauważ, że musimy przekazać tylko <code>name</code>, bo akurat <code>_id</code> będzie nadawane automatycznie.</p>
<p>Dziwić może jednak to:</p>
<pre class=" language-js"><code class=" language-js">newDepartment<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Jak to? Uruchamiamy jakąś metodę <code>save</code> i ona ma wystarczyć? A gdzie metoda <code>insertOne</code>?</p>
<p>Wyjaśnijmy sobie tutaj jedną rzecz. Model w Mongoose służy nam nie tylko do walidacji danych. Ta klasa ma również wiele wbudowanych metod, z których możemy bardzo łatwo korzystać. Np. <code>save</code> powinna po prostu spróbować dodać dokument do kolekcji zgodnej z modelem (u nas <code>Department</code> tyczy się kolekcji <code>departments</code>). Pod maską oczywiście, <code>save</code> korzysta ze zwykłego <code>insertOne</code>. Te gotowe metody mają nam po prostu pomóc w łatwiejszym pisaniu kodu i przyznaj, wygląda to obiecująco, prawda?</p>
<p>Podsumowując, nasz skrypt zadziała następująco:</p>
<ol>
<li>Najpierw "wyciągnie" parametr <code>name</code> z <code>req.body</code> i przypisze go do stałej.</li>
<li>Potem utworzy nowy dokument na bazie modelu <code>Department</code>. Na tym etapie w bazie jeszcze go nie ma.</li>
<li>Następnie zapisuje go w kolekcji (<code>save</code> = zapisz dokument do kolekcji).</li>
<li>Na końcu oczekuje na wykonanie metody (<code>await</code>) i jeśli wszystko poszło dobrze, to zwraca komunikat <code>OK</code>.</li>
</ol>
<p>Skoro korzystamy z <code>async...await</code>, jak pewnie pamiętasz, powinniśmy cały kod przechowywać w bloku <code>try...catch</code>, bowiem pozwala to na wyłapywanie ewentualnych błędów. Teraz też tak robimy i jeśli Mongoose zwróci jakiś błąd, nasz serwer przekaże go klientowi.</p>
<p>Oczywiście pamiętaj też, że ważny jest schemat struktury danych, z którego korzysta model. Musimy trzymać się właściwości i typów, które są w nim zapisane. Jeśli więc np. wymagamy w schemacie atrybutu <code>name</code>, to nie możemy zrobić czegoś takiego:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> newDepartment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Department</span><span class="token punctuation">(</span><span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">await</span> newDepartment<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Po pierwsze, <code>name</code> jest wymagany, a u nas go brakuje. Po drugie, wcale nie zezwalamy na <code>test</code>. Mongoose zwróciłby w takiej sytuacji błąd.</p>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Promise vs Async/Await</h4>
<p>Jeśli zamiast składni <code>async...await</code> wolisz promise'y, możesz zapisywać kod Mongoose również z ich pomocą.</p>
<p>Na przykład nasz endpoint mógłby wyglądać tak:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/departments'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> newDepartment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Department</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    newDepartment<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token keyword control-flow">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Wybór należy do Ciebie. Niemniej jednak my zachęcamy do korzystania z <code>async...await</code>, co przy bardziej skomplikowanych operacjach jest o wiele czytelniejsze niż zapis z promise'ami.</p>
</div>
<p>Oczywiście nie zapomnijmy jeszcze o jednej rzeczy. Jeśli chcemy korzystać z wybranego modelu, to musimy go zaimportować. Na górze pliku dodaj:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">Department</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../models/department.model'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Teraz nasz endpoint jest już gotowy, ale na razie nie próbuj go jeszcze testować. Serwer w większości endpointów stara się korzystać z <code>req.db</code> (które już nie działa), więc na razie informowałby od razu o błędach. Sprawdzimy, czy wszystko funkcjonuje prawidłowo, ale dopiero wtedy, kiedy skończymy pracę nad całym plikiem.</p>
<h3 id="293-mongoose-pierwsze-starcie-kolejne-endpointy">Kolejne endpointy</h3>
<p>Teraz będziemy starali się iść już zgodnie z kolejnością.</p>
<h4>GET <code>router.get('/departments')</code></h4>
<p>Zaczniemy od endpointu pobierającego i zwracającego wszystkie dane z kolekcji.</p>
<p>W tej chwili wygląda on tak:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Przy użyciu Mongoose będzie wyglądać tak:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Zauważ, że ponownie działamy na metodzie z klasy (modelu) Department. Wcześniej było to <code>.save</code>, teraz jest to <code>find</code>. Akurat ta nazwa może być dla Ciebie łatwiejsza do rozszyfrowania. Mongoose'owy <code>find</code> używa po prostu metody <code>find</code> z MongoDB. Warto zauważyć również, że w przypadku Mongoose nie musimy się już przejmować konwersją danych do tablicy. Paczka robi to za nas.</p>
<p>Oprócz <code>find</code> Mongoose oferuje również dwie kolejne metody pomocnicze do pobierania danych:</p>
<ul>
<li><code>findById(id)</code> – skrót do <code>find({ _id: id })</code> z MongoDB,</li>
<li><code>findOne()</code> - skrót do <code>findOne</code> z MongoDB.</li>
</ul>
<p>W <code>find</code> możesz oczywiście wpisywać dowolny warunek oraz używać operatorów. Robimy to dokładnie tak samo, jak w poprzednim submodulem, a więc np. szukanie działów innych niż IT wyglądałoby tak – <code>Department.find({ name: { $ne: 'IT' }})</code>.</p>
<p>Podsumowując powyższy kod, tak jak wcześniej, powinien on znaleźć po prostu wszystkie dane z kolekcji <code>departments</code> i zwrócić je klientowi.</p>
<h4>GET <code>/departments/random</code></h4>
<p>Tym razem nie będziemy zostawiać najtrudniejszego na koniec :)</p>
<p>W tej chwili ten endpoint wygląda następująco:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments/random'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">{</span> $sample<span class="token operator">:</span> <span class="token punctuation">{</span> size<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>W Mongoose wciąż możemy używać funkcji <code>aggregate</code>, ale istnieje też przystępniejsza opcja z wykorzystaniem metody <code>skip</code> i <code>countDocuments</code>. Metoda <code>skip</code> pozwala na pominięcie przy wyszukiwaniu dowolnej ilości dokumentów, natomiast <code>countDocuments</code> potrafi po prostu zliczyć ilość wszystkich dokumentów w kolekcji.</p>
<p>Z tą wiedzą możemy zmodyfikować nasz endpoint następująco:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments/random'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">countDocuments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> rand <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">floor</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span>rand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>dep<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Jak możemy zrozumieć ten kod? Najpierw liczymy wszystkie elementy w kolekcji. Następnie losujemy liczbę, ale taką, która nie będzie większa od ilości dokumentów. W kolejnym kroku spróbujemy wybrać bezwarunkowo jeden element. Skoro nie mamy jednak warunku, to oczywiście Mongoose będzie zwracać pierwszy dokument z kolekcji, zawsze ten sam, a tego nie chcemy. Owszem, potrzebujemy jednego elementu, ale nie zawsze tego samego. I tutaj do gry wchodzi <code>skip</code>, która zapewnia nas, że wyszukiwanie będzie rozpoczynane z różnego miejsca. Jeśli <code>rand</code> równa się 1, to rozpoczynamy wyszukiwanie od pierwszego dokumentu. Ten od razu pasuje do warunku, więc zostanie zwrócony. Jeśli jednak <code>rand</code> równa się 100, to wyszukiwanie pasującego elementu zacznie się od dokumentu nr 100 i to on będzie zwrócony jako pierwszy pasujący. Na samym końcu upewniamy się już tylko, czy udało się cokolwiek znaleźć (w końcu kolekcja może być pusta) i zwracamy znaleziony element lub ewentualny błąd.</p>
<h4>GET <code>/departments/:id</code></h4>
<p>Kolejny endpoint będzie już o wiele prostszy:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token function"><span class="token maybe-class-name">ObjectId</span></span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Zamienimy go na:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">findById</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>dep<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Uwaga!</h4>
<p>Zauważ, że nie musimy tym razem korzystać z funkcji <code>ObjectId</code> do konwersji stringu <code>req.params.id</code> do odpowiedniego formatu. Mongoose zajmuje się tym za nas.</p>
<p>Na tym etapie warto również w ogóle usunąć zbędny import tej funkcji. Nie będziemy z niej korzystać.</p>
</div>
<h4>PUT <code>/departments/:id</code></h4>
<p>Teraz w kolejce było dodawanie działu, ale ten endpoint zrobiliśmy już na samym początku. Od razu możemy przejść do następnego.</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token function"><span class="token maybe-class-name">ObjectId</span></span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Zmodyfikujemy go tak:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Jak zapewne się domyślasz, <code>updateOne</code> pod maską odpali po prostu <code>updateOne</code> w MongoDB. Składnia w samej metodzie jest identyczna. Oprócz tego Mongoose oferuje również <code>updateMany</code> do aktualizacji wielu elementów, która działa analogicznie do <code>updateMany</code> z czystego MongoDB. Efekt będzie taki sam, jak byśmy uruchomili te komendy w konsoli Mongo Shell.</p>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Dokładniejsza walidacja</h4>
<p>Nasz zmodyfikowany endpoint powinien działać poprawnie, ale wciąż nie jest idealny. Kod zakłada, że dokument do usunięcia na pewno istnieje. A co jeśli wpiszemy w linku błędne id? Jak wtedy nasz endpoint sobie z tym poradzi?</p>
<p>Nie musisz tego testować. Powiemy Ci – pokaże po prostu błąd 500, który informuje użytkownika o winie serwera. Czy to dobra praktyka? Często błąd wyrzucany przez Mongoose faktycznie będzie winą serwera, ale czy wpisanie złego id w adresie przez użytkownika również nim jest? Raczej nie. O wiele bardziej adekwatna byłaby tutaj informacja o błędzie 404.</p>
<p>Najłatwiej zmienić to następująco:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">findById</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> $set<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found...'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Logiczny sposób? Oczywiście. Sprawdzamy, czy element istnieje i jeśli tak, to go aktualizujemy, a jeśli nie, zwracamy odpowiedni kod i komunikat.</p>
<p>Innym, zalecanym przez Mongoose, sposobem jest następująca technika:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">put</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">findById</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      dep<span class="token punctuation">.</span><span class="token property-access">name</span> <span class="token operator">=</span> name<span class="token punctuation">;</span>
      <span class="token keyword control-flow">await</span> dep<span class="token punctuation">.</span><span class="token method function property-access">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found...'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Wykorzystuje ona metodę <code>save</code>. Zauważ, że gdy tworzyliśmy nowy dokument i w kolekcji jeszcze go nie było, <code>save</code> zwyczajnie go dodawało. Kiedy stosujemy tę metodę na istniejącym elemencie, Mongoose go aktualizuje. Cały kod możemy więc podsumować jako rozkaz: znajdź odpowiedni dział po id, zmień jego atrybut <code>name</code> na wartość z <code>req.params.id</code> i zaktualizuj ten dokument w kolekcji.</p>
<p>To trochę inne podejście, ale możesz się z nim często spotkać.</p>
<p>Spróbuj wykorzystać jedną z opcji w naszym endpoincie.</p>
</div>
<h4>DELETE <code>/departments/:id</code></h4>
<p>Został nam już tylko jeden endpoint. Metody, które oferuje Mongoose do usuwania danych są bardzo intuicyjne, <code>deleteOne</code> to odpowiednik znanego Ci już <code>deleteOne</code> z Mongo Shell, podobnie sprawa ma się z <code>deleteMany</code>. Ich użycie będzie więc tak samo proste, jak <code>updateOne</code> w endpoincie powyżej.</p>
<p>Spróbuj zmodyfikować ostatni endpoint bez naszej pomocy:</p>
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token property-access">db</span><span class="token punctuation">.</span><span class="token method function property-access">collection</span><span class="token punctuation">(</span><span class="token string">'departments'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token function"><span class="token maybe-class-name">ObjectId</span></span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Następnie upewnij się, że wszystko gra.</p>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-K6pB3rdKf9-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż odpowiedź</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-K6pB3rdKf9-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj odpowiedź</a>
  </span>
</p>
<div id="collapse-K6pB3rdKf9-toggle" class="collapse">
<pre class=" language-js"><code class=" language-js">router<span class="token punctuation">.</span><span class="token method function property-access">delete</span><span class="token punctuation">(</span><span class="token string">'/departments/:id'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">findById</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token property-access">params</span><span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'OK'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found...'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<p>To tyle!</p>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Metoda <code>remove</code></h4>
<p>Warto wiedzieć, że Mongoose udostępnia jeszcze jedną metodę do usuwania danych. Nazywa się ona <code>remove</code> i ma zastosowanie w przypadku bezpośredniego dostępu do dokumentu.</p>
<p>Na przykład, jeśli z jakiegoś powodu załadowalibyśmy już dane z bazy:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> department <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token string">'42423fwfe5435fsdf'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>i chcielibyśmy taki dokument usunąć, to zamiast korzystać z <code>deleteOne</code>:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> department <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token string">'42423fwfe5435fsdf'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">deleteOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> department<span class="token punctuation">.</span><span class="token property-access">_id</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>moglibyśmy użyć metody <code>remove</code> bezpośrednio na tym dokumencie:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> department <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _id<span class="token operator">:</span> <span class="token string">'42423fwfe5435fsdf'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">await</span> department<span class="token punctuation">.</span><span class="token method function property-access">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Oczywiście Mongoose wciąż korzystałby tutaj z <code>deleteOne</code> i efekt byłby dokładnie taki sam. To po prostu "skrót", który ma poprawić czytelność kodu. Jest to dokładnie taki sam zabieg, jak w przypadku metody <code>save</code>, która pozwalała nam na czytelniejsze dodawanie lub modyfikowanie danych.</p>
<p>Naturalnie ta metoda ma zastosowanie tylko wtedy, gdy dany dokument jest już załadowany, więc mamy do niego dostęp. W przeciwnym razie szybszym wyjściem będzie skorzystanie z <code>deleteOne</code> lub <code>deleteMany</code>.</p>
</div>
<h3 id="293-mongoose-pierwsze-starcie-testujemy">Testujemy</h3>
<p>Czas przetestować zmiany. W <code>server.js</code> zakomentuj na chwilę kod importujący i korzystający z dwóch pozostałych plików z route'ami. One wciąż bazują na <code>req.db</code>, więc uruchomienie wyrzucałoby nam błąd.</p>
<p>Włącz serwer i za pomocą Postmana oraz MongoDB Compass postaraj się ustalić, czy wszystkie endpointy działają poprawnie.</p>
<h3 id="293-mongoose-pierwsze-starcie-podsumowanie">Podsumowanie</h3>
<p>Tak naprawdę w kwestii modyfikacji bazy danych niczego nowego się nie dowiedzieliśmy – dodawać, usuwać czy aktualizować dane umieliśmy przecież już wcześniej. Poznanie Mongoose pozwala nam jednak znacznie uprościć te operacje, uporządkować kod, a do tego wprowadza niezwykle ważną i pomocną technikę modelowania danych, która w przypadku większych aplikacji jest nieodzowna.</p>
<p>Dzięki tym zaletom Mongoose prawdopodobnie na stałe wyląduje w gronie Twoich ulubionych narzędzi i będzie nieodzownym elementem backendowego stacku technologicznego.</p>
<p>Po tym submodule jesteś już w stanie utworzyć i obsługiwać bazy danych złożone z dowolnych kolekcji. Potrafisz dodawać nowe dokumenty, modyfikować je oraz usuwać.</p>
<p>Bazy danych to jednak często coś więcej niż tylko pojedyncze kolekcje. Tworzą bardziej skomplikowane struktury, a ich dane mogą się w jakiś sposób przenikać. Musimy je wtedy integrować albo odpowiednio filtrować, bo np. na jednej podstronie chcemy użyć danych z kolekcji <code>departments</code> i <code>employees</code>, albo potrzebujemy wybrać dane z jednej, sprawdzając, czy istnieje odpowiedni dokument w drugiej. Często mówimy w kontekście baz danych o <strong>relacjach</strong> i właśnie to, a więc <strong>relacyjność</strong>, będzie tematem naszego kolejnego submodułu.</p>

                        </div>
                    </div>
                                        <div class="card-block task-card">
                        <h3 id="293-mongoose-pierwsze-starcie-zadanie-trenujemy">Zadanie: <span class="task-title">trenujemy</span></h3>
                        <div class="task-content">
                            <p>Czas na dwa krótkie ćwiczenia.</p>
<p><strong>Zadanie 1</strong></p>
<p>Zadanie pierwsze nie jest zbyt wymagające i polega na modyfikacji pozostałych dwóch plików z route'ami, aby również korzystały z dobrodziejstw Mongoose. Możesz wzorować się na <code>departments.routes.js</code>. Nie zapomnij również o odpowiednich schematach struktury danych i modelach! Najlepiej zacznij właśnie od nich.</p>
<div class="bc-note alert-warning">
<h4 class="alert-heading text-center">Uwaga!</h4>
<p>Jeśli dla testów endpointów <code>departments.routes.js</code> importy pozostałych plików w <code>server.js</code> zostały zakomentowane, to nie zapomnij przywrócić ich do życia.</p>
</div>
<p><strong>Zadanie 2</strong></p>
<p>Zadanie drugie jest już trochę bardziej wymagające. W tej chwili, gdy edytujemy lub usuwamy element, serwer kwituje to wysłaniem komunikatu <code>OK</code>. Twoim zdaniem jest taka modyfikacja endpointów do usuwania i aktualizowania danych w pliku <code>departments.routes.js</code>, aby po udanej operacji zwracały jeszcze dokument, na którym pracowały.</p>
<p>Zatem, jeśli usuwasz z kolekcji dokument, to chcemy, aby serwer po udanej operacji usunięcia, zwrócił nam jeszcze ten dokument w <code>response</code>. Gdy modyfikujesz, to serwer po udanej operacji zmiany, również powinien zwracać ten zmieniony dokument w odpowiedzi.</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Uwaga!</h4>
<p>Zadanie wymaga modyfikacji tych dwóch endpointów tylko w <code>departments.routes.js</code>. W pozostałych plikach nie musisz już tego robić.</p>
</div>
<p>Do wykonania zadania możesz wykorzystać znane Ci już metody lub przejrzeć listę innych, których jeszcze nie opisywaliśmy. Znajdziesz ją pod <a href="https://mongoosejs.com/docs/api/model.html" target="_blank">tym linkiem</a>.</p>

                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <div class="clearfix">
                                                                                <a href="https://kodilla.com/pl/bootcamp-task/407/666336" target="_blank" class="btn btn-info-outline">Podgląd zadania</a>
                            <form target="_blank" class="form-inline project-link-form">
                                <div class="form-group">
                                    <input type="text" name="link" class="form-control" value="https://github.com/skwiryt/companyApp">
                                </div>
                                <button type="submit" class="btn  btn-primary ">Wyślij link <i class="fa fa-check"></i></button>
                            </form>
                                                                                                    </div>
                    </div>
                </section>
                                    
                <section id="submodule-1157" class="card submodule completed" data-bootcamp-user-submodule-id="666337">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">29.4. <span>Mongoose – relacje między kolekcjami</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Kiedy mówimy o bazach danych, bardzo często możemy usłyszeć o <strong>relacyjności danych</strong>. Co to w ogóle znaczy?</p>
<p>Wyobraź sobie bazę danych z takimi dwoma kolekcjami:</p>
<pre class=" language-js"><code class=" language-js"><span class="token comment">// BooksDB</span>

books<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">'The Catcher in the Rye'</span><span class="token punctuation">,</span>
    author<span class="token operator">:</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'J. D. Salinger'</span><span class="token punctuation">,</span>
      nationality<span class="token operator">:</span> <span class="token string">'USA'</span><span class="token punctuation">,</span>
      votes<span class="token operator">:</span> <span class="token number">125</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">'Of Mice and Men'</span><span class="token punctuation">,</span>
    author<span class="token operator">:</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'John Steinbeck'</span> <span class="token punctuation">,</span>
      nationality<span class="token operator">:</span> <span class="token string">'USA'</span><span class="token punctuation">,</span>
      votes<span class="token operator">:</span> <span class="token number">89</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

authors<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'J. D. Salinger'</span><span class="token punctuation">,</span>
    nationality<span class="token operator">:</span> <span class="token string">'USA'</span><span class="token punctuation">,</span>
    votes<span class="token operator">:</span> <span class="token number">125</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'John Steinbeck'</span> <span class="token punctuation">,</span>
    nationality<span class="token operator">:</span> <span class="token string">'USA'</span><span class="token punctuation">,</span>
    votes<span class="token operator">:</span> <span class="token number">89</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p>Oprócz tego załóżmy, że dane te są wykorzystywane w trzech miejscach:</p>
<ul>
<li><strong>Strona główna</strong> – pokazuje tylko listę tytułów.</li>
<li><strong>Podstrona "Autorzy"</strong> – pokazuje listę nazwisk autorów.</li>
<li><strong>Podstrona "Książki"</strong> – pokazuje listę tytułów wraz z autorami i ich liczbą głosów.</li>
</ul>
<p>Czy taka struktura kolekcji miałaby rację bytu? Wydaje się, że tak. Na stronie głównej wykorzystywalibyśmy dane z <code>books</code>, na podstronie z autorami <code>authors</code>, a na podstronie z książkami znowu <code>books</code> i tylko <code>books</code>, bo same informacje o autorach są zawarte również w tej kolekcji. Wygląda to na dość wygodne rozwiązanie, ale wcale nie jest idealne...</p>
<p>Czy udało Ci się zauważyć jakąś wadę w takiej konstrukcji struktury danych? Część danych się dubluje (chodzi o informacje o autorach), a to bardzo zła praktyka. Pamiętaj, że <strong>dane w kolekcjach nie powinny się powielać</strong>. To jedna z zasad, której warto trzymać się przy projektowaniu baz danych.</p>
<p>Dlaczego powielanie danych jest takie złe? W końcu samo pobieranie z takich kolekcji, jak już powiedzieliśmy, byłoby bardzo proste i wygodne.</p>
<p>Po pierwsze, niepotrzebnie zwiększamy rozmiar naszej bazy danych. To istotna kwestia, chociażby z tego względu, że często utrzymujemy je na serwerach zdalnych i płacimy za zajmowane miejsce.</p>
<p>Po drugie, trzymając te dane w kilku miejscach, znacznie utrudniamy sobie ich modyfikację. Powiedzmy, że chcesz zmienić np. ilość głosów dla jednego z autorów. Musielibyśmy wtedy zmodyfikować nie tylko dokument w <code>authors</code>, ale też jego odpowiednik w <code>books</code>, bo inaczej dane nie byłyby spójne.</p>
<p>W takim razie, jak moglibyśmy przerobić te dane? Najprostszy sposób to wydzielenie ich (autorzy sobie, książki sobie) i wykorzystywanie idei referencji. Czym może być taka referencja? Identyfikatorem, nazwą, czymkolwiek, co będzie w stanie wskazać na właściwy unikalny dokument (z innej kolekcji).</p>
<p>Na przykład:</p>
<pre class=" language-js"><code class=" language-js"><span class="token comment">// BooksDB</span>

books<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">'The Catcher in the Rye'</span><span class="token punctuation">,</span>
    authorId<span class="token operator">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">'Of Mice and Men'</span><span class="token punctuation">,</span>
    authorId<span class="token operator">:</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

authors<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'J. D. Salinger'</span><span class="token punctuation">,</span>
    nationality<span class="token operator">:</span> <span class="token string">'USA'</span><span class="token punctuation">,</span>
    votes<span class="token operator">:</span> <span class="token number">125</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'John Steinbeck'</span> <span class="token punctuation">,</span>
    nationality<span class="token operator">:</span> <span class="token string">'USA'</span><span class="token punctuation">,</span>
    votes<span class="token operator">:</span> <span class="token number">89</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<p>Zauważ, że teraz w kolekcji <code>books</code> nie trzymamy już zduplikowanych informacji o autorze. Mamy tylko atrybut, który wskazuje na id tego dokumentu w drugiej kolekcji – <code>authors</code>. Oczywiście, zamiast identyfikatora moglibyśmy tutaj użyć również nazwiska, ale jednak bezpieczniejszą praktyką jest zastosowanie <code>_id</code>, które zawsze jest unikalne.</p>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Trochę teorii</h4>
<p>Taki proces porządkowania danych, wydzielania kolekcji i niwelowania duplikatów (tzw. redundancji, nadmiarowości) nazywa się <strong>normalizacją bazy danych</strong>. Sama relacja, którą możemy teraz zauważyć pomiędzy <code>authors</code> a <code>books</code> – jest relacją <strong>jeden do wielu</strong> (wiele książek może mieć referencję do tego samego autora).</p>
<p>W odniesieniu do MongoDB rzadko korzystamy z nazewnictwa takich powiązań, bo sam silnik domyślnie w żaden sposób takich relacji nie zauważa, ani nic z nimi nie robi (sytuację poprawia Mongoose, ale tylko trochę). Ich używanie ma większy sens w przypadku baz relacyjnych, jak SQL czy MySQL, które rzeczywiście zauważają takie powiązania i pozwalają nawet na zabezpieczanie tego typu więzi (np. usunięcie autora musiałoby korelować z wymuszoną modyfikacją atrybutu <code>authorId</code> niektórych książek). Niemniej jednak, warto zapamiętać to nazewnictwo, bowiem osoby "wychowane" na klasycznych bazach danych bardzo często używają tych nazw również w kontekście MongoDB. Wypada więc wiedzieć, o czym mówią.</p>
<p>Oprócz relacji <strong>jeden do wielu</strong> możemy analogicznie mówić o relacjach <strong>wiele do wielu</strong>, <strong>wiele do jednego</strong>, czy <strong>jeden do jednego</strong>.</p>
</div>
<p>Jak działałby nasz kod w praktyce? Na głównej stronie ładowalibyśmy dane z kolekcji <code>books</code> (bo tu interesują nas tylko tytuły), a na podstronie z autorami wyciągalibyśmy jedynie dokumenty z <code>authors</code>. Gorzej sytuacja miałaby się już w przypadku kolejnej podstrony, na której potrzebujemy pokazywać zarówno tytuły książek, jak i nazwiska oraz oceny autorów. Musielibyśmy najpierw pobrać kolekcję książek, a potem, przed wyświetleniem informacji, znaleźć jeszcze dane autora w <code>authors</code> na bazie <code>authorId</code>.</p>
<p>Jak mogłoby to wyglądać? Na przykład tak:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Book</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">if</span><span class="token punctuation">(</span>books <span class="token operator">&amp;&amp;</span> books<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">for</span><span class="token punctuation">(</span>book <span class="token keyword">of</span> books<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> author <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Author</span><span class="token punctuation">.</span><span class="token method function property-access">findById</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token property-access">authorId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>author<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      book<span class="token punctuation">.</span><span class="token property-access">author</span> <span class="token operator">=</span> author<span class="token punctuation">;</span>

      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Book title'</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Book author'</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Book author votes'</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">votes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Taki kod zadziałałby następująco. Najpierw pobieralibyśmy wszystkie książki, a jak wiemy, nie mają one dokładnych informacji o autorze. Zamiast tego posiadają informację o id odpowiedniego dokumentu w kolekcji <code>authors</code>. Dlatego też, zanim pokażemy informacje o danej książce, musimy w jakiś sposób pobrać te dokładne informacje. Robimy to, ściągając po prostu cały dokument z kolekcji <code>authors</code> o <code>_id</code> równym <code>book.authorId</code>, a następnie przypisując go do obiektu książki jako nowy atrybut. Tym samym otrzymujemy na końcu obiekt <code>book</code>, który posiada dokładne informacje nie tylko o książce, ale również o autorze. Autor odpowiadający <code>authorId</code> jest zapisany po prostu jako nowy atrybut <code>book</code>.</p>
<p>Czy taki zapis jest dla nas wygodny? Nie do końca, na pewno wymaga trochę więcej pracy. Akurat pod tym względem stary układ był nieco lepszy. Musisz przyznać jednak, że znacznie poprawiliśmy jakość naszej przykładowej bazy danych. Informacje się nie duplikują, kolekcje są małe i przyjazne w odbiorze, chcąc modyfikować autora, wystarczy zrobić to w jednym miejscu, a jak widać załadowanie nawet bardzo dokładnych danych wciąż jest możliwe. Trudniejsze, ale możliwe.</p>
<p><strong>Ćwiczenie</strong></p>
<p>Co ciekawe, nasza baza danych <code>companyDB</code> też cierpi na redundancję (nadmiarowość) danych. Co prawda sytuacja jest mniej skomplikowana, ale jednak warto byłoby również to naprawić. Spójrz tylko na te dwie kolekcje:</p>
<pre class=" language-js"><code class=" language-js"><span class="token comment">// CompanyDB</span>

departments<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'3254353412frsdfs'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'3254354232frsdfs'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Testing'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'32543545436fgdds'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Marketing'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

employees<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token string">'5d89da449adfcce066c6b643'</span><span class="token punctuation">,</span>
    firstName<span class="token operator">:</span> <span class="token string">'Amanda'</span><span class="token punctuation">,</span>
    lastName<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span>
    department<span class="token operator">:</span> <span class="token string">'Marketing'</span>
  <span class="token punctuation">}</span>
  <span class="token spread operator">...</span>
<span class="token punctuation">]</span></code></pre>
<p>Atrybut <code>department</code> w <code>employees</code> to tak naprawdę zdublowana informacja z <code>departments</code>. Do tego, gdybyśmy chcieli zmienić np. nazwę któregoś z działu, konieczna byłaby modyfikacja nie tylko w kolekcji <code>departments</code>, ale i niektórych dokumentów z <code>employees</code>...</p>
<p>Jak widzisz, sytuacja w naszej bazie nie jest idealna. Twoim zadaniem będzie więc (wzorując się na przykładzie z Books) odpowiednie jej znormalizowanie. Kolekcje możesz zmodyfikować za pomocą konsoli lub w MongoDB Compass, technika jest dowolna.</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Uwaga!</h4>
<p>Modyfikując dane w Compassie możesz zastanawiać się, jaki typ danych należy wybrać dla nowych wartości <code>department</code> w dokumentach kolekcji <code>employees</code>. Domyślnie używaliśmy stringu, ale przecież teraz będzie to jakaś referencja. Czy należy więc użyć czegoś innego?</p>
<p>W założeniu <code>department</code> powinno być referencją po <code>id</code> z innej kolekcji, a to sugeruje, że należy użyć typu ObjectId. To prawda, ale Compass nie daje nam takiej możliwości... Spokojnie możesz jednak pozostawić po prostu String. Mongoose, jak przekonasz się później, poradzi sobie z tym i skonwertuje tę wartość w razie potrzeby.</p>
</div>
<p class="text-center">
  <span class="collapse-toggles">
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-7yY-5SSN7-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Pokaż odpowiedź</a>
    <a href="https://kodilla.com/pl/bootcamp-module/407/278/5935#collapse-7yY-5SSN7-toggle" class="btn btn-primary collapsed" data-toggle="collapse">Ukryj odpowiedź</a>
  </span>
</p>
<div id="collapse-7yY-5SSN7-toggle" class="collapse">
<p>Dążymy do następującej struktury danych:</p>
<pre class=" language-js"><code class=" language-js">departments<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'3254353412frsdfs'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'IT'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'3254354232frsdfs'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Testing'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'32543545436fgdds'</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Marketing'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

employees<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    _id<span class="token operator">:</span> <span class="token string">'5d89da449adfcce066c6b643'</span><span class="token punctuation">,</span>
    firstName<span class="token operator">:</span> <span class="token string">'Amanda'</span><span class="token punctuation">,</span>
    lastName<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span>
    department<span class="token operator">:</span> <span class="token string">'3254353412frsdfs'</span>
  <span class="token punctuation">}</span>
  <span class="token spread operator">...</span>
<span class="token punctuation">]</span></code></pre>
<p>Chcemy, aby atrybut <code>department</code> w <code>employees</code> był tylko referencją po <code>_id</code> do odpowiedniego dokumentu w <code>departments</code>.</p>
</div>
<p>Wiemy już jak mniej więcej ma to wszystko wyglądać, ale pojawia się pytanie. Czy naprawdę musimy wybierać – poprawna struktura danych w bazie albo wygodne ich pobieranie? Nie, jeśli mamy odpowiednie pomocnicze metody. Tak się składa, że akurat Mongoose takowe posiada.</p>
<h3 id="294-mongoose-relacje-miedzy-kolekcjami-metoda-populate">Metoda <code>populate</code></h3>
<p>W przykładzie powyżej pokazywaliśmy, jak możemy przygotować dane z jednej kolekcji, aby zawierała też coś z drugiej. Wykorzystywaliśmy przy tym zamysł referencji. Nie było to może bardzo trudne w realizacji, ale jednak wymagało od nas czasu i pozostawiło po sobie sporą ilość kodu. Warto wiedzieć jednak, że Mongoose posiada wbudowaną metodę, która może to robić za nas! Mowa o <code>populate</code>.</p>
<p>Aby jej użyć, Mongoose musi zdawać sobie sprawę, który atrybut w dokumencie jest w istocie referencją do innej kolekcji oraz do jakiej dokładnie. My bowiem wiedzieliśmy, że <code>authorId</code> tyczy się kolekcji <code>authors</code> tylko dlatego, że sami wymyśliliśmy taką relację. Osoba postronna mogłaby to zauważyć po nazewnictwie atrybutu, ale skąd ma o tym wiedzieć Mongoose?</p>
<p>Musimy ją poinformować o tym w schemacie struktury danych kolekcji.</p>
<p>Twój model <code>Employee</code> ma w tej chwili mniej więcej taką strukturę:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> employeeSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  firstName<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  lastName<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  department<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Musimy teraz dodatkowo poinformować Mongoose, że atrybut <code>department</code> ma być referencją do kolekcji <code>Department</code>. Możemy to zrobić, dodając opcję <code>ref</code>.</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> employeeSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  firstName<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  lastName<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  department<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token known-class-name class-name">String</span><span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> ref<span class="token operator">:</span> <span class="token string">'Department'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Od teraz Mongoose już wie, że atrybut <code>department</code> to referencja do dokumentu w kolekcji <code>departments</code> (model <code>Department</code> korzysta bowiem właśnie z <code>departments</code>).</p>
<p>Jeśli mamy to gotowe, teraz wystarczy, że przy pobieraniu danych (<code>find</code>) wywołamy metodę <code>populate</code>, a Mongoose sam zajmie się "dobraniem" odpowiednich danych z konkretnej kolekcji.</p>
<p>Na przykład:</p>
<pre class=" language-js"><code class=" language-js"><span class="token maybe-class-name">Employee</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>zwróciłoby nam dane tylko z <code>employees</code>:</p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">[</span>
 <span class="token punctuation">{</span>
   _id<span class="token operator">:</span> <span class="token string">'5d89da449adfcce066c6b643'</span><span class="token punctuation">,</span>
   firstName<span class="token operator">:</span> <span class="token string">'Amanda'</span><span class="token punctuation">,</span>
   lastName<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span>
   department<span class="token operator">:</span> <span class="token string">'3254353412frsdfs'</span>
 <span class="token punctuation">}</span>
 <span class="token spread operator">...</span>
<span class="token punctuation">]</span></code></pre>
<p>Gdybyśmy użyli jeszcze metody <code>populate</code>:</p>
<pre class=" language-js"><code class=" language-js"><span class="token maybe-class-name">Employee</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token string">'department'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>to w miejsce <code>department</code> obiekty pracowników miałyby konkretną informację o dziale:</p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">[</span>
 <span class="token punctuation">{</span>
   _id<span class="token operator">:</span> <span class="token string">'5d89da449adfcce066c6b643'</span><span class="token punctuation">,</span>
   firstName<span class="token operator">:</span> <span class="token string">'Amanda'</span><span class="token punctuation">,</span>
   lastName<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span>
   department<span class="token operator">:</span> <span class="token punctuation">{</span>
     id<span class="token operator">:</span> <span class="token string">'3254353412frsdfs'</span><span class="token punctuation">,</span>
     name<span class="token operator">:</span> <span class="token string">'IT'</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token spread operator">...</span>
<span class="token punctuation">]</span></code></pre>
<p>Krótko mówiąc, <code>populate</code> <strong>składa nasze dane z dwóch lub więcej kolekcji w jeden większy obiekt</strong>, tak jak robiliśmy to wcześniej sami. Jak widzisz, nie musimy iść na kompromis. Możemy mieć odpowiednią strukturę w bazie danych, a przy tym wciąż nie mieć problemu z ich pobieraniem.</p>
<pre class=" language-js"><code class=" language-js"><span class="token function">populate</span><span class="token punctuation">(</span><span class="token string">'department'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Aby wszystko było jasne – parametr <code>populate</code> mówi po prostu, który atrybut Mongoose powinien zostać w taki sposób obsłużony.</p>
<p>Dla praktyki powiedzmy tylko jeszcze, jak mogłaby wyglądać funkcja do pobierania książek, gdybyśmy odpowiednio skorzystali z mongoose'owych schematów danych i <code>populate</code>.</p>
<p>Ten kod:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Book</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">if</span><span class="token punctuation">(</span>books <span class="token operator">&amp;&amp;</span> books<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">for</span><span class="token punctuation">(</span>book <span class="token keyword">of</span> books<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> author <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Author</span><span class="token punctuation">.</span><span class="token method function property-access">findById</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token property-access">authorId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>author<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      book<span class="token punctuation">.</span><span class="token property-access">author</span> <span class="token operator">=</span> author<span class="token punctuation">;</span>

      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Book title'</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Book author'</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Book author votes'</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">votes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>skróciłby się do:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> books <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Book</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">populate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword control-flow">if</span><span class="token punctuation">(</span>books <span class="token operator">&amp;&amp;</span> books<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Book title'</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Book author'</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Book author votes'</span><span class="token punctuation">,</span> book<span class="token punctuation">.</span><span class="token property-access">author</span><span class="token punctuation">.</span><span class="token property-access">votes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<h3 id="294-mongoose-relacje-miedzy-kolekcjami-podsumowanie">Podsumowanie</h3>
<p>Oczywiście to tylko namiastka "relacyjności". W innych znanych silnikach (jak SQL czy MySQL) wygląda to o wiele bardziej zaawansowanie. Wbrew pozorom jednak, <code>populate</code> często będzie wystarczające, aby zadbać o jakość naszej bazy danych, a z racji tego, że to tak proste narzędzie, nie mamy wymówek, aby z niego nie korzystać.</p>
<p>Pamiętaj – jeśli widzisz, że dane w bazie są źle poukładane, staraj się jak najszybciej to naprawić. Im lepiej skonstruowana baza, z większym podziałem i oparciem na relacjach, tym przyjemniej się z nią w przyszłości pracuje.</p>

                        </div>
                    </div>
                                        <div class="card-block task-card">
                        <h3 id="294-mongoose-relacje-miedzy-kolekcjami-zadanie-wykorzystujemy-wiedze-w-praktyce">Zadanie: <span class="task-title">wykorzystujemy wiedzę w praktyce</span></h3>
                        <div class="task-content">
                            <p><strong>Zadanie 1</strong></p>
<p>Korzystając z informacji podanych w submodule, zmodyfikuj endpointy do pobierania danych w <code>employees.routes.js</code> tak, aby w miejscu atrybutu <code>department</code> były zwracane odpowiadające dokumenty z kolekcji <code>department</code>.</p>
<p>Krótko mówiąc, oczekujemy, że endpointy będą zwracać dokumenty w takim formacie:</p>
<pre class=" language-js"><code class=" language-js"><span class="token punctuation">[</span>
 <span class="token punctuation">{</span>
   _id<span class="token operator">:</span> <span class="token string">'5d89da449adfcce066c6b643'</span><span class="token punctuation">,</span>
   firstName<span class="token operator">:</span> <span class="token string">'Amanda'</span><span class="token punctuation">,</span>
   lastName<span class="token operator">:</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span>
   department<span class="token operator">:</span> <span class="token punctuation">{</span>
     id<span class="token operator">:</span> <span class="token string">'3254353412frsdfs'</span><span class="token punctuation">,</span>
     name<span class="token operator">:</span> <span class="token string">'IT'</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token spread operator">...</span>
<span class="token punctuation">]</span></code></pre>
<p>W zadaniu skorzystaj z metody <code>populate()</code>.</p>
<p><strong>Zadanie 2</strong></p>
<p>Jak zapewne udało Ci się już zauważyć, nasze pliki z route'ami znacznie się rozrosły. Różnica względem tego, co otrzymaliśmy na początku, a co mamy teraz, jest spora.</p>
<p>Im większy plik, tym ciężej się po nim nawiguję. Wyobraź sobie, że chcesz np. zmienić tylko adres któregoś z endpointów. Aby znaleźć właściwy, bylibyśmy zmuszeni przekopać się przez kilkadziesiąt linijek kodu.</p>
<p>Jest jeszcze inna kwestia. Sama nazwa plików też jest myląca, bowiem <code>.routes.js</code> sugeruje, że w środku znajdą się same route'y, wskazujące tylko jaka funkcja ma się włączyć pod konkretnym adresem. Tymczasem u nas są tu także całe funkcje.</p>
<p>Twoim zadaniem jest więc wydzielenie funkcji od route'ów ze wszystkich <code>.routes.js</code> i przeniesienie ich do osobnych plików.</p>
<p>Idea będzie następująca.</p>
<p>Stworzymy kolejny folder (<code>controllers</code>), w którym będziemy trzymać pliki z grupami funkcji. Niech to będą osobne pliki dla każdej grupy route'ów, np. dla <code>departments.routes.js</code> stworzymy <code>departments.controller.js</code>, a dla <code>products.routes.js</code> – <code>products.controller.js</code>.</p>
<p>W tej chwili w plikach <code>.routes.js</code> do każdego endpointu jest przypięta rozbudowana anonimowa funkcja <code>(req, res) =&gt; { ... }</code>. Nasz pomysł jest taki, aby funkcje te nie były już anonimowe, lecz miały swoją nazwę i były przechowywane w odpowiadającym pliku w folderze <code>controllers</code>. W pliku z route'ami będziemy je tylko importować i przypinać do wybranych endpointów.</p>
<p>Dzięki takiemu zabiegowi znacznie uporządkujemy kod. Chcesz zmodyfikować jakąś funkcjonalność – wchodzisz do plików controllera. Jeśli zamierzasz zmienić tylko jakiś adres, robisz to w bardzo małym pliku z samymi route'ami.</p>
<p>Oczywiście nazywanie grup funkcji jako <code>controllers</code> nie jest obligatoryjne, to tylko jedna z idei widywana czasem w świecie IT. Równie dobrze możesz nazwać sobie ten folder <code>methods</code>, a pliki <code>departments.methods.js</code>.</p>
<p>Nie zapomnij też, że skoro funkcje będą w innym pliku, musimy przenieś do niego również import modeli. Zaciąganie ich w samych plikach z route'ami nie będzie miało już sensu.</p>
<p>Powyższe instrukcje mogą być dla Ciebie jeszcze nie do końca jasne. Aby łatwiej zrozumieć do czego dążymy, pokażemy, jak mógłby wyglądać ten proces modyfikacji na przykładzie <code>departments.routes.js</code>. <strong>Uwaga – pokazujemy tu wersję tego pliku przed modyfikacjami z zadania pierwszego</strong>.</p>
<p>Załóżmy, że plik <code>departments.routes.js</code> wygląda mniej więcej tak:</p>
<pre class=" language-js"><code class=" language-js"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token maybe-class-name">Department</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../models/department.model'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments/random'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">countDocuments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> rand <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">floor</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span>rand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>dep<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token spread operator">...</span></code></pre>
<p>Zgodnie z treścią zadania, utworzylibyśmy więc nowy plik <code>/controllers/departments.controller.js</code> i przenieśli logikę funkcji właśnie do niego. W pliku z route'ami następnie te funkcje byłyby importowane i wykorzystywane.</p>
<p>Całość wyglądałaby tak:</p>
<pre class=" language-js"><code class=" language-js"><span class="token comment">//departments.routes.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token method function property-access"><span class="token maybe-class-name">Router</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">DepartmentController</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../controllers/departments.controller'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments'</span><span class="token punctuation">,</span> <span class="token maybe-class-name">DepartmentController</span><span class="token punctuation">.</span><span class="token property-access">getAll</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
router<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">'/departments/random'</span><span class="token punctuation">,</span> <span class="token maybe-class-name">DepartmentController</span><span class="token punctuation">.</span><span class="token property-access">getRandom</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token spread operator">...</span></code></pre>
<pre class=" language-js"><code class=" language-js"><span class="token comment">//departments.controller.js</span>

<span class="token keyword">const</span> <span class="token maybe-class-name">Department</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../models/department.model'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">getAll</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


exports<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">getRandom</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">countDocuments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> rand <span class="token operator">=</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">floor</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword control-flow">await</span> <span class="token maybe-class-name">Department</span><span class="token punctuation">.</span><span class="token method function property-access">findOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">skip</span><span class="token punctuation">(</span>rand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>dep<span class="token punctuation">)</span> res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Not found'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">else</span> res<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> message<span class="token operator">:</span> err <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token spread operator">...</span></code></pre>
<p>Końcowy efekt byłby zatem taki sam. Serwer pod odpowiednim endpointem wykonywałby dokładnie tę samą funkcjonalność i zwracał te same dane, lub komunikat. My jednak pracowalibyśmy na mniejszych częściach kodu, a wiesz już, że to zawsze dobra idea.</p>

                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <div class="clearfix">
                                                                                <a href="https://kodilla.com/pl/bootcamp-task/407/666337" target="_blank" class="btn btn-info-outline">Podgląd zadania</a>
                            <form target="_blank" class="form-inline project-link-form">
                                <div class="form-group">
                                    <input type="text" name="link" class="form-control" value="https://github.com/skwiryt/companyApp">
                                </div>
                                <button type="submit" class="btn  btn-primary ">Wyślij link <i class="fa fa-check"></i></button>
                            </form>
                                                                                                    </div>
                    </div>
                </section>
                                    
                <section id="submodule-1158" class="card submodule completed" data-bootcamp-user-submodule-id="666338">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">29.5. <span>Mongoose w praktyce</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Czas na sporą dawkę pracy własnej!</p>
<p>Po raz kolejny wrócimy do naszej witryny festiwalu muzycznego. Tym razem Twoim zadaniem będzie takie zmodyfikowanie całej aplikacji, aby zamiast tablicy, wykorzystywała bazy danych MongoDB. Tak naprawdę, nie będzie tu więc nic nowego, dokładnie taki sam proces przeprowadzaliśmy już na naszym gotowym serwerze API z poprzednich submodułów. Teraz będziemy mogli jednak ominąć etap z użyciem paczki <code>mongodb</code> i od razu skorzystamy z Mongoose.</p>
<p>Efektem ma być aplikacja, która <strong>działa tak samo, jak wcześniej, ale "pod maską" korzysta z baz danych MongoDB i paczki Mongoose</strong>.</p>
<p>Na bieżąco możesz korzystać z pomocy Mongo Shell, MongoDB Compass oraz Postmana.</p>
<p>Całą pracę możemy podzielić na kilka etapów.</p>
<h3 id="295-mongoose-w-praktyce-etap-1-przygotowanie-bazy-danych">Etap 1 – przygotowanie bazy danych</h3>
<p>Twoim zadaniem będzie przygotowanie nowej bazy danych – <code>NewWaveDB</code>, dodanie do niej kolekcji <code>testimonials</code>, <code>concerts</code>, <code>seats</code>, a następnie wypełnienie jej tymi samymi danymi, które byłby używane na stronie dotychczas.</p>
<pre class=" language-js"><code class=" language-js">testimonials<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> author<span class="token operator">:</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'This company is worth every coin!'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> author<span class="token operator">:</span> <span class="token string">'Amanda Doe'</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">'They really know how to make you happy.'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
concerts<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> performer<span class="token operator">:</span> <span class="token string">'John Doe'</span><span class="token punctuation">,</span> genre<span class="token operator">:</span> <span class="token string">'Rock'</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> image<span class="token operator">:</span> <span class="token string">'/img/uploads/1fsd324fsdg.jpg'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> performer<span class="token operator">:</span> <span class="token string">'Rebekah Parker'</span><span class="token punctuation">,</span> genre<span class="token operator">:</span> <span class="token string">'R&amp;B'</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> image<span class="token operator">:</span> <span class="token string">'/img/uploads/2f342s4fsdg.jpg'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> performer<span class="token operator">:</span> <span class="token string">'Maybell Haley'</span><span class="token punctuation">,</span> genre<span class="token operator">:</span> <span class="token string">'Pop'</span><span class="token punctuation">,</span> price<span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> image<span class="token operator">:</span> <span class="token string">'/img/uploads/hdfh42sd213.jpg'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
seats<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> seat<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> client<span class="token operator">:</span> <span class="token string">'Amanda Doe'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'amandadoe@example.com'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> seat<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span> client<span class="token operator">:</span> <span class="token string">'Curtis Johnson'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'curtisj@example.com'</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> seat<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> client<span class="token operator">:</span> <span class="token string">'Felix McManara'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'felxim98@example.com'</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> seat<span class="token operator">:</span> <span class="token number">26</span><span class="token punctuation">,</span> client<span class="token operator">:</span> <span class="token string">'Fauna Keithrins'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'mefauna312@example.com'</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> seat<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> client<span class="token operator">:</span> <span class="token string">'Felix McManara'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'felxim98@example.com'</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span> day<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> seat<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> client<span class="token operator">:</span> <span class="token string">'Molier Lo Celso'</span><span class="token punctuation">,</span> email<span class="token operator">:</span> <span class="token string">'moiler.lo.celso@example.com'</span>  <span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Uwaga!</h4>
<p>Przy wprowadzaniu danych, zastanów się, czy da się tę bazę jeszcze znormalizować. Może występują tutaj redundancje albo warto wydzielić jakąś kolejną kolekcję?</p>
<p>Normalizacja nie jest w tym zadaniu wymagana, ale jeśli uważasz, że czujesz się już pewnie w temacie, spróbuj się tym zająć.</p>
</div>
<p>Przy wykonaniu zadania z tego etapu możesz wspomóc się konsolą oraz programem MongoDB Compass.</p>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">mongoimport</h4>
<p>Wprowadzanie tak dużej ilości danych może być czasochłonne, dlatego warto szukać jakiegoś prostego sposobu, który mógłby to przyśpieszyć.</p>
<p>MongoDB Compass oferuje opcję importu pliku JSON jako danych do kolekcji i w teorii właśnie tego szukamy. Moglibyśmy bowiem przygotować z naszych danych pliki JSON dla każdej kolekcji, a potem tylko je zaimportować. Niestety funkcja ta nie zawsze działa poprawnie.</p>
<p>Zamiast tego możesz skorzystać z podobnej funkcjonalności w samej konsoli Mongo Shell:</p>
<pre class=" language-js"><code class=" language-js">mongoimport <span class="token operator">--</span>db <span class="token operator">&lt;</span>dbname<span class="token operator">&gt;</span> <span class="token operator">--</span>collection <span class="token operator">&lt;</span>collection<span class="token operator">-</span>name<span class="token operator">&gt;</span> <span class="token operator">--</span>drop <span class="token operator">--</span>file <span class="token operator">&lt;</span>filename<span class="token operator">&gt;</span></code></pre>
<p>Na przykład:</p>
<pre class=" language-js"><code class=" language-js">mongoimport <span class="token operator">--</span>db booksDB <span class="token operator">--</span>collection boooks <span class="token operator">--</span>file booksData<span class="token punctuation">.</span><span class="token property-access">json</span></code></pre>
<p>Ma ona takie samo działanie. Importuje zawartość pliku JSON do wybranej kolekcji we wskazanej bazie danych.</p>
</div>
<h3 id="295-mongoose-w-praktyce-etap-2-przygotowanie-polaczenie-z-baza-danych">Etap 2 – przygotowanie połączenie z bazą danych</h3>
<p>Czas na przejście do aplikacji. Musisz tak zmodyfikować <code>server.js</code>, aby poprawnie łączył się z naszą bazą danych <code>NewWaveDB</code>. Naturalnie wykorzystaj do tego funkcję <code>connect</code> z Moongoose.</p>
<h3 id="295-mongoose-w-praktyce-etap-3-przygotowanie-modeli">Etap 3 – przygotowanie modeli</h3>
<p>Zanim przejdziemy do kolejnego kroku, a więc modyfikacji samych endpointów, musimy najpierw przygotować schematy struktur danych i modele, które się na nich opierają.</p>
<p>Podobnie jak w przypadku poprzednich submodułów, proponujemy, aby trzymać modele w oddzielnych plikach, w osobnym folderze <code>/models</code>. Jeśli jakieś dane powinny być według Ciebie powiązane relacją, nie zapomnij również o użyciu referencji.</p>
<h3 id="295-mongoose-w-praktyce-etap-4-modyfikacja-endpointow">Etap 4 – modyfikacja endpointów</h3>
<p>Gdy modele są już gotowe, możesz wykorzystać je przy modyfikacji endpointów. Nie będziesz tutaj potrzebować żadnych nowych metod. Te, które już znasz (a poznaliśmy ich naprawdę sporo), spokojnie Ci wystarczą.</p>
<h3 id="295-mongoose-w-praktyce-etap-5-wydzielenie-controllerow">Etap 5 – wydzielenie controllerów</h3>
<p>Na koniec, podobnie jak robiliśmy to już wcześniej, wydziel funkcje przypięte do route'ów do osobnych plików.</p>

                        </div>
                    </div>
                                        <div class="card-block task-card">
                        <h3 id="295-mongoose-w-praktyce-zadanie-gotowe">Zadanie: <span class="task-title">gotowe!</span></h3>
                        <div class="task-content">
                            <p>Gdy zadanie będzie już gotowe, wyślij zmiany na repozytorium, a link prześlij swojemu Mentorowi.</p>
<p><strong>Uwaga – nie wrzucaj zmienionej wersji na Heroku, nie będzie on bowiem w stanie połączyć się z lokalną bazą danych</strong>. Ten przykład ma działać na razie tylko lokalnie.</p>

                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <div class="clearfix">
                                                                                <a href="https://kodilla.com/pl/bootcamp-task/407/666338" target="_blank" class="btn btn-info-outline">Podgląd zadania</a>
                            <form target="_blank" class="form-inline project-link-form">
                                <div class="form-group">
                                    <input type="text" name="link" class="form-control" value="https://github.com/skwiryt/testimonials">
                                </div>
                                <button type="submit" class="btn  btn-primary ">Wyślij link <i class="fa fa-check"></i></button>
                            </form>
                                                                                                    </div>
                    </div>
                </section>
                                    
                <section id="submodule-1159" class="card submodule completed" data-bootcamp-user-submodule-id="666339">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">29.6. <span>MongoDB Atlas – zdalna baza danych</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Jak wspomnieliśmy na końcu poprzedniego submodułu, lokalna baza danych ma jedną poważną wadę – może być używana tylko na naszym komputerze. Oczywiście w większości przypadków to nam nie wystarczy, bo strony czy aplikacje piszemy po to, aby udostępniać je w internecie. Na szczęście jest to problem, który łatwo możemy obejść. Wystarczy, że naszą bazę danych zamiast na lokalnym, postawimy na serwerze zdalnym.</p>
<h3 id="296-mongodb-atlas-zdalna-baza-danych-mongodb-atlas-zdalna-baza-danych">MongoDB Atlas – zdalna baza danych</h3>
<p>Hostować bazę danych zdalnie możemy na kilka sposobów, ale najprostszym z nich będzie skorzystanie z oficjalnej usługi – <strong>MongoDB Atlas</strong>. Pozwala ona na umieszczenie baz danych w chmurze.</p>
<h3 id="296-mongodb-atlas-zdalna-baza-danych-konfiguracja">Konfiguracja</h3>
<p>Przejdźmy do rzeczy!</p>
<p>Zacznij od odwiedzenia oficjalnej <a href="https://www.mongodb.com/cloud/atlas" target="_blank">strony tej usługi</a>. Jeśli korzystasz z niej pierwszy raz (a tak prawdopodobnie jest), wybierz <strong>Start free</strong> i załóż nowe konto.</p>
<p>Darmowa opcja ma sporo ograniczeń, włącznie z dość małą przestrzenią na dane (512MB), dla nas będzie jednak wystarczająca. Jak widzisz, normalizacja danych w celu zaoszczędzenia miejsca może mieć swój sens.</p>
<p>Po zalogowaniu możemy zabrać się za przygotowanie clustera (czyli po prostu serwera) dla naszej bazy danych. Jeśli to Twoje pierwsze zetknięcie z tą platformą, automatycznie przekieruje Cię ona do zakładki <strong>Create New Cluster</strong>.</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas.png" alt="image" style="width: auto;"></a>
<p>Zaczniemy od wyboru chmury, z której skorzystamy. Darmowe serwery znajdują się zarówno w opcji AWS (Amazon Web Services), Google Cloud Platform, jak i Azure (Microsoft). Do naszego przykładu, możesz zdecydować się na dowolną z nich. Następnie wybierz jeszcze jeden z darmowych clusterów.</p>
<div class="bc-note alert-info">
<h4 class="alert-heading text-center">Czy cluster jest darmowy?</h4>
<p>To, czy dany cluster posiada jeszcze darmową przestrzeń, jest komunikowane poprzez etykietkę <strong>Free Tier Available</strong>. Wybieraj więc z clusterów, przy których widzisz właśnie ten komunikat.</p>
</div>
<p>Gdy wybierzesz już jedną z darmowych opcji, przejdź do zakładki <strong>Cluster Tier</strong> i upewnij się, że zaznaczono darmową opcję. Jeśli nie, to wybierz właśnie ją.</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas2.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas2.png" alt="image" style="width: auto;"></a>
<p>Teraz w dolnym boksie powinna widnieć informacja <strong>Free</strong>. Oznacza to, że możemy za darmo przejść dalej! Kliknij na przycisk <strong>Create Cluster</strong>, aby kontynuować.</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas3.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas3.png" alt="image" style="width: auto;"></a>
<h3 id="296-mongodb-atlas-zdalna-baza-danych-dodajemy-uzytkownika-bazy">Dodajemy użytkownika bazy</h3>
<p>W następnym kroku platforma przekieruje nas do panelu administracyjnego. Sam cluster nie jest gotowy do pracy od zaraz. Jego przygotowanie przez system może zająć od 7 do 10 minut, o czym informuje nas sam dashboard.</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas4.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas4.png" alt="image" style="width: auto;"></a>
<p>Nie musimy jednak bezczynnie czekać. W tym czasie zajmiemy się dalszą konfiguracją i stworzymy użytkownika, który będzie łączył się z naszą bazą. Jest to operacja, którą proponuje dashboard.</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas5.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas5.png" alt="image" style="width: auto;"></a>
<p>Po kliknięciu na wskazany przycisk, panel sam zacznie wskazywać Ci drogę w odpowiednie miejsce. Jeśli jednak z jakiegoś powodu powyższy box nie jest u Ciebie dostępny, poniżej przedstawiamy również instrukcję tekstową:</p>
<ol>
<li>Wejdź w zakładkę <strong>Database Access</strong>.</li>
<li>Następnie odnajdź przycisk <strong>Add New User</strong> i kliknij na niego.</li>
</ol>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Użytkownik bazy danych</h4>
<p>Warto powiedzieć teraz kilka słów, o co w ogóle w tym chodzi. Bardzo często bazy danych mogą być obsługiwane przez kilka osób oraz różną ilość aplikacji. Niekoniecznie chcielibyśmy, aby każda z nich miała pełny dostęp do wszystkich operacji. Wyobraź sobie, że zatrudniasz stażystę, który ma wprowadzić do bazy jakąś kolekcję rekordów. Czy chcielibyśmy, aby miał dostęp do operacji <code>delete</code> czy <code>drop</code>? Raczej nie. Pewnie wolelibyśmy nadać mu tylko uprawnienia do używania <code>insertMany</code> i <code>insertOne</code>.</p>
<p>Każdy użytkownik może mieć inne uprawnienia, dzięki czemu jesteśmy w stanie decydować komu i w jakim zakresie zezwalamy na pracę z naszą bazą danych.</p>
</div>
<p>Po wybraniu tej opcji Twoim oczom ukaże się panel <strong>Add New User</strong>:</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas6.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas6.png" alt="image" style="width: auto;"></a>
<p>Wybór nazwy oraz hasła pozostawiamy Tobie. Jeśli chodzi o wybranie opcji dostępu, nasz użytkownik potrzebuje pełni możliwości. Musi być w stanie dodawać, modyfikować, ale również i usuwać dane. Wybierz więc opcję <strong>Atlas Admin</strong>.</p>
<p>Następnie kliknij na przycisk <strong>Add User</strong>, aby dokończyć operację. Jeśli wszystko poszło dobrze, to panel w aktualnej liście użytkowników, pokaże również tego, który właśnie został utworzony.</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas7.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas7.png" alt="image" style="width: auto;"></a>
<h3 id="296-mongodb-atlas-zdalna-baza-danych-akceptowanie-polaczen-z-zewnatrz">Akceptowanie połączeń z zewnątrz</h3>
<p>Po dodaniu użytkownika dashboard proponuje nam kolejny krok – <strong>Whitelist your IP address</strong>. O co w tym chodzi?</p>
<p>Zdalny serwer bazy danych będzie musiał być dostępny dla naszej aplikacji w dwóch miejscach – lokalnie oraz na serwerze Heroku. Nie chcielibyśmy jednak, aby inne serwery również miały do niego dostęp. Platforma pozwala więc decydować, kto może się z nim połączyć. Służy do tego właśnie funkcjonalność <strong>białej listy</strong>.</p>
<p>Kliknij więc w przycisk <strong>Whitelist your IP address</strong> w boksie <strong>Get Started</strong> i podążaj za instrukcjami pokazywanymi przez panel. Ponownie, jeśli nie widzisz tego boksa, poniżej przedstawiamy instrukcję tekstową:</p>
<ol>
<li>Wejdź w zakładkę <strong>Network Access</strong> (blok <strong>Security</strong>).</li>
<li>Kliknij na przycisk <strong>Add IP address</strong>.</li>
</ol>
<p>Twoim oczom powinien ukazać się poniższy panel:</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas8.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas8.png" alt="image" style="width: auto;"></a>
<p>Mamy tu kilka możliwości:</p>
<ul>
<li>Możemy ustawić opcję <strong>Allow access from anywhere</strong>, która pozwala na dostęp dla każdego. Jest to dość wygodne na czas testów, na pewno nie chcielibyśmy jednak zostawiać tego dla gotowej aplikacji.</li>
<li>Istnieje również opcja <strong>Add current IP address</strong>, która powinna ustalić Twój adres IP i zezwolić na dostęp właśnie z niego. Może to być dobry wybór przy próbie przetestowania, czy nasza aplikacja będzie w stanie połączyć się z clusterem lokalnie.</li>
<li>Trzecia możliwość to <strong>wpisanie adresu IP ręcznie</strong>. Jest to idealna opcja, gdy posiadamy już serwer zdalny dla naszej aplikacji i znamy jego adres IP.</li>
</ul>
<p>Hosting Heroku ma tę wadę, że niestety w darmowym pakiecie nie oferuje stałego IP i nie możemy niestety skorzystać z potencjalnie najlepszej trzeciej opcji. Zamiast tego wybierz pierwszą – <strong>Allow access from anywhere</strong>. Niemniej jednak w komercyjnym projekcie, skorzystalibyśmy z opcji numer 3.</p>
<h3 id="296-mongodb-atlas-zdalna-baza-danych-ladowanie-poczatkowych-danych">Ładowanie początkowych danych</h3>
<p>Dashboard proponuje jeszcze załadowanie testowych danych, my jednak wolelibyśmy dodać swoje własne, najlepiej dokładnie takie, jakie mamy teraz lokalnie. To będzie już Twoim zadaniem na później.</p>
<p>Proces konfiguracji MongoDB Atlas dobiegł końca.</p>
<h3 id="296-mongodb-atlas-zdalna-baza-danych-mongodb-atlas-integracja-z-nasza-aplikacja">MongoDB Atlas – integracja z naszą aplikacją</h3>
<p>Nasza aplikacja nadal korzysta z lokalnej bazy danych MongoDB, ale naszedł czas, by to zmienić!</p>
<p>Zaczniemy od sprawdzenia jaki jest link do serwera bazy danych. W dashboardzie MongoDB Atlas, kliknij opcję <strong>Connect to Your Cluster</strong> w boksie <strong>Get Started</strong> i podążaj za wskazówkami w panelu, lub przeczytaj naszą instrukcję tekstową:</p>
<ol>
<li>Wejdź w zakładkę <strong>Clusters</strong>.</li>
<li>Odnajdź swój cluster.</li>
<li>Kliknij na przycisk <strong>Connect</strong>.</li>
</ol>
<div class="bc-note alert-warning">
<h4 class="alert-heading text-center">Uwaga!</h4>
<p>Aby połączenie stało się możliwe, cluster musi być już przygotowany. Jeśli więc w tym miejscu wciąż pojawia się komunikat o tworzeniu clustera przez system, odczekaj, aż będzie on gotowy.</p>
</div>
<p>Po wybraniu opcji <strong>Connect</strong> panel pokaże nam następujące okno:</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas9.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas9.png" alt="image" style="width: auto;"></a>
<p>Możemy zdecydować, jaką opcję połączenia zastosujemy. Wybierz <strong>Connect Your Application</strong>. Następna zakładka zapyta nas o wybrany silnik, który został zastosowany w naszej aplikacji, musimy też wskazać jego wersję. U nas to oczywiście <strong>Node.js</strong> i wersja <strong>nowsza niż 3.0</strong>.</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas10.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas10.png" alt="image" style="width: auto;"></a>
<p>W wyniku otrzymujemy "Connection String", który wykorzystamy za chwilę do integracji naszej aplikacji ze zdalną bazą danych.</p>
<a href="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas11.png" class="img-modal-group"><img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/MongoAtlas11.png" alt="image" style="width: auto;"></a>

                        </div>
                    </div>
                                        <div class="card-block task-card">
                        <h3 id="296-mongodb-atlas-zdalna-baza-danych-zadanie-zmieniamy-baze-danych">Zadanie: <span class="task-title">zmieniamy bazę danych</span></h3>
                        <div class="task-content">
                            <p>Zdalna baza danych już istnieje. Twoim zadaniem jest teraz połączenie się z nią w naszej aplikacji (zamiast z bazą lokalną) oraz załadowanie wszystkich danych.</p>
<p><strong>Zadanie 1</strong></p>
<p>Pierwsze zadanie będzie stosunkowo proste. Masz już bowiem przygotowany "Connection String", wystarczy wstawić go w miejsce naszego adresu lokalnego w funkcji <code>connect</code>.</p>
<p>Od tej chwili aplikacja nie będzie korzystać już lokalnej bazy danych, tylko zdalnej. Spróbuj uruchomić serwer i sprawdź, czy nie pokaże żadnych błędów.</p>
<div class="bc-note alert-success">
<h4 class="alert-heading text-center">Uwaga</h4>
<p>Przechowywanie "Connection String" w pliku (np. <code>server.js</code>) nie jest idealnym rozwiązaniem, bo taki plik jest przecież wysyłany na repo (często publiczne). Na razie tym się nie przejmuj, jak zrobić to inaczej opowiemy w kolejnych częściach kursu, gdy wspomnimy o bezpieczeństwie aplikacji.</p>
</div>
<p><strong>Zadanie 2</strong></p>
<p>Niestety nasza zdalna baza danych jest jeszcze pusta. Twoim zadaniem jest dodanie do niej odpowiednich informacji.</p>
<p>Możesz to robić pojedynczo, wchodząc w zakładkę <strong>Clusters</strong>, a potem wybierając opcję <strong>Collections</strong>. MongoDB Atlas pozwala na bardzo podobne operowanie bazą jak MongoDB Compass.</p>
<p>Możesz także skusić się na opcję importu z plików JSON. Więcej o tym <a href="https://docs.atlas.mongodb.com/import/mongoimport/" target="_blank">tutaj</a>.</p>
<p>Jak to zrobisz, zależy tylko od Ciebie. Efekt powinien być jednak taki, iż w zdalnej bazie danych będą dokładnie te same kolekcje i dane, jakie mieliśmy dotychczas w lokalnej.</p>

                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <div class="clearfix">
                                                                                <a href="https://kodilla.com/pl/bootcamp-task/407/666339" target="_blank" class="btn btn-info-outline">Podgląd zadania</a>
                            <form target="_blank" class="form-inline project-link-form">
                                <div class="form-group">
                                    <input type="text" name="link" class="form-control" value="https://github.com/skwiryt/testimonials">
                                </div>
                                <button type="submit" class="btn  btn-primary ">Wyślij link <i class="fa fa-check"></i></button>
                            </form>
                                                                                                    </div>
                    </div>
                </section>
                                    
                <section id="submodule-1160" class="card submodule completed" data-bootcamp-user-submodule-id="666340">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">29.7. <span>Podsumowanie</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Przed tym modułem mogło Ci się wydawać, że bazy danych tak naprawdę nie są nam do niczego potrzebne. W końcu pisaliśmy już aplikacje i jakoś sobie bez nich radziliśmy.</p>
<p>Mamy nadzieję jednak, że niniejszy moduł zmienił Twoje postrzeganie. Bazy danych są potrzebne, a często wręcz niezbędne i od tego tematu zwyczajnie nie da się uciec. Prędzej czy później natrafisz na takie sytuacje, w których brak zaawansowanej bazy danych będzie nie do przejścia.</p>
<p>Chyba zgodzisz się z tym, że bazy danych (w wydaniu MongoDB) wcale nie są aż tak straszne w odbiorze. Z pomocą Mongoose byliśmy w stanie operować na nich dość łatwo, czasem nawet prościej niż na zwykłych tablicach. Dodawanie danych, usuwanie, modyfikacja – wszystko sprowadzało się do bardzo intuicyjnych komend. MongoDB wraz z Mongoose możemy uznać więc za narzędzie nie tylko potrzebne, ale też bardzo miłe w odbiorze, które chętnie będziesz wykorzystywać również w przyszłości.</p>
<p>Z modułu na moduł, możesz mieć wrażenie, że nasze aplikacje stają się coraz bardziej rozbudowane. Dzięki temu ich możliwości są większe, ale też coraz częściej nie czujemy się już w nich pewnie. Przydałyby się jakieś testy, prawda? Właśnie tym, a więc testowaniem kodu po stronie backendu, zajmiemy się w kolejnym module.</p>

                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <small>Jeśli masz wątpliwości do powyższego materiału, to - zanim zatwierdzisz - zapytaj na czacie :)</small>
                                                <div class="clearfix">
                                                                                <button class="btn  btn-primary "><i class="fa fa-check"></i><span>Zapoznałe(a)m się!</span></button>
                                                                                                    </div>
                    </div>
                </section>
                                    
                <section id="submodule-1161" class="card submodule completed" data-bootcamp-user-submodule-id="666341">
                <!-- klasy dla section: completed current comments -->
                    <div class="card-block submodule-header clearfix">
                        <i class="fa fa-check-circle-o fa-2x"></i>
                        <i class="fa fa-play-circle-o fa-2x"></i>
                        <i class="fa fa-exclamation-circle fa-2x"></i>
                        <i class="fa fa-send-o fa-2x"></i>
                        <h2 class="bootcamp-submodule-name">29.8. <span>Quiz powtórkowy</span></h2>
                                            </div>
                    <div class="card-block">
                        <div class="submodule-content">
                            <p>Na koniec tego modułu przygotowaliśmy dla Ciebie quiz powtórkowy. Pomoże Ci on powtórzyć wiedzę z poprzednich modułów.</p>
<p>Odpowiedzi tego quizu nie są nigdzie zapisywane, więc są tylko do Twojej wiadomości. Ten quiz ma Ci posłużyć jako pomoc w nauce – dlatego pod każdym pytaniem znajdziesz guzik, który sprawdzi poprawność Twoich odpowiedzi oraz poda Ci wyjaśnienie zagadnienia poruszanego w tym pytaniu.</p>
<p>Tym razem tylko jedno pytanie, ale za to wymagające odrobiny przemyślenia...</p>

        <div class="kodilla-quiz">
      
        <article class="question initiated" data-type="multiple-choice">
      
        <header>
          <p>Wybierz przypadki, w których warto skorzystać z WebSocketa:</p>

        </header>
        <ol type="a" class="answers" data-correct="2,3,6,7">
          <li><label><input type="checkbox"> strona produktu w sklepie internetowym</label></li>
<li><label><input type="checkbox"> artykuł na blogu</label></li>
<li><label><input type="checkbox"> czat</label></li>
<li><label><input type="checkbox"> aukcja internetowa</label></li>
<li><label><input type="checkbox"> prognoza pogody</label></li>
<li><label><input type="checkbox"> ankieta </label></li>
<li><label><input type="checkbox"> gra typu multiplayer</label></li>
<li><label><input type="checkbox"> panel rezerwacji miejsc w kinie</label></li>
        </ol>
        <div class="buttons text-center">
          <button class="button-ok btn btn-primary">Sprawdź odpowiedź</button>
        </div>
      
      
        <div class="explanation">
          <div class="bc-note alert-success">
            <h4 class="alert-heading text-center">Wyjaśnienie</h4>
      <p>To pytanie jest bardzo trudne, więc nie przejmuj się, jeśli nie udało Ci się zaznaczyć wszystkich poprawnych odpowiedzi.</p>
<p>Cały problem polega na tym, że teoretycznie każdy z tych przypadków można obsłużyć bez WebSocketa, opierając się wyłącznie na zapytaniach ajaxowych. Z drugiej strony, moglibyśmy stosować WebSocket do wszystkich połączeń z serwerem. Jak w takim razie możemy znaleźć złoty środek?</p>
<p>Warto pamiętać, że aplikacja oparta o WebSocket będzie zwykle droższa w utrzymaniu. W związku z tym zdecydujemy się na to rozwiązanie tylko wtedy, kiedy dla użytkownika kluczowa będzie prędkość komunikacji.</p>
<p>Zacznijmy od czatu i gry multiplayer – w tym wypadku wiele osób komunikuje się ze sobą i będą oczekiwać, że komunikacja będzie "na żywo", więc na pewno warto by było zastosować WebSocket.</p>
<p>Z drugiej strony mamy stronę produktu w sklepie, artykuł na blogu, prognozę pogody czy ankietę – tu treści będą zmieniać się bardzo rzadko, a serwer rzadko będzie musiał powiadomić klienta o jakiejś zmianie.</p>
<p>Największy problem mielibyśmy przy decyzji dotyczącej aukcji internetowej czy panelu rezerwacji miejsc w kinie – tutaj WebSocket pozwoliłby na zwiększenie wygody użytkowania, ale z drugiej strony wymagałby znacznie większych nakładów. O ile ostateczna decyzja byłaby trudna, to możemy przynajmniej powiedzieć, że użycie WebSocketa dałoby jakąś wartość – i dlatego oznaczyliśmy te odpowiedzi jako poprawne.</p>

          </div>
        </div>
      
        </article>
      
        </div>
        
<style>
  .kodilla-quiz .question {
    margin-bottom: 1.5em;
  }
  .kodilla-quiz .explanation {
    display: none;
  }
  .kodilla-quiz li>label {
    display: inline-block;
    padding-top: 1px;
    vertical-align: top;
  }
</style>
<script>
  if(typeof initQuizzes == 'undefined'){
    function initQuizzes(){
      var types = {
        'multiple-choice': initMultipleChoice,
      };

      var questions = document.querySelectorAll('.kodilla-quiz .question');

      for(var i=0; i<questions.length; i++){
        var question = questions[i];
        var initFunc = types[question.dataset.type];

        if(typeof(initFunc) != 'undefined' && !question.classList.contains('initiated')){
          question.classList.add('initiated');
          initFunc(question);
        }
      }
    }

    function initMultipleChoice(question){
      var answers = question.querySelector('.answers');
      var inputs = answers.querySelectorAll('input');
      var buttons = question.querySelector('.buttons');
      var buttonOK = buttons.querySelector('.button-ok');
      var explanation = question.querySelector('.explanation');
      var correct = question.querySelector('[data-correct]').dataset.correct.split(',');

      buttonOK.addEventListener('click', function(e){
        e.preventDefault();

        var inputsChecked = answers.querySelectorAll('input:checked');
        if(inputsChecked.length == 0){
          alert('Wybierz co najmniej jedna odpowiedź');
          return;
        }

        correct.forEach(function(index){
          inputs[index].parentNode.parentNode.classList.add('text-success', 'text-bold');
        });

        for (var i = 0; i < inputs.length; i++) {
          var input = inputs[i];
          var li = input.parentNode.parentNode;
          input.setAttribute('disabled', true);
          
          if(input.checked){
            li.classList.add('text-bold');
            
            if(!li.classList.contains('text-success')){
              li.classList.add('text-danger');
            }
          }

        }
        
        if(explanation) explanation.style.display = 'block';
        buttons.setAttribute('hidden', true);
      });
    }
  }
  initQuizzes();
</script>

      
                        </div>
                    </div>
                                        <div class="card-block submodule-footer clearfix  completed ">
                                                <small>Jeśli masz wątpliwości do powyższego materiału, to - zanim zatwierdzisz - zapytaj na czacie :)</small>
                                                <div class="clearfix">
                                                                                <button class="btn  btn-primary "><i class="fa fa-check"></i><span>Zapoznałe(a)m się!</span></button>
                                                                                                    </div>
                    </div>
                </section>
                            </main>
        </div>
    </section>
</main>
;
<script async="" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/ei.js"></script>
<script type="text/x-translation" data-translation-name="SentBootcampLinkReviewFormMessage">Wysłano link do zatwierdzenia</script>
    <div id="alerts">
    <div class="alert alert-danger" role="alert" style="display: none;">
        <i class="fa fa-exclamation" aria-hidden="true"></i>
        <button type="button" class="close" data-hide="alert" aria-label="Zamknij">
            <span aria-hidden="true">×</span>
            <span class="sr-only">Zamknij</span>
        </button>
        <ul>
                        </ul>
    </div>
    <div class="alert alert-success" role="alert" style="display: none;">
        <i class="fa fa-check" aria-hidden="true"></i>
        <button type="button" class="close" data-hide="alert" aria-label="Zamknij">
            <span aria-hidden="true">×</span>
            <span class="sr-only">Zamknij</span>
        </button>
        <ul>
                </ul>
    </div>
    <div class="alert alert-warning" role="alert" style="display: none;">
        <i class="fa fa-warning" aria-hidden="true"></i>
        <button type="button" class="close" data-hide="alert" aria-label="Zamknij">
            <span aria-hidden="true">×</span>
            <span class="sr-only">Zamknij</span>
        </button>
        <ul>
                </ul>
    </div>
    <div class="alert alert-info" role="alert" style="display: none;">
        <i class="fa fa-info" aria-hidden="true"></i>
        <button type="button" class="close" data-hide="alert" aria-label="Zamknij">
            <span aria-hidden="true">×</span>
            <span class="sr-only">Zamknij</span>
        </button>
        <ul>
                    </ul>
    </div>
    <div class="container">
        <div class="alert alert-notify" role="alert" style="display: none;">
            <i class="fa fa-info" aria-hidden="true"></i>
            <button type="button" class="close" data-hide="alert" aria-label="Zamknij">
                <span aria-hidden="true">×</span>
                <span class="sr-only">Zamknij</span>
            </button>
            <ul>
                            </ul>
        </div>
    </div>
</div>
    <div class="modal fade informator-modal" id="informator" tabindex="-1" role="dialog" aria-labelledby="informatorModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <img src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/logo-menu.png" alt="Logo Kodilla" class="brand-logo">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i class="fa fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="modal-body content-container">
                <h3>Zamów szczegółowy informator</h3>
                <form class="row js-ajax-form" data-view-class="InformatorForm" action="https://kodilla.com/pl/download-informator" method="post">
                    <input type="hidden" name="ga-pobieranie-informatora-z-modala" value="wypelnienie">
                    <input type="hidden" name="tags[0]" value="informator">
                                        <div class="user-data-container">
                        <input type="text" class="form-control" name="firstname" placeholder="Imię">
                        <input type="text" class="form-control" name="surname" placeholder="Nazwisko">
                    </div>
                    <div class="user-data-container">
                        <input type="email" class="form-control" name="email" placeholder="Email" required="">
                        <input type="tel" class="form-control" name="phone" placeholder="Numer telefonu" pattern="^([\+][0-9]{1,3}([ \.\-])?)?([\(]{1}[0-9]{3}[\)])?([0-9 \.\-]{1,15})$" title="Wpisz poprawny numer telefonu, np. 453 674 897" minlength="9" maxlength="15" data-custom-message="Wpisz poprawny numer telefonu, np. 453 674 897">
                    </div>
                    <div class="terms-box">
                        <label>
                            <input name="accept_terms" value="true" data-custom-message="Prosimy o zaakceptowanie regulaminu" type="checkbox" class="form-control input-checkbox" required="">
                            <span>Akceptuję <a target="_blank" href="https://kodilla.com/pl/regulamin">regulamin</a>  i nie wnoszę zastrzeżeń</span>
                        </label>
                    </div>
                    <div class="personal-terms-box">
                        <label>
                            <input name="accept_marketing" value="true" data-custom-message="Jeśli chcesz otrzymać dostęp do materiałów, konieczna jest akceptacja obydwu zgód" type="checkbox" class="form-control input-checkbox" required="">
                            <span>Chcę otrzymywać newsletter, informacje o promocjach i produktach dostępnych w Kodilla.
                                <span class="details-button" data-action="show-details" data-identifier="personal-terms-details-informator">Czytaj więcej</span>
                                <span class="display-none" data-identifier="personal-terms-details-informator">Wyrażam zgodę na otrzymywanie informacji handlowych od Kodilla na podany przeze mnie adres e-mail. Zgoda jest dobrowolna, jednakże niezbędna do otrzymywania informacji o produktach, promocjach i o tym, co u nas słychać. Administratorem danych jest Codemy S.A. z siedzibą we Wrocławiu, Plac Powstańców Śląskich 13/4. Mam prawo cofnąć zgodę w każdym czasie, jednak wtedy nie będę otrzymywać informacji. Dane mogą być przetwarzane pomimo cofnięcia zgody wyłącznie w takim zakresie i celu, w jakim ich przetwarzanie jest niezbędne do ustalenia, dochodzenia lub obrony roszczeń Administratora w związku z udzieloną zgodą. Mam prawo dostępu do danych, sprostowania, usunięcia, ograniczenia przetwarzania, prawo wniesienia sprzeciwu, skargi do organu nadzorczego i przeniesienia danych. Szczegółowe informacje znajdują się na stronie kodilla.com, zakładka "Polityka Prywatności".</span>
                            </span>
                        </label>
                    </div>
                    <div class="display-none">
                        <input type="text" name="myName" value="">
                    </div>
                    <div class="">
                        <button type="submit" class="btn btn-primary">
                            Pobierz Informator
                            <i data-role="loading-icon" class="fa fa-spinner fa-spin fa-1x fa-fw display-none"></i>
                        </button>
                    </div>
                </form>
                <a href="https://kodilla.com/pl/informator" id="informator-link" target="_blank" class="display-none"></a>
            </div>
            <div class="modal-footer">
                <p>Pobranie informatora do niczego nie zobowiązuje</p>
            </div>
        </div>
    </div>
</div>
<footer class="site-footer">
                <section class="footer-lower">
            <nav class="container">
                <a class="navbar-img" href="https://kodilla.com/pl">
                    <svg id="kodilla-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 168 29.553" width="168" height="30">
                        <defs>
                            <style>
                                .footer-logo-fill {
                                    fill: #fff;
                                }
                            </style>
                        </defs>
                        <g id="Group_1" data-name="Group 1" transform="translate(23.59)">
                            <path id="KODILLA_copy_5_1_" class="footer-logo-fill" d="M78.058,0a14.758,14.758,0,1,0,.075,0Zm0,23.739a8.939,8.939,0,0,1-8.944-8.907V14.8c0-4.957,4.584-.708,8.907-.708,4.919,0,9.019-4.211,9.019.708a8.978,8.978,0,0,1-8.981,8.944Z" transform="translate(-63.3)"></path>
                            <ellipse id="eye_copy_4_1_" class="footer-logo-fill" cx="3.876" cy="3.876" rx="3.876" ry="3.876" transform="translate(9.462 13.2) rotate(-28.436)"></ellipse>
                        </g>
                        <path id="Path_1" data-name="Path 1" class="footer-logo-fill" d="M0,29.819V.9H6.671V13.347L17.255.9h7.491L13.938,13.794,25.491,29.819h-7.6l-8.2-11.665-3.019,3.13v8.5H0Z" transform="translate(0 -0.565)"></path>
                        <path id="Path_2" data-name="Path 2" class="footer-logo-fill" d="M151.4,29.819V.9h10.807a15.515,15.515,0,0,1,6.261,1.155,12.966,12.966,0,0,1,4.509,3.093A12.918,12.918,0,0,1,175.7,9.732a17.245,17.245,0,0,1,.932,5.59,16.821,16.821,0,0,1-1.006,5.963,12.227,12.227,0,0,1-2.907,4.547,13.484,13.484,0,0,1-4.547,2.944,15.964,15.964,0,0,1-5.925,1.043Zm18.41-14.5a11.274,11.274,0,0,0-.522-3.466,7.723,7.723,0,0,0-1.491-2.72,6.616,6.616,0,0,0-2.385-1.752,8.055,8.055,0,0,0-3.205-.6h-4.1v17.18h4.1a7.985,7.985,0,0,0,3.242-.634,6.8,6.8,0,0,0,2.385-1.826,8.286,8.286,0,0,0,1.453-2.72A11.634,11.634,0,0,0,169.81,15.322Z" transform="translate(-94.978 -0.565)"></path>
                        <path id="Path_3" data-name="Path 3" class="footer-logo-fill" d="M228.3,29.819V.9h6.671V29.819Z" transform="translate(-143.219 -0.565)"></path>
                        <path id="Path_4" data-name="Path 4" class="footer-logo-fill" d="M259.9,29.819V.9h6.671V23.968h14.012v5.851Z" transform="translate(-163.043 -0.565)"></path>
                        <path id="Path_5" data-name="Path 5" class="footer-logo-fill" d="M327.371,23.931V.9H320.7V29.819h18.522l2.124-5.851H327.371Z" transform="translate(-201.185 -0.565)"></path>
                        <path id="Path_6" data-name="Path 6" class="footer-logo-fill" d="M388.547.9h6.037L405.13,29.819h-6.857l-2.236-6.484h-9.019l-2.2,6.484H378Zm6.373,17.851L391.528,8.54l-3.466,10.211Z" transform="translate(-237.13 -0.565)"></path>
                    </svg>
                </a>
                <ul class="nav">
                    <li>
                        <a href="https://kodilla.com/pl/regulamin" rel="nofollow">Regulamin</a>
                    </li>
                    <li>
                        <a href="https://kodilla.com/pl/polityka-prywatnosci" rel="nofollow">Polityka prywatności</a>
                    </li>
                    <li class="nav-item nav-item-last">© 2021 Kodilla</li>
                </ul>
            </nav>
        </section>
    </footer>

<!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KN2WWBH" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/jquery-2.1.4.min.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/js.cookie-2.1.0.min.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/jquery-dateFormat.min.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/bootstrap.min.js"></script>
<script>
    (function () {
        $(document).ready(function () {
            if (window.location.hash === '#informator-modal') {
                showInformator();
            }
        });

        $('[data-action="show-modal"]').click(function() {
            showInformator();
        });

        function showInformator() {
            $('#informator').modal('show');
        }
    })();
</script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/fb-412414a519.js" async=""></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/call-us-261b222cf4.js"></script>
<script>
    if (document.querySelector('main.editor')) {
        document.querySelector('body').classList.add('editor');
    }
</script>

<script type="text/javascript" async="">
  setTimeout(function (){
      (function(e,t,o,n,p,r,i){e.visitorGlobalObjectAlias=n;e[e.visitorGlobalObjectAlias]=e[e.visitorGlobalObjectAlias]||function(){(e[e.visitorGlobalObjectAlias].q=e[e.visitorGlobalObjectAlias].q||[]).push(arguments)};e[e.visitorGlobalObjectAlias].l=(new Date).getTime();r=t.createElement("script");r.src=o;r.async=true;i=t.getElementsByTagName("script")[0];i.parentNode.insertBefore(r,i)})(window,document,"https://diffuser-cdn.app-us1.com/diffuser/diffuser.js","vgo");
      vgo('setAccount', '649095895');
      vgo('setTrackByDefault', true);

      vgo('process');
  }, 3000);

</script>

<script>
    document.addEventListener("DOMContentLoaded", yall);
    window.environment = 'production';
    window.loggedIn = true;
    window.domain = 'https://kodilla.com';
            window.fbAppId = 1449248938627896;
    window.chatService = 'LiveAgent';
    window.useMessenger = window.chatService === 'Messenger';
    window.locale = 'pl';
    window.lang = 'pl';

    window.serverUTC       = 1627846166000;
    window.serverOffset    = 120;
    window.userDate        = new Date();
    window.userUTC         = userDate.getTime();
    window.userOffset      = userDate.getTimezoneOffset() * (-1);
    window.userClockDiff   = userUTC - serverUTC;
    window.diffRounded     = Math.round( userClockDiff / ( 1000 * 60 * 15 ) );
    window.isDifferentZone = ( userOffset - serverOffset !== 0 ) ? 1 : 0;
    window.hasWrongTime    = ( diffRounded !== 0 ) ? 1 : 0;
    window.dateTooltipText = 'Data i godzina są podane dla Twojej strefy czasowej GMT. <br>W razie wątpliwości napisz: <u>support@kodilla.com</u>.';
    window.wrongHourNotice = 'Godzina na Twoim urządzeniu r&oacute;żni się od godziny obowiązującej w strefie czasowej wybranej w ustawieniach Twojego urządzenia.';

    window.PAYU_HASH_ALGORITHM = 'SHA-256';
    window.PAYU_POS_ID = 1429452;
    window.PAYU_MD5_SECOND_KEY = 'f3627be5fab5a4238c8474936f057908';

    var moment = undefined,
        momentReady = function( method, method2, count ){
            var c = ( count ) ? count : 0;

            if      ( isDifferentZone && moment !== undefined ){
                if      ( method ) { method(); }
                else    { return false; }
            }
            else if ( isDifferentZone && moment === undefined ) {
                if ( c < 20 ) {
                    c++;
                    setTimeout( function() { momentReady( method, method2, c ); }
                        , 300 );
                } else {
                    if      ( method2 === true && method )  { method(); }
                    else if ( method2 !== true && method2 ) { method2(); }
                }
            }
            else {
                if      ( method2 === true && method )  { method(); }
                else if ( method2 !== true && method2 ) { method2(); }
                else    { return false; }
            }
        };

    if ( window.isDifferentZone && moment === undefined ) {
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = '/static/js/libs/moment.timezone.locales.min.js?v=2.22.2';
        document.getElementsByTagName("head")[0].appendChild(script);
    }
</script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/OneSignalSDK.js" async=""></script>
<script>
    var OneSignal = window.OneSignal || [];
    OneSignal.push(function() {
        OneSignal.init({
            appId: "92552bb5-b477-4ea2-8260-dba65be198d9",
        });
    });
</script>
<script data-ad-client="ca-pub-9483216428129091" async="" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/f.txt"></script>
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:2404285,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
        <script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/underscore-min.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/backbone-min.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/backbone-relational.min.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/backbone-super.min.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/handlebars-v4.0.5.min.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/handlebars-ifCond-139a2339f7.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/application-0dcfdc1306.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/main-cf3b73d734.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/settings-5fc44a761b.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/delete-account-da2b3de486.js"></script>
<script type="text/x-translation" data-translation-name="checkAccountDeleteCalculationMessage">Wynik jest nieprawidłowy</script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/forms-222ea01b08.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/alerts-66650c3acb.js"></script>
<script>
    App.Views.InpageAlertManager = Backbone.View.extend({
        events: {
            'click [data-alert-type][data-alert-text]': 'showAlert'
        },
        showAlert: function(e) {
            var $el = $(e.currentTarget);
            App.alertsView['show'+$el.data('alertType')]([App.Translations($el.data('alertText'))]);
        }
    });
</script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/collections-c07e1162e2.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/models-4e0e4fcffb.js"></script>
<script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/knowledge-base-61f71273c9.js"></script>
<script>
    App.Views.LearningProgram = Backbone.View.extend({
        events: {
            'click [data-technology-desc-expander]' : 'expandTechnologyDesc'
        },

        initialize: function() {
            this.$allTechnologyDesc = this.$el.find('[data-technology-desc]');
            this.$allTechnologyExpanderIcons = this.$el.find('[data-technology-expander-icon]');
        },

        expandTechnologyDesc: function() {
            this.$allTechnologyDesc.each(function(){
                var $desc = $(this);
                $desc.slideToggle('fast');
            });
            this.$allTechnologyExpanderIcons.each(function(){
                var $icon = $(this);
                $icon.toggleClass("fa-minus");
            });
        },
    });
</script>

    <script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/tether.min.js"></script>
    <script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/prism.min.js"></script>

    <script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/bootcamp-1522c7c010.js"></script>
    <script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/jquery.seourl.min.js"></script>
    <script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/perfect-scrollbar.jquery.min.js"></script>
    <script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/jquery.fancybox.min.js"></script>
    <script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/moment.timezone.locales.min.js"></script>
    <script src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/bootstrap-datetimepicker.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $("a.img-modal-group").fancybox();
        });
    </script>

<div class="modal fade" tabindex="-1" role="dialog" id="call-us-modal">
    <div class="modal-dialog modal-dialog-callus" role="document">
        <div class="modal-content call-modal">
            <div id="call-us-step1">
                <h2>Umów się na rozmowę z doradcą Kodilli</h2>
                <p>Krok <span>1/2:</span> Podaj numer telefonu</p>
                <form action="https://kodilla.com/pl/call-center/dates/phone_calls" method="post" id="call-us-form1">
                    <input type="tel" name="phone" id="call-us-input-phone" class="call-center-input" placeholder="731771787">
                    <p class="error-message display-none" id="validation-message-phone">Pole Numer Telefonu jest wymagane. Nieprawidłowy format.</p>
                    <button class="btn btn-success" id="call-us-submit-phone">Zarezerwuj rozmowę</button>
                </form>
                <p id="call-us-counter-holder" style="display: none;">Dzisiaj już  <span id="call-us-counter" class="call-counter" data-url="https://kodilla.com/pl/call-center/counter/phone_calls">-</span> <span id="call-us-counter-text" data-one=" osoba zamówiła rozmowę z nami." data-few=" osoby zamówiły rozmowę z nami." data-more=" osób zamówiło rozmowę z nami."></span></p>
                <div class="data-protection">
                    <p>Twój numer telefonu nie będzie wykorzystywany w celach marketingowych ani przekazany dalej. Tylko oddzwonimy. Dane są przetwarzane zgodnie z <a href="https://kodilla.com/pl/polityka-prywatnosci">Polityką Prywatności</a>.</p>
                </div>
            </div>

            <div id="call-us-step2" style="display: none;">
                <h2>Wybierz dogodny termin i godzinę na rozmowę z doradcą</h2>
                <p>Krok <span>2/2:</span>
                </p><form action="https://kodilla.com/pl/call-center/step2/phone_calls" method="post" id="call-us-form2">
                    <div class="select-date">
                        <select name="date" id="call-us-input-date">
                        </select>
                        <select name="time" id="call-us-input-time">
                        </select>
                    </div>
                    <button class="btn btn-success" id="call-us-submit-call">Oddzwońcie do mnie!</button>
                </form>
            </div>

            <div id="call-us-step3" style="display: none;">
                <div class="thanks">
                    <i class="fa fa-check-circle" aria-hidden="true"></i>
                    <h2>Dziękujemy za zamowienie rozmowy! Do usłyszenia w wybranym terminie!</h2>
                </div>
            </div>
        </div>
    </div>
</div>



                <style type="text/css">
    .embeddedServiceHelpButton .helpButton .uiButton {
        background-color: #1EA71C;
        font-family: "Arial", sans-serif;
    }
    .embeddedServiceHelpButton .helpButton .uiButton:focus {
        outline: 1px solid #1EA71C;
    }
</style>
<script>
    function openChat(){
        $('.helpButtonEnabled').trigger('click');
    }
</script>
<script type="text/javascript" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/esw.min.js"></script>

<script type="text/javascript">
    var initESW = function(gslbBaseURL) {
        let firstName = 'Marek Baberowski'.split(" ")[0];
        let lastName = 'Marek Baberowski'.split(" ")[1];
        console.log(name);
        embedded_svc.settings.displayHelpButton = true;
        embedded_svc.settings.language = '';

        embedded_svc.settings.defaultMinimizedText =  'Skontaktuj się z nami';
        embedded_svc.settings.disabledMinimizedText = ' ';

        embedded_svc.settings.loadingText = 'Ładowanie';
        embedded_svc.settings.storageDomain = 'kodilla.com';

        embedded_svc.settings.prepopulatedPrechatFields = {
            'FirstName': firstName,
            'LastName': lastName,
            'Email': 'm.z.baberowski@gmail.com'
        };
        embedded_svc.settings.offlineSupportMinimizedText = 'Napisz do nas';

        embedded_svc.settings.enabledFeatures = ['LiveAgent'];
        embedded_svc.settings.entryFeature = 'LiveAgent';

        embedded_svc.init(
            'https://kodilla.my.salesforce.com',
            'https://kodillacommunity.force.com',
            gslbBaseURL,
            '00D1i000000VBFH',
            'Support_Kodilla',
            {
                baseLiveAgentContentURL: 'https://c.la1-c2-fra.salesforceliveagent.com/content',
                deploymentId: '5721i00000009s9',
                buttonId: '5731i0000000AJN',
                baseLiveAgentURL: 'https://d.la1-c2-fra.salesforceliveagent.com/chat',
                eswLiveAgentDevName: 'Support_Kodilla',
                isOfflineSupportEnabled: true
            }
        );
    };

    if (!window.embedded_svc) {
        var s = document.createElement('script');
        s.setAttribute('src', 'https://kodilla.my.salesforce.com/embeddedservice/5.0/esw.min.js');
        s.onload = function() {
            initESW(null);
        };
        document.body.appendChild(s);
    } else {
        initESW('https://service.force.com');
    }
</script><script id="common-script" type="text/javascript" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/common.min.js"></script>
        <div data-role="notifications-wrapper" class="notifications-wrapper"></div>
<!-- Facebook Pixel Code -->
    <script>
        setTimeout(function(){
            !function(f,b,e,v,n,t,s)
            {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
                n.callMethod.apply(n,arguments):n.queue.push(arguments)};
                if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
                n.queue=[];t=b.createElement(e);t.async=!0;
                t.src=v;s=b.getElementsByTagName(e)[0];
                s.parentNode.insertBefore(t,s)}(window, document,'script',
                'https://connect.facebook.net/en_US/fbevents.js');
            fbq('init', 389137334769464 );
            fbq('track', 'PageView');
        }, 3000);
    </script>
    <!-- End Facebook Pixel Code -->

    <!-- Google Tag Manager -->
    <script>
        setTimeout(function () {
            (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
                j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
                'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','GTM-KN2WWBH');
        }, 3000);

    </script>
    <!-- End Google Tag Manager -->

    
    

<script id="liveagent-esw-script" type="text/javascript" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/liveagent.esw.min.js"></script><iframe name="_hjRemoteVarsFrame" title="_hjRemoteVarsFrame" id="_hjRemoteVarsFrame" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/box-25a418976ea02a6f393fbbe77cec94bb.html" style="display: none !important; width: 1px !important; height: 1px !important; opacity: 0 !important; pointer-events: none !important;"></iframe><form id="fileUploadForm" enctype="multipart/form-data" method="post" target="fileUploadIframe"><input type="file" id="fileSelector" name="file" style="display: none;"><input name="filename" type="hidden"></form><iframe id="fileUploadIframe" name="fileUploadIframe" title="FileUploadFrame" style="display: none;" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/saved_resource.html"></iframe><iframe id="esw_storage_iframe" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/esw.html" title="Live Chat Metadata" style="display: none;"></iframe><script type="text/javascript" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/EmbeddedServiceConfig.jsonp"></script><script id="invite-esw-script" type="text/javascript" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/invite.esw.min.js"></script><div class="embeddedServiceHelpButton"><div class="helpButton"><button class="helpButtonEnabled uiButton" href="javascript:void(0)"><span class="embeddedServiceIcon" aria-hidden="true" data-icon="" style="display: inline-block;"></span><span class="helpButtonLabel" id="helpButtonSpan" aria-live="polite" aria-atomic="true"><span class="assistiveText">Live chat:</span><span class="message">Napisz do nas</span></span></button></div></div><script id="inert-script" type="text/javascript" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/inert.min.js"></script><script type="text/javascript" src="./Moduł_ 29. MongoDB – baza danych dla backendu_files/EmbeddedServiceConfig(1).jsonp"></script><div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; width: 0px; height: 0px;"><div></div></div></div>
<script type="text/javascript" id="">window._tfa=window._tfa||[];window._tfa.push({notify:"event",name:"page_view",id:1209537});!function(a,b,d,c){document.getElementById(c)||(a.async=1,a.src=d,a.id=c,b.parentNode.insertBefore(a,b))}(document.createElement("script"),document.getElementsByTagName("script")[0],"//cdn.taboola.com/libtrc/unip/1209537/tfa.js","tb_tfa_script");</script>
<noscript>
  <img src="//trc.taboola.com/1209537/log/3/unip?en=page_view" width="0" height="0" style="display:none">
</noscript>


<script type="text/javascript" id="">window._adftrack=Array.isArray(window._adftrack)?window._adftrack:window._adftrack?[window._adftrack]:[];window._adftrack.push({pm:2049944});(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src="https://track.adform.net/serving/scripts/trackpoint/async/";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();</script>
<noscript>
    <p style="margin:0;padding:0;border:0;">
        <img src="https://track.adform.net/Serving/TrackPoint/?pm=2049944" width="1" height="1" alt="">
    </p>
</noscript>

<script type="text/javascript" id="">(function(){window.__insp=window.__insp||[];__insp.push(["wid",794470694]);var c=function(){if("undefined"==typeof window.__inspld){window.__inspld=1;var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.id="inspsync";a.src=("https:"==document.location.protocol?"https":"http")+"://cdn.inspectlet.com/inspectlet.js?wid\x3d794470694\x26r\x3d"+Math.floor((new Date).getTime()/36E5);var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}};setTimeout(c,0)})();</script>
</body></html>